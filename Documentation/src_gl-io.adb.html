<?xml version='1.0' encoding='utf-8'?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN"  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html><head>
  <meta http-equiv="Content-Type" content="application/xhtml+xml; charset=UTF-8" />
  <meta http-equiv="Content-Script-Type" content="text/javascript"/>

  <title>
    File: gl-io.adb
  </title>
  <link rel='stylesheet' href='support/docgen.css' type='text/css'/>
  <link rel='stylesheet' href='support/tags.css' type='text/css'/>
  <script src='support/docgen.js' type='text/javascript' charset='utf-8'></script>
</head>
<body onload="onloadDoc();">

<div id='leftSide'>
  <div id='leftSideInside'>
  <div id='header'>
    <h2 class="button">Documentation</h2>
    <a href='toc.html'><div class="button2">Table of Contents</div></a>

    <a href='tree.html'><div class="button2">Class Inheritance Tree</div></a>

  </div>
  </div>
</div> <!-- leftSide -->

<div class='subprograms'>
  <div class='details'><ol><li id="l1"><pre><span class="comment">--</span> </pre></li>
<li id="l2"><pre> <span class="comment">-- Input:</span> </pre></li>
<li id="l3"><pre> <span class="comment">--   TGA  : Orig. author is Nate Miller (tga.c, 7 - Aug - 1999), vandals1@home.com</span> </pre></li>
<li id="l4"><pre> <span class="comment">--   BMP  : from Gautier&apos;s SVGA.IO package</span> </pre></li>
<li id="l5"><pre> <span class="comment">--</span> </pre></li>
<li id="l6"><pre> <span class="comment">-- Output:</span> </pre></li>
<li id="l7"><pre> <span class="comment">--   BMP  : from http://wiki.delphigl.com/index.php/Screenshot (Delphi)</span> </pre></li>
<li id="l8"><pre> <span class="comment">--   AVI  : from specification, plus re - using the raw bitmap output from BMP</span> </pre></li>
<li id="l9"><pre> </pre></li>
<li id="l10"><pre><span class="keyword">with</span> Ada.Exceptions;                    <span class="keyword">use</span> Ada.Exceptions; </pre></li>
<li id="l11"><pre><span class="keyword">with</span> Ada.Unchecked_Conversion; </pre></li>
<li id="l12"><pre><span class="keyword">with</span> System; </pre></li>
<li id="l13"><pre> </pre></li>
<li id="l14"><pre><span class="keyword">package</span> <span class="keyword">body</span> <span class="droplink">GL.IO<ul><li><a href="gl-io.ads.html#gl-io.ads:45:12" title="To API doc">To API doc</a></li><li><a href="src_gl-io.ads.html#l45" title="To spec">To spec</a></li></ul></span> <span class="keyword">is</span> </pre></li>
<li id="l15"><pre> </pre></li>
<li id="l16"><pre>   <span class="keyword">use</span> Ada.Streams.Stream_IO; </pre></li>
<li id="l17"><pre> </pre></li>
<li id="l18"><pre>   <span class="keyword">type</span> U8  <span class="keyword">is</span> <span class="keyword">mod</span> 2 ** 8;   <span class="keyword">for</span> <a href="src_gl-io.adb.html#l18" title="defined at gl-io.adb:18:9">U8</a>&apos;Size  <span class="keyword">use</span> 8; </pre></li>
<li id="l19"><pre>   <span class="keyword">type</span> U16 <span class="keyword">is</span> <span class="keyword">mod</span> 2 ** 16;  <span class="keyword">for</span> <a href="src_gl-io.adb.html#l19" title="defined at gl-io.adb:19:9">U16</a>&apos;Size <span class="keyword">use</span> 16; </pre></li>
<li id="l20"><pre>   <span class="keyword">type</span> U32 <span class="keyword">is</span> <span class="keyword">mod</span> 2 ** 32;  <span class="keyword">for</span> <a href="src_gl-io.adb.html#l20" title="defined at gl-io.adb:20:9">U32</a>&apos;Size <span class="keyword">use</span> 32; </pre></li>
<li id="l21"><pre> </pre></li>
<li id="l22"><pre>   <span class="keyword">type</span> I32 <span class="keyword">is</span> <span class="keyword">range</span> -2 ** 31 .. 2 ** 31 - 1; <span class="keyword">for</span> <a href="src_gl-io.adb.html#l22" title="defined at gl-io.adb:22:9">I32</a>&apos;Size <span class="keyword">use</span> 32; </pre></li>
<li id="l23"><pre> </pre></li>
<li id="l24"><pre>   not_yet_implemented  : <span class="keyword">exception</span>; </pre></li>
<li id="l25"><pre> </pre></li>
<li id="l26"><pre>   <span class="keyword">function</span> <span class="droplink">to_greyscale_Pixels<ul><li><a href="gl-io.ads.html#gl-io.ads:74:12" title="To API doc">To API doc</a></li><li><a href="src_gl-io.ads.html#l74" title="To spec">To spec</a></li></ul></span> (<span class="droplink">the_Image<ul><li><a href="gl-io.ads.html#gl-io.ads:74:33" title="To API doc">To API doc</a></li><li><a href="src_gl-io.ads.html#l74" title="To spec">To spec</a></li></ul></span> : <span class="droplink">Image<ul><li><a href="gl-io.ads.html#gl-io.ads:59:8" title="To API doc">To API doc</a></li><li><a href="src_gl-io.ads.html#l59" title="To spec">To spec</a></li></ul></span>) <span class="keyword">return</span> <span class="droplink">Byte_Grid<ul><li><a href="gl-io.ads.html#gl-io.ads:57:8" title="To API doc">To API doc</a></li><li><a href="src_gl-io.ads.html#l57" title="To spec">To spec</a></li></ul></span> <span class="keyword">is</span> </pre></li>
<li id="l27"><pre> </pre></li>
<li id="l28"><pre>      the_Grid  : <span class="droplink">Byte_Grid<ul><li><a href="gl-io.ads.html#gl-io.ads:57:8" title="To API doc">To API doc</a></li><li><a href="src_gl-io.ads.html#l57" title="To spec">To spec</a></li></ul></span> (1 .. the_Image.Height, 1 .. the_Image.Width); </pre></li>
<li id="l29"><pre> </pre></li>
<li id="l30"><pre>   <span class="keyword">begin</span> </pre></li>
<li id="l31"><pre>      <span class="keyword">case</span> the_Image.tex_pixel_Format <span class="keyword">is</span> </pre></li>
<li id="l32"><pre>         <span class="keyword">when</span> GL.LUMINANCE =&gt; </pre></li>
<li id="l33"><pre> </pre></li>
<li id="l34"><pre>            <span class="keyword">for</span> Row <span class="keyword">in</span> <a href="src_gl-io.adb.html#l28" title="defined at gl-io.adb:28:7">the_Grid</a>&apos;Range (1) <span class="keyword">loop</span> </pre></li>
<li id="l35"><pre>               <span class="keyword">for</span> Col <span class="keyword">in</span> <a href="src_gl-io.adb.html#l28" title="defined at gl-io.adb:28:7">the_Grid</a>&apos;Range (2) <span class="keyword">loop</span> </pre></li>
<li id="l36"><pre>                  <a href="src_gl-io.adb.html#l28" title="defined at gl-io.adb:28:7">the_Grid</a> (Row, Col) := the_Image.Data.<span class="keyword">all</span> (the_Image.Width * (Row - 1) + Col - 1); </pre></li>
<li id="l37"><pre>               <span class="keyword">end</span> <span class="keyword">loop</span>; </pre></li>
<li id="l38"><pre>            <span class="keyword">end</span> <span class="keyword">loop</span>; </pre></li>
<li id="l39"><pre> </pre></li>
<li id="l40"><pre>         <span class="keyword">when</span> <span class="keyword">others</span> =&gt; </pre></li>
<li id="l41"><pre>            <span class="keyword">raise</span> <a href="src_gl-io.adb.html#l24" title="defined at gl-io.adb:24:4">not_yet_implemented</a>;       <span class="comment">-- tbd : do these</span> </pre></li>
<li id="l42"><pre>      <span class="keyword">end</span> <span class="keyword">case</span>; </pre></li>
<li id="l43"><pre>      <span class="keyword">return</span> <a href="src_gl-io.adb.html#l28" title="defined at gl-io.adb:28:7">the_Grid</a>; </pre></li>
<li id="l44"><pre>   <span class="keyword">end</span> <span class="droplink">to_greyscale_Pixels<ul><li><a href="gl-io.ads.html#gl-io.ads:74:12" title="To API doc">To API doc</a></li><li><a href="src_gl-io.ads.html#l74" title="To spec">To spec</a></li><li><a href="src_gl-io.adb.html#l26" title="To body">To body</a></li></ul></span>; </pre></li>
<li id="l45"><pre> </pre></li>
<li id="l46"><pre>   <span class="keyword">procedure</span> Insert_into_GL (id              : Integer; </pre></li>
<li id="l47"><pre>                             Insert_Size     : Integer; </pre></li>
<li id="l48"><pre>                             width           : Integer; </pre></li>
<li id="l49"><pre>                             height          : Integer; </pre></li>
<li id="l50"><pre>                             texFormat       : <span class="droplink">TexFormatEnm<ul><li><a href="gl.ads.html#gl.ads:2294:9" title="To API doc">To API doc</a></li><li><a href="src_gl.ads.html#l2294" title="To spec">To spec</a></li></ul></span>; </pre></li>
<li id="l51"><pre>                             texPixelFormat  : <span class="droplink">TexPixelFormatEnm<ul><li><a href="gl.ads.html#gl.ads:2382:9" title="To API doc">To API doc</a></li><li><a href="src_gl.ads.html#l2382" title="To spec">To spec</a></li></ul></span>; </pre></li>
<li id="l52"><pre>                             image_p         : <span class="droplink">Byte_Array_Ptr<ul><li><a href="gl-io.ads.html#gl-io.ads:52:8" title="To API doc">To API doc</a></li><li><a href="src_gl-io.ads.html#l52" title="To spec">To spec</a></li></ul></span> </pre></li>
<li id="l53"><pre>                            ) <span class="keyword">is</span> </pre></li>
<li id="l54"><pre>      <span class="keyword">pragma</span> Unreferenced (<a href="src_gl-io.adb.html#l47" title="defined at gl-io.adb:47:30">Insert_Size</a>); </pre></li>
<li id="l55"><pre> </pre></li>
<li id="l56"><pre>      ptr : <span class="keyword">constant</span> <span class="droplink">GL.pointer<ul><li><a href="gl.ads.html#gl.ads:150:9" title="To API doc">To API doc</a></li><li><a href="src_gl.ads.html#l150" title="To spec">To spec</a></li></ul></span> := <a href="src_gl-io.adb.html#l52" title="defined at gl-io.adb:52:30">image_p</a>.<span class="keyword">all</span> (0)&apos;Access; </pre></li>
<li id="l57"><pre> </pre></li>
<li id="l58"><pre>   <span class="keyword">begin</span> </pre></li>
<li id="l59"><pre>      <span class="droplink">BindTexture<ul><li><a href="gl.ads.html#gl.ads:2629:14" title="To API doc">To API doc</a></li><li><a href="src_gl.ads.html#l2629" title="To spec">To spec</a></li><li><a href="src_gl.ads.html#l4408" title="To body">To body</a></li></ul></span> (TEXTURE_2D, <span class="droplink">Uint<ul><li><a href="gl.ads.html#gl.ads:124:9" title="To API doc">To API doc</a></li><li><a href="src_gl.ads.html#l124" title="To spec">To spec</a></li></ul></span> (<a href="src_gl-io.adb.html#l46" title="defined at gl-io.adb:46:30">id</a>)); </pre></li>
<li id="l60"><pre>      <span class="droplink">PixelStore<ul><li><a href="gl.ads.html#gl.ads:2041:14" title="To API doc">To API doc</a></li><li><a href="src_gl.ads.html#l2041" title="To spec">To spec</a></li><li><a href="src_gl.ads.html#l3977" title="To body">To body</a></li></ul></span> (UNPACK_ALIGNMENT, 1); </pre></li>
<li id="l61"><pre>      <span class="droplink">TexParameter<ul><li><a href="gl.ads.html#gl.ads:2568:14" title="To API doc">To API doc</a></li><li><a href="src_gl.ads.html#l2568" title="To spec">To spec</a></li><li><a href="src_gl.ads.html#l4030" title="To body">To body</a></li></ul></span> (TEXTURE_2D, TEXTURE_WRAP_S, <span class="droplink">REPEAT<ul><li><a href="gl.ads.html#gl.ads:2499:4" title="To API doc">To API doc</a></li><li><a href="src_gl.ads.html#l2499" title="To spec">To spec</a></li></ul></span>); </pre></li>
<li id="l62"><pre>      <span class="droplink">TexParameter<ul><li><a href="gl.ads.html#gl.ads:2568:14" title="To API doc">To API doc</a></li><li><a href="src_gl.ads.html#l2568" title="To spec">To spec</a></li><li><a href="src_gl.ads.html#l4030" title="To body">To body</a></li></ul></span> (TEXTURE_2D, TEXTURE_WRAP_T, <span class="droplink">REPEAT<ul><li><a href="gl.ads.html#gl.ads:2499:4" title="To API doc">To API doc</a></li><li><a href="src_gl.ads.html#l2499" title="To spec">To spec</a></li></ul></span>); </pre></li>
<li id="l63"><pre>      <span class="comment">-- TexParameter (TEXTURE_2D, TEXTURE_MAG_FILTER, NEAREST);</span> </pre></li>
<li id="l64"><pre>      <span class="droplink">TexParameter<ul><li><a href="gl.ads.html#gl.ads:2568:14" title="To API doc">To API doc</a></li><li><a href="src_gl.ads.html#l2568" title="To spec">To spec</a></li><li><a href="src_gl.ads.html#l4030" title="To body">To body</a></li></ul></span> (TEXTURE_2D, TEXTURE_MAG_FILTER, <span class="droplink">LINEAR<ul><li><a href="gl.ads.html#gl.ads:3006:4" title="To API doc">To API doc</a></li><li><a href="src_gl.ads.html#l3006" title="To spec">To spec</a></li></ul></span>); </pre></li>
<li id="l65"><pre>      <span class="comment">-- TexParameter (TEXTURE_2D, TEXTURE_MIN_FILTER, NEAREST);</span> </pre></li>
<li id="l66"><pre>      <span class="droplink">TexParameter<ul><li><a href="gl.ads.html#gl.ads:2568:14" title="To API doc">To API doc</a></li><li><a href="src_gl.ads.html#l2568" title="To spec">To spec</a></li><li><a href="src_gl.ads.html#l4030" title="To body">To body</a></li></ul></span> (TEXTURE_2D, TEXTURE_MIN_FILTER, <span class="droplink">LINEAR<ul><li><a href="gl.ads.html#gl.ads:3006:4" title="To API doc">To API doc</a></li><li><a href="src_gl.ads.html#l3006" title="To spec">To spec</a></li></ul></span>); </pre></li>
<li id="l67"><pre>      <span class="droplink">TexEnv<ul><li><a href="gl.ads.html#gl.ads:2544:14" title="To API doc">To API doc</a></li><li><a href="src_gl.ads.html#l2544" title="To spec">To spec</a></li><li><a href="src_gl.ads.html#l4023" title="To body">To body</a></li></ul></span> (TEXTURE_ENV, TEXTURE_ENV_MODE, <span class="droplink">MODULATE<ul><li><a href="gl.ads.html#gl.ads:2497:4" title="To API doc">To API doc</a></li><li><a href="src_gl.ads.html#l2497" title="To spec">To spec</a></li></ul></span>); </pre></li>
<li id="l68"><pre>      <span class="droplink">TexImage2D<ul><li><a href="gl.ads.html#gl.ads:2607:14" title="To API doc">To API doc</a></li><li><a href="src_gl.ads.html#l2607" title="To spec">To spec</a></li><li><a href="src_gl.ads.html#l4404" title="To body">To body</a></li></ul></span> (TEXTURE_2D, 0, <a href="src_gl-io.adb.html#l50" title="defined at gl-io.adb:50:30">texFormat</a>, <span class="droplink">Sizei<ul><li><a href="gl.ads.html#gl.ads:125:9" title="To API doc">To API doc</a></li><li><a href="src_gl.ads.html#l125" title="To spec">To spec</a></li></ul></span> (<a href="src_gl-io.adb.html#l48" title="defined at gl-io.adb:48:30">width</a>), </pre></li>
<li id="l69"><pre>                  <span class="droplink">Sizei<ul><li><a href="gl.ads.html#gl.ads:125:9" title="To API doc">To API doc</a></li><li><a href="src_gl.ads.html#l125" title="To spec">To spec</a></li></ul></span> (<a href="src_gl-io.adb.html#l49" title="defined at gl-io.adb:49:30">height</a>), 0, <a href="src_gl-io.adb.html#l51" title="defined at gl-io.adb:51:30">texPixelFormat</a>, GL_UNSIGNED_BYTE, </pre></li>
<li id="l70"><pre>                  <a href="src_gl-io.adb.html#l56" title="defined at gl-io.adb:56:7">ptr</a>); </pre></li>
<li id="l71"><pre>   <span class="keyword">end</span> <span class="droplink">Insert_into_GL<ul><li><a href="src_gl-io.adb.html#l46" title="To spec">To spec</a></li><li><a href="src_gl-io.adb.html#l46" title="To body">To body</a></li></ul></span>; </pre></li>
<li id="l72"><pre> </pre></li>
<li id="l73"><pre>   <span class="comment">-- Workaround for the severe xxx&apos;Read xxx&apos;Write performance</span> </pre></li>
<li id="l74"><pre>   <span class="comment">-- problems in the GNAT and ObjectAda compilers (as in 2009)</span> </pre></li>
<li id="l75"><pre>   <span class="comment">-- This is possible if and only if Byte = Stream_Element and</span> </pre></li>
<li id="l76"><pre>   <span class="comment">-- arrays types are both packed the same way.</span> </pre></li>
<li id="l77"><pre>   <span class="comment">--</span> </pre></li>
<li id="l78"><pre>   <span class="keyword">subtype</span> Size_test_a <span class="keyword">is</span> <span class="droplink">Byte_Array<ul><li><a href="gl-io.ads.html#gl-io.ads:51:8" title="To API doc">To API doc</a></li><li><a href="src_gl-io.ads.html#l51" title="To spec">To spec</a></li></ul></span> (1 .. 19); </pre></li>
<li id="l79"><pre>   <span class="keyword">subtype</span> Size_test_b <span class="keyword">is</span> Ada.Streams.Stream_Element_Array (1 .. 19); </pre></li>
<li id="l80"><pre>   workaround_possible : <span class="keyword">constant</span> Boolean := </pre></li>
<li id="l81"><pre>     <a href="src_gl-io.adb.html#l78" title="defined at gl-io.adb:78:12">Size_test_a</a>&apos;Size = <a href="src_gl-io.adb.html#l79" title="defined at gl-io.adb:79:12">Size_test_b</a>&apos;Size <span class="keyword">and</span> <span class="keyword">then</span> </pre></li>
<li id="l82"><pre>     <a href="src_gl-io.adb.html#l78" title="defined at gl-io.adb:78:12">Size_test_a</a>&apos;Alignment = <a href="src_gl-io.adb.html#l79" title="defined at gl-io.adb:79:12">Size_test_b</a>&apos;Alignment; </pre></li>
<li id="l83"><pre>   <span class="comment">--</span> </pre></li>
<li id="l84"><pre> </pre></li>
<li id="l85"><pre>   <span class="keyword">procedure</span> <a href="src_gl-io.adb.html#l89" title="defined at gl-io.adb:85:14">Fill_Buffer</a> (<a href="src_gl-io.adb.html#l89" title="defined at gl-io.adb:85:27">b</a> : <span class="keyword">in</span> <span class="keyword">out</span> <span class="droplink">Input_buffer<ul><li><a href="gl-io.ads.html#gl-io.ads:145:8" title="To API doc">To API doc</a></li><li><a href="src_gl-io.ads.html#l145" title="To spec">To spec</a></li><li><a href="src_gl-io.ads.html#l155" title="To body">To body</a></li></ul></span>); </pre></li>
<li id="l86"><pre>   <span class="comment">-- ^ Spec here to avoid in Get_Byte below (GNAT 2009):</span> </pre></li>
<li id="l87"><pre>   <span class="comment">-- warning : call to subprogram with no separate spec prevents inlining</span> </pre></li>
<li id="l88"><pre> </pre></li>
<li id="l89"><pre>   <span class="keyword">procedure</span> <a href="src_gl-io.adb.html#l85" title="defined at gl-io.adb:85:14">Fill_Buffer</a> (<a href="src_gl-io.adb.html#l85" title="defined at gl-io.adb:85:27">b</a> : <span class="keyword">in</span> <span class="keyword">out</span> <span class="droplink">Input_buffer<ul><li><a href="gl-io.ads.html#gl-io.ads:145:8" title="To API doc">To API doc</a></li><li><a href="src_gl-io.ads.html#l145" title="To spec">To spec</a></li><li><a href="src_gl-io.ads.html#l155" title="To body">To body</a></li></ul></span>) </pre></li>
<li id="l90"><pre>   <span class="keyword">is</span> </pre></li>
<li id="l91"><pre>      <span class="comment">--</span> </pre></li>
<li id="l92"><pre>      <span class="keyword">procedure</span> BlockRead ( </pre></li>
<li id="l93"><pre>                           buffer        :    <span class="keyword">out</span> <span class="droplink">Byte_Array<ul><li><a href="gl-io.ads.html#gl-io.ads:51:8" title="To API doc">To API doc</a></li><li><a href="src_gl-io.ads.html#l51" title="To spec">To spec</a></li></ul></span>; </pre></li>
<li id="l94"><pre>                           actually_read :    <span class="keyword">out</span> Natural </pre></li>
<li id="l95"><pre>                          ) </pre></li>
<li id="l96"><pre>      <span class="keyword">is</span> </pre></li>
<li id="l97"><pre>         <span class="keyword">use</span> Ada.Streams; </pre></li>
<li id="l98"><pre>         Last_Read : Stream_Element_Offset; </pre></li>
<li id="l99"><pre>      <span class="keyword">begin</span> </pre></li>
<li id="l100"><pre>         <span class="keyword">if</span> <a href="src_gl-io.adb.html#l80" title="defined at gl-io.adb:80:4">workaround_possible</a> <span class="keyword">then</span> </pre></li>
<li id="l101"><pre>            <span class="keyword">declare</span> </pre></li>
<li id="l102"><pre>               SE_Buffer : Stream_Element_Array (1 .. buffer&apos;Length); </pre></li>
<li id="l103"><pre>               <span class="comment">-- direct mapping : buffer = SE_Buffer</span> </pre></li>
<li id="l104"><pre>               <span class="keyword">for</span> SE_Buffer&apos;Address <span class="keyword">use</span> buffer&apos;Address; </pre></li>
<li id="l105"><pre>               <span class="keyword">pragma</span> Import (Ada, SE_Buffer); </pre></li>
<li id="l106"><pre>            <span class="keyword">begin</span> </pre></li>
<li id="l107"><pre>               Read (b.stm.<span class="keyword">all</span>, SE_Buffer, Last_Read); </pre></li>
<li id="l108"><pre>            <span class="keyword">end</span>; </pre></li>
<li id="l109"><pre>         <span class="keyword">else</span> </pre></li>
<li id="l110"><pre>            <span class="keyword">declare</span> </pre></li>
<li id="l111"><pre>               SE_Buffer : Stream_Element_Array (1 .. buffer&apos;Length); </pre></li>
<li id="l112"><pre>               <span class="comment">-- need to copy array</span> </pre></li>
<li id="l113"><pre>            <span class="keyword">begin</span> </pre></li>
<li id="l114"><pre>               Read (b.stm.<span class="keyword">all</span>, SE_Buffer, Last_Read); </pre></li>
<li id="l115"><pre>               <span class="keyword">for</span> i <span class="keyword">in</span> buffer&apos;Range <span class="keyword">loop</span> </pre></li>
<li id="l116"><pre>                  buffer (i) := <span class="droplink">Ubyte<ul><li><a href="gl.ads.html#gl.ads:122:9" title="To API doc">To API doc</a></li><li><a href="src_gl.ads.html#l122" title="To spec">To spec</a></li></ul></span> (SE_Buffer (Stream_Element_Offset (i - buffer&apos;First) + SE_Buffer&apos;First)); </pre></li>
<li id="l117"><pre>               <span class="keyword">end</span> <span class="keyword">loop</span>; </pre></li>
<li id="l118"><pre>            <span class="keyword">end</span>; </pre></li>
<li id="l119"><pre>         <span class="keyword">end</span> <span class="keyword">if</span>; </pre></li>
<li id="l120"><pre>         actually_read := Natural (Last_Read); </pre></li>
<li id="l121"><pre>      <span class="keyword">end</span> BlockRead; </pre></li>
<li id="l122"><pre> </pre></li>
<li id="l123"><pre>   <span class="keyword">begin</span> </pre></li>
<li id="l124"><pre>      BlockRead ( </pre></li>
<li id="l125"><pre>                 buffer        =&gt; b.data, </pre></li>
<li id="l126"><pre>                 actually_read =&gt; b.MaxInBufIdx </pre></li>
<li id="l127"><pre>                ); </pre></li>
<li id="l128"><pre>      b.InputEoF := b.MaxInBufIdx = 0; </pre></li>
<li id="l129"><pre>      b.InBufIdx := 1; </pre></li>
<li id="l130"><pre>   <span class="keyword">end</span> <span class="droplink">Fill_Buffer<ul><li><a href="src_gl-io.adb.html#l85" title="To spec">To spec</a></li><li><a href="src_gl-io.adb.html#l89" title="To body">To body</a></li></ul></span>; </pre></li>
<li id="l131"><pre> </pre></li>
<li id="l132"><pre>   <span class="keyword">procedure</span> <span class="droplink">Attach_Stream<ul><li><a href="gl-io.ads.html#gl-io.ads:147:13" title="To API doc">To API doc</a></li><li><a href="src_gl-io.ads.html#l147" title="To spec">To spec</a></li></ul></span> (<span class="droplink">b<ul><li><a href="gl-io.ads.html#gl-io.ads:147:28" title="To API doc">To API doc</a></li><li><a href="src_gl-io.ads.html#l147" title="To spec">To spec</a></li></ul></span>    : <span class="keyword">out</span> <span class="droplink">Input_buffer<ul><li><a href="gl-io.ads.html#gl-io.ads:145:8" title="To API doc">To API doc</a></li><li><a href="src_gl-io.ads.html#l145" title="To spec">To spec</a></li><li><a href="src_gl-io.ads.html#l155" title="To body">To body</a></li></ul></span>; </pre></li>
<li id="l133"><pre>                            <span class="droplink">stm<ul><li><a href="gl-io.ads.html#gl-io.ads:148:28" title="To API doc">To API doc</a></li><li><a href="src_gl-io.ads.html#l148" title="To spec">To spec</a></li></ul></span>  :     Ada.Streams.Stream_IO.Stream_Access) <span class="keyword">is</span> </pre></li>
<li id="l134"><pre> </pre></li>
<li id="l135"><pre>   <span class="keyword">begin</span> </pre></li>
<li id="l136"><pre>      b.stm := <span class="droplink">stm<ul><li><a href="gl-io.ads.html#gl-io.ads:148:28" title="To API doc">To API doc</a></li><li><a href="src_gl-io.ads.html#l148" title="To spec">To spec</a></li></ul></span>; </pre></li>
<li id="l137"><pre>      <span class="droplink">Fill_Buffer<ul><li><a href="src_gl-io.adb.html#l85" title="To spec">To spec</a></li><li><a href="src_gl-io.adb.html#l89" title="To body">To body</a></li></ul></span> (<span class="droplink">b<ul><li><a href="gl-io.ads.html#gl-io.ads:147:28" title="To API doc">To API doc</a></li><li><a href="src_gl-io.ads.html#l147" title="To spec">To spec</a></li><li><a href="src_gl-io.adb.html#l132" title="To body">To body</a></li></ul></span>); </pre></li>
<li id="l138"><pre>   <span class="keyword">end</span> <span class="droplink">Attach_Stream<ul><li><a href="gl-io.ads.html#gl-io.ads:147:13" title="To API doc">To API doc</a></li><li><a href="src_gl-io.ads.html#l147" title="To spec">To spec</a></li><li><a href="src_gl-io.adb.html#l132" title="To body">To body</a></li></ul></span>; </pre></li>
<li id="l139"><pre> </pre></li>
<li id="l140"><pre>   <span class="keyword">procedure</span> <span class="droplink">Get_Byte<ul><li><a href="gl-io.ads.html#gl-io.ads:150:13" title="To API doc">To API doc</a></li><li><a href="src_gl-io.ads.html#l150" title="To spec">To spec</a></li></ul></span> (<span class="droplink">b<ul><li><a href="gl-io.ads.html#gl-io.ads:150:23" title="To API doc">To API doc</a></li><li><a href="src_gl-io.ads.html#l150" title="To spec">To spec</a></li></ul></span> : <span class="keyword">in</span> <span class="keyword">out</span> <span class="droplink">Input_buffer<ul><li><a href="gl-io.ads.html#gl-io.ads:145:8" title="To API doc">To API doc</a></li><li><a href="src_gl-io.ads.html#l145" title="To spec">To spec</a></li><li><a href="src_gl-io.ads.html#l155" title="To body">To body</a></li></ul></span>; <span class="droplink">Return_Byte<ul><li><a href="gl-io.ads.html#gl-io.ads:150:48" title="To API doc">To API doc</a></li><li><a href="src_gl-io.ads.html#l150" title="To spec">To spec</a></li></ul></span> : <span class="keyword">out</span> <span class="droplink">Ubyte<ul><li><a href="gl.ads.html#gl.ads:122:9" title="To API doc">To API doc</a></li><li><a href="src_gl.ads.html#l122" title="To spec">To spec</a></li></ul></span>) <span class="keyword">is</span> </pre></li>
<li id="l141"><pre> </pre></li>
<li id="l142"><pre>   <span class="keyword">begin</span> </pre></li>
<li id="l143"><pre>      <span class="keyword">if</span> b.InBufIdx &gt; b.MaxInBufIdx <span class="keyword">then</span> </pre></li>
<li id="l144"><pre>         <span class="droplink">Fill_Buffer<ul><li><a href="src_gl-io.adb.html#l85" title="To spec">To spec</a></li><li><a href="src_gl-io.adb.html#l89" title="To body">To body</a></li></ul></span> (<span class="droplink">b<ul><li><a href="gl-io.ads.html#gl-io.ads:150:23" title="To API doc">To API doc</a></li><li><a href="src_gl-io.ads.html#l150" title="To spec">To spec</a></li><li><a href="src_gl-io.adb.html#l140" title="To body">To body</a></li></ul></span>); </pre></li>
<li id="l145"><pre>         <span class="keyword">if</span> b.InputEoF <span class="keyword">then</span> </pre></li>
<li id="l146"><pre>            <span class="keyword">raise</span> End_Error; </pre></li>
<li id="l147"><pre>         <span class="keyword">end</span> <span class="keyword">if</span>; </pre></li>
<li id="l148"><pre>      <span class="keyword">end</span> <span class="keyword">if</span>; </pre></li>
<li id="l149"><pre>      <span class="droplink">Return_Byte<ul><li><a href="gl-io.ads.html#gl-io.ads:150:48" title="To API doc">To API doc</a></li><li><a href="src_gl-io.ads.html#l150" title="To spec">To spec</a></li></ul></span> := b.data (b.InBufIdx); </pre></li>
<li id="l150"><pre>      b.InBufIdx := b.InBufIdx + 1; </pre></li>
<li id="l151"><pre>   <span class="keyword">end</span> <span class="droplink">Get_Byte<ul><li><a href="gl-io.ads.html#gl-io.ads:150:13" title="To API doc">To API doc</a></li><li><a href="src_gl-io.ads.html#l150" title="To spec">To spec</a></li><li><a href="src_gl-io.adb.html#l140" title="To body">To body</a></li></ul></span>; </pre></li>
<li id="l152"><pre> </pre></li>
<li id="l153"><pre>   <span class="keyword">function</span> <span class="droplink">To_TGA_Image<ul><li><a href="gl-io.ads.html#gl-io.ads:72:12" title="To API doc">To API doc</a></li><li><a href="src_gl-io.ads.html#l72" title="To spec">To spec</a></li></ul></span> (<span class="droplink">S<ul><li><a href="gl-io.ads.html#gl-io.ads:72:26" title="To API doc">To API doc</a></li><li><a href="src_gl-io.ads.html#l72" title="To spec">To spec</a></li></ul></span>  :  Ada.Streams.Stream_IO.Stream_Access) <span class="keyword">return</span> <span class="droplink">Image<ul><li><a href="gl-io.ads.html#gl-io.ads:59:8" title="To API doc">To API doc</a></li><li><a href="src_gl-io.ads.html#l59" title="To spec">To spec</a></li></ul></span> <span class="keyword">is</span> </pre></li>
<li id="l154"><pre> </pre></li>
<li id="l155"><pre>      the_Image  : <span class="droplink">Image<ul><li><a href="gl-io.ads.html#gl-io.ads:59:8" title="To API doc">To API doc</a></li><li><a href="src_gl-io.ads.html#l59" title="To spec">To spec</a></li></ul></span>; </pre></li>
<li id="l156"><pre>      stream_buf : <span class="droplink">Input_buffer<ul><li><a href="gl-io.ads.html#gl-io.ads:145:8" title="To API doc">To API doc</a></li><li><a href="src_gl-io.ads.html#l145" title="To spec">To spec</a></li><li><a href="src_gl-io.ads.html#l155" title="To body">To body</a></li></ul></span>; </pre></li>
<li id="l157"><pre> </pre></li>
<li id="l158"><pre>      <span class="comment">-- Run Length Encoding --</span> </pre></li>
<li id="l159"><pre>      RLE : Boolean; </pre></li>
<li id="l160"><pre>      RLE_pixels_remaining : Natural := 0; </pre></li>
<li id="l161"><pre>      pix_mem : <span class="droplink">Byte_Array<ul><li><a href="gl-io.ads.html#gl-io.ads:51:8" title="To API doc">To API doc</a></li><li><a href="src_gl-io.ads.html#l51" title="To spec">To spec</a></li></ul></span> (1 .. 4); </pre></li>
<li id="l162"><pre>      is_run_packet : Boolean; </pre></li>
<li id="l163"><pre> </pre></li>
<li id="l164"><pre>      <span class="keyword">procedure</span> RLE_Pixel (iBits : Integer; pix : <span class="keyword">out</span> <span class="droplink">Byte_Array<ul><li><a href="gl-io.ads.html#gl-io.ads:51:8" title="To API doc">To API doc</a></li><li><a href="src_gl-io.ads.html#l51" title="To spec">To spec</a></li></ul></span>) <span class="keyword">is</span> </pre></li>
<li id="l165"><pre> </pre></li>
<li id="l166"><pre>         <span class="keyword">procedure</span> Get_pixel <span class="keyword">is</span> </pre></li>
<li id="l167"><pre> </pre></li>
<li id="l168"><pre>         <span class="keyword">begin</span> </pre></li>
<li id="l169"><pre>            <span class="keyword">case</span> <a href="src_gl-io.adb.html#l164" title="defined at gl-io.adb:164:28">iBits</a> <span class="keyword">is</span> </pre></li>
<li id="l170"><pre>            <span class="keyword">when</span> 32 =&gt; <span class="comment">-- BGRA</span> </pre></li>
<li id="l171"><pre>               <span class="droplink">Get_Byte<ul><li><a href="gl-io.ads.html#gl-io.ads:150:13" title="To API doc">To API doc</a></li><li><a href="src_gl-io.ads.html#l150" title="To spec">To spec</a></li><li><a href="src_gl-io.adb.html#l140" title="To body">To body</a></li></ul></span> (<a href="src_gl-io.adb.html#l156" title="defined at gl-io.adb:156:7">stream_buf</a>, <a href="src_gl-io.adb.html#l164" title="defined at gl-io.adb:164:45">pix</a> (<a href="src_gl-io.adb.html#l164" title="defined at gl-io.adb:164:45">pix</a>&apos;First + 2)); </pre></li>
<li id="l172"><pre>               <span class="droplink">Get_Byte<ul><li><a href="gl-io.ads.html#gl-io.ads:150:13" title="To API doc">To API doc</a></li><li><a href="src_gl-io.ads.html#l150" title="To spec">To spec</a></li><li><a href="src_gl-io.adb.html#l140" title="To body">To body</a></li></ul></span> (<a href="src_gl-io.adb.html#l156" title="defined at gl-io.adb:156:7">stream_buf</a>, <a href="src_gl-io.adb.html#l164" title="defined at gl-io.adb:164:45">pix</a> (<a href="src_gl-io.adb.html#l164" title="defined at gl-io.adb:164:45">pix</a>&apos;First + 1)); </pre></li>
<li id="l173"><pre>               <span class="droplink">Get_Byte<ul><li><a href="gl-io.ads.html#gl-io.ads:150:13" title="To API doc">To API doc</a></li><li><a href="src_gl-io.ads.html#l150" title="To spec">To spec</a></li><li><a href="src_gl-io.adb.html#l140" title="To body">To body</a></li></ul></span> (<a href="src_gl-io.adb.html#l156" title="defined at gl-io.adb:156:7">stream_buf</a>, <a href="src_gl-io.adb.html#l164" title="defined at gl-io.adb:164:45">pix</a> (<a href="src_gl-io.adb.html#l164" title="defined at gl-io.adb:164:45">pix</a>&apos;First)); </pre></li>
<li id="l174"><pre>               <span class="droplink">Get_Byte<ul><li><a href="gl-io.ads.html#gl-io.ads:150:13" title="To API doc">To API doc</a></li><li><a href="src_gl-io.ads.html#l150" title="To spec">To spec</a></li><li><a href="src_gl-io.adb.html#l140" title="To body">To body</a></li></ul></span> (<a href="src_gl-io.adb.html#l156" title="defined at gl-io.adb:156:7">stream_buf</a>, <a href="src_gl-io.adb.html#l164" title="defined at gl-io.adb:164:45">pix</a> (<a href="src_gl-io.adb.html#l164" title="defined at gl-io.adb:164:45">pix</a>&apos;First + 3)); </pre></li>
<li id="l175"><pre>            <span class="keyword">when</span> 24 =&gt; <span class="comment">-- BGR</span> </pre></li>
<li id="l176"><pre>               <span class="droplink">Get_Byte<ul><li><a href="gl-io.ads.html#gl-io.ads:150:13" title="To API doc">To API doc</a></li><li><a href="src_gl-io.ads.html#l150" title="To spec">To spec</a></li><li><a href="src_gl-io.adb.html#l140" title="To body">To body</a></li></ul></span> (<a href="src_gl-io.adb.html#l156" title="defined at gl-io.adb:156:7">stream_buf</a>, <a href="src_gl-io.adb.html#l164" title="defined at gl-io.adb:164:45">pix</a> (<a href="src_gl-io.adb.html#l164" title="defined at gl-io.adb:164:45">pix</a>&apos;First + 2)); </pre></li>
<li id="l177"><pre>               <span class="droplink">Get_Byte<ul><li><a href="gl-io.ads.html#gl-io.ads:150:13" title="To API doc">To API doc</a></li><li><a href="src_gl-io.ads.html#l150" title="To spec">To spec</a></li><li><a href="src_gl-io.adb.html#l140" title="To body">To body</a></li></ul></span> (<a href="src_gl-io.adb.html#l156" title="defined at gl-io.adb:156:7">stream_buf</a>, <a href="src_gl-io.adb.html#l164" title="defined at gl-io.adb:164:45">pix</a> (<a href="src_gl-io.adb.html#l164" title="defined at gl-io.adb:164:45">pix</a>&apos;First + 1)); </pre></li>
<li id="l178"><pre>               <span class="droplink">Get_Byte<ul><li><a href="gl-io.ads.html#gl-io.ads:150:13" title="To API doc">To API doc</a></li><li><a href="src_gl-io.ads.html#l150" title="To spec">To spec</a></li><li><a href="src_gl-io.adb.html#l140" title="To body">To body</a></li></ul></span> (<a href="src_gl-io.adb.html#l156" title="defined at gl-io.adb:156:7">stream_buf</a>, <a href="src_gl-io.adb.html#l164" title="defined at gl-io.adb:164:45">pix</a> (<a href="src_gl-io.adb.html#l164" title="defined at gl-io.adb:164:45">pix</a>&apos;First)); </pre></li>
<li id="l179"><pre>            <span class="keyword">when</span> 8  =&gt; <span class="comment">-- Grey</span> </pre></li>
<li id="l180"><pre>               <span class="droplink">Get_Byte<ul><li><a href="gl-io.ads.html#gl-io.ads:150:13" title="To API doc">To API doc</a></li><li><a href="src_gl-io.ads.html#l150" title="To spec">To spec</a></li><li><a href="src_gl-io.adb.html#l140" title="To body">To body</a></li></ul></span> (<a href="src_gl-io.adb.html#l156" title="defined at gl-io.adb:156:7">stream_buf</a>, <a href="src_gl-io.adb.html#l164" title="defined at gl-io.adb:164:45">pix</a> (<a href="src_gl-io.adb.html#l164" title="defined at gl-io.adb:164:45">pix</a>&apos;First)); </pre></li>
<li id="l181"><pre>            <span class="keyword">when</span> <span class="keyword">others</span> =&gt; </pre></li>
<li id="l182"><pre>               <span class="keyword">null</span>; </pre></li>
<li id="l183"><pre>            <span class="keyword">end</span> <span class="keyword">case</span>; </pre></li>
<li id="l184"><pre>         <span class="keyword">end</span> <span class="droplink">Get_pixel<ul><li><a href="src_gl-io.adb.html#l166" title="To spec">To spec</a></li><li><a href="src_gl-io.adb.html#l166" title="To body">To body</a></li></ul></span>; </pre></li>
<li id="l185"><pre> </pre></li>
<li id="l186"><pre>         tmp : <span class="droplink">GL.Ubyte<ul><li><a href="gl.ads.html#gl.ads:122:9" title="To API doc">To API doc</a></li><li><a href="src_gl.ads.html#l122" title="To spec">To spec</a></li></ul></span>; </pre></li>
<li id="l187"><pre> </pre></li>
<li id="l188"><pre>      <span class="keyword">begin</span> <span class="comment">--  RLE_Pixel</span> </pre></li>
<li id="l189"><pre>         <span class="keyword">if</span> <a href="src_gl-io.adb.html#l160" title="defined at gl-io.adb:160:7">RLE_pixels_remaining</a> = 0 <span class="keyword">then</span> <span class="comment">-- load RLE code</span> </pre></li>
<li id="l190"><pre>            <span class="droplink">Get_Byte<ul><li><a href="gl-io.ads.html#gl-io.ads:150:13" title="To API doc">To API doc</a></li><li><a href="src_gl-io.ads.html#l150" title="To spec">To spec</a></li><li><a href="src_gl-io.adb.html#l140" title="To body">To body</a></li></ul></span> (<a href="src_gl-io.adb.html#l156" title="defined at gl-io.adb:156:7">stream_buf</a>, <a href="src_gl-io.adb.html#l186" title="defined at gl-io.adb:186:10">tmp</a>); </pre></li>
<li id="l191"><pre>            <span class="droplink">Get_pixel<ul><li><a href="src_gl-io.adb.html#l166" title="To spec">To spec</a></li><li><a href="src_gl-io.adb.html#l166" title="To body">To body</a></li></ul></span>; </pre></li>
<li id="l192"><pre>            <a href="src_gl-io.adb.html#l160" title="defined at gl-io.adb:160:7">RLE_pixels_remaining</a> := <span class="droplink">GL.Ubyte<ul><li><a href="gl.ads.html#gl.ads:122:9" title="To API doc">To API doc</a></li><li><a href="src_gl.ads.html#l122" title="To spec">To spec</a></li></ul></span>&apos;Pos (<a href="src_gl-io.adb.html#l186" title="defined at gl-io.adb:186:10">tmp</a> <span class="keyword">and</span> 16#7F#); </pre></li>
<li id="l193"><pre>            <a href="src_gl-io.adb.html#l162" title="defined at gl-io.adb:162:7">is_run_packet</a> := (<a href="src_gl-io.adb.html#l186" title="defined at gl-io.adb:186:10">tmp</a> <span class="keyword">and</span> 16#80#) /= 0; </pre></li>
<li id="l194"><pre>            <span class="keyword">if</span> <a href="src_gl-io.adb.html#l162" title="defined at gl-io.adb:162:7">is_run_packet</a> <span class="keyword">then</span> </pre></li>
<li id="l195"><pre>               <span class="keyword">case</span> <a href="src_gl-io.adb.html#l164" title="defined at gl-io.adb:164:28">iBits</a> <span class="keyword">is</span> </pre></li>
<li id="l196"><pre>               <span class="keyword">when</span> 32 =&gt; </pre></li>
<li id="l197"><pre>                  <a href="src_gl-io.adb.html#l161" title="defined at gl-io.adb:161:7">pix_mem</a> (1 .. 4) := <a href="src_gl-io.adb.html#l164" title="defined at gl-io.adb:164:45">pix</a>; </pre></li>
<li id="l198"><pre>               <span class="keyword">when</span> 24 =&gt; </pre></li>
<li id="l199"><pre>                  <a href="src_gl-io.adb.html#l161" title="defined at gl-io.adb:161:7">pix_mem</a> (1 .. 3) := <a href="src_gl-io.adb.html#l164" title="defined at gl-io.adb:164:45">pix</a>; </pre></li>
<li id="l200"><pre>               <span class="keyword">when</span> 8  =&gt; </pre></li>
<li id="l201"><pre>                  <a href="src_gl-io.adb.html#l161" title="defined at gl-io.adb:161:7">pix_mem</a> (1 .. 1) := <a href="src_gl-io.adb.html#l164" title="defined at gl-io.adb:164:45">pix</a>; </pre></li>
<li id="l202"><pre>               <span class="keyword">when</span> <span class="keyword">others</span> =&gt; </pre></li>
<li id="l203"><pre>                  <span class="keyword">null</span>; </pre></li>
<li id="l204"><pre>               <span class="keyword">end</span> <span class="keyword">case</span>; </pre></li>
<li id="l205"><pre>            <span class="keyword">end</span> <span class="keyword">if</span>; </pre></li>
<li id="l206"><pre>         <span class="keyword">else</span> </pre></li>
<li id="l207"><pre>            <span class="keyword">if</span> <a href="src_gl-io.adb.html#l162" title="defined at gl-io.adb:162:7">is_run_packet</a> <span class="keyword">then</span> </pre></li>
<li id="l208"><pre>               <span class="keyword">case</span> <a href="src_gl-io.adb.html#l164" title="defined at gl-io.adb:164:28">iBits</a> <span class="keyword">is</span> </pre></li>
<li id="l209"><pre>               <span class="keyword">when</span> 32 =&gt; </pre></li>
<li id="l210"><pre>                  <a href="src_gl-io.adb.html#l164" title="defined at gl-io.adb:164:45">pix</a> := <a href="src_gl-io.adb.html#l161" title="defined at gl-io.adb:161:7">pix_mem</a> (1 .. 4); </pre></li>
<li id="l211"><pre>               <span class="keyword">when</span> 24 =&gt; </pre></li>
<li id="l212"><pre>                  <a href="src_gl-io.adb.html#l164" title="defined at gl-io.adb:164:45">pix</a> := <a href="src_gl-io.adb.html#l161" title="defined at gl-io.adb:161:7">pix_mem</a> (1 .. 3); </pre></li>
<li id="l213"><pre>               <span class="keyword">when</span> 8  =&gt; </pre></li>
<li id="l214"><pre>                  <a href="src_gl-io.adb.html#l164" title="defined at gl-io.adb:164:45">pix</a> := <a href="src_gl-io.adb.html#l161" title="defined at gl-io.adb:161:7">pix_mem</a> (1 .. 1); </pre></li>
<li id="l215"><pre>               <span class="keyword">when</span> <span class="keyword">others</span> =&gt; </pre></li>
<li id="l216"><pre>                  <span class="keyword">null</span>; </pre></li>
<li id="l217"><pre>               <span class="keyword">end</span> <span class="keyword">case</span>; </pre></li>
<li id="l218"><pre>            <span class="keyword">else</span> </pre></li>
<li id="l219"><pre>               <span class="droplink">Get_pixel<ul><li><a href="src_gl-io.adb.html#l166" title="To spec">To spec</a></li><li><a href="src_gl-io.adb.html#l166" title="To body">To body</a></li></ul></span>; </pre></li>
<li id="l220"><pre>            <span class="keyword">end</span> <span class="keyword">if</span>; </pre></li>
<li id="l221"><pre>            <a href="src_gl-io.adb.html#l160" title="defined at gl-io.adb:160:7">RLE_pixels_remaining</a> := <a href="src_gl-io.adb.html#l160" title="defined at gl-io.adb:160:7">RLE_pixels_remaining</a> - 1; </pre></li>
<li id="l222"><pre>         <span class="keyword">end</span> <span class="keyword">if</span>; </pre></li>
<li id="l223"><pre>      <span class="keyword">end</span> <span class="droplink">RLE_Pixel<ul><li><a href="src_gl-io.adb.html#l164" title="To spec">To spec</a></li><li><a href="src_gl-io.adb.html#l164" title="To body">To body</a></li></ul></span>; </pre></li>
<li id="l224"><pre> </pre></li>
<li id="l225"><pre>      <span class="comment">--  =============</span> </pre></li>
<li id="l226"><pre>      <span class="comment">--  getRGBA</span> </pre></li>
<li id="l227"><pre> </pre></li>
<li id="l228"><pre>      <span class="comment">--  Reads in RGBA data for a 32bit image.</span> </pre></li>
<li id="l229"><pre>      <span class="comment">--  =============</span> </pre></li>
<li id="l230"><pre> </pre></li>
<li id="l231"><pre>      <span class="keyword">procedure</span> getRGBA (buffer : <span class="keyword">out</span> <span class="droplink">Byte_Array<ul><li><a href="gl-io.ads.html#gl-io.ads:51:8" title="To API doc">To API doc</a></li><li><a href="src_gl-io.ads.html#l51" title="To spec">To spec</a></li></ul></span>) <span class="keyword">is</span> </pre></li>
<li id="l232"><pre>         i : Integer := <a href="src_gl-io.adb.html#l231" title="defined at gl-io.adb:231:26">buffer</a>&apos;First; </pre></li>
<li id="l233"><pre>      <span class="keyword">begin</span> </pre></li>
<li id="l234"><pre>         <span class="keyword">if</span> <a href="src_gl-io.adb.html#l159" title="defined at gl-io.adb:159:7">RLE</a> <span class="keyword">then</span> </pre></li>
<li id="l235"><pre>            <span class="keyword">while</span> <a href="src_gl-io.adb.html#l232" title="defined at gl-io.adb:232:10">i</a> &lt;= <a href="src_gl-io.adb.html#l231" title="defined at gl-io.adb:231:26">buffer</a>&apos;Last - 3 <span class="keyword">loop</span> </pre></li>
<li id="l236"><pre>               <span class="droplink">RLE_Pixel<ul><li><a href="src_gl-io.adb.html#l164" title="To spec">To spec</a></li><li><a href="src_gl-io.adb.html#l164" title="To body">To body</a></li></ul></span> (32, <a href="src_gl-io.adb.html#l231" title="defined at gl-io.adb:231:26">buffer</a> (<a href="src_gl-io.adb.html#l232" title="defined at gl-io.adb:232:10">i</a> .. <a href="src_gl-io.adb.html#l232" title="defined at gl-io.adb:232:10">i</a> + 3)); </pre></li>
<li id="l237"><pre>               <a href="src_gl-io.adb.html#l232" title="defined at gl-io.adb:232:10">i</a> := <a href="src_gl-io.adb.html#l232" title="defined at gl-io.adb:232:10">i</a> + 4; </pre></li>
<li id="l238"><pre>            <span class="keyword">end</span> <span class="keyword">loop</span>; </pre></li>
<li id="l239"><pre>         <span class="keyword">else</span> </pre></li>
<li id="l240"><pre>            <span class="keyword">while</span> <a href="src_gl-io.adb.html#l232" title="defined at gl-io.adb:232:10">i</a> &lt;= <a href="src_gl-io.adb.html#l231" title="defined at gl-io.adb:231:26">buffer</a>&apos;Last - 3 <span class="keyword">loop</span> </pre></li>
<li id="l241"><pre>               <span class="comment">-- TGA is stored in BGRA, make it RGBA</span> </pre></li>
<li id="l242"><pre>               <span class="droplink">Get_Byte<ul><li><a href="gl-io.ads.html#gl-io.ads:150:13" title="To API doc">To API doc</a></li><li><a href="src_gl-io.ads.html#l150" title="To spec">To spec</a></li><li><a href="src_gl-io.adb.html#l140" title="To body">To body</a></li></ul></span> (<a href="src_gl-io.adb.html#l156" title="defined at gl-io.adb:156:7">stream_buf</a>, <a href="src_gl-io.adb.html#l231" title="defined at gl-io.adb:231:26">buffer</a> (<a href="src_gl-io.adb.html#l232" title="defined at gl-io.adb:232:10">i</a> + 2)); </pre></li>
<li id="l243"><pre>               <span class="droplink">Get_Byte<ul><li><a href="gl-io.ads.html#gl-io.ads:150:13" title="To API doc">To API doc</a></li><li><a href="src_gl-io.ads.html#l150" title="To spec">To spec</a></li><li><a href="src_gl-io.adb.html#l140" title="To body">To body</a></li></ul></span> (<a href="src_gl-io.adb.html#l156" title="defined at gl-io.adb:156:7">stream_buf</a>, <a href="src_gl-io.adb.html#l231" title="defined at gl-io.adb:231:26">buffer</a> (<a href="src_gl-io.adb.html#l232" title="defined at gl-io.adb:232:10">i</a> + 1)); </pre></li>
<li id="l244"><pre>               <span class="droplink">Get_Byte<ul><li><a href="gl-io.ads.html#gl-io.ads:150:13" title="To API doc">To API doc</a></li><li><a href="src_gl-io.ads.html#l150" title="To spec">To spec</a></li><li><a href="src_gl-io.adb.html#l140" title="To body">To body</a></li></ul></span> (<a href="src_gl-io.adb.html#l156" title="defined at gl-io.adb:156:7">stream_buf</a>, <a href="src_gl-io.adb.html#l231" title="defined at gl-io.adb:231:26">buffer</a> (<a href="src_gl-io.adb.html#l232" title="defined at gl-io.adb:232:10">i</a>)); </pre></li>
<li id="l245"><pre>               <span class="droplink">Get_Byte<ul><li><a href="gl-io.ads.html#gl-io.ads:150:13" title="To API doc">To API doc</a></li><li><a href="src_gl-io.ads.html#l150" title="To spec">To spec</a></li><li><a href="src_gl-io.adb.html#l140" title="To body">To body</a></li></ul></span> (<a href="src_gl-io.adb.html#l156" title="defined at gl-io.adb:156:7">stream_buf</a>, <a href="src_gl-io.adb.html#l231" title="defined at gl-io.adb:231:26">buffer</a> (<a href="src_gl-io.adb.html#l232" title="defined at gl-io.adb:232:10">i</a> + 3)); </pre></li>
<li id="l246"><pre>               <a href="src_gl-io.adb.html#l232" title="defined at gl-io.adb:232:10">i</a> := <a href="src_gl-io.adb.html#l232" title="defined at gl-io.adb:232:10">i</a> + 4; </pre></li>
<li id="l247"><pre>            <span class="keyword">end</span> <span class="keyword">loop</span>; </pre></li>
<li id="l248"><pre>         <span class="keyword">end</span> <span class="keyword">if</span>; </pre></li>
<li id="l249"><pre>         the_Image.tex_Format      := GL.RGBA; </pre></li>
<li id="l250"><pre>         the_Image.tex_pixel_Format := GL.RGBA; </pre></li>
<li id="l251"><pre>      <span class="keyword">end</span> <span class="droplink">getRGBA<ul><li><a href="src_gl-io.adb.html#l231" title="To spec">To spec</a></li><li><a href="src_gl-io.adb.html#l231" title="To body">To body</a></li></ul></span>; </pre></li>
<li id="l252"><pre> </pre></li>
<li id="l253"><pre>      <span class="comment">--  =============</span> </pre></li>
<li id="l254"><pre>      <span class="comment">--  getRGB</span> </pre></li>
<li id="l255"><pre> </pre></li>
<li id="l256"><pre>      <span class="comment">--  Reads in RGB data for a 24bit image.</span> </pre></li>
<li id="l257"><pre>      <span class="comment">--  =============</span> </pre></li>
<li id="l258"><pre> </pre></li>
<li id="l259"><pre>      <span class="keyword">procedure</span> getRGB (buffer : <span class="keyword">out</span> <span class="droplink">Byte_Array<ul><li><a href="gl-io.ads.html#gl-io.ads:51:8" title="To API doc">To API doc</a></li><li><a href="src_gl-io.ads.html#l51" title="To spec">To spec</a></li></ul></span>) <span class="keyword">is</span> </pre></li>
<li id="l260"><pre>         i : Integer := <a href="src_gl-io.adb.html#l259" title="defined at gl-io.adb:259:25">buffer</a>&apos;First; </pre></li>
<li id="l261"><pre>      <span class="keyword">begin</span> </pre></li>
<li id="l262"><pre>         <span class="keyword">if</span> <a href="src_gl-io.adb.html#l159" title="defined at gl-io.adb:159:7">RLE</a> <span class="keyword">then</span> </pre></li>
<li id="l263"><pre>            <span class="keyword">while</span> <a href="src_gl-io.adb.html#l260" title="defined at gl-io.adb:260:10">i</a> &lt;= <a href="src_gl-io.adb.html#l259" title="defined at gl-io.adb:259:25">buffer</a>&apos;Last - 2 <span class="keyword">loop</span> </pre></li>
<li id="l264"><pre>               <span class="droplink">RLE_Pixel<ul><li><a href="src_gl-io.adb.html#l164" title="To spec">To spec</a></li><li><a href="src_gl-io.adb.html#l164" title="To body">To body</a></li></ul></span> (24, <a href="src_gl-io.adb.html#l259" title="defined at gl-io.adb:259:25">buffer</a> (<a href="src_gl-io.adb.html#l260" title="defined at gl-io.adb:260:10">i</a> .. <a href="src_gl-io.adb.html#l260" title="defined at gl-io.adb:260:10">i</a> + 2)); </pre></li>
<li id="l265"><pre>               <a href="src_gl-io.adb.html#l260" title="defined at gl-io.adb:260:10">i</a> := <a href="src_gl-io.adb.html#l260" title="defined at gl-io.adb:260:10">i</a> + 3; </pre></li>
<li id="l266"><pre>            <span class="keyword">end</span> <span class="keyword">loop</span>; </pre></li>
<li id="l267"><pre>         <span class="keyword">else</span> </pre></li>
<li id="l268"><pre>            <span class="keyword">while</span> <a href="src_gl-io.adb.html#l260" title="defined at gl-io.adb:260:10">i</a> &lt;= <a href="src_gl-io.adb.html#l259" title="defined at gl-io.adb:259:25">buffer</a>&apos;Last - 2 <span class="keyword">loop</span> </pre></li>
<li id="l269"><pre>               <span class="comment">-- TGA is stored in BGR, make it RGB</span> </pre></li>
<li id="l270"><pre>               <span class="droplink">Get_Byte<ul><li><a href="gl-io.ads.html#gl-io.ads:150:13" title="To API doc">To API doc</a></li><li><a href="src_gl-io.ads.html#l150" title="To spec">To spec</a></li><li><a href="src_gl-io.adb.html#l140" title="To body">To body</a></li></ul></span> (<a href="src_gl-io.adb.html#l156" title="defined at gl-io.adb:156:7">stream_buf</a>, <a href="src_gl-io.adb.html#l259" title="defined at gl-io.adb:259:25">buffer</a> (<a href="src_gl-io.adb.html#l260" title="defined at gl-io.adb:260:10">i</a> + 2)); </pre></li>
<li id="l271"><pre>               <span class="droplink">Get_Byte<ul><li><a href="gl-io.ads.html#gl-io.ads:150:13" title="To API doc">To API doc</a></li><li><a href="src_gl-io.ads.html#l150" title="To spec">To spec</a></li><li><a href="src_gl-io.adb.html#l140" title="To body">To body</a></li></ul></span> (<a href="src_gl-io.adb.html#l156" title="defined at gl-io.adb:156:7">stream_buf</a>, <a href="src_gl-io.adb.html#l259" title="defined at gl-io.adb:259:25">buffer</a> (<a href="src_gl-io.adb.html#l260" title="defined at gl-io.adb:260:10">i</a> + 1)); </pre></li>
<li id="l272"><pre>               <span class="droplink">Get_Byte<ul><li><a href="gl-io.ads.html#gl-io.ads:150:13" title="To API doc">To API doc</a></li><li><a href="src_gl-io.ads.html#l150" title="To spec">To spec</a></li><li><a href="src_gl-io.adb.html#l140" title="To body">To body</a></li></ul></span> (<a href="src_gl-io.adb.html#l156" title="defined at gl-io.adb:156:7">stream_buf</a>, <a href="src_gl-io.adb.html#l259" title="defined at gl-io.adb:259:25">buffer</a> (<a href="src_gl-io.adb.html#l260" title="defined at gl-io.adb:260:10">i</a>)); </pre></li>
<li id="l273"><pre>               <a href="src_gl-io.adb.html#l260" title="defined at gl-io.adb:260:10">i</a> := <a href="src_gl-io.adb.html#l260" title="defined at gl-io.adb:260:10">i</a> + 3; </pre></li>
<li id="l274"><pre>            <span class="keyword">end</span> <span class="keyword">loop</span>; </pre></li>
<li id="l275"><pre>         <span class="keyword">end</span> <span class="keyword">if</span>; </pre></li>
<li id="l276"><pre>         the_Image.tex_Format      := GL.RGB; </pre></li>
<li id="l277"><pre>         the_Image.tex_pixel_Format := GL.RGB; </pre></li>
<li id="l278"><pre>      <span class="keyword">end</span> <span class="droplink">getRGB<ul><li><a href="src_gl-io.adb.html#l259" title="To spec">To spec</a></li><li><a href="src_gl-io.adb.html#l259" title="To body">To body</a></li></ul></span>; </pre></li>
<li id="l279"><pre> </pre></li>
<li id="l280"><pre>      <span class="comment">--  =============</span> </pre></li>
<li id="l281"><pre>      <span class="comment">--  getGray</span> </pre></li>
<li id="l282"><pre> </pre></li>
<li id="l283"><pre>      <span class="comment">--  Gets the grayscale image data.  Used as an alpha channel.</span> </pre></li>
<li id="l284"><pre>      <span class="comment">--  =============</span> </pre></li>
<li id="l285"><pre> </pre></li>
<li id="l286"><pre>      <span class="keyword">procedure</span> getGray (buffer : <span class="keyword">out</span> <span class="droplink">Byte_Array<ul><li><a href="gl-io.ads.html#gl-io.ads:51:8" title="To API doc">To API doc</a></li><li><a href="src_gl-io.ads.html#l51" title="To spec">To spec</a></li></ul></span>) <span class="keyword">is</span> </pre></li>
<li id="l287"><pre>      <span class="keyword">begin</span> </pre></li>
<li id="l288"><pre>         <span class="keyword">if</span> <a href="src_gl-io.adb.html#l159" title="defined at gl-io.adb:159:7">RLE</a> <span class="keyword">then</span> </pre></li>
<li id="l289"><pre>            <span class="keyword">for</span> b <span class="keyword">in</span> <a href="src_gl-io.adb.html#l286" title="defined at gl-io.adb:286:26">buffer</a>&apos;Range <span class="keyword">loop</span> </pre></li>
<li id="l290"><pre>               <span class="droplink">RLE_Pixel<ul><li><a href="src_gl-io.adb.html#l164" title="To spec">To spec</a></li><li><a href="src_gl-io.adb.html#l164" title="To body">To body</a></li></ul></span> (8, <a href="src_gl-io.adb.html#l286" title="defined at gl-io.adb:286:26">buffer</a> (b .. b)); </pre></li>
<li id="l291"><pre>            <span class="keyword">end</span> <span class="keyword">loop</span>; </pre></li>
<li id="l292"><pre>         <span class="keyword">else</span> </pre></li>
<li id="l293"><pre>            <span class="keyword">for</span> b <span class="keyword">in</span> <a href="src_gl-io.adb.html#l286" title="defined at gl-io.adb:286:26">buffer</a>&apos;Range <span class="keyword">loop</span> </pre></li>
<li id="l294"><pre>               <span class="droplink">Get_Byte<ul><li><a href="gl-io.ads.html#gl-io.ads:150:13" title="To API doc">To API doc</a></li><li><a href="src_gl-io.ads.html#l150" title="To spec">To spec</a></li><li><a href="src_gl-io.adb.html#l140" title="To body">To body</a></li></ul></span> (<a href="src_gl-io.adb.html#l156" title="defined at gl-io.adb:156:7">stream_buf</a>, <a href="src_gl-io.adb.html#l286" title="defined at gl-io.adb:286:26">buffer</a> (b)); </pre></li>
<li id="l295"><pre>            <span class="keyword">end</span> <span class="keyword">loop</span>; </pre></li>
<li id="l296"><pre>         <span class="keyword">end</span> <span class="keyword">if</span>; </pre></li>
<li id="l297"><pre>         the_Image.tex_Format      := GL.LUMINANCE; <span class="comment">-- ALPHA</span> </pre></li>
<li id="l298"><pre>         the_Image.tex_pixel_Format := GL.LUMINANCE; </pre></li>
<li id="l299"><pre>      <span class="keyword">end</span> <span class="droplink">getGray<ul><li><a href="src_gl-io.adb.html#l286" title="To spec">To spec</a></li><li><a href="src_gl-io.adb.html#l286" title="To body">To body</a></li></ul></span>; </pre></li>
<li id="l300"><pre> </pre></li>
<li id="l301"><pre>      <span class="comment">--  =============</span> </pre></li>
<li id="l302"><pre>      <span class="comment">--  getData</span> </pre></li>
<li id="l303"><pre> </pre></li>
<li id="l304"><pre>      <span class="comment">--  Gets the image data for the specified bit depth.</span> </pre></li>
<li id="l305"><pre>      <span class="comment">--  =============</span> </pre></li>
<li id="l306"><pre> </pre></li>
<li id="l307"><pre>      <span class="keyword">procedure</span> getData (iBits : Integer; buffer : <span class="keyword">out</span> <span class="droplink">Byte_Array<ul><li><a href="gl-io.ads.html#gl-io.ads:51:8" title="To API doc">To API doc</a></li><li><a href="src_gl-io.ads.html#l51" title="To spec">To spec</a></li></ul></span>) <span class="keyword">is</span> </pre></li>
<li id="l308"><pre>      <span class="keyword">begin</span> </pre></li>
<li id="l309"><pre>         <span class="droplink">Attach_Stream<ul><li><a href="gl-io.ads.html#gl-io.ads:147:13" title="To API doc">To API doc</a></li><li><a href="src_gl-io.ads.html#l147" title="To spec">To spec</a></li><li><a href="src_gl-io.adb.html#l132" title="To body">To body</a></li></ul></span> (<a href="src_gl-io.adb.html#l156" title="defined at gl-io.adb:156:7">stream_buf</a>, <span class="droplink">S<ul><li><a href="gl-io.ads.html#gl-io.ads:72:26" title="To API doc">To API doc</a></li><li><a href="src_gl-io.ads.html#l72" title="To spec">To spec</a></li></ul></span>); </pre></li>
<li id="l310"><pre>         <span class="keyword">case</span> <a href="src_gl-io.adb.html#l307" title="defined at gl-io.adb:307:26">iBits</a> <span class="keyword">is</span> </pre></li>
<li id="l311"><pre>         <span class="keyword">when</span> 32 =&gt; </pre></li>
<li id="l312"><pre>            <span class="droplink">getRGBA<ul><li><a href="src_gl-io.adb.html#l231" title="To spec">To spec</a></li><li><a href="src_gl-io.adb.html#l231" title="To body">To body</a></li></ul></span> (<a href="src_gl-io.adb.html#l307" title="defined at gl-io.adb:307:43">buffer</a>); </pre></li>
<li id="l313"><pre>            the_Image.blending_hint := True; </pre></li>
<li id="l314"><pre>         <span class="keyword">when</span> 24 =&gt; </pre></li>
<li id="l315"><pre>            <span class="droplink">getRGB<ul><li><a href="src_gl-io.adb.html#l259" title="To spec">To spec</a></li><li><a href="src_gl-io.adb.html#l259" title="To body">To body</a></li></ul></span> (<a href="src_gl-io.adb.html#l307" title="defined at gl-io.adb:307:43">buffer</a>); </pre></li>
<li id="l316"><pre>            the_Image.blending_hint := False; </pre></li>
<li id="l317"><pre>         <span class="keyword">when</span> 8  =&gt; </pre></li>
<li id="l318"><pre>            <span class="droplink">getGray<ul><li><a href="src_gl-io.adb.html#l286" title="To spec">To spec</a></li><li><a href="src_gl-io.adb.html#l286" title="To body">To body</a></li></ul></span> (<a href="src_gl-io.adb.html#l307" title="defined at gl-io.adb:307:43">buffer</a>); </pre></li>
<li id="l319"><pre>            the_Image.blending_hint := True; </pre></li>
<li id="l320"><pre>         <span class="keyword">when</span> <span class="keyword">others</span> =&gt; <span class="keyword">null</span>; </pre></li>
<li id="l321"><pre>         <span class="keyword">end</span> <span class="keyword">case</span>; </pre></li>
<li id="l322"><pre>      <span class="keyword">end</span> <span class="droplink">getData<ul><li><a href="src_gl-io.adb.html#l307" title="To spec">To spec</a></li><li><a href="src_gl-io.adb.html#l307" title="To body">To body</a></li></ul></span>; </pre></li>
<li id="l323"><pre> </pre></li>
<li id="l324"><pre>      TGA_type : <span class="droplink">Byte_Array<ul><li><a href="gl-io.ads.html#gl-io.ads:51:8" title="To API doc">To API doc</a></li><li><a href="src_gl-io.ads.html#l51" title="To spec">To spec</a></li></ul></span> (0 .. 3); </pre></li>
<li id="l325"><pre>      info     : <span class="droplink">Byte_Array<ul><li><a href="gl-io.ads.html#gl-io.ads:51:8" title="To API doc">To API doc</a></li><li><a href="src_gl-io.ads.html#l51" title="To spec">To spec</a></li></ul></span> (0 .. 5); </pre></li>
<li id="l326"><pre>      dummy    : <span class="droplink">Byte_Array<ul><li><a href="gl-io.ads.html#gl-io.ads:51:8" title="To API doc">To API doc</a></li><li><a href="src_gl-io.ads.html#l51" title="To spec">To spec</a></li></ul></span> (1 .. 8); </pre></li>
<li id="l327"><pre> </pre></li>
<li id="l328"><pre>      Image_Bits : Integer; </pre></li>
<li id="l329"><pre>      Image_Type : Integer; </pre></li>
<li id="l330"><pre> </pre></li>
<li id="l331"><pre>   <span class="keyword">begin</span> <span class="comment">-- to_TGA_Image</span> </pre></li>
<li id="l332"><pre>      <span class="droplink">Byte_Array<ul><li><a href="gl-io.ads.html#gl-io.ads:51:8" title="To API doc">To API doc</a></li><li><a href="src_gl-io.ads.html#l51" title="To spec">To spec</a></li></ul></span>&apos;Read (<span class="droplink">S<ul><li><a href="gl-io.ads.html#gl-io.ads:72:26" title="To API doc">To API doc</a></li><li><a href="src_gl-io.ads.html#l72" title="To spec">To spec</a></li></ul></span>, <a href="src_gl-io.adb.html#l324" title="defined at gl-io.adb:324:7">TGA_type</a>); <span class="comment">-- read in colormap info and image type</span> </pre></li>
<li id="l333"><pre>      <span class="droplink">Byte_Array<ul><li><a href="gl-io.ads.html#gl-io.ads:51:8" title="To API doc">To API doc</a></li><li><a href="src_gl-io.ads.html#l51" title="To spec">To spec</a></li></ul></span>&apos;Read (<span class="droplink">S<ul><li><a href="gl-io.ads.html#gl-io.ads:72:26" title="To API doc">To API doc</a></li><li><a href="src_gl-io.ads.html#l72" title="To spec">To spec</a></li></ul></span>, <a href="src_gl-io.adb.html#l326" title="defined at gl-io.adb:326:7">dummy</a>);    <span class="comment">-- seek past the header and useless info</span> </pre></li>
<li id="l334"><pre>      <span class="droplink">Byte_Array<ul><li><a href="gl-io.ads.html#gl-io.ads:51:8" title="To API doc">To API doc</a></li><li><a href="src_gl-io.ads.html#l51" title="To spec">To spec</a></li></ul></span>&apos;Read (<span class="droplink">S<ul><li><a href="gl-io.ads.html#gl-io.ads:72:26" title="To API doc">To API doc</a></li><li><a href="src_gl-io.ads.html#l72" title="To spec">To spec</a></li></ul></span>, <a href="src_gl-io.adb.html#l325" title="defined at gl-io.adb:325:7">info</a>); </pre></li>
<li id="l335"><pre> </pre></li>
<li id="l336"><pre>      <span class="keyword">if</span> <a href="src_gl-io.adb.html#l324" title="defined at gl-io.adb:324:7">TGA_type</a> (1) /= <span class="droplink">GL.Ubyte<ul><li><a href="gl.ads.html#gl.ads:122:9" title="To API doc">To API doc</a></li><li><a href="src_gl.ads.html#l122" title="To spec">To spec</a></li></ul></span>&apos;Val (0) <span class="keyword">then</span> </pre></li>
<li id="l337"><pre>         Raise_Exception ( </pre></li>
<li id="l338"><pre>                          <span class="droplink">TGA_Unsupported_Image_Type<ul><li><a href="gl-io.ads.html#gl-io.ads:119:3" title="To API doc">To API doc</a></li><li><a href="src_gl-io.ads.html#l119" title="To spec">To spec</a></li></ul></span>&apos;Identity, </pre></li>
<li id="l339"><pre>                          <span class="string">&quot;TGA : palette not supported, please use BMP&quot;</span> </pre></li>
<li id="l340"><pre>                         ); </pre></li>
<li id="l341"><pre>      <span class="keyword">end</span> <span class="keyword">if</span>; </pre></li>
<li id="l342"><pre> </pre></li>
<li id="l343"><pre>      <span class="comment">-- Image type:</span> </pre></li>
<li id="l344"><pre>      <span class="comment">--      1=8 - bit palette style</span> </pre></li>
<li id="l345"><pre>      <span class="comment">--      2=Direct [A]RGB image</span> </pre></li>
<li id="l346"><pre>      <span class="comment">--      3=grayscale</span> </pre></li>
<li id="l347"><pre>      <span class="comment">--      9=RLE version of Type 1</span> </pre></li>
<li id="l348"><pre>      <span class="comment">--     10=RLE version of Type 2</span> </pre></li>
<li id="l349"><pre>      <span class="comment">--     11=RLE version of Type 3</span> </pre></li>
<li id="l350"><pre> </pre></li>
<li id="l351"><pre>      <a href="src_gl-io.adb.html#l329" title="defined at gl-io.adb:329:7">Image_Type</a> := <span class="droplink">GL.Ubyte<ul><li><a href="gl.ads.html#gl.ads:122:9" title="To API doc">To API doc</a></li><li><a href="src_gl.ads.html#l122" title="To spec">To spec</a></li></ul></span>&apos;Pos (<a href="src_gl-io.adb.html#l324" title="defined at gl-io.adb:324:7">TGA_type</a> (2)); </pre></li>
<li id="l352"><pre>      <a href="src_gl-io.adb.html#l159" title="defined at gl-io.adb:159:7">RLE</a> := <a href="src_gl-io.adb.html#l329" title="defined at gl-io.adb:329:7">Image_Type</a> &gt;= 9; </pre></li>
<li id="l353"><pre>      <span class="keyword">if</span> <a href="src_gl-io.adb.html#l159" title="defined at gl-io.adb:159:7">RLE</a> <span class="keyword">then</span> </pre></li>
<li id="l354"><pre>         <a href="src_gl-io.adb.html#l329" title="defined at gl-io.adb:329:7">Image_Type</a> := <a href="src_gl-io.adb.html#l329" title="defined at gl-io.adb:329:7">Image_Type</a> - 8; </pre></li>
<li id="l355"><pre>         <a href="src_gl-io.adb.html#l160" title="defined at gl-io.adb:160:7">RLE_pixels_remaining</a> := 0; </pre></li>
<li id="l356"><pre>      <span class="keyword">end</span> <span class="keyword">if</span>; </pre></li>
<li id="l357"><pre>      <span class="keyword">if</span> <a href="src_gl-io.adb.html#l329" title="defined at gl-io.adb:329:7">Image_Type</a> /= 2 <span class="keyword">and</span> <span class="keyword">then</span> <a href="src_gl-io.adb.html#l329" title="defined at gl-io.adb:329:7">Image_Type</a> /= 3 <span class="keyword">then</span> </pre></li>
<li id="l358"><pre>         Raise_Exception ( </pre></li>
<li id="l359"><pre>                          <span class="droplink">TGA_Unsupported_Image_Type<ul><li><a href="gl-io.ads.html#gl-io.ads:119:3" title="To API doc">To API doc</a></li><li><a href="src_gl-io.ads.html#l119" title="To spec">To spec</a></li></ul></span>&apos;Identity, </pre></li>
<li id="l360"><pre>                          <span class="string">&quot;TGA type =&quot;</span> &amp; Integer&apos;<span class="droplink">Image<ul><li><a href="gl-io.ads.html#gl-io.ads:59:8" title="To API doc">To API doc</a></li><li><a href="src_gl-io.ads.html#l59" title="To spec">To spec</a></li></ul></span> (<a href="src_gl-io.adb.html#l329" title="defined at gl-io.adb:329:7">Image_Type</a>) </pre></li>
<li id="l361"><pre>                         ); </pre></li>
<li id="l362"><pre>      <span class="keyword">end</span> <span class="keyword">if</span>; </pre></li>
<li id="l363"><pre> </pre></li>
<li id="l364"><pre>      the_Image.Width  := <span class="droplink">GL.Ubyte<ul><li><a href="gl.ads.html#gl.ads:122:9" title="To API doc">To API doc</a></li><li><a href="src_gl.ads.html#l122" title="To spec">To spec</a></li></ul></span>&apos;Pos (<a href="src_gl-io.adb.html#l325" title="defined at gl-io.adb:325:7">info</a> (0)) + <span class="droplink">GL.Ubyte<ul><li><a href="gl.ads.html#gl.ads:122:9" title="To API doc">To API doc</a></li><li><a href="src_gl.ads.html#l122" title="To spec">To spec</a></li></ul></span>&apos;Pos (<a href="src_gl-io.adb.html#l325" title="defined at gl-io.adb:325:7">info</a> (1)) * 256; </pre></li>
<li id="l365"><pre>      the_Image.Height := <span class="droplink">GL.Ubyte<ul><li><a href="gl.ads.html#gl.ads:122:9" title="To API doc">To API doc</a></li><li><a href="src_gl.ads.html#l122" title="To spec">To spec</a></li></ul></span>&apos;Pos (<a href="src_gl-io.adb.html#l325" title="defined at gl-io.adb:325:7">info</a> (2)) + <span class="droplink">GL.Ubyte<ul><li><a href="gl.ads.html#gl.ads:122:9" title="To API doc">To API doc</a></li><li><a href="src_gl.ads.html#l122" title="To spec">To spec</a></li></ul></span>&apos;Pos (<a href="src_gl-io.adb.html#l325" title="defined at gl-io.adb:325:7">info</a> (3)) * 256; </pre></li>
<li id="l366"><pre>      <a href="src_gl-io.adb.html#l328" title="defined at gl-io.adb:328:7">Image_Bits</a>   := <span class="droplink">GL.Ubyte<ul><li><a href="gl.ads.html#gl.ads:122:9" title="To API doc">To API doc</a></li><li><a href="src_gl.ads.html#l122" title="To spec">To spec</a></li></ul></span>&apos;Pos (<a href="src_gl-io.adb.html#l325" title="defined at gl-io.adb:325:7">info</a> (4)); </pre></li>
<li id="l367"><pre> </pre></li>
<li id="l368"><pre>      the_Image.size := the_Image.Width * the_Image.Height; </pre></li>
<li id="l369"><pre> </pre></li>
<li id="l370"><pre>      <span class="comment">-- 30 - Apr - 2006 : dimensions not power of two allowed, but discouraged in the docs.</span> </pre></li>
<li id="l371"><pre>      <span class="comment">--</span> </pre></li>
<li id="l372"><pre>      <span class="comment">--  -- make sure dimension is a power of 2</span> </pre></li>
<li id="l373"><pre>      <span class="comment">--  if not (checkSize (imageWidth)  and  checkSize (imageHeight)) then</span> </pre></li>
<li id="l374"><pre>      <span class="comment">--     raise TGA_BAD_DIMENSION;</span> </pre></li>
<li id="l375"><pre>      <span class="comment">--  end if;</span> </pre></li>
<li id="l376"><pre> </pre></li>
<li id="l377"><pre>      <span class="comment">-- make sure we are loading a supported TGA_type</span> </pre></li>
<li id="l378"><pre>      <span class="keyword">if</span> <a href="src_gl-io.adb.html#l328" title="defined at gl-io.adb:328:7">Image_Bits</a> /= 32 <span class="keyword">and</span> <span class="keyword">then</span> <a href="src_gl-io.adb.html#l328" title="defined at gl-io.adb:328:7">Image_Bits</a> /= 24 <span class="keyword">and</span> <span class="keyword">then</span> <a href="src_gl-io.adb.html#l328" title="defined at gl-io.adb:328:7">Image_Bits</a> /= 8 <span class="keyword">then</span> </pre></li>
<li id="l379"><pre>         <span class="keyword">raise</span> <span class="droplink">TGA_Unsupported_Bits_per_pixel<ul><li><a href="gl-io.ads.html#gl-io.ads:120:3" title="To API doc">To API doc</a></li><li><a href="src_gl-io.ads.html#l120" title="To spec">To spec</a></li></ul></span>; </pre></li>
<li id="l380"><pre>      <span class="keyword">end</span> <span class="keyword">if</span>; </pre></li>
<li id="l381"><pre> </pre></li>
<li id="l382"><pre>      <span class="comment">-- Allocation</span> </pre></li>
<li id="l383"><pre>      the_Image.Data := <span class="keyword">new</span> <span class="droplink">Byte_Array<ul><li><a href="gl-io.ads.html#gl-io.ads:51:8" title="To API doc">To API doc</a></li><li><a href="src_gl-io.ads.html#l51" title="To spec">To spec</a></li></ul></span> (0 .. (<a href="src_gl-io.adb.html#l328" title="defined at gl-io.adb:328:7">Image_Bits</a> / 8) * the_Image.size - 1); </pre></li>
<li id="l384"><pre>      <span class="droplink">getData<ul><li><a href="src_gl-io.adb.html#l307" title="To spec">To spec</a></li><li><a href="src_gl-io.adb.html#l307" title="To body">To body</a></li></ul></span> (<a href="src_gl-io.adb.html#l328" title="defined at gl-io.adb:328:7">Image_Bits</a>, the_Image.Data.<span class="keyword">all</span>); </pre></li>
<li id="l385"><pre> </pre></li>
<li id="l386"><pre>      <span class="keyword">return</span> <a href="src_gl-io.adb.html#l155" title="defined at gl-io.adb:155:7">the_Image</a>; </pre></li>
<li id="l387"><pre>   <span class="keyword">end</span> <span class="droplink">To_TGA_Image<ul><li><a href="gl-io.ads.html#gl-io.ads:72:12" title="To API doc">To API doc</a></li><li><a href="src_gl-io.ads.html#l72" title="To spec">To spec</a></li><li><a href="src_gl-io.adb.html#l153" title="To body">To body</a></li></ul></span>; </pre></li>
<li id="l388"><pre> </pre></li>
<li id="l389"><pre>   <span class="keyword">function</span> <span class="droplink">To_TGA_Image<ul><li><a href="gl-io.ads.html#gl-io.ads:70:12" title="To API doc">To API doc</a></li><li><a href="src_gl-io.ads.html#l70" title="To spec">To spec</a></li></ul></span> (<span class="droplink">Filename<ul><li><a href="gl-io.ads.html#gl-io.ads:70:26" title="To API doc">To API doc</a></li><li><a href="src_gl-io.ads.html#l70" title="To spec">To spec</a></li></ul></span> : String) <span class="keyword">return</span> <span class="droplink">Image<ul><li><a href="gl-io.ads.html#gl-io.ads:59:8" title="To API doc">To API doc</a></li><li><a href="src_gl-io.ads.html#l59" title="To spec">To spec</a></li></ul></span> <span class="keyword">is</span> </pre></li>
<li id="l390"><pre> </pre></li>
<li id="l391"><pre>      f          : File_Type; </pre></li>
<li id="l392"><pre>      the_Image  : <span class="droplink">Image<ul><li><a href="gl-io.ads.html#gl-io.ads:59:8" title="To API doc">To API doc</a></li><li><a href="src_gl-io.ads.html#l59" title="To spec">To spec</a></li></ul></span>; </pre></li>
<li id="l393"><pre> </pre></li>
<li id="l394"><pre>   <span class="keyword">begin</span> </pre></li>
<li id="l395"><pre>      <span class="keyword">begin</span> </pre></li>
<li id="l396"><pre>         Open (<a href="src_gl-io.adb.html#l391" title="defined at gl-io.adb:391:7">f</a>, In_File, <span class="droplink">Filename<ul><li><a href="gl-io.ads.html#gl-io.ads:70:26" title="To API doc">To API doc</a></li><li><a href="src_gl-io.ads.html#l70" title="To spec">To spec</a></li></ul></span>); </pre></li>
<li id="l397"><pre>      <span class="keyword">exception</span> </pre></li>
<li id="l398"><pre>         <span class="keyword">when</span> Name_Error =&gt; Raise_Exception (<span class="droplink">File_Not_Found<ul><li><a href="gl-io.ads.html#gl-io.ads:47:3" title="To API doc">To API doc</a></li><li><a href="src_gl-io.ads.html#l47" title="To spec">To spec</a></li></ul></span>&apos;Identity, <span class="string">&quot; file name:&quot;</span> &amp; <span class="droplink">Filename<ul><li><a href="gl-io.ads.html#gl-io.ads:70:26" title="To API doc">To API doc</a></li><li><a href="src_gl-io.ads.html#l70" title="To spec">To spec</a></li></ul></span>); </pre></li>
<li id="l399"><pre>      <span class="keyword">end</span>; </pre></li>
<li id="l400"><pre>      <a href="src_gl-io.adb.html#l392" title="defined at gl-io.adb:392:7">the_Image</a> := <span class="droplink">To_TGA_Image<ul><li><a href="gl-io.ads.html#gl-io.ads:72:12" title="To API doc">To API doc</a></li><li><a href="src_gl-io.ads.html#l72" title="To spec">To spec</a></li><li><a href="src_gl-io.adb.html#l153" title="To body">To body</a></li></ul></span> (Stream (<a href="src_gl-io.adb.html#l391" title="defined at gl-io.adb:391:7">f</a>)); </pre></li>
<li id="l401"><pre>      Close (<a href="src_gl-io.adb.html#l391" title="defined at gl-io.adb:391:7">f</a>); </pre></li>
<li id="l402"><pre>      <span class="keyword">return</span> <a href="src_gl-io.adb.html#l392" title="defined at gl-io.adb:392:7">the_Image</a>; </pre></li>
<li id="l403"><pre>   <span class="keyword">exception</span> </pre></li>
<li id="l404"><pre>      <span class="keyword">when</span> e : <span class="keyword">others</span> =&gt; </pre></li>
<li id="l405"><pre>         Close (<a href="src_gl-io.adb.html#l391" title="defined at gl-io.adb:391:7">f</a>); </pre></li>
<li id="l406"><pre>         Raise_Exception (Exception_Identity (e), <span class="string">&quot; file name:&quot;</span> &amp; <span class="droplink">Filename<ul><li><a href="gl-io.ads.html#gl-io.ads:70:26" title="To API doc">To API doc</a></li><li><a href="src_gl-io.ads.html#l70" title="To spec">To spec</a></li></ul></span>); </pre></li>
<li id="l407"><pre>         <span class="keyword">return</span> <a href="src_gl-io.adb.html#l392" title="defined at gl-io.adb:392:7">the_Image</a>; </pre></li>
<li id="l408"><pre>   <span class="keyword">end</span> <span class="droplink">To_TGA_Image<ul><li><a href="gl-io.ads.html#gl-io.ads:70:12" title="To API doc">To API doc</a></li><li><a href="src_gl-io.ads.html#l70" title="To spec">To spec</a></li><li><a href="src_gl-io.adb.html#l389" title="To body">To body</a></li></ul></span>; </pre></li>
<li id="l409"><pre> </pre></li>
<li id="l410"><pre>   <span class="comment">--  =============</span> </pre></li>
<li id="l411"><pre>   <span class="comment">--  loadTGA</span> </pre></li>
<li id="l412"><pre> </pre></li>
<li id="l413"><pre>   <span class="comment">--  Loads up a targa stream.</span> </pre></li>
<li id="l414"><pre>   <span class="comment">--  Supported types are 8, 24 and 32 uncompressed images.</span> </pre></li>
<li id="l415"><pre>   <span class="comment">--  id is the texture ID to bind to.</span> </pre></li>
<li id="l416"><pre>   <span class="comment">--  =============</span> </pre></li>
<li id="l417"><pre> </pre></li>
<li id="l418"><pre>   <span class="keyword">procedure</span> <span class="droplink">Load_TGA<ul><li><a href="gl-io.ads.html#gl-io.ads:115:14" title="To API doc">To API doc</a></li><li><a href="src_gl-io.ads.html#l115" title="To spec">To spec</a></li></ul></span> (<span class="droplink">S<ul><li><a href="gl-io.ads.html#gl-io.ads:115:24" title="To API doc">To API doc</a></li><li><a href="src_gl-io.ads.html#l115" title="To spec">To spec</a></li></ul></span>             :     Ada.Streams.Stream_IO.Stream_Access; </pre></li>
<li id="l419"><pre>                       <span class="droplink">Id<ul><li><a href="gl-io.ads.html#gl-io.ads:116:24" title="To API doc">To API doc</a></li><li><a href="src_gl-io.ads.html#l116" title="To spec">To spec</a></li></ul></span>            :     Integer;     <span class="comment">-- Id is the texture identifier to bind to</span> </pre></li>
<li id="l420"><pre>                       <span class="droplink">blending_hint<ul><li><a href="gl-io.ads.html#gl-io.ads:117:24" title="To API doc">To API doc</a></li><li><a href="src_gl-io.ads.html#l117" title="To spec">To spec</a></li></ul></span> : <span class="keyword">out</span> Boolean) <span class="keyword">is</span>  <span class="comment">-- has the image blending / transparency /alpha ?</span> </pre></li>
<li id="l421"><pre> </pre></li>
<li id="l422"><pre>      the_Image  : <span class="droplink">Image<ul><li><a href="gl-io.ads.html#gl-io.ads:59:8" title="To API doc">To API doc</a></li><li><a href="src_gl-io.ads.html#l59" title="To spec">To spec</a></li></ul></span> := <span class="droplink">To_TGA_Image<ul><li><a href="gl-io.ads.html#gl-io.ads:72:12" title="To API doc">To API doc</a></li><li><a href="src_gl-io.ads.html#l72" title="To spec">To spec</a></li><li><a href="src_gl-io.adb.html#l153" title="To body">To body</a></li></ul></span> (<span class="droplink">S<ul><li><a href="gl-io.ads.html#gl-io.ads:115:24" title="To API doc">To API doc</a></li><li><a href="src_gl-io.ads.html#l115" title="To spec">To spec</a></li></ul></span>); </pre></li>
<li id="l423"><pre> </pre></li>
<li id="l424"><pre>   <span class="keyword">begin</span> </pre></li>
<li id="l425"><pre>      <span class="droplink">Insert_into_GL<ul><li><a href="src_gl-io.adb.html#l46" title="To spec">To spec</a></li><li><a href="src_gl-io.adb.html#l46" title="To body">To body</a></li></ul></span> (<a href="src_gl-io.adb.html#l46" title="defined at gl-io.adb:46:30">id</a>             =&gt; <span class="droplink">Id<ul><li><a href="gl-io.ads.html#gl-io.ads:116:24" title="To API doc">To API doc</a></li><li><a href="src_gl-io.ads.html#l116" title="To spec">To spec</a></li></ul></span>, </pre></li>
<li id="l426"><pre>                      <a href="src_gl-io.adb.html#l47" title="defined at gl-io.adb:47:30">Insert_Size</a>    =&gt; the_Image.size, </pre></li>
<li id="l427"><pre>                      <a href="src_gl-io.adb.html#l48" title="defined at gl-io.adb:48:30">width</a>          =&gt; the_Image.Width, </pre></li>
<li id="l428"><pre>                      <a href="src_gl-io.adb.html#l49" title="defined at gl-io.adb:49:30">height</a>         =&gt; the_Image.Height, </pre></li>
<li id="l429"><pre>                      <a href="src_gl-io.adb.html#l50" title="defined at gl-io.adb:50:30">texFormat</a>      =&gt; the_Image.tex_Format, </pre></li>
<li id="l430"><pre>                      <a href="src_gl-io.adb.html#l51" title="defined at gl-io.adb:51:30">texPixelFormat</a> =&gt; the_Image.tex_pixel_Format, </pre></li>
<li id="l431"><pre>                      <a href="src_gl-io.adb.html#l52" title="defined at gl-io.adb:52:30">image_p</a>        =&gt; the_Image.Data); </pre></li>
<li id="l432"><pre> </pre></li>
<li id="l433"><pre>      <span class="comment">-- release our data, its been uploaded to the GL system</span> </pre></li>
<li id="l434"><pre>      <span class="droplink">Free<ul><li><a href="gl-io.ads.html#gl-io.ads:54:13" title="To API doc">To API doc</a></li><li><a href="src_gl-io.ads.html#l54" title="To spec">To spec</a></li></ul></span> (the_Image.Data); </pre></li>
<li id="l435"><pre> </pre></li>
<li id="l436"><pre>      <span class="droplink">blending_hint<ul><li><a href="gl-io.ads.html#gl-io.ads:117:24" title="To API doc">To API doc</a></li><li><a href="src_gl-io.ads.html#l117" title="To spec">To spec</a></li></ul></span> := the_Image.blending_hint; </pre></li>
<li id="l437"><pre>   <span class="keyword">end</span> <span class="droplink">Load_TGA<ul><li><a href="gl-io.ads.html#gl-io.ads:115:14" title="To API doc">To API doc</a></li><li><a href="src_gl-io.ads.html#l115" title="To spec">To spec</a></li><li><a href="src_gl-io.adb.html#l418" title="To body">To body</a></li></ul></span>; </pre></li>
<li id="l438"><pre> </pre></li>
<li id="l439"><pre>   <span class="comment">-- Template for all loaders from a file</span> </pre></li>
<li id="l440"><pre>   <span class="keyword">generic</span> </pre></li>
<li id="l441"><pre>      <span class="keyword">with</span> <span class="keyword">procedure</span> Stream_Loader (S : Stream_Access; id : Integer; blending_hint : <span class="keyword">out</span> Boolean); </pre></li>
<li id="l442"><pre>   <span class="keyword">procedure</span> <a href="src_gl-io.adb.html#l444" title="defined at gl-io.adb:442:14">Load_XXX</a> (name : String; id : Integer; blending_hint : <span class="keyword">out</span> Boolean); </pre></li>
<li id="l443"><pre> </pre></li>
<li id="l444"><pre>   <span class="keyword">procedure</span> <a href="src_gl-io.adb.html#l442" title="defined at gl-io.adb:442:14">Load_XXX</a> (<a href="src_gl-io.adb.html#l442" title="defined at gl-io.adb:442:24">name</a> : String; <a href="src_gl-io.adb.html#l442" title="defined at gl-io.adb:442:39">id</a> : Integer; <a href="src_gl-io.adb.html#l442" title="defined at gl-io.adb:442:53">blending_hint</a> : <span class="keyword">out</span> Boolean) <span class="keyword">is</span> </pre></li>
<li id="l445"><pre>      f : File_Type; </pre></li>
<li id="l446"><pre>   <span class="keyword">begin</span> </pre></li>
<li id="l447"><pre>      <span class="keyword">begin</span> </pre></li>
<li id="l448"><pre>         Open (f, In_File, <a href="src_gl-io.adb.html#l442" title="defined at gl-io.adb:442:24">name</a>); </pre></li>
<li id="l449"><pre>      <span class="keyword">exception</span> </pre></li>
<li id="l450"><pre>         <span class="keyword">when</span> Name_Error =&gt; Raise_Exception (<span class="droplink">File_Not_Found<ul><li><a href="gl-io.ads.html#gl-io.ads:47:3" title="To API doc">To API doc</a></li><li><a href="src_gl-io.ads.html#l47" title="To spec">To spec</a></li></ul></span>&apos;Identity, <span class="string">&quot; file name:&quot;</span> &amp; <a href="src_gl-io.adb.html#l442" title="defined at gl-io.adb:442:24">name</a>); </pre></li>
<li id="l451"><pre>      <span class="keyword">end</span>; </pre></li>
<li id="l452"><pre>      <a href="src_gl-io.adb.html#l441" title="defined at gl-io.adb:441:22">Stream_Loader</a> (Stream (f), <a href="src_gl-io.adb.html#l442" title="defined at gl-io.adb:442:39">id</a>, <a href="src_gl-io.adb.html#l442" title="defined at gl-io.adb:442:53">blending_hint</a>); </pre></li>
<li id="l453"><pre>      Close (f); </pre></li>
<li id="l454"><pre>   <span class="keyword">exception</span> </pre></li>
<li id="l455"><pre>      <span class="keyword">when</span> e : <span class="keyword">others</span> =&gt; </pre></li>
<li id="l456"><pre>         Close (f); </pre></li>
<li id="l457"><pre>         Raise_Exception (Exception_Identity (e), <span class="string">&quot; file name:&quot;</span> &amp; <a href="src_gl-io.adb.html#l442" title="defined at gl-io.adb:442:24">name</a>); </pre></li>
<li id="l458"><pre>   <span class="keyword">end</span> <span class="droplink">Load_XXX<ul><li><a href="src_gl-io.adb.html#l442" title="To spec">To spec</a></li><li><a href="src_gl-io.adb.html#l444" title="To body">To body</a></li></ul></span>; </pre></li>
<li id="l459"><pre> </pre></li>
<li id="l460"><pre>   <span class="keyword">procedure</span> <a href="src_gl-io.adb.html#l444" title="defined at gl-io.adb:460:14">i_Load_TGA</a> <span class="keyword">is</span> <span class="keyword">new</span> <span class="droplink">Load_XXX<ul><li><a href="src_gl-io.adb.html#l442" title="To spec">To spec</a></li><li><a href="src_gl-io.adb.html#l444" title="To body">To body</a></li></ul></span> (<a href="src_gl-io.adb.html#l441" title="defined at gl-io.adb:441:22">Stream_Loader</a> =&gt; <span class="droplink">Load_TGA<ul><li><a href="gl-io.ads.html#gl-io.ads:115:14" title="To API doc">To API doc</a></li><li><a href="src_gl-io.ads.html#l115" title="To spec">To spec</a></li><li><a href="src_gl-io.adb.html#l418" title="To body">To body</a></li></ul></span>); </pre></li>
<li id="l461"><pre> </pre></li>
<li id="l462"><pre>   <span class="keyword">procedure</span> <span class="droplink">Load_TGA<ul><li><a href="gl-io.ads.html#gl-io.ads:111:14" title="To API doc">To API doc</a></li><li><a href="src_gl-io.ads.html#l111" title="To spec">To spec</a></li></ul></span> (<span class="droplink">Name<ul><li><a href="gl-io.ads.html#gl-io.ads:111:24" title="To API doc">To API doc</a></li><li><a href="src_gl-io.ads.html#l111" title="To spec">To spec</a></li></ul></span> : String; <span class="droplink">Id<ul><li><a href="gl-io.ads.html#gl-io.ads:112:24" title="To API doc">To API doc</a></li><li><a href="src_gl-io.ads.html#l112" title="To spec">To spec</a></li></ul></span> : Integer; <span class="droplink">blending_hint<ul><li><a href="gl-io.ads.html#gl-io.ads:113:24" title="To API doc">To API doc</a></li><li><a href="src_gl-io.ads.html#l113" title="To spec">To spec</a></li></ul></span> : <span class="keyword">out</span> Boolean) <span class="keyword">renames</span> <span class="droplink">i_Load_TGA<ul><li><a href="src_gl-io.adb.html#l460" title="To spec">To spec</a></li><li><a href="src_gl-io.adb.html#l444" title="To body">To body</a></li></ul></span>; </pre></li>
<li id="l463"><pre> </pre></li>
<li id="l464"><pre>   <span class="comment">-- BMP</span> </pre></li>
<li id="l465"><pre> </pre></li>
<li id="l466"><pre>   <span class="keyword">procedure</span> <span class="droplink">Load_BMP<ul><li><a href="gl-io.ads.html#gl-io.ads:98:13" title="To API doc">To API doc</a></li><li><a href="src_gl-io.ads.html#l98" title="To spec">To spec</a></li></ul></span> (<span class="droplink">S<ul><li><a href="gl-io.ads.html#gl-io.ads:98:23" title="To API doc">To API doc</a></li><li><a href="src_gl-io.ads.html#l98" title="To spec">To spec</a></li></ul></span>             :     Ada.Streams.Stream_IO.Stream_Access; <span class="comment">-- Input data stream</span> </pre></li>
<li id="l467"><pre>                       <span class="droplink">Id<ul><li><a href="gl-io.ads.html#gl-io.ads:99:23" title="To API doc">To API doc</a></li><li><a href="src_gl-io.ads.html#l99" title="To spec">To spec</a></li></ul></span>            :     Integer;     <span class="comment">-- Id is the texture identifier to bind to</span> </pre></li>
<li id="l468"><pre>                       <span class="droplink">blending_hint<ul><li><a href="gl-io.ads.html#gl-io.ads:100:23" title="To API doc">To API doc</a></li><li><a href="src_gl-io.ads.html#l100" title="To spec">To spec</a></li></ul></span> : <span class="keyword">out</span> Boolean) <span class="keyword">is</span>  <span class="comment">-- has the image blending / transparency /alpha ?</span> </pre></li>
<li id="l469"><pre> </pre></li>
<li id="l470"><pre>      imageData : <span class="droplink">Byte_Array_Ptr<ul><li><a href="gl-io.ads.html#gl-io.ads:52:8" title="To API doc">To API doc</a></li><li><a href="src_gl-io.ads.html#l52" title="To spec">To spec</a></li></ul></span> := <span class="keyword">null</span>; </pre></li>
<li id="l471"><pre>      stream_buf : <span class="droplink">Input_buffer<ul><li><a href="gl-io.ads.html#gl-io.ads:145:8" title="To API doc">To API doc</a></li><li><a href="src_gl-io.ads.html#l145" title="To spec">To spec</a></li><li><a href="src_gl-io.ads.html#l155" title="To body">To body</a></li></ul></span>; </pre></li>
<li id="l472"><pre> </pre></li>
<li id="l473"><pre>      <span class="keyword">subtype</span> Y_Loc <span class="keyword">is</span> Natural <span class="keyword">range</span> 0 .. 4095; </pre></li>
<li id="l474"><pre>      <span class="keyword">subtype</span> X_Loc <span class="keyword">is</span> Natural <span class="keyword">range</span> 0 .. 4095; </pre></li>
<li id="l475"><pre> </pre></li>
<li id="l476"><pre>      <span class="comment">-- 256 - col types</span> </pre></li>
<li id="l477"><pre> </pre></li>
<li id="l478"><pre>      <span class="keyword">subtype</span> Color_Type <span class="keyword">is</span> <span class="droplink">GL.Ubyte<ul><li><a href="gl.ads.html#gl.ads:122:9" title="To API doc">To API doc</a></li><li><a href="src_gl.ads.html#l122" title="To spec">To spec</a></li></ul></span>; </pre></li>
<li id="l479"><pre> </pre></li>
<li id="l480"><pre>      <span class="keyword">type</span> RGB_Color_Bytes <span class="keyword">is</span> </pre></li>
<li id="l481"><pre>         <span class="keyword">record</span> </pre></li>
<li id="l482"><pre>            Red    : <a href="src_gl-io.adb.html#l478" title="defined at gl-io.adb:478:15">Color_Type</a>; </pre></li>
<li id="l483"><pre>            Green  : <a href="src_gl-io.adb.html#l478" title="defined at gl-io.adb:478:15">Color_Type</a>; </pre></li>
<li id="l484"><pre>            Blue   : <a href="src_gl-io.adb.html#l478" title="defined at gl-io.adb:478:15">Color_Type</a>; </pre></li>
<li id="l485"><pre>         <span class="keyword">end</span> <span class="keyword">record</span>; </pre></li>
<li id="l486"><pre> </pre></li>
<li id="l487"><pre>      <span class="keyword">type</span> Color_Palette <span class="keyword">is</span> <span class="keyword">array</span> (<a href="src_gl-io.adb.html#l478" title="defined at gl-io.adb:478:15">Color_Type</a>) <span class="keyword">of</span> <a href="src_gl-io.adb.html#l480" title="defined at gl-io.adb:480:12">RGB_Color_Bytes</a>; </pre></li>
<li id="l488"><pre> </pre></li>
<li id="l489"><pre>      Palette  : <a href="src_gl-io.adb.html#l487" title="defined at gl-io.adb:487:12">Color_Palette</a>; </pre></li>
<li id="l490"><pre> </pre></li>
<li id="l491"><pre>      <span class="comment">----------------------------------------------------</span> </pre></li>
<li id="l492"><pre>      <span class="comment">-- BMP format I/O                                 --</span> </pre></li>
<li id="l493"><pre>      <span class="comment">--                                                --</span> </pre></li>
<li id="l494"><pre>      <span class="comment">-- Rev 1.5  10 - May - 2006 GdM : added 4 - bit support  --</span> </pre></li>
<li id="l495"><pre>      <span class="comment">-- Rev 1.4  11/02/99    RBS                       --</span> </pre></li>
<li id="l496"><pre>      <span class="comment">--                                                --</span> </pre></li>
<li id="l497"><pre>      <span class="comment">----------------------------------------------------</span> </pre></li>
<li id="l498"><pre>      <span class="comment">-- Coded by G. de Montmollin</span> </pre></li>
<li id="l499"><pre> </pre></li>
<li id="l500"><pre>      <span class="comment">-- Code additions, changes, and corrections by Bob Sutton</span> </pre></li>
<li id="l501"><pre>      <span class="comment">--</span> </pre></li>
<li id="l502"><pre>      <span class="comment">-- Remarks expanded and altered</span> </pre></li>
<li id="l503"><pre>      <span class="comment">-- Provided for scanline padding in data stream</span> </pre></li>
<li id="l504"><pre>      <span class="comment">-- Corrected stream reading for images exceeding screen size.</span> </pre></li>
<li id="l505"><pre>      <span class="comment">-- Provided selectable trim modes for oversize images</span> </pre></li>
<li id="l506"><pre>      <span class="comment">-- Procedures originally Read_BMP_dimensions now Read_BMP_Header</span> </pre></li>
<li id="l507"><pre>      <span class="comment">-- Some exceptions added</span> </pre></li>
<li id="l508"><pre>      <span class="comment">--</span> </pre></li>
<li id="l509"><pre>      <span class="comment">-- Rev 1.2  RBS.  Added variable XY screen location for BMP</span> </pre></li>
<li id="l510"><pre>      <span class="comment">-- Rev 1.3  RBS.  Added image inversion &amp; reversal capability</span> </pre></li>
<li id="l511"><pre>      <span class="comment">-- Rev 1.4  RBS.  Activated LOCATE centering / clipping options</span> </pre></li>
<li id="l512"><pre>      <span class="comment">--</span> </pre></li>
<li id="l513"><pre>      <span class="comment">-- This version presumes that the infile is a new style, 256 color bitmap.</span> </pre></li>
<li id="l514"><pre>      <span class="comment">-- The Bitmap Information Header structure (40 bytes) is presumed</span> </pre></li>
<li id="l515"><pre>      <span class="comment">-- instead of the pre - Windows 3.0 Bitmap Core Header Structure (12 Bytes)</span> </pre></li>
<li id="l516"><pre>      <span class="comment">-- Pos 15 (0EH), if 28H, is valid BIH structure.  If 0CH, is BCH structure.</span> </pre></li>
<li id="l517"><pre> </pre></li>
<li id="l518"><pre>      <span class="keyword">procedure</span> Read_BMP_Header (S : Stream_Access; </pre></li>
<li id="l519"><pre>                                 width      : <span class="keyword">out</span> <a href="src_gl-io.adb.html#l474" title="defined at gl-io.adb:474:15">X_Loc</a>; </pre></li>
<li id="l520"><pre>                                 height     : <span class="keyword">out</span> <a href="src_gl-io.adb.html#l473" title="defined at gl-io.adb:473:15">Y_Loc</a>; </pre></li>
<li id="l521"><pre>                                 image_bits : <span class="keyword">out</span> Integer; </pre></li>
<li id="l522"><pre>                                 offset     : <span class="keyword">out</span> <a href="src_gl-io.adb.html#l20" title="defined at gl-io.adb:20:9">U32</a>) <span class="keyword">is</span> </pre></li>
<li id="l523"><pre> </pre></li>
<li id="l524"><pre>         fsz : <a href="src_gl-io.adb.html#l20" title="defined at gl-io.adb:20:9">U32</a>; </pre></li>
<li id="l525"><pre>         ih : <a href="src_gl-io.adb.html#l20" title="defined at gl-io.adb:20:9">U32</a>; </pre></li>
<li id="l526"><pre>         w, dummy16 : <a href="src_gl-io.adb.html#l19" title="defined at gl-io.adb:19:9">U16</a>; </pre></li>
<li id="l527"><pre>         n : <a href="src_gl-io.adb.html#l20" title="defined at gl-io.adb:20:9">U32</a>; </pre></li>
<li id="l528"><pre>         Str2 :  String (1 .. 2); </pre></li>
<li id="l529"><pre>         Str4 :  String (1 .. 4); </pre></li>
<li id="l530"><pre>         Str20 : String (1 .. 20); </pre></li>
<li id="l531"><pre> </pre></li>
<li id="l532"><pre>         <span class="comment">-- Get numbers with correct trucmuche endian, to ensure</span> </pre></li>
<li id="l533"><pre>         <span class="comment">-- correct header loading on some non - Intel machines</span> </pre></li>
<li id="l534"><pre> </pre></li>
<li id="l535"><pre>         <span class="keyword">generic</span> </pre></li>
<li id="l536"><pre>            <span class="keyword">type</span> Number <span class="keyword">is</span> <span class="keyword">mod</span> &lt;&gt;; <span class="comment">-- range &lt;&gt; in Ada83 version (fake Interfaces)</span> </pre></li>
<li id="l537"><pre>         <span class="keyword">procedure</span> <a href="src_gl-io.adb.html#l539" title="defined at gl-io.adb:537:20">Read_Intel_x86_number</a> (n : <span class="keyword">out</span> <a href="src_gl-io.adb.html#l536" title="defined at gl-io.adb:536:18">Number</a>); </pre></li>
<li id="l538"><pre> </pre></li>
<li id="l539"><pre>         <span class="keyword">procedure</span> <a href="src_gl-io.adb.html#l537" title="defined at gl-io.adb:537:20">Read_Intel_x86_number</a> (<a href="src_gl-io.adb.html#l537" title="defined at gl-io.adb:537:43">n</a> : <span class="keyword">out</span> <a href="src_gl-io.adb.html#l536" title="defined at gl-io.adb:536:18">Number</a>) <span class="keyword">is</span> </pre></li>
<li id="l540"><pre>            b : <span class="droplink">GL.Ubyte<ul><li><a href="gl.ads.html#gl.ads:122:9" title="To API doc">To API doc</a></li><li><a href="src_gl.ads.html#l122" title="To spec">To spec</a></li></ul></span>; </pre></li>
<li id="l541"><pre>            m : <a href="src_gl-io.adb.html#l536" title="defined at gl-io.adb:536:18">Number</a> := 1; </pre></li>
<li id="l542"><pre>         <span class="keyword">begin</span> </pre></li>
<li id="l543"><pre>            <a href="src_gl-io.adb.html#l537" title="defined at gl-io.adb:537:43">n</a> := 0; </pre></li>
<li id="l544"><pre>            <span class="keyword">for</span> i <span class="keyword">in</span> 1 .. <a href="src_gl-io.adb.html#l536" title="defined at gl-io.adb:536:18">Number</a>&apos;Size / 8 <span class="keyword">loop</span> </pre></li>
<li id="l545"><pre>               <span class="droplink">GL.Ubyte<ul><li><a href="gl.ads.html#gl.ads:122:9" title="To API doc">To API doc</a></li><li><a href="src_gl.ads.html#l122" title="To spec">To spec</a></li></ul></span>&apos;Read (<a href="src_gl-io.adb.html#l518" title="defined at gl-io.adb:518:34">S</a>, b); </pre></li>
<li id="l546"><pre>               <a href="src_gl-io.adb.html#l537" title="defined at gl-io.adb:537:43">n</a> := <a href="src_gl-io.adb.html#l537" title="defined at gl-io.adb:537:43">n</a> + m * <a href="src_gl-io.adb.html#l536" title="defined at gl-io.adb:536:18">Number</a> (b); </pre></li>
<li id="l547"><pre>               m := m * 256; </pre></li>
<li id="l548"><pre>            <span class="keyword">end</span> <span class="keyword">loop</span>; </pre></li>
<li id="l549"><pre>         <span class="keyword">end</span> <span class="droplink">Read_Intel_x86_number<ul><li><a href="src_gl-io.adb.html#l537" title="To spec">To spec</a></li><li><a href="src_gl-io.adb.html#l539" title="To body">To body</a></li></ul></span>; </pre></li>
<li id="l550"><pre> </pre></li>
<li id="l551"><pre>         <span class="keyword">procedure</span> <a href="src_gl-io.adb.html#l539" title="defined at gl-io.adb:551:20">Read_Intel</a> <span class="keyword">is</span> <span class="keyword">new</span> <span class="droplink">Read_Intel_x86_number<ul><li><a href="src_gl-io.adb.html#l537" title="To spec">To spec</a></li><li><a href="src_gl-io.adb.html#l539" title="To body">To body</a></li></ul></span> (<a href="src_gl-io.adb.html#l19" title="defined at gl-io.adb:19:9">U16</a>); </pre></li>
<li id="l552"><pre>         <span class="keyword">procedure</span> <a href="src_gl-io.adb.html#l539" title="defined at gl-io.adb:552:20">Read_Intel</a> <span class="keyword">is</span> <span class="keyword">new</span> <span class="droplink">Read_Intel_x86_number<ul><li><a href="src_gl-io.adb.html#l537" title="To spec">To spec</a></li><li><a href="src_gl-io.adb.html#l539" title="To body">To body</a></li></ul></span> (<a href="src_gl-io.adb.html#l20" title="defined at gl-io.adb:20:9">U32</a>); </pre></li>
<li id="l553"><pre> </pre></li>
<li id="l554"><pre>      <span class="keyword">begin</span> </pre></li>
<li id="l555"><pre>         <span class="comment">--   First 14 bytes is file header structure.</span> </pre></li>
<li id="l556"><pre>         <span class="comment">--   Pos= 1,  read 2 bytes, file signature word</span> </pre></li>
<li id="l557"><pre>         String&apos;Read (<a href="src_gl-io.adb.html#l518" title="defined at gl-io.adb:518:34">S</a>, <a href="src_gl-io.adb.html#l528" title="defined at gl-io.adb:528:10">Str2</a>); </pre></li>
<li id="l558"><pre>         <span class="keyword">if</span> <a href="src_gl-io.adb.html#l528" title="defined at gl-io.adb:528:10">Str2</a> /= <span class="string">&quot;BM&quot;</span> <span class="keyword">then</span> </pre></li>
<li id="l559"><pre>            <span class="keyword">raise</span> <span class="droplink">Not_BMP_format<ul><li><a href="gl-io.ads.html#gl-io.ads:103:3" title="To API doc">To API doc</a></li><li><a href="src_gl-io.ads.html#l103" title="To spec">To spec</a></li></ul></span>; </pre></li>
<li id="l560"><pre>         <span class="keyword">end</span> <span class="keyword">if</span>; </pre></li>
<li id="l561"><pre>         <span class="comment">--   Pos= 3,  read the file size</span> </pre></li>
<li id="l562"><pre>         <span class="droplink">Read_Intel<ul><li><a href="src_gl-io.adb.html#l552" title="To spec">To spec</a></li><li><a href="src_gl-io.adb.html#l539" title="To body">To body</a></li></ul></span> (<a href="src_gl-io.adb.html#l524" title="defined at gl-io.adb:524:10">fsz</a>); </pre></li>
<li id="l563"><pre>         <span class="comment">--   Pos= 7, read four bytes, unknown</span> </pre></li>
<li id="l564"><pre>         String&apos;Read (<a href="src_gl-io.adb.html#l518" title="defined at gl-io.adb:518:34">S</a>, <a href="src_gl-io.adb.html#l529" title="defined at gl-io.adb:529:10">Str4</a>); </pre></li>
<li id="l565"><pre>         <span class="comment">--   Pos= 11, read four bytes offset, file top to bitmap data.</span> </pre></li>
<li id="l566"><pre>         <span class="comment">--            For 256 colors, this is usually 36 04 00 00</span> </pre></li>
<li id="l567"><pre>         <span class="droplink">Read_Intel<ul><li><a href="src_gl-io.adb.html#l552" title="To spec">To spec</a></li><li><a href="src_gl-io.adb.html#l539" title="To body">To body</a></li></ul></span> (<a href="src_gl-io.adb.html#l522" title="defined at gl-io.adb:522:34">offset</a>); </pre></li>
<li id="l568"><pre>         <span class="comment">--   Pos= 15. The beginning of Bitmap information header.</span> </pre></li>
<li id="l569"><pre>         <span class="comment">--   Data expected :  28H, denoting 40 byte header</span> </pre></li>
<li id="l570"><pre>         <span class="droplink">Read_Intel<ul><li><a href="src_gl-io.adb.html#l552" title="To spec">To spec</a></li><li><a href="src_gl-io.adb.html#l539" title="To body">To body</a></li></ul></span> (<a href="src_gl-io.adb.html#l525" title="defined at gl-io.adb:525:10">ih</a>); </pre></li>
<li id="l571"><pre>         <span class="comment">--   Pos= 19. Bitmap width, in pixels.  Four bytes</span> </pre></li>
<li id="l572"><pre>         <span class="droplink">Read_Intel<ul><li><a href="src_gl-io.adb.html#l552" title="To spec">To spec</a></li><li><a href="src_gl-io.adb.html#l539" title="To body">To body</a></li></ul></span> (<a href="src_gl-io.adb.html#l527" title="defined at gl-io.adb:527:10">n</a>); </pre></li>
<li id="l573"><pre>         <a href="src_gl-io.adb.html#l519" title="defined at gl-io.adb:519:34">width</a> :=  <a href="src_gl-io.adb.html#l474" title="defined at gl-io.adb:474:15">X_Loc</a> (<a href="src_gl-io.adb.html#l527" title="defined at gl-io.adb:527:10">n</a>); </pre></li>
<li id="l574"><pre>         <span class="comment">--   Pos= 23. Bitmap height, in pixels.  Four bytes</span> </pre></li>
<li id="l575"><pre>         <span class="droplink">Read_Intel<ul><li><a href="src_gl-io.adb.html#l552" title="To spec">To spec</a></li><li><a href="src_gl-io.adb.html#l539" title="To body">To body</a></li></ul></span> (<a href="src_gl-io.adb.html#l527" title="defined at gl-io.adb:527:10">n</a>); </pre></li>
<li id="l576"><pre>         <a href="src_gl-io.adb.html#l520" title="defined at gl-io.adb:520:34">height</a> := <a href="src_gl-io.adb.html#l473" title="defined at gl-io.adb:473:15">Y_Loc</a> (<a href="src_gl-io.adb.html#l527" title="defined at gl-io.adb:527:10">n</a>); </pre></li>
<li id="l577"><pre>         <span class="comment">--   Pos= 27, skip two bytes.  Data is number of Bitmap planes.</span> </pre></li>
<li id="l578"><pre>         <span class="droplink">Read_Intel<ul><li><a href="src_gl-io.adb.html#l551" title="To spec">To spec</a></li><li><a href="src_gl-io.adb.html#l539" title="To body">To body</a></li></ul></span> (<a href="src_gl-io.adb.html#l526" title="defined at gl-io.adb:526:13">dummy16</a>); <span class="comment">-- perform the skip</span> </pre></li>
<li id="l579"><pre>         <span class="comment">--   Pos= 29, Number of bits per pixel</span> </pre></li>
<li id="l580"><pre>         <span class="comment">--   Value 8, denoting 256 color, is expected</span> </pre></li>
<li id="l581"><pre>         <span class="droplink">Read_Intel<ul><li><a href="src_gl-io.adb.html#l551" title="To spec">To spec</a></li><li><a href="src_gl-io.adb.html#l539" title="To body">To body</a></li></ul></span> (<a href="src_gl-io.adb.html#l526" title="defined at gl-io.adb:526:10">w</a>); </pre></li>
<li id="l582"><pre>         <span class="keyword">if</span> <a href="src_gl-io.adb.html#l526" title="defined at gl-io.adb:526:10">w</a> /= 8 <span class="keyword">and</span> <span class="keyword">then</span> <a href="src_gl-io.adb.html#l526" title="defined at gl-io.adb:526:10">w</a> /= 4 <span class="keyword">and</span> <span class="keyword">then</span> <a href="src_gl-io.adb.html#l526" title="defined at gl-io.adb:526:10">w</a> /= 1 <span class="keyword">then</span> </pre></li>
<li id="l583"><pre>            <span class="keyword">raise</span> <span class="droplink">BMP_Unsupported_Bits_per_Pixel<ul><li><a href="gl-io.ads.html#gl-io.ads:104:3" title="To API doc">To API doc</a></li><li><a href="src_gl-io.ads.html#l104" title="To spec">To spec</a></li></ul></span>; </pre></li>
<li id="l584"><pre>         <span class="keyword">end</span> <span class="keyword">if</span>; </pre></li>
<li id="l585"><pre>         <a href="src_gl-io.adb.html#l521" title="defined at gl-io.adb:521:34">image_bits</a> := Integer (<a href="src_gl-io.adb.html#l526" title="defined at gl-io.adb:526:10">w</a>); </pre></li>
<li id="l586"><pre>         <span class="comment">--   Pos= 31, read four bytees</span> </pre></li>
<li id="l587"><pre>         <span class="droplink">Read_Intel<ul><li><a href="src_gl-io.adb.html#l552" title="To spec">To spec</a></li><li><a href="src_gl-io.adb.html#l539" title="To body">To body</a></li></ul></span> (<a href="src_gl-io.adb.html#l527" title="defined at gl-io.adb:527:10">n</a>);                <span class="comment">-- Type of compression used</span> </pre></li>
<li id="l588"><pre>         <span class="keyword">if</span> <a href="src_gl-io.adb.html#l527" title="defined at gl-io.adb:527:10">n</a> /= 0 <span class="keyword">then</span> </pre></li>
<li id="l589"><pre>            <span class="keyword">raise</span> <span class="droplink">Unsupported_compression<ul><li><a href="gl-io.ads.html#gl-io.ads:105:3" title="To API doc">To API doc</a></li><li><a href="src_gl-io.ads.html#l105" title="To spec">To spec</a></li></ul></span>; </pre></li>
<li id="l590"><pre>         <span class="keyword">end</span> <span class="keyword">if</span>; </pre></li>
<li id="l591"><pre> </pre></li>
<li id="l592"><pre>         <span class="comment">--   Pos= 35 (23H), skip twenty bytes</span> </pre></li>
<li id="l593"><pre>         String&apos;Read (<a href="src_gl-io.adb.html#l518" title="defined at gl-io.adb:518:34">S</a>, <a href="src_gl-io.adb.html#l530" title="defined at gl-io.adb:530:10">Str20</a>);     <span class="comment">-- perform the skip</span> </pre></li>
<li id="l594"><pre> </pre></li>
<li id="l595"><pre>         <span class="comment">--   Pos= 55 (36H), - start of palette</span> </pre></li>
<li id="l596"><pre>      <span class="keyword">end</span> <span class="droplink">Read_BMP_Header<ul><li><a href="src_gl-io.adb.html#l518" title="To spec">To spec</a></li><li><a href="src_gl-io.adb.html#l518" title="To body">To body</a></li></ul></span>; </pre></li>
<li id="l597"><pre> </pre></li>
<li id="l598"><pre>      <span class="keyword">procedure</span> Load_BMP_Palette (S           :     Stream_Access; </pre></li>
<li id="l599"><pre>                                  Image_Bits  :     Integer; </pre></li>
<li id="l600"><pre>                                  BMP_Palette : <span class="keyword">out</span> <a href="src_gl-io.adb.html#l487" title="defined at gl-io.adb:487:12">Color_Palette</a>) <span class="keyword">is</span> </pre></li>
<li id="l601"><pre> </pre></li>
<li id="l602"><pre>         dummy : <span class="droplink">GL.Ubyte<ul><li><a href="gl.ads.html#gl.ads:122:9" title="To API doc">To API doc</a></li><li><a href="src_gl.ads.html#l122" title="To spec">To spec</a></li></ul></span>; </pre></li>
<li id="l603"><pre>         mc : <span class="keyword">constant</span> <a href="src_gl-io.adb.html#l478" title="defined at gl-io.adb:478:15">Color_Type</a> := (2**<a href="src_gl-io.adb.html#l599" title="defined at gl-io.adb:599:35">Image_Bits</a>) - 1; </pre></li>
<li id="l604"><pre> </pre></li>
<li id="l605"><pre>      <span class="keyword">begin</span> </pre></li>
<li id="l606"><pre>         <span class="keyword">for</span> DAC <span class="keyword">in</span> 0 .. <a href="src_gl-io.adb.html#l603" title="defined at gl-io.adb:603:10">mc</a> <span class="keyword">loop</span> </pre></li>
<li id="l607"><pre>            <span class="droplink">GL.Ubyte<ul><li><a href="gl.ads.html#gl.ads:122:9" title="To API doc">To API doc</a></li><li><a href="src_gl.ads.html#l122" title="To spec">To spec</a></li></ul></span>&apos;Read (<a href="src_gl-io.adb.html#l598" title="defined at gl-io.adb:598:35">S</a>, <a href="src_gl-io.adb.html#l600" title="defined at gl-io.adb:600:35">BMP_Palette</a> (DAC).Blue); </pre></li>
<li id="l608"><pre>            <span class="droplink">GL.Ubyte<ul><li><a href="gl.ads.html#gl.ads:122:9" title="To API doc">To API doc</a></li><li><a href="src_gl.ads.html#l122" title="To spec">To spec</a></li></ul></span>&apos;Read (<a href="src_gl-io.adb.html#l598" title="defined at gl-io.adb:598:35">S</a>, <a href="src_gl-io.adb.html#l600" title="defined at gl-io.adb:600:35">BMP_Palette</a> (DAC).Green); </pre></li>
<li id="l609"><pre>            <span class="droplink">GL.Ubyte<ul><li><a href="gl.ads.html#gl.ads:122:9" title="To API doc">To API doc</a></li><li><a href="src_gl.ads.html#l122" title="To spec">To spec</a></li></ul></span>&apos;Read (<a href="src_gl-io.adb.html#l598" title="defined at gl-io.adb:598:35">S</a>, <a href="src_gl-io.adb.html#l600" title="defined at gl-io.adb:600:35">BMP_Palette</a> (DAC).Red); </pre></li>
<li id="l610"><pre>            <span class="droplink">GL.Ubyte<ul><li><a href="gl.ads.html#gl.ads:122:9" title="To API doc">To API doc</a></li><li><a href="src_gl.ads.html#l122" title="To spec">To spec</a></li></ul></span>&apos;Read (<a href="src_gl-io.adb.html#l598" title="defined at gl-io.adb:598:35">S</a>, <a href="src_gl-io.adb.html#l602" title="defined at gl-io.adb:602:10">dummy</a>); </pre></li>
<li id="l611"><pre>         <span class="keyword">end</span> <span class="keyword">loop</span>; </pre></li>
<li id="l612"><pre>      <span class="keyword">end</span> <span class="droplink">Load_BMP_Palette<ul><li><a href="src_gl-io.adb.html#l598" title="To spec">To spec</a></li><li><a href="src_gl-io.adb.html#l598" title="To body">To body</a></li></ul></span>; </pre></li>
<li id="l613"><pre> </pre></li>
<li id="l614"><pre>      <span class="comment">-- Load image only from stream (after having read header and palette!)</span> </pre></li>
<li id="l615"><pre> </pre></li>
<li id="l616"><pre>      <span class="keyword">procedure</span> Load_BMP_Image (S           : Stream_Access; </pre></li>
<li id="l617"><pre>                                width       :        <a href="src_gl-io.adb.html#l474" title="defined at gl-io.adb:474:15">X_Loc</a>; </pre></li>
<li id="l618"><pre>                                height      :        <a href="src_gl-io.adb.html#l473" title="defined at gl-io.adb:473:15">Y_Loc</a>; </pre></li>
<li id="l619"><pre>                                Buffer      : <span class="keyword">in</span> <span class="keyword">out</span> <span class="droplink">Byte_Array<ul><li><a href="gl-io.ads.html#gl-io.ads:51:8" title="To API doc">To API doc</a></li><li><a href="src_gl-io.ads.html#l51" title="To spec">To spec</a></li></ul></span>; </pre></li>
<li id="l620"><pre>                                BMP_bits    :        Integer; </pre></li>
<li id="l621"><pre>                                BMP_Palette : <a href="src_gl-io.adb.html#l487" title="defined at gl-io.adb:487:12">Color_Palette</a>) <span class="keyword">is</span> </pre></li>
<li id="l622"><pre> </pre></li>
<li id="l623"><pre>         idx : Natural; </pre></li>
<li id="l624"><pre>         b01, b : <span class="droplink">GL.Ubyte<ul><li><a href="gl.ads.html#gl.ads:122:9" title="To API doc">To API doc</a></li><li><a href="src_gl.ads.html#l122" title="To spec">To spec</a></li></ul></span> := 0; </pre></li>
<li id="l625"><pre>         pair : Boolean := True; </pre></li>
<li id="l626"><pre>         bit : Natural <span class="keyword">range</span> 0 .. 7 := 0; </pre></li>
<li id="l627"><pre>         <span class="comment">--</span> </pre></li>
<li id="l628"><pre>         x3 : Natural; <span class="comment">-- idx + x*3 (each pixel takes 3 bytes)</span> </pre></li>
<li id="l629"><pre>         x3_max : Natural; </pre></li>
<li id="l630"><pre>         <span class="comment">--</span> </pre></li>
<li id="l631"><pre>         <span class="keyword">procedure</span> Fill_palettized <span class="keyword">is</span> </pre></li>
<li id="l632"><pre>            <span class="keyword">pragma</span> Inline (<span class="droplink">Fill_palettized<ul><li><a href="src_gl-io.adb.html#l631" title="To spec">To spec</a></li><li><a href="src_gl-io.adb.html#l631" title="To body">To body</a></li></ul></span>); </pre></li>
<li id="l633"><pre>         <span class="keyword">begin</span> </pre></li>
<li id="l634"><pre>            <a href="src_gl-io.adb.html#l619" title="defined at gl-io.adb:619:33">Buffer</a> (<a href="src_gl-io.adb.html#l628" title="defined at gl-io.adb:628:10">x3</a>) := <span class="droplink">Ubyte<ul><li><a href="gl.ads.html#gl.ads:122:9" title="To API doc">To API doc</a></li><li><a href="src_gl.ads.html#l122" title="To spec">To spec</a></li></ul></span> (<a href="src_gl-io.adb.html#l621" title="defined at gl-io.adb:621:33">BMP_Palette</a> (<a href="src_gl-io.adb.html#l624" title="defined at gl-io.adb:624:15">b</a>).Red); </pre></li>
<li id="l635"><pre>            <a href="src_gl-io.adb.html#l619" title="defined at gl-io.adb:619:33">Buffer</a> (<a href="src_gl-io.adb.html#l628" title="defined at gl-io.adb:628:10">x3</a> + 1) := <span class="droplink">Ubyte<ul><li><a href="gl.ads.html#gl.ads:122:9" title="To API doc">To API doc</a></li><li><a href="src_gl.ads.html#l122" title="To spec">To spec</a></li></ul></span> (<a href="src_gl-io.adb.html#l621" title="defined at gl-io.adb:621:33">BMP_Palette</a> (<a href="src_gl-io.adb.html#l624" title="defined at gl-io.adb:624:15">b</a>).Green); </pre></li>
<li id="l636"><pre>            <a href="src_gl-io.adb.html#l619" title="defined at gl-io.adb:619:33">Buffer</a> (<a href="src_gl-io.adb.html#l628" title="defined at gl-io.adb:628:10">x3</a> + 2) := <span class="droplink">Ubyte<ul><li><a href="gl.ads.html#gl.ads:122:9" title="To API doc">To API doc</a></li><li><a href="src_gl.ads.html#l122" title="To spec">To spec</a></li></ul></span> (<a href="src_gl-io.adb.html#l621" title="defined at gl-io.adb:621:33">BMP_Palette</a> (<a href="src_gl-io.adb.html#l624" title="defined at gl-io.adb:624:15">b</a>).Blue); </pre></li>
<li id="l637"><pre>         <span class="keyword">end</span> <span class="droplink">Fill_palettized<ul><li><a href="src_gl-io.adb.html#l631" title="To spec">To spec</a></li><li><a href="src_gl-io.adb.html#l631" title="To body">To body</a></li></ul></span>; </pre></li>
<li id="l638"><pre>         <span class="comment">--</span> </pre></li>
<li id="l639"><pre>      <span class="keyword">begin</span> </pre></li>
<li id="l640"><pre>         <span class="droplink">Attach_Stream<ul><li><a href="gl-io.ads.html#gl-io.ads:147:13" title="To API doc">To API doc</a></li><li><a href="src_gl-io.ads.html#l147" title="To spec">To spec</a></li><li><a href="src_gl-io.adb.html#l132" title="To body">To body</a></li></ul></span> (<a href="src_gl-io.adb.html#l471" title="defined at gl-io.adb:471:7">stream_buf</a>, <a href="src_gl-io.adb.html#l616" title="defined at gl-io.adb:616:33">S</a>); </pre></li>
<li id="l641"><pre>         <span class="keyword">for</span> y <span class="keyword">in</span> 0 .. <a href="src_gl-io.adb.html#l618" title="defined at gl-io.adb:618:33">height</a> - 1 <span class="keyword">loop</span> </pre></li>
<li id="l642"><pre>            <a href="src_gl-io.adb.html#l623" title="defined at gl-io.adb:623:10">idx</a> := y * <a href="src_gl-io.adb.html#l617" title="defined at gl-io.adb:617:33">width</a> * 3; <span class="comment">-- GL destination picture is 24 bit</span> </pre></li>
<li id="l643"><pre>            <a href="src_gl-io.adb.html#l628" title="defined at gl-io.adb:628:10">x3</a> := <a href="src_gl-io.adb.html#l623" title="defined at gl-io.adb:623:10">idx</a>; </pre></li>
<li id="l644"><pre>            <a href="src_gl-io.adb.html#l629" title="defined at gl-io.adb:629:10">x3_max</a> := <a href="src_gl-io.adb.html#l623" title="defined at gl-io.adb:623:10">idx</a> + (<a href="src_gl-io.adb.html#l617" title="defined at gl-io.adb:617:33">width</a> - 1) * 3; </pre></li>
<li id="l645"><pre>            <span class="keyword">case</span> <a href="src_gl-io.adb.html#l620" title="defined at gl-io.adb:620:33">BMP_bits</a> <span class="keyword">is</span> </pre></li>
<li id="l646"><pre>            <span class="keyword">when</span> 1 =&gt; <span class="comment">-- B/W</span> </pre></li>
<li id="l647"><pre>               <span class="keyword">while</span> <a href="src_gl-io.adb.html#l628" title="defined at gl-io.adb:628:10">x3</a> &lt;= <a href="src_gl-io.adb.html#l629" title="defined at gl-io.adb:629:10">x3_max</a> <span class="keyword">loop</span> </pre></li>
<li id="l648"><pre>                  <span class="keyword">if</span> <a href="src_gl-io.adb.html#l626" title="defined at gl-io.adb:626:10">bit</a> = 0 <span class="keyword">then</span> </pre></li>
<li id="l649"><pre>                     <span class="droplink">Get_Byte<ul><li><a href="gl-io.ads.html#gl-io.ads:150:13" title="To API doc">To API doc</a></li><li><a href="src_gl-io.ads.html#l150" title="To spec">To spec</a></li><li><a href="src_gl-io.adb.html#l140" title="To body">To body</a></li></ul></span> (<a href="src_gl-io.adb.html#l471" title="defined at gl-io.adb:471:7">stream_buf</a>, <a href="src_gl-io.adb.html#l624" title="defined at gl-io.adb:624:10">b01</a>); </pre></li>
<li id="l650"><pre>                  <span class="keyword">end</span> <span class="keyword">if</span>; </pre></li>
<li id="l651"><pre>                  <a href="src_gl-io.adb.html#l624" title="defined at gl-io.adb:624:15">b</a> := (<a href="src_gl-io.adb.html#l624" title="defined at gl-io.adb:624:10">b01</a> <span class="keyword">and</span> 16#80#) / 16#80#; </pre></li>
<li id="l652"><pre>                  <span class="droplink">Fill_palettized<ul><li><a href="src_gl-io.adb.html#l631" title="To spec">To spec</a></li><li><a href="src_gl-io.adb.html#l631" title="To body">To body</a></li></ul></span>; </pre></li>
<li id="l653"><pre>                  <a href="src_gl-io.adb.html#l624" title="defined at gl-io.adb:624:10">b01</a> := <a href="src_gl-io.adb.html#l624" title="defined at gl-io.adb:624:10">b01</a> * 2; <span class="comment">-- cannot overflow.</span> </pre></li>
<li id="l654"><pre>                  <span class="keyword">if</span> <a href="src_gl-io.adb.html#l626" title="defined at gl-io.adb:626:10">bit</a> = 7 <span class="keyword">then</span> </pre></li>
<li id="l655"><pre>                     <a href="src_gl-io.adb.html#l626" title="defined at gl-io.adb:626:10">bit</a> := 0; </pre></li>
<li id="l656"><pre>                  <span class="keyword">else</span> </pre></li>
<li id="l657"><pre>                     <a href="src_gl-io.adb.html#l626" title="defined at gl-io.adb:626:10">bit</a> := <a href="src_gl-io.adb.html#l626" title="defined at gl-io.adb:626:10">bit</a> + 1; </pre></li>
<li id="l658"><pre>                  <span class="keyword">end</span> <span class="keyword">if</span>; </pre></li>
<li id="l659"><pre>                  <a href="src_gl-io.adb.html#l628" title="defined at gl-io.adb:628:10">x3</a> := <a href="src_gl-io.adb.html#l628" title="defined at gl-io.adb:628:10">x3</a> + 3; </pre></li>
<li id="l660"><pre>               <span class="keyword">end</span> <span class="keyword">loop</span>; </pre></li>
<li id="l661"><pre>            <span class="keyword">when</span> 4 =&gt; <span class="comment">-- 16 colour image</span> </pre></li>
<li id="l662"><pre>               <span class="keyword">while</span> <a href="src_gl-io.adb.html#l628" title="defined at gl-io.adb:628:10">x3</a> &lt;= <a href="src_gl-io.adb.html#l629" title="defined at gl-io.adb:629:10">x3_max</a> <span class="keyword">loop</span> </pre></li>
<li id="l663"><pre>                  <span class="keyword">if</span> <a href="src_gl-io.adb.html#l625" title="defined at gl-io.adb:625:10">pair</a> <span class="keyword">then</span> </pre></li>
<li id="l664"><pre>                     <span class="droplink">Get_Byte<ul><li><a href="gl-io.ads.html#gl-io.ads:150:13" title="To API doc">To API doc</a></li><li><a href="src_gl-io.ads.html#l150" title="To spec">To spec</a></li><li><a href="src_gl-io.adb.html#l140" title="To body">To body</a></li></ul></span> (<a href="src_gl-io.adb.html#l471" title="defined at gl-io.adb:471:7">stream_buf</a>, <a href="src_gl-io.adb.html#l624" title="defined at gl-io.adb:624:10">b01</a>); </pre></li>
<li id="l665"><pre>                     <a href="src_gl-io.adb.html#l624" title="defined at gl-io.adb:624:15">b</a> := (<a href="src_gl-io.adb.html#l624" title="defined at gl-io.adb:624:10">b01</a> <span class="keyword">and</span> 16#F0#) / 16#10#; </pre></li>
<li id="l666"><pre>                  <span class="keyword">else</span> </pre></li>
<li id="l667"><pre>                     <a href="src_gl-io.adb.html#l624" title="defined at gl-io.adb:624:15">b</a> := (<a href="src_gl-io.adb.html#l624" title="defined at gl-io.adb:624:10">b01</a> <span class="keyword">and</span> 16#0F#); </pre></li>
<li id="l668"><pre>                  <span class="keyword">end</span> <span class="keyword">if</span>; </pre></li>
<li id="l669"><pre>                  <a href="src_gl-io.adb.html#l625" title="defined at gl-io.adb:625:10">pair</a> := <span class="keyword">not</span> <a href="src_gl-io.adb.html#l625" title="defined at gl-io.adb:625:10">pair</a>; </pre></li>
<li id="l670"><pre>                  <span class="droplink">Fill_palettized<ul><li><a href="src_gl-io.adb.html#l631" title="To spec">To spec</a></li><li><a href="src_gl-io.adb.html#l631" title="To body">To body</a></li></ul></span>; </pre></li>
<li id="l671"><pre>                  <a href="src_gl-io.adb.html#l628" title="defined at gl-io.adb:628:10">x3</a> := <a href="src_gl-io.adb.html#l628" title="defined at gl-io.adb:628:10">x3</a> + 3; </pre></li>
<li id="l672"><pre>               <span class="keyword">end</span> <span class="keyword">loop</span>; </pre></li>
<li id="l673"><pre>            <span class="keyword">when</span> 8 =&gt; <span class="comment">-- 256 colour image</span> </pre></li>
<li id="l674"><pre>               <span class="keyword">while</span> <a href="src_gl-io.adb.html#l628" title="defined at gl-io.adb:628:10">x3</a> &lt;= <a href="src_gl-io.adb.html#l629" title="defined at gl-io.adb:629:10">x3_max</a> <span class="keyword">loop</span> </pre></li>
<li id="l675"><pre>                  <span class="droplink">Get_Byte<ul><li><a href="gl-io.ads.html#gl-io.ads:150:13" title="To API doc">To API doc</a></li><li><a href="src_gl-io.ads.html#l150" title="To spec">To spec</a></li><li><a href="src_gl-io.adb.html#l140" title="To body">To body</a></li></ul></span> (<a href="src_gl-io.adb.html#l471" title="defined at gl-io.adb:471:7">stream_buf</a>, <a href="src_gl-io.adb.html#l624" title="defined at gl-io.adb:624:15">b</a>); </pre></li>
<li id="l676"><pre>                  <span class="droplink">Fill_palettized<ul><li><a href="src_gl-io.adb.html#l631" title="To spec">To spec</a></li><li><a href="src_gl-io.adb.html#l631" title="To body">To body</a></li></ul></span>; </pre></li>
<li id="l677"><pre>                  <a href="src_gl-io.adb.html#l628" title="defined at gl-io.adb:628:10">x3</a> := <a href="src_gl-io.adb.html#l628" title="defined at gl-io.adb:628:10">x3</a> + 3; </pre></li>
<li id="l678"><pre>               <span class="keyword">end</span> <span class="keyword">loop</span>; </pre></li>
<li id="l679"><pre>            <span class="keyword">when</span> <span class="keyword">others</span> =&gt; </pre></li>
<li id="l680"><pre>               <span class="keyword">null</span>; </pre></li>
<li id="l681"><pre>            <span class="keyword">end</span> <span class="keyword">case</span>; </pre></li>
<li id="l682"><pre>         <span class="keyword">end</span> <span class="keyword">loop</span>; </pre></li>
<li id="l683"><pre>      <span class="keyword">end</span> <span class="droplink">Load_BMP_Image<ul><li><a href="src_gl-io.adb.html#l616" title="To spec">To spec</a></li><li><a href="src_gl-io.adb.html#l616" title="To body">To body</a></li></ul></span>; </pre></li>
<li id="l684"><pre> </pre></li>
<li id="l685"><pre>      Width                : <a href="src_gl-io.adb.html#l474" title="defined at gl-io.adb:474:15">X_Loc</a>; </pre></li>
<li id="l686"><pre>      Height               : <a href="src_gl-io.adb.html#l473" title="defined at gl-io.adb:473:15">Y_Loc</a>; </pre></li>
<li id="l687"><pre>      offset               : <a href="src_gl-io.adb.html#l20" title="defined at gl-io.adb:20:9">U32</a>; </pre></li>
<li id="l688"><pre>      BMP_bits, imagebits  : Integer; </pre></li>
<li id="l689"><pre>      BMP_Size             : Integer; </pre></li>
<li id="l690"><pre>      BMP_tex_format       : <span class="droplink">GL.TexFormatEnm<ul><li><a href="gl.ads.html#gl.ads:2294:9" title="To API doc">To API doc</a></li><li><a href="src_gl.ads.html#l2294" title="To spec">To spec</a></li></ul></span>; </pre></li>
<li id="l691"><pre>      BMP_tex_pixel_format : <span class="droplink">GL.TexPixelFormatEnm<ul><li><a href="gl.ads.html#gl.ads:2382:9" title="To API doc">To API doc</a></li><li><a href="src_gl.ads.html#l2382" title="To spec">To spec</a></li></ul></span>; </pre></li>
<li id="l692"><pre> </pre></li>
<li id="l693"><pre>   <span class="keyword">begin</span> </pre></li>
<li id="l694"><pre>      <span class="droplink">Read_BMP_Header<ul><li><a href="src_gl-io.adb.html#l518" title="To spec">To spec</a></li><li><a href="src_gl-io.adb.html#l518" title="To body">To body</a></li></ul></span> (<span class="droplink">S<ul><li><a href="gl-io.ads.html#gl-io.ads:98:23" title="To API doc">To API doc</a></li><li><a href="src_gl-io.ads.html#l98" title="To spec">To spec</a></li></ul></span>, <a href="src_gl-io.adb.html#l685" title="defined at gl-io.adb:685:7">Width</a>, <a href="src_gl-io.adb.html#l686" title="defined at gl-io.adb:686:7">Height</a>, <a href="src_gl-io.adb.html#l688" title="defined at gl-io.adb:688:7">BMP_bits</a>, <a href="src_gl-io.adb.html#l687" title="defined at gl-io.adb:687:7">offset</a>); </pre></li>
<li id="l695"><pre>      <a href="src_gl-io.adb.html#l688" title="defined at gl-io.adb:688:17">imagebits</a> := 24; </pre></li>
<li id="l696"><pre>      <span class="droplink">blending_hint<ul><li><a href="gl-io.ads.html#gl-io.ads:100:23" title="To API doc">To API doc</a></li><li><a href="src_gl-io.ads.html#l100" title="To spec">To spec</a></li></ul></span> := False; <span class="comment">-- no blending with BMP&apos;s</span> </pre></li>
<li id="l697"><pre>      <a href="src_gl-io.adb.html#l690" title="defined at gl-io.adb:690:7">BMP_tex_format</a>      := GL.RGB; </pre></li>
<li id="l698"><pre>      <a href="src_gl-io.adb.html#l691" title="defined at gl-io.adb:691:7">BMP_tex_pixel_format</a> := GL.RGB; </pre></li>
<li id="l699"><pre>      <span class="droplink">Load_BMP_Palette<ul><li><a href="src_gl-io.adb.html#l598" title="To spec">To spec</a></li><li><a href="src_gl-io.adb.html#l598" title="To body">To body</a></li></ul></span> (<span class="droplink">S<ul><li><a href="gl-io.ads.html#gl-io.ads:98:23" title="To API doc">To API doc</a></li><li><a href="src_gl-io.ads.html#l98" title="To spec">To spec</a></li></ul></span>, <a href="src_gl-io.adb.html#l688" title="defined at gl-io.adb:688:7">BMP_bits</a>, <a href="src_gl-io.adb.html#l489" title="defined at gl-io.adb:489:7">Palette</a>); </pre></li>
<li id="l700"><pre> </pre></li>
<li id="l701"><pre>      <a href="src_gl-io.adb.html#l689" title="defined at gl-io.adb:689:7">BMP_Size</a> := <a href="src_gl-io.adb.html#l685" title="defined at gl-io.adb:685:7">Width</a> * <a href="src_gl-io.adb.html#l686" title="defined at gl-io.adb:686:7">Height</a>; </pre></li>
<li id="l702"><pre> </pre></li>
<li id="l703"><pre>      <span class="comment">-- Allocation</span> </pre></li>
<li id="l704"><pre>      <a href="src_gl-io.adb.html#l470" title="defined at gl-io.adb:470:7">imageData</a> := <span class="keyword">new</span> <span class="droplink">Byte_Array<ul><li><a href="gl-io.ads.html#gl-io.ads:51:8" title="To API doc">To API doc</a></li><li><a href="src_gl-io.ads.html#l51" title="To spec">To spec</a></li></ul></span> (0 .. (<a href="src_gl-io.adb.html#l688" title="defined at gl-io.adb:688:17">imagebits</a> / 8) * <a href="src_gl-io.adb.html#l689" title="defined at gl-io.adb:689:7">BMP_Size</a> - 1); </pre></li>
<li id="l705"><pre> </pre></li>
<li id="l706"><pre>      <span class="droplink">Load_BMP_Image<ul><li><a href="src_gl-io.adb.html#l616" title="To spec">To spec</a></li><li><a href="src_gl-io.adb.html#l616" title="To body">To body</a></li></ul></span> </pre></li>
<li id="l707"><pre>        (<span class="droplink">S<ul><li><a href="gl-io.ads.html#gl-io.ads:98:23" title="To API doc">To API doc</a></li><li><a href="src_gl-io.ads.html#l98" title="To spec">To spec</a></li></ul></span>, <a href="src_gl-io.adb.html#l685" title="defined at gl-io.adb:685:7">Width</a>, <a href="src_gl-io.adb.html#l686" title="defined at gl-io.adb:686:7">Height</a>, <a href="src_gl-io.adb.html#l470" title="defined at gl-io.adb:470:7">imageData</a>.<span class="keyword">all</span>, </pre></li>
<li id="l708"><pre>         <a href="src_gl-io.adb.html#l688" title="defined at gl-io.adb:688:7">BMP_bits</a>, <a href="src_gl-io.adb.html#l489" title="defined at gl-io.adb:489:7">Palette</a>); </pre></li>
<li id="l709"><pre> </pre></li>
<li id="l710"><pre>      <span class="droplink">Insert_into_GL<ul><li><a href="src_gl-io.adb.html#l46" title="To spec">To spec</a></li><li><a href="src_gl-io.adb.html#l46" title="To body">To body</a></li></ul></span> (<a href="src_gl-io.adb.html#l46" title="defined at gl-io.adb:46:30">id</a>             =&gt; <span class="droplink">Id<ul><li><a href="gl-io.ads.html#gl-io.ads:99:23" title="To API doc">To API doc</a></li><li><a href="src_gl-io.ads.html#l99" title="To spec">To spec</a></li></ul></span>, </pre></li>
<li id="l711"><pre>                      <a href="src_gl-io.adb.html#l47" title="defined at gl-io.adb:47:30">Insert_Size</a>    =&gt; <a href="src_gl-io.adb.html#l689" title="defined at gl-io.adb:689:7">BMP_Size</a>, </pre></li>
<li id="l712"><pre>                      <a href="src_gl-io.adb.html#l48" title="defined at gl-io.adb:48:30">width</a>          =&gt; <a href="src_gl-io.adb.html#l685" title="defined at gl-io.adb:685:7">Width</a>, </pre></li>
<li id="l713"><pre>                      <a href="src_gl-io.adb.html#l49" title="defined at gl-io.adb:49:30">height</a>         =&gt; <a href="src_gl-io.adb.html#l686" title="defined at gl-io.adb:686:7">Height</a>, </pre></li>
<li id="l714"><pre>                      <a href="src_gl-io.adb.html#l50" title="defined at gl-io.adb:50:30">texFormat</a>      =&gt; <a href="src_gl-io.adb.html#l690" title="defined at gl-io.adb:690:7">BMP_tex_format</a>, </pre></li>
<li id="l715"><pre>                      <a href="src_gl-io.adb.html#l51" title="defined at gl-io.adb:51:30">texPixelFormat</a> =&gt; <a href="src_gl-io.adb.html#l691" title="defined at gl-io.adb:691:7">BMP_tex_pixel_format</a>, </pre></li>
<li id="l716"><pre>                      <a href="src_gl-io.adb.html#l52" title="defined at gl-io.adb:52:30">image_p</a>        =&gt; <a href="src_gl-io.adb.html#l470" title="defined at gl-io.adb:470:7">imageData</a> </pre></li>
<li id="l717"><pre>                     ); </pre></li>
<li id="l718"><pre> </pre></li>
<li id="l719"><pre>      <span class="comment">-- release our data, its been uploaded to the GL system</span> </pre></li>
<li id="l720"><pre>      <span class="droplink">Free<ul><li><a href="gl-io.ads.html#gl-io.ads:54:13" title="To API doc">To API doc</a></li><li><a href="src_gl-io.ads.html#l54" title="To spec">To spec</a></li></ul></span> (<a href="src_gl-io.adb.html#l470" title="defined at gl-io.adb:470:7">imageData</a>); </pre></li>
<li id="l721"><pre> </pre></li>
<li id="l722"><pre>   <span class="keyword">end</span> <span class="droplink">Load_BMP<ul><li><a href="gl-io.ads.html#gl-io.ads:98:13" title="To API doc">To API doc</a></li><li><a href="src_gl-io.ads.html#l98" title="To spec">To spec</a></li><li><a href="src_gl-io.adb.html#l466" title="To body">To body</a></li></ul></span>; </pre></li>
<li id="l723"><pre> </pre></li>
<li id="l724"><pre>   <span class="keyword">procedure</span> <a href="src_gl-io.adb.html#l444" title="defined at gl-io.adb:724:14">i_Load_BMP</a> <span class="keyword">is</span> <span class="keyword">new</span> <span class="droplink">Load_XXX<ul><li><a href="src_gl-io.adb.html#l442" title="To spec">To spec</a></li><li><a href="src_gl-io.adb.html#l444" title="To body">To body</a></li></ul></span> (<a href="src_gl-io.adb.html#l441" title="defined at gl-io.adb:441:22">Stream_Loader</a> =&gt; <span class="droplink">Load_BMP<ul><li><a href="gl-io.ads.html#gl-io.ads:98:13" title="To API doc">To API doc</a></li><li><a href="src_gl-io.ads.html#l98" title="To spec">To spec</a></li><li><a href="src_gl-io.adb.html#l466" title="To body">To body</a></li></ul></span>); </pre></li>
<li id="l725"><pre> </pre></li>
<li id="l726"><pre>   <span class="keyword">procedure</span> <span class="droplink">Load_BMP<ul><li><a href="gl-io.ads.html#gl-io.ads:94:14" title="To API doc">To API doc</a></li><li><a href="src_gl-io.ads.html#l94" title="To spec">To spec</a></li></ul></span> (<span class="droplink">Name<ul><li><a href="gl-io.ads.html#gl-io.ads:94:24" title="To API doc">To API doc</a></li><li><a href="src_gl-io.ads.html#l94" title="To spec">To spec</a></li></ul></span> : String; <span class="droplink">Id<ul><li><a href="gl-io.ads.html#gl-io.ads:95:24" title="To API doc">To API doc</a></li><li><a href="src_gl-io.ads.html#l95" title="To spec">To spec</a></li></ul></span> : Integer; <span class="droplink">blending_hint<ul><li><a href="gl-io.ads.html#gl-io.ads:96:24" title="To API doc">To API doc</a></li><li><a href="src_gl-io.ads.html#l96" title="To spec">To spec</a></li></ul></span> : <span class="keyword">out</span> Boolean) <span class="keyword">renames</span> <span class="droplink">i_Load_BMP<ul><li><a href="src_gl-io.adb.html#l724" title="To spec">To spec</a></li><li><a href="src_gl-io.adb.html#l444" title="To body">To body</a></li></ul></span>; </pre></li>
<li id="l727"><pre> </pre></li>
<li id="l728"><pre>   <span class="keyword">procedure</span> <span class="droplink">Load<ul><li><a href="gl-io.ads.html#gl-io.ads:78:14" title="To API doc">To API doc</a></li><li><a href="src_gl-io.ads.html#l78" title="To spec">To spec</a></li></ul></span> (<span class="droplink">name<ul><li><a href="gl-io.ads.html#gl-io.ads:78:20" title="To API doc">To API doc</a></li><li><a href="src_gl-io.ads.html#l78" title="To spec">To spec</a></li></ul></span>          :     String;            <span class="comment">-- file name</span> </pre></li>
<li id="l729"><pre>                   <span class="droplink">format<ul><li><a href="gl-io.ads.html#gl-io.ads:79:20" title="To API doc">To API doc</a></li><li><a href="src_gl-io.ads.html#l79" title="To spec">To spec</a></li></ul></span>        :     <span class="droplink">Supported_format<ul><li><a href="gl-io.ads.html#gl-io.ads:49:8" title="To API doc">To API doc</a></li><li><a href="src_gl-io.ads.html#l49" title="To spec">To spec</a></li></ul></span>;  <span class="comment">-- expected file format</span> </pre></li>
<li id="l730"><pre>                   <span class="droplink">ID<ul><li><a href="gl-io.ads.html#gl-io.ads:80:20" title="To API doc">To API doc</a></li><li><a href="src_gl-io.ads.html#l80" title="To spec">To spec</a></li></ul></span>            :     Integer;           <span class="comment">-- ID is the texture identifier to bind to</span> </pre></li>
<li id="l731"><pre>                   <span class="droplink">blending_hint<ul><li><a href="gl-io.ads.html#gl-io.ads:81:20" title="To API doc">To API doc</a></li><li><a href="src_gl-io.ads.html#l81" title="To spec">To spec</a></li></ul></span> : <span class="keyword">out</span> Boolean) <span class="keyword">is</span>        <span class="comment">-- has blending / transparency /alpha ?</span> </pre></li>
<li id="l732"><pre> </pre></li>
<li id="l733"><pre>   <span class="keyword">begin</span> </pre></li>
<li id="l734"><pre>      <span class="keyword">case</span> <span class="droplink">format<ul><li><a href="gl-io.ads.html#gl-io.ads:79:20" title="To API doc">To API doc</a></li><li><a href="src_gl-io.ads.html#l79" title="To spec">To spec</a></li><li><a href="src_gl-io.adb.html#l729" title="To body">To body</a></li></ul></span> <span class="keyword">is</span> </pre></li>
<li id="l735"><pre>      <span class="keyword">when</span> BMP =&gt; <span class="droplink">Load_BMP<ul><li><a href="gl-io.ads.html#gl-io.ads:94:14" title="To API doc">To API doc</a></li><li><a href="src_gl-io.ads.html#l94" title="To spec">To spec</a></li><li><a href="src_gl-io.adb.html#l726" title="To body">To body</a></li></ul></span> (<span class="droplink">name<ul><li><a href="gl-io.ads.html#gl-io.ads:78:20" title="To API doc">To API doc</a></li><li><a href="src_gl-io.ads.html#l78" title="To spec">To spec</a></li></ul></span>, <span class="droplink">ID<ul><li><a href="gl-io.ads.html#gl-io.ads:80:20" title="To API doc">To API doc</a></li><li><a href="src_gl-io.ads.html#l80" title="To spec">To spec</a></li></ul></span>, <span class="droplink">blending_hint<ul><li><a href="gl-io.ads.html#gl-io.ads:81:20" title="To API doc">To API doc</a></li><li><a href="src_gl-io.ads.html#l81" title="To spec">To spec</a></li></ul></span>); </pre></li>
<li id="l736"><pre>      <span class="keyword">when</span> TGA =&gt; <span class="droplink">Load_TGA<ul><li><a href="gl-io.ads.html#gl-io.ads:111:14" title="To API doc">To API doc</a></li><li><a href="src_gl-io.ads.html#l111" title="To spec">To spec</a></li><li><a href="src_gl-io.adb.html#l462" title="To body">To body</a></li></ul></span> (<span class="droplink">name<ul><li><a href="gl-io.ads.html#gl-io.ads:78:20" title="To API doc">To API doc</a></li><li><a href="src_gl-io.ads.html#l78" title="To spec">To spec</a></li></ul></span>, <span class="droplink">ID<ul><li><a href="gl-io.ads.html#gl-io.ads:80:20" title="To API doc">To API doc</a></li><li><a href="src_gl-io.ads.html#l80" title="To spec">To spec</a></li></ul></span>, <span class="droplink">blending_hint<ul><li><a href="gl-io.ads.html#gl-io.ads:81:20" title="To API doc">To API doc</a></li><li><a href="src_gl-io.ads.html#l81" title="To spec">To spec</a></li></ul></span>); </pre></li>
<li id="l737"><pre>      <span class="keyword">end</span> <span class="keyword">case</span>; </pre></li>
<li id="l738"><pre>   <span class="keyword">end</span> <span class="droplink">Load<ul><li><a href="gl-io.ads.html#gl-io.ads:78:14" title="To API doc">To API doc</a></li><li><a href="src_gl-io.ads.html#l78" title="To spec">To spec</a></li><li><a href="src_gl-io.adb.html#l728" title="To body">To body</a></li></ul></span>; </pre></li>
<li id="l739"><pre> </pre></li>
<li id="l740"><pre>   <span class="keyword">procedure</span> <span class="droplink">Load<ul><li><a href="gl-io.ads.html#gl-io.ads:83:14" title="To API doc">To API doc</a></li><li><a href="src_gl-io.ads.html#l83" title="To spec">To spec</a></li></ul></span> (<span class="droplink">s<ul><li><a href="gl-io.ads.html#gl-io.ads:83:20" title="To API doc">To API doc</a></li><li><a href="src_gl-io.ads.html#l83" title="To spec">To spec</a></li></ul></span>             :     Ada.Streams.Stream_IO.Stream_Access; <span class="comment">-- input data stream (e.g. Unzip.Streams)</span> </pre></li>
<li id="l741"><pre>                   <span class="droplink">format<ul><li><a href="gl-io.ads.html#gl-io.ads:84:20" title="To API doc">To API doc</a></li><li><a href="src_gl-io.ads.html#l84" title="To spec">To spec</a></li></ul></span>        :     <span class="droplink">Supported_format<ul><li><a href="gl-io.ads.html#gl-io.ads:49:8" title="To API doc">To API doc</a></li><li><a href="src_gl-io.ads.html#l49" title="To spec">To spec</a></li></ul></span>;  <span class="comment">-- expected file format</span> </pre></li>
<li id="l742"><pre>                   <span class="droplink">ID<ul><li><a href="gl-io.ads.html#gl-io.ads:85:20" title="To API doc">To API doc</a></li><li><a href="src_gl-io.ads.html#l85" title="To spec">To spec</a></li></ul></span>            :     Integer;           <span class="comment">-- ID is the texture identifier to bind to</span> </pre></li>
<li id="l743"><pre>                   <span class="droplink">blending_hint<ul><li><a href="gl-io.ads.html#gl-io.ads:86:20" title="To API doc">To API doc</a></li><li><a href="src_gl-io.ads.html#l86" title="To spec">To spec</a></li></ul></span> : <span class="keyword">out</span> Boolean) <span class="keyword">is</span>        <span class="comment">-- has blending / transparency /alpha ?</span> </pre></li>
<li id="l744"><pre> </pre></li>
<li id="l745"><pre>   <span class="keyword">begin</span> </pre></li>
<li id="l746"><pre>      <span class="keyword">case</span> <span class="droplink">format<ul><li><a href="gl-io.ads.html#gl-io.ads:84:20" title="To API doc">To API doc</a></li><li><a href="src_gl-io.ads.html#l84" title="To spec">To spec</a></li><li><a href="src_gl-io.adb.html#l741" title="To body">To body</a></li></ul></span> <span class="keyword">is</span> </pre></li>
<li id="l747"><pre>      <span class="keyword">when</span> BMP =&gt; <span class="droplink">Load_BMP<ul><li><a href="gl-io.ads.html#gl-io.ads:98:13" title="To API doc">To API doc</a></li><li><a href="src_gl-io.ads.html#l98" title="To spec">To spec</a></li><li><a href="src_gl-io.adb.html#l466" title="To body">To body</a></li></ul></span> (<span class="droplink">s<ul><li><a href="gl-io.ads.html#gl-io.ads:83:20" title="To API doc">To API doc</a></li><li><a href="src_gl-io.ads.html#l83" title="To spec">To spec</a></li></ul></span>, <span class="droplink">ID<ul><li><a href="gl-io.ads.html#gl-io.ads:85:20" title="To API doc">To API doc</a></li><li><a href="src_gl-io.ads.html#l85" title="To spec">To spec</a></li></ul></span>, <span class="droplink">blending_hint<ul><li><a href="gl-io.ads.html#gl-io.ads:86:20" title="To API doc">To API doc</a></li><li><a href="src_gl-io.ads.html#l86" title="To spec">To spec</a></li></ul></span>); </pre></li>
<li id="l748"><pre>      <span class="keyword">when</span> TGA =&gt; <span class="droplink">Load_TGA<ul><li><a href="gl-io.ads.html#gl-io.ads:115:14" title="To API doc">To API doc</a></li><li><a href="src_gl-io.ads.html#l115" title="To spec">To spec</a></li><li><a href="src_gl-io.adb.html#l418" title="To body">To body</a></li></ul></span> (<span class="droplink">s<ul><li><a href="gl-io.ads.html#gl-io.ads:83:20" title="To API doc">To API doc</a></li><li><a href="src_gl-io.ads.html#l83" title="To spec">To spec</a></li></ul></span>, <span class="droplink">ID<ul><li><a href="gl-io.ads.html#gl-io.ads:85:20" title="To API doc">To API doc</a></li><li><a href="src_gl-io.ads.html#l85" title="To spec">To spec</a></li></ul></span>, <span class="droplink">blending_hint<ul><li><a href="gl-io.ads.html#gl-io.ads:86:20" title="To API doc">To API doc</a></li><li><a href="src_gl-io.ads.html#l86" title="To spec">To spec</a></li></ul></span>); </pre></li>
<li id="l749"><pre>      <span class="keyword">end</span> <span class="keyword">case</span>; </pre></li>
<li id="l750"><pre>   <span class="keyword">end</span> <span class="droplink">Load<ul><li><a href="gl-io.ads.html#gl-io.ads:83:14" title="To API doc">To API doc</a></li><li><a href="src_gl-io.ads.html#l83" title="To spec">To spec</a></li><li><a href="src_gl-io.adb.html#l740" title="To body">To body</a></li></ul></span>; </pre></li>
<li id="l751"><pre> </pre></li>
<li id="l752"><pre>   <span class="comment">-------------</span> </pre></li>
<li id="l753"><pre>   <span class="comment">-- Outputs --</span> </pre></li>
<li id="l754"><pre>   <span class="comment">-------------</span> </pre></li>
<li id="l755"><pre> </pre></li>
<li id="l756"><pre>   <span class="keyword">generic</span> </pre></li>
<li id="l757"><pre>      <span class="keyword">type</span> Number <span class="keyword">is</span> <span class="keyword">mod</span> &lt;&gt;; </pre></li>
<li id="l758"><pre>      s : Stream_Access; </pre></li>
<li id="l759"><pre>   <span class="keyword">procedure</span> <a href="src_gl-io.adb.html#l761" title="defined at gl-io.adb:759:14">Write_Intel_x86_number</a> (n : <a href="src_gl-io.adb.html#l757" title="defined at gl-io.adb:757:12">Number</a>); </pre></li>
<li id="l760"><pre> </pre></li>
<li id="l761"><pre>   <span class="keyword">procedure</span> <a href="src_gl-io.adb.html#l759" title="defined at gl-io.adb:759:14">Write_Intel_x86_number</a> (<a href="src_gl-io.adb.html#l759" title="defined at gl-io.adb:759:38">n</a> : <a href="src_gl-io.adb.html#l757" title="defined at gl-io.adb:757:12">Number</a>) <span class="keyword">is</span> </pre></li>
<li id="l762"><pre>      m : <a href="src_gl-io.adb.html#l757" title="defined at gl-io.adb:757:12">Number</a> := <a href="src_gl-io.adb.html#l759" title="defined at gl-io.adb:759:38">n</a>; </pre></li>
<li id="l763"><pre>      bytes : <span class="keyword">constant</span> Integer := <a href="src_gl-io.adb.html#l757" title="defined at gl-io.adb:757:12">Number</a>&apos;Size / 8; </pre></li>
<li id="l764"><pre>   <span class="keyword">begin</span> </pre></li>
<li id="l765"><pre>      <span class="keyword">for</span> i <span class="keyword">in</span> 1 .. bytes <span class="keyword">loop</span> </pre></li>
<li id="l766"><pre>         <a href="src_gl-io.adb.html#l18" title="defined at gl-io.adb:18:9">U8</a>&apos;Write (<a href="src_gl-io.adb.html#l758" title="defined at gl-io.adb:758:7">s</a>, <a href="src_gl-io.adb.html#l18" title="defined at gl-io.adb:18:9">U8</a> (m <span class="keyword">mod</span> 256)); </pre></li>
<li id="l767"><pre>         m := m / 256; </pre></li>
<li id="l768"><pre>      <span class="keyword">end</span> <span class="keyword">loop</span>; </pre></li>
<li id="l769"><pre>   <span class="keyword">end</span> <span class="droplink">Write_Intel_x86_number<ul><li><a href="src_gl-io.adb.html#l759" title="To spec">To spec</a></li><li><a href="src_gl-io.adb.html#l761" title="To body">To body</a></li></ul></span>; </pre></li>
<li id="l770"><pre> </pre></li>
<li id="l771"><pre>   <span class="keyword">procedure</span> Write_raw_BGR_frame (s : Stream_Access; width, height : Natural) <span class="keyword">is</span> </pre></li>
<li id="l772"><pre>      <span class="comment">-- 4 - byte padding for .bmp/.avi formats is the same as GL&apos;s default</span> </pre></li>
<li id="l773"><pre>      <span class="comment">-- padding : see glPixelStore, GL_[UN]PACK_ALIGNMENT = 4 as initial value.</span> </pre></li>
<li id="l774"><pre>      <span class="comment">-- http://www.opengl.org/sdk/docs/man/xhtml/glPixelStore.xml</span> </pre></li>
<li id="l775"><pre>      <span class="comment">--</span> </pre></li>
<li id="l776"><pre>      padded_row_size : <span class="keyword">constant</span> Positive := </pre></li>
<li id="l777"><pre>        4 * Integer (<span class="droplink">C_Float<ul><li><a href="gl.ads.html#gl.ads:126:9" title="To API doc">To API doc</a></li><li><a href="src_gl.ads.html#l126" title="To spec">To spec</a></li></ul></span>&apos;Ceiling (<span class="droplink">C_Float<ul><li><a href="gl.ads.html#gl.ads:126:9" title="To API doc">To API doc</a></li><li><a href="src_gl.ads.html#l126" title="To spec">To spec</a></li></ul></span> (<a href="src_gl-io.adb.html#l771" title="defined at gl-io.adb:771:54">width</a>) * 3.0 / 4.0)); </pre></li>
<li id="l778"><pre>      <span class="comment">-- (in bytes)</span> </pre></li>
<li id="l779"><pre>      <span class="comment">--</span> </pre></li>
<li id="l780"><pre>      <span class="keyword">type</span> Temp_bitmap_type <span class="keyword">is</span> <span class="keyword">array</span> (Natural <span class="keyword">range</span> &lt;&gt;) <span class="keyword">of</span> <span class="keyword">aliased</span> <span class="droplink">GL.Ubyte<ul><li><a href="gl.ads.html#gl.ads:122:9" title="To API doc">To API doc</a></li><li><a href="src_gl.ads.html#l122" title="To spec">To spec</a></li></ul></span>; </pre></li>
<li id="l781"><pre>      PicData : <a href="src_gl-io.adb.html#l780" title="defined at gl-io.adb:780:12">Temp_bitmap_type</a> (0 .. (<a href="src_gl-io.adb.html#l776" title="defined at gl-io.adb:776:7">padded_row_size</a> + 4) * (<a href="src_gl-io.adb.html#l771" title="defined at gl-io.adb:771:61">height</a> + 4) - 1); </pre></li>
<li id="l782"><pre>      <span class="comment">-- No dynamic allocation needed!</span> </pre></li>
<li id="l783"><pre>      <span class="comment">-- The &quot;+ 4&quot; are there to avoid parity address problems when GL writes</span> </pre></li>
<li id="l784"><pre>      <span class="comment">-- to the buffer.</span> </pre></li>
<li id="l785"><pre>      <span class="keyword">type</span> loc_pointer <span class="keyword">is</span> <span class="keyword">new</span> <span class="droplink">GL.pointer<ul><li><a href="gl.ads.html#gl.ads:150:9" title="To API doc">To API doc</a></li><li><a href="src_gl.ads.html#l150" title="To spec">To spec</a></li></ul></span>; </pre></li>
<li id="l786"><pre>      <span class="keyword">function</span> Cvt <span class="keyword">is</span> <span class="keyword">new</span> Ada.Unchecked_Conversion (System.Address, <a href="src_gl-io.adb.html#l785" title="defined at gl-io.adb:785:12">loc_pointer</a>); </pre></li>
<li id="l787"><pre>      <span class="comment">-- This method is functionally identical as GNAT&apos;s Unrestricted_Access</span> </pre></li>
<li id="l788"><pre>      <span class="comment">-- but has no type safety (cf GNAT Docs)</span> </pre></li>
<li id="l789"><pre>      <span class="keyword">pragma</span> No_Strict_Aliasing (<a href="src_gl-io.adb.html#l785" title="defined at gl-io.adb:785:12">loc_pointer</a>); <span class="comment">-- recommended by GNAT 2005 +</span> </pre></li>
<li id="l790"><pre>      pPicData : <a href="src_gl-io.adb.html#l785" title="defined at gl-io.adb:785:12">loc_pointer</a>; </pre></li>
<li id="l791"><pre>      data_max : <span class="keyword">constant</span> Integer := <a href="src_gl-io.adb.html#l776" title="defined at gl-io.adb:776:7">padded_row_size</a> * <a href="src_gl-io.adb.html#l771" title="defined at gl-io.adb:771:61">height</a> - 1; </pre></li>
<li id="l792"><pre>   <span class="keyword">begin</span> </pre></li>
<li id="l793"><pre>      <a href="src_gl-io.adb.html#l790" title="defined at gl-io.adb:790:7">pPicData</a> := <a href="src_gl-io.adb.html#l786" title="defined at gl-io.adb:786:16">Cvt</a> (<a href="src_gl-io.adb.html#l781" title="defined at gl-io.adb:781:7">PicData</a> (0)&apos;Address); </pre></li>
<li id="l794"><pre>      <span class="droplink">GL.ReadPixels<ul><li><a href="gl.ads.html#gl.ads:2071:14" title="To API doc">To API doc</a></li><li><a href="src_gl.ads.html#l2071" title="To spec">To spec</a></li><li><a href="src_gl.ads.html#l4373" title="To body">To body</a></li></ul></span> ( </pre></li>
<li id="l795"><pre>                     0, 0, </pre></li>
<li id="l796"><pre>                     <span class="droplink">GL.Sizei<ul><li><a href="gl.ads.html#gl.ads:125:9" title="To API doc">To API doc</a></li><li><a href="src_gl.ads.html#l125" title="To spec">To spec</a></li></ul></span> (<a href="src_gl-io.adb.html#l771" title="defined at gl-io.adb:771:54">width</a>), <span class="droplink">GL.Sizei<ul><li><a href="gl.ads.html#gl.ads:125:9" title="To API doc">To API doc</a></li><li><a href="src_gl.ads.html#l125" title="To spec">To spec</a></li></ul></span> (<a href="src_gl-io.adb.html#l771" title="defined at gl-io.adb:771:61">height</a>), </pre></li>
<li id="l797"><pre>                     GL.BGR, </pre></li>
<li id="l798"><pre>                     GL.GL_UNSIGNED_BYTE, </pre></li>
<li id="l799"><pre>                     <span class="droplink">GL.pointer<ul><li><a href="gl.ads.html#gl.ads:150:9" title="To API doc">To API doc</a></li><li><a href="src_gl.ads.html#l150" title="To spec">To spec</a></li></ul></span> (<a href="src_gl-io.adb.html#l790" title="defined at gl-io.adb:790:7">pPicData</a>) </pre></li>
<li id="l800"><pre>                    ); </pre></li>
<li id="l801"><pre>      <span class="keyword">if</span> <a href="src_gl-io.adb.html#l80" title="defined at gl-io.adb:80:4">workaround_possible</a> <span class="keyword">then</span> </pre></li>
<li id="l802"><pre>         <span class="keyword">declare</span> </pre></li>
<li id="l803"><pre>            <span class="keyword">use</span> Ada.Streams; </pre></li>
<li id="l804"><pre>            SE_Buffer    : Stream_Element_Array (0 .. Stream_Element_Offset (<a href="src_gl-io.adb.html#l781" title="defined at gl-io.adb:781:7">PicData</a>&apos;Last)); </pre></li>
<li id="l805"><pre>            <span class="keyword">for</span> SE_Buffer&apos;Address <span class="keyword">use</span> <a href="src_gl-io.adb.html#l781" title="defined at gl-io.adb:781:7">PicData</a>&apos;Address; </pre></li>
<li id="l806"><pre>            <span class="keyword">pragma</span> Import (Ada, SE_Buffer); </pre></li>
<li id="l807"><pre>         <span class="keyword">begin</span> </pre></li>
<li id="l808"><pre>            Ada.Streams.Write (<a href="src_gl-io.adb.html#l771" title="defined at gl-io.adb:771:35">s</a>.<span class="keyword">all</span>, SE_Buffer (0 .. Stream_Element_Offset (<a href="src_gl-io.adb.html#l791" title="defined at gl-io.adb:791:7">data_max</a>))); </pre></li>
<li id="l809"><pre>         <span class="keyword">end</span>; </pre></li>
<li id="l810"><pre>      <span class="keyword">else</span> </pre></li>
<li id="l811"><pre>         <a href="src_gl-io.adb.html#l780" title="defined at gl-io.adb:780:12">Temp_bitmap_type</a>&apos;Write (<a href="src_gl-io.adb.html#l771" title="defined at gl-io.adb:771:35">s</a>, <a href="src_gl-io.adb.html#l781" title="defined at gl-io.adb:781:7">PicData</a> (0 .. <a href="src_gl-io.adb.html#l791" title="defined at gl-io.adb:791:7">data_max</a>)); </pre></li>
<li id="l812"><pre>      <span class="keyword">end</span> <span class="keyword">if</span>; </pre></li>
<li id="l813"><pre>   <span class="keyword">end</span> <span class="droplink">Write_raw_BGR_frame<ul><li><a href="src_gl-io.adb.html#l771" title="To spec">To spec</a></li><li><a href="src_gl-io.adb.html#l771" title="To body">To body</a></li></ul></span>; </pre></li>
<li id="l814"><pre> </pre></li>
<li id="l815"><pre>   <span class="comment">-------------------------------------------------------</span> </pre></li>
<li id="l816"><pre>   <span class="comment">-- BMP RGB (A) output of the current, active viewport --</span> </pre></li>
<li id="l817"><pre>   <span class="comment">-------------------------------------------------------</span> </pre></li>
<li id="l818"><pre> </pre></li>
<li id="l819"><pre>   <span class="keyword">procedure</span> <span class="droplink">Screenshot<ul><li><a href="gl-io.ads.html#gl-io.ads:127:13" title="To API doc">To API doc</a></li><li><a href="src_gl-io.ads.html#l127" title="To spec">To spec</a></li></ul></span> (<span class="droplink">Name<ul><li><a href="gl-io.ads.html#gl-io.ads:127:25" title="To API doc">To API doc</a></li><li><a href="src_gl-io.ads.html#l127" title="To spec">To spec</a></li></ul></span> : String) <span class="keyword">is</span> </pre></li>
<li id="l820"><pre>      <span class="comment">-- Translated by (New) P2Ada v. 15 - Nov - 2006</span> </pre></li>
<li id="l821"><pre>      <span class="comment">-- http://wiki.delphigl.com/index.php/Screenshot</span> </pre></li>
<li id="l822"><pre>      f : Ada.Streams.Stream_IO.File_Type; </pre></li>
<li id="l823"><pre> </pre></li>
<li id="l824"><pre>      <span class="keyword">type</span> Bitmap_File_Header <span class="keyword">is</span> <span class="keyword">record</span> </pre></li>
<li id="l825"><pre>         bfType      : <a href="src_gl-io.adb.html#l19" title="defined at gl-io.adb:19:9">U16</a>; </pre></li>
<li id="l826"><pre>         bfSize      : <a href="src_gl-io.adb.html#l20" title="defined at gl-io.adb:20:9">U32</a>; </pre></li>
<li id="l827"><pre>         bfReserved1 : <a href="src_gl-io.adb.html#l19" title="defined at gl-io.adb:19:9">U16</a> := 0; </pre></li>
<li id="l828"><pre>         bfReserved2 : <a href="src_gl-io.adb.html#l19" title="defined at gl-io.adb:19:9">U16</a> := 0; </pre></li>
<li id="l829"><pre>         bfOffBits   : <a href="src_gl-io.adb.html#l20" title="defined at gl-io.adb:20:9">U32</a>; </pre></li>
<li id="l830"><pre>      <span class="keyword">end</span> <span class="keyword">record</span>; </pre></li>
<li id="l831"><pre>      <span class="keyword">pragma</span> Pack (<a href="src_gl-io.adb.html#l824" title="defined at gl-io.adb:824:12">Bitmap_File_Header</a>); </pre></li>
<li id="l832"><pre>      <span class="keyword">for</span> <a href="src_gl-io.adb.html#l824" title="defined at gl-io.adb:824:12">Bitmap_File_Header</a>&apos;Size <span class="keyword">use</span> 8 * 14; </pre></li>
<li id="l833"><pre> </pre></li>
<li id="l834"><pre>      <span class="keyword">type</span> Bitmap_Info_Header <span class="keyword">is</span> <span class="keyword">record</span> </pre></li>
<li id="l835"><pre>         biSize          : <a href="src_gl-io.adb.html#l20" title="defined at gl-io.adb:20:9">U32</a>; </pre></li>
<li id="l836"><pre>         biWidth         : <a href="src_gl-io.adb.html#l22" title="defined at gl-io.adb:22:9">I32</a>; </pre></li>
<li id="l837"><pre>         biHeight        : <a href="src_gl-io.adb.html#l22" title="defined at gl-io.adb:22:9">I32</a>; </pre></li>
<li id="l838"><pre>         biPlanes        : <a href="src_gl-io.adb.html#l19" title="defined at gl-io.adb:19:9">U16</a>; </pre></li>
<li id="l839"><pre>         biBitCount      : <a href="src_gl-io.adb.html#l19" title="defined at gl-io.adb:19:9">U16</a>; </pre></li>
<li id="l840"><pre>         biCompression   : <a href="src_gl-io.adb.html#l20" title="defined at gl-io.adb:20:9">U32</a>; </pre></li>
<li id="l841"><pre>         biSizeImage     : <a href="src_gl-io.adb.html#l20" title="defined at gl-io.adb:20:9">U32</a>; </pre></li>
<li id="l842"><pre>         biXPelsPerMeter : <a href="src_gl-io.adb.html#l22" title="defined at gl-io.adb:22:9">I32</a> := 0; </pre></li>
<li id="l843"><pre>         biYPelsPerMeter : <a href="src_gl-io.adb.html#l22" title="defined at gl-io.adb:22:9">I32</a> := 0; </pre></li>
<li id="l844"><pre>         biClrUsed       : <a href="src_gl-io.adb.html#l20" title="defined at gl-io.adb:20:9">U32</a> := 0; </pre></li>
<li id="l845"><pre>         biClrImportant  : <a href="src_gl-io.adb.html#l20" title="defined at gl-io.adb:20:9">U32</a> := 0; </pre></li>
<li id="l846"><pre>      <span class="keyword">end</span> <span class="keyword">record</span>; </pre></li>
<li id="l847"><pre>      <span class="keyword">pragma</span> Pack (<a href="src_gl-io.adb.html#l834" title="defined at gl-io.adb:834:12">Bitmap_Info_Header</a>); </pre></li>
<li id="l848"><pre>      <span class="keyword">for</span> <a href="src_gl-io.adb.html#l834" title="defined at gl-io.adb:834:12">Bitmap_Info_Header</a>&apos;Size <span class="keyword">use</span> 8 * 40; </pre></li>
<li id="l849"><pre> </pre></li>
<li id="l850"><pre>      FileInfo            : <a href="src_gl-io.adb.html#l834" title="defined at gl-io.adb:834:12">Bitmap_Info_Header</a>; </pre></li>
<li id="l851"><pre>      FileHeader          : <a href="src_gl-io.adb.html#l824" title="defined at gl-io.adb:824:12">Bitmap_File_Header</a>; </pre></li>
<li id="l852"><pre>      Screenshot_Viewport : <span class="keyword">array</span> (0 .. 3) <span class="keyword">of</span> <span class="keyword">aliased</span> <span class="droplink">GL.Int<ul><li><a href="gl.ads.html#gl.ads:121:9" title="To API doc">To API doc</a></li><li><a href="src_gl.ads.html#l121" title="To spec">To spec</a></li></ul></span>; </pre></li>
<li id="l853"><pre> </pre></li>
<li id="l854"><pre>      <span class="keyword">type</span> GL_IntPointer <span class="keyword">is</span> <span class="keyword">new</span> <span class="droplink">GL.intPointer<ul><li><a href="gl.ads.html#gl.ads:139:9" title="To API doc">To API doc</a></li><li><a href="src_gl.ads.html#l139" title="To spec">To spec</a></li></ul></span>; </pre></li>
<li id="l855"><pre>      <span class="keyword">function</span> Cvt <span class="keyword">is</span> <span class="keyword">new</span> Ada.Unchecked_Conversion (System.Address, <a href="src_gl-io.adb.html#l854" title="defined at gl-io.adb:854:12">GL_IntPointer</a>); </pre></li>
<li id="l856"><pre>      <span class="comment">-- This method is functionally identical as GNAT&apos;s Unrestricted_Access</span> </pre></li>
<li id="l857"><pre>      <span class="comment">-- but has no type safety (cf GNAT Docs)</span> </pre></li>
<li id="l858"><pre>      <span class="keyword">pragma</span> No_Strict_Aliasing (<a href="src_gl-io.adb.html#l854" title="defined at gl-io.adb:854:12">GL_IntPointer</a>); <span class="comment">-- recommended by GNAT 2005+</span> </pre></li>
<li id="l859"><pre> </pre></li>
<li id="l860"><pre>   <span class="keyword">begin</span> </pre></li>
<li id="l861"><pre>      <span class="comment">--  Größe des Viewports abfragen --&gt; Spätere Bildgrößenangaben</span> </pre></li>
<li id="l862"><pre>      <span class="droplink">GL.GetIntegerv<ul><li><a href="gl.ads.html#gl.ads:1198:14" title="To API doc">To API doc</a></li><li><a href="src_gl.ads.html#l1198" title="To spec">To spec</a></li><li><a href="src_gl.ads.html#l4148" title="To body">To body</a></li></ul></span> (GL.VIEWPORT, <span class="droplink">GL.intPointer<ul><li><a href="gl.ads.html#gl.ads:139:9" title="To API doc">To API doc</a></li><li><a href="src_gl.ads.html#l139" title="To spec">To spec</a></li></ul></span> (<a href="src_gl-io.adb.html#l855" title="defined at gl-io.adb:855:16">Cvt</a> (<a href="src_gl-io.adb.html#l852" title="defined at gl-io.adb:852:7">Screenshot_Viewport</a> (0)&apos;Address))); </pre></li>
<li id="l863"><pre> </pre></li>
<li id="l864"><pre>      <span class="comment">--  Initialisieren der Daten des Headers</span> </pre></li>
<li id="l865"><pre>      FileHeader.bfType := 16#4D42#; <span class="comment">-- &apos;BM&apos;</span> </pre></li>
<li id="l866"><pre>      FileHeader.bfOffBits := <a href="src_gl-io.adb.html#l834" title="defined at gl-io.adb:834:12">Bitmap_Info_Header</a>&apos;Size / 8 + <a href="src_gl-io.adb.html#l824" title="defined at gl-io.adb:824:12">Bitmap_File_Header</a>&apos;Size / 8; </pre></li>
<li id="l867"><pre> </pre></li>
<li id="l868"><pre>      <span class="comment">--  Schreiben der Bitmap - Informationen</span> </pre></li>
<li id="l869"><pre>      FileInfo.biSize       := <a href="src_gl-io.adb.html#l834" title="defined at gl-io.adb:834:12">Bitmap_Info_Header</a>&apos;Size / 8; </pre></li>
<li id="l870"><pre>      FileInfo.biWidth      := <a href="src_gl-io.adb.html#l22" title="defined at gl-io.adb:22:9">I32</a> (<a href="src_gl-io.adb.html#l852" title="defined at gl-io.adb:852:7">Screenshot_Viewport</a> (2)); </pre></li>
<li id="l871"><pre>      FileInfo.biHeight     := <a href="src_gl-io.adb.html#l22" title="defined at gl-io.adb:22:9">I32</a> (<a href="src_gl-io.adb.html#l852" title="defined at gl-io.adb:852:7">Screenshot_Viewport</a> (3)); </pre></li>
<li id="l872"><pre>      FileInfo.biPlanes     := 1; </pre></li>
<li id="l873"><pre>      FileInfo.biBitCount   := 24; </pre></li>
<li id="l874"><pre>      FileInfo.biCompression := 0; </pre></li>
<li id="l875"><pre>      FileInfo.biSizeImage  := </pre></li>
<li id="l876"><pre>        <a href="src_gl-io.adb.html#l20" title="defined at gl-io.adb:20:9">U32</a> ( </pre></li>
<li id="l877"><pre>             <span class="comment">-- 4 - byte padding for .bmp/.avi formats</span> </pre></li>
<li id="l878"><pre>             4 * Integer (<span class="droplink">C_Float<ul><li><a href="gl.ads.html#gl.ads:126:9" title="To API doc">To API doc</a></li><li><a href="src_gl.ads.html#l126" title="To spec">To spec</a></li></ul></span>&apos;Ceiling (<span class="droplink">C_Float<ul><li><a href="gl.ads.html#gl.ads:126:9" title="To API doc">To API doc</a></li><li><a href="src_gl.ads.html#l126" title="To spec">To spec</a></li></ul></span> (FileInfo.biWidth) * 3.0 / 4.0)) * </pre></li>
<li id="l879"><pre>               Integer (FileInfo.biHeight) </pre></li>
<li id="l880"><pre>            ); </pre></li>
<li id="l881"><pre> </pre></li>
<li id="l882"><pre>      <span class="comment">--  Größenangabe auch in den Header übernehmen</span> </pre></li>
<li id="l883"><pre>      FileHeader.bfSize := FileHeader.bfOffBits + FileInfo.biSizeImage; </pre></li>
<li id="l884"><pre> </pre></li>
<li id="l885"><pre>      <span class="comment">--  Und den ganzen Müll in die Datei schieben ; - )</span> </pre></li>
<li id="l886"><pre>      <span class="comment">--  Moderne Leute nehmen dafür auch Streams . ..</span> </pre></li>
<li id="l887"><pre>      Create (<a href="src_gl-io.adb.html#l822" title="defined at gl-io.adb:822:7">f</a>, Out_File, <span class="droplink">Name<ul><li><a href="gl-io.ads.html#gl-io.ads:127:25" title="To API doc">To API doc</a></li><li><a href="src_gl-io.ads.html#l127" title="To spec">To spec</a></li></ul></span>); </pre></li>
<li id="l888"><pre>      <span class="keyword">declare</span> </pre></li>
<li id="l889"><pre>         <span class="keyword">procedure</span> Write_Intel <span class="keyword">is</span> <span class="keyword">new</span> <span class="droplink">Write_Intel_x86_number<ul><li><a href="src_gl-io.adb.html#l759" title="To spec">To spec</a></li><li><a href="src_gl-io.adb.html#l761" title="To body">To body</a></li></ul></span> (<a href="src_gl-io.adb.html#l19" title="defined at gl-io.adb:19:9">U16</a>, Stream (<a href="src_gl-io.adb.html#l822" title="defined at gl-io.adb:822:7">f</a>)); </pre></li>
<li id="l890"><pre>         <span class="keyword">procedure</span> Write_Intel <span class="keyword">is</span> <span class="keyword">new</span> <span class="droplink">Write_Intel_x86_number<ul><li><a href="src_gl-io.adb.html#l759" title="To spec">To spec</a></li><li><a href="src_gl-io.adb.html#l761" title="To body">To body</a></li></ul></span> (<a href="src_gl-io.adb.html#l20" title="defined at gl-io.adb:20:9">U32</a>, Stream (<a href="src_gl-io.adb.html#l822" title="defined at gl-io.adb:822:7">f</a>)); </pre></li>
<li id="l891"><pre>         <span class="keyword">function</span> Cvt <span class="keyword">is</span> <span class="keyword">new</span> Ada.Unchecked_Conversion (<a href="src_gl-io.adb.html#l22" title="defined at gl-io.adb:22:9">I32</a>, <a href="src_gl-io.adb.html#l20" title="defined at gl-io.adb:20:9">U32</a>); </pre></li>
<li id="l892"><pre> </pre></li>
<li id="l893"><pre>      <span class="keyword">begin</span> </pre></li>
<li id="l894"><pre>         <span class="comment">-- ** Only for Intel endianess : ** --</span> </pre></li>
<li id="l895"><pre>         <span class="comment">--  BITMAPFILEHEADER&apos;Write (Stream (F), FileHeader);</span> </pre></li>
<li id="l896"><pre>         <span class="comment">--  BITMAPINFOHEADER&apos;Write (Stream (F), FileInfo);</span> </pre></li>
<li id="l897"><pre>         <span class="comment">--</span> </pre></li>
<li id="l898"><pre>         <span class="comment">-- ** Endian - safe : ** --</span> </pre></li>
<li id="l899"><pre>         Write_Intel (FileHeader.bfType); </pre></li>
<li id="l900"><pre>         Write_Intel (FileHeader.bfSize); </pre></li>
<li id="l901"><pre>         Write_Intel (FileHeader.bfReserved1); </pre></li>
<li id="l902"><pre>         Write_Intel (FileHeader.bfReserved2); </pre></li>
<li id="l903"><pre>         Write_Intel (FileHeader.bfOffBits); </pre></li>
<li id="l904"><pre>         <span class="comment">--</span> </pre></li>
<li id="l905"><pre>         Write_Intel (FileInfo.biSize); </pre></li>
<li id="l906"><pre>         Write_Intel (Cvt (FileInfo.biWidth)); </pre></li>
<li id="l907"><pre>         Write_Intel (Cvt (FileInfo.biHeight)); </pre></li>
<li id="l908"><pre>         Write_Intel (FileInfo.biPlanes); </pre></li>
<li id="l909"><pre>         Write_Intel (FileInfo.biBitCount); </pre></li>
<li id="l910"><pre>         Write_Intel (FileInfo.biCompression); </pre></li>
<li id="l911"><pre>         Write_Intel (FileInfo.biSizeImage); </pre></li>
<li id="l912"><pre>         Write_Intel (Cvt (FileInfo.biXPelsPerMeter)); </pre></li>
<li id="l913"><pre>         Write_Intel (Cvt (FileInfo.biYPelsPerMeter)); </pre></li>
<li id="l914"><pre>         Write_Intel (FileInfo.biClrUsed); </pre></li>
<li id="l915"><pre>         Write_Intel (FileInfo.biClrImportant); </pre></li>
<li id="l916"><pre>         <span class="comment">--</span> </pre></li>
<li id="l917"><pre>         <span class="droplink">Write_raw_BGR_frame<ul><li><a href="src_gl-io.adb.html#l771" title="To spec">To spec</a></li><li><a href="src_gl-io.adb.html#l771" title="To body">To body</a></li></ul></span> (Stream (<a href="src_gl-io.adb.html#l822" title="defined at gl-io.adb:822:7">f</a>), Integer (<a href="src_gl-io.adb.html#l852" title="defined at gl-io.adb:852:7">Screenshot_Viewport</a> (2)), Integer (<a href="src_gl-io.adb.html#l852" title="defined at gl-io.adb:852:7">Screenshot_Viewport</a> (3))); </pre></li>
<li id="l918"><pre>         Close (<a href="src_gl-io.adb.html#l822" title="defined at gl-io.adb:822:7">f</a>); </pre></li>
<li id="l919"><pre>      <span class="keyword">exception</span> </pre></li>
<li id="l920"><pre>         <span class="keyword">when</span> <span class="keyword">others</span> =&gt; </pre></li>
<li id="l921"><pre>            Close (<a href="src_gl-io.adb.html#l822" title="defined at gl-io.adb:822:7">f</a>); </pre></li>
<li id="l922"><pre>            <span class="keyword">raise</span>; </pre></li>
<li id="l923"><pre>      <span class="keyword">end</span>; </pre></li>
<li id="l924"><pre>   <span class="keyword">end</span> <span class="droplink">Screenshot<ul><li><a href="gl-io.ads.html#gl-io.ads:127:13" title="To API doc">To API doc</a></li><li><a href="src_gl-io.ads.html#l127" title="To spec">To spec</a></li><li><a href="src_gl-io.adb.html#l819" title="To body">To body</a></li></ul></span>; </pre></li>
<li id="l925"><pre> </pre></li>
<li id="l926"><pre>   <span class="comment">-------------------</span> </pre></li>
<li id="l927"><pre>   <span class="comment">-- Video capture --</span> </pre></li>
<li id="l928"><pre>   <span class="comment">-------------------</span> </pre></li>
<li id="l929"><pre> </pre></li>
<li id="l930"><pre>   <span class="comment">-- Exceptionally we define global variables since it is not expected</span> </pre></li>
<li id="l931"><pre>   <span class="comment">-- that more that one capture is taken at the same time.</span> </pre></li>
<li id="l932"><pre>   avi : Ada.Streams.Stream_IO.File_Type; </pre></li>
<li id="l933"><pre>   frames : Natural; </pre></li>
<li id="l934"><pre>   rate : Positive; </pre></li>
<li id="l935"><pre>   width, height : Positive; </pre></li>
<li id="l936"><pre>   bmp_size : <a href="src_gl-io.adb.html#l20" title="defined at gl-io.adb:20:9">U32</a>; </pre></li>
<li id="l937"><pre> </pre></li>
<li id="l938"><pre>   <span class="keyword">procedure</span> Write_RIFF_headers <span class="keyword">is</span> </pre></li>
<li id="l939"><pre>      <span class="comment">-- Written 1st time to take place (but # of frames unknown)</span> </pre></li>
<li id="l940"><pre>      <span class="comment">-- Written 2nd time for setting # of frames, sizes, etc.</span> </pre></li>
<li id="l941"><pre>      <span class="comment">--</span> </pre></li>
<li id="l942"><pre>      padded_row_size : <span class="keyword">constant</span> Positive := </pre></li>
<li id="l943"><pre>        4 * Integer (<span class="droplink">C_Float<ul><li><a href="gl.ads.html#gl.ads:126:9" title="To API doc">To API doc</a></li><li><a href="src_gl.ads.html#l126" title="To spec">To spec</a></li></ul></span>&apos;Ceiling (<span class="droplink">C_Float<ul><li><a href="gl.ads.html#gl.ads:126:9" title="To API doc">To API doc</a></li><li><a href="src_gl.ads.html#l126" title="To spec">To spec</a></li></ul></span> (<a href="src_gl-io.adb.html#l935" title="defined at gl-io.adb:935:4">width</a>) * 3.0 / 4.0)); </pre></li>
<li id="l944"><pre>      calc_bmp_size : <span class="keyword">constant</span> <a href="src_gl-io.adb.html#l20" title="defined at gl-io.adb:20:9">U32</a> := <a href="src_gl-io.adb.html#l20" title="defined at gl-io.adb:20:9">U32</a> (<a href="src_gl-io.adb.html#l942" title="defined at gl-io.adb:942:7">padded_row_size</a> * <a href="src_gl-io.adb.html#l935" title="defined at gl-io.adb:935:11">height</a>); </pre></li>
<li id="l945"><pre>      index_size : <span class="keyword">constant</span> <a href="src_gl-io.adb.html#l20" title="defined at gl-io.adb:20:9">U32</a> := <a href="src_gl-io.adb.html#l20" title="defined at gl-io.adb:20:9">U32</a> (<a href="src_gl-io.adb.html#l933" title="defined at gl-io.adb:933:4">frames</a>) * 16; </pre></li>
<li id="l946"><pre>      movie_size : <span class="keyword">constant</span> <a href="src_gl-io.adb.html#l20" title="defined at gl-io.adb:20:9">U32</a> := 4 + <a href="src_gl-io.adb.html#l20" title="defined at gl-io.adb:20:9">U32</a> (<a href="src_gl-io.adb.html#l933" title="defined at gl-io.adb:933:4">frames</a>) * (<a href="src_gl-io.adb.html#l944" title="defined at gl-io.adb:944:7">calc_bmp_size</a> + 8); </pre></li>
<li id="l947"><pre>      second_list_size : <span class="keyword">constant</span> <a href="src_gl-io.adb.html#l20" title="defined at gl-io.adb:20:9">U32</a> := 4 + 64 + 48; </pre></li>
<li id="l948"><pre>      first_list_size  : <span class="keyword">constant</span> <a href="src_gl-io.adb.html#l20" title="defined at gl-io.adb:20:9">U32</a> := (4 + 64) + (8 + <a href="src_gl-io.adb.html#l947" title="defined at gl-io.adb:947:7">second_list_size</a>); </pre></li>
<li id="l949"><pre>      file_size : <span class="keyword">constant</span> <a href="src_gl-io.adb.html#l20" title="defined at gl-io.adb:20:9">U32</a> := 8 + (8 + <a href="src_gl-io.adb.html#l948" title="defined at gl-io.adb:948:7">first_list_size</a>) + (4 + <a href="src_gl-io.adb.html#l946" title="defined at gl-io.adb:946:7">movie_size</a>) + (8 + <a href="src_gl-io.adb.html#l945" title="defined at gl-io.adb:945:7">index_size</a>); </pre></li>
<li id="l950"><pre>      s : <span class="keyword">constant</span> Stream_Access := Stream (<a href="src_gl-io.adb.html#l932" title="defined at gl-io.adb:932:4">avi</a>); </pre></li>
<li id="l951"><pre>      <span class="keyword">procedure</span> <a href="src_gl-io.adb.html#l761" title="defined at gl-io.adb:951:17">Write_Intel</a> <span class="keyword">is</span> <span class="keyword">new</span> <span class="droplink">Write_Intel_x86_number<ul><li><a href="src_gl-io.adb.html#l759" title="To spec">To spec</a></li><li><a href="src_gl-io.adb.html#l761" title="To body">To body</a></li></ul></span> (<a href="src_gl-io.adb.html#l19" title="defined at gl-io.adb:19:9">U16</a>, <a href="src_gl-io.adb.html#l950" title="defined at gl-io.adb:950:7">s</a>); </pre></li>
<li id="l952"><pre>      <span class="keyword">procedure</span> <a href="src_gl-io.adb.html#l761" title="defined at gl-io.adb:952:17">Write_Intel</a> <span class="keyword">is</span> <span class="keyword">new</span> <span class="droplink">Write_Intel_x86_number<ul><li><a href="src_gl-io.adb.html#l759" title="To spec">To spec</a></li><li><a href="src_gl-io.adb.html#l761" title="To body">To body</a></li></ul></span> (<a href="src_gl-io.adb.html#l20" title="defined at gl-io.adb:20:9">U32</a>, <a href="src_gl-io.adb.html#l950" title="defined at gl-io.adb:950:7">s</a>); </pre></li>
<li id="l953"><pre>      microseconds_per_frame : <span class="keyword">constant</span> <a href="src_gl-io.adb.html#l20" title="defined at gl-io.adb:20:9">U32</a> := <a href="src_gl-io.adb.html#l20" title="defined at gl-io.adb:20:9">U32</a> (1_000_000.0 / Long_Float (<a href="src_gl-io.adb.html#l934" title="defined at gl-io.adb:934:4">rate</a>)); </pre></li>
<li id="l954"><pre> </pre></li>
<li id="l955"><pre>   <span class="keyword">begin</span> </pre></li>
<li id="l956"><pre>      <a href="src_gl-io.adb.html#l936" title="defined at gl-io.adb:936:4">bmp_size</a> := <a href="src_gl-io.adb.html#l944" title="defined at gl-io.adb:944:7">calc_bmp_size</a>; </pre></li>
<li id="l957"><pre>      String&apos;Write (<a href="src_gl-io.adb.html#l950" title="defined at gl-io.adb:950:7">s</a>, <span class="string">&quot;RIFF&quot;</span>); </pre></li>
<li id="l958"><pre>      <a href="src_gl-io.adb.html#l20" title="defined at gl-io.adb:20:9">U32</a>&apos;Write (<a href="src_gl-io.adb.html#l950" title="defined at gl-io.adb:950:7">s</a>, <a href="src_gl-io.adb.html#l949" title="defined at gl-io.adb:949:7">file_size</a>); </pre></li>
<li id="l959"><pre>      String&apos;Write (<a href="src_gl-io.adb.html#l950" title="defined at gl-io.adb:950:7">s</a>, <span class="string">&quot;AVI &quot;</span>); </pre></li>
<li id="l960"><pre>      String&apos;Write (<a href="src_gl-io.adb.html#l950" title="defined at gl-io.adb:950:7">s</a>, <span class="string">&quot;LIST&quot;</span>); </pre></li>
<li id="l961"><pre>      <span class="droplink">Write_Intel<ul><li><a href="src_gl-io.adb.html#l952" title="To spec">To spec</a></li><li><a href="src_gl-io.adb.html#l761" title="To body">To body</a></li></ul></span> (<a href="src_gl-io.adb.html#l948" title="defined at gl-io.adb:948:7">first_list_size</a>); </pre></li>
<li id="l962"><pre>      String&apos;Write (<a href="src_gl-io.adb.html#l950" title="defined at gl-io.adb:950:7">s</a>, <span class="string">&quot;hdrl&quot;</span>); </pre></li>
<li id="l963"><pre>      String&apos;Write (<a href="src_gl-io.adb.html#l950" title="defined at gl-io.adb:950:7">s</a>, <span class="string">&quot;avih&quot;</span>); </pre></li>
<li id="l964"><pre>      <span class="droplink">Write_Intel<ul><li><a href="src_gl-io.adb.html#l952" title="To spec">To spec</a></li><li><a href="src_gl-io.adb.html#l761" title="To body">To body</a></li></ul></span> (<a href="src_gl-io.adb.html#l20" title="defined at gl-io.adb:20:9">U32</a>&apos;(56)); </pre></li>
<li id="l965"><pre>      <span class="comment">-- Begin of AVI Header</span> </pre></li>
<li id="l966"><pre>      <span class="droplink">Write_Intel<ul><li><a href="src_gl-io.adb.html#l952" title="To spec">To spec</a></li><li><a href="src_gl-io.adb.html#l761" title="To body">To body</a></li></ul></span> (<a href="src_gl-io.adb.html#l953" title="defined at gl-io.adb:953:7">microseconds_per_frame</a>); </pre></li>
<li id="l967"><pre>      <span class="droplink">Write_Intel<ul><li><a href="src_gl-io.adb.html#l952" title="To spec">To spec</a></li><li><a href="src_gl-io.adb.html#l761" title="To body">To body</a></li></ul></span> (<a href="src_gl-io.adb.html#l20" title="defined at gl-io.adb:20:9">U32</a>&apos;(0));  <span class="comment">-- MaxBytesPerSec</span> </pre></li>
<li id="l968"><pre>      <span class="droplink">Write_Intel<ul><li><a href="src_gl-io.adb.html#l952" title="To spec">To spec</a></li><li><a href="src_gl-io.adb.html#l761" title="To body">To body</a></li></ul></span> (<a href="src_gl-io.adb.html#l20" title="defined at gl-io.adb:20:9">U32</a>&apos;(0));  <span class="comment">-- Reserved1</span> </pre></li>
<li id="l969"><pre>      <span class="droplink">Write_Intel<ul><li><a href="src_gl-io.adb.html#l952" title="To spec">To spec</a></li><li><a href="src_gl-io.adb.html#l761" title="To body">To body</a></li></ul></span> (<a href="src_gl-io.adb.html#l20" title="defined at gl-io.adb:20:9">U32</a>&apos;(16)); <span class="comment">-- Flags (16 = has an index)</span> </pre></li>
<li id="l970"><pre>      <span class="droplink">Write_Intel<ul><li><a href="src_gl-io.adb.html#l952" title="To spec">To spec</a></li><li><a href="src_gl-io.adb.html#l761" title="To body">To body</a></li></ul></span> (<a href="src_gl-io.adb.html#l20" title="defined at gl-io.adb:20:9">U32</a> (<a href="src_gl-io.adb.html#l933" title="defined at gl-io.adb:933:4">frames</a>)); </pre></li>
<li id="l971"><pre>      <span class="droplink">Write_Intel<ul><li><a href="src_gl-io.adb.html#l952" title="To spec">To spec</a></li><li><a href="src_gl-io.adb.html#l761" title="To body">To body</a></li></ul></span> (<a href="src_gl-io.adb.html#l20" title="defined at gl-io.adb:20:9">U32</a>&apos;(0));  <span class="comment">-- InitialFrames</span> </pre></li>
<li id="l972"><pre>      <span class="droplink">Write_Intel<ul><li><a href="src_gl-io.adb.html#l952" title="To spec">To spec</a></li><li><a href="src_gl-io.adb.html#l761" title="To body">To body</a></li></ul></span> (<a href="src_gl-io.adb.html#l20" title="defined at gl-io.adb:20:9">U32</a>&apos;(1));  <span class="comment">-- Streams</span> </pre></li>
<li id="l973"><pre>      <span class="droplink">Write_Intel<ul><li><a href="src_gl-io.adb.html#l952" title="To spec">To spec</a></li><li><a href="src_gl-io.adb.html#l761" title="To body">To body</a></li></ul></span> (<a href="src_gl-io.adb.html#l936" title="defined at gl-io.adb:936:4">bmp_size</a>); </pre></li>
<li id="l974"><pre>      <span class="droplink">Write_Intel<ul><li><a href="src_gl-io.adb.html#l952" title="To spec">To spec</a></li><li><a href="src_gl-io.adb.html#l761" title="To body">To body</a></li></ul></span> (<a href="src_gl-io.adb.html#l20" title="defined at gl-io.adb:20:9">U32</a> (<a href="src_gl-io.adb.html#l935" title="defined at gl-io.adb:935:4">width</a>)); </pre></li>
<li id="l975"><pre>      <span class="droplink">Write_Intel<ul><li><a href="src_gl-io.adb.html#l952" title="To spec">To spec</a></li><li><a href="src_gl-io.adb.html#l761" title="To body">To body</a></li></ul></span> (<a href="src_gl-io.adb.html#l20" title="defined at gl-io.adb:20:9">U32</a> (<a href="src_gl-io.adb.html#l935" title="defined at gl-io.adb:935:11">height</a>)); </pre></li>
<li id="l976"><pre>      <span class="droplink">Write_Intel<ul><li><a href="src_gl-io.adb.html#l952" title="To spec">To spec</a></li><li><a href="src_gl-io.adb.html#l761" title="To body">To body</a></li></ul></span> (<a href="src_gl-io.adb.html#l20" title="defined at gl-io.adb:20:9">U32</a>&apos;(0));  <span class="comment">-- Scale</span> </pre></li>
<li id="l977"><pre>      <span class="droplink">Write_Intel<ul><li><a href="src_gl-io.adb.html#l952" title="To spec">To spec</a></li><li><a href="src_gl-io.adb.html#l761" title="To body">To body</a></li></ul></span> (<a href="src_gl-io.adb.html#l20" title="defined at gl-io.adb:20:9">U32</a>&apos;(0));  <span class="comment">-- Rate</span> </pre></li>
<li id="l978"><pre>      <span class="droplink">Write_Intel<ul><li><a href="src_gl-io.adb.html#l952" title="To spec">To spec</a></li><li><a href="src_gl-io.adb.html#l761" title="To body">To body</a></li></ul></span> (<a href="src_gl-io.adb.html#l20" title="defined at gl-io.adb:20:9">U32</a>&apos;(0));  <span class="comment">-- Start</span> </pre></li>
<li id="l979"><pre>      <span class="droplink">Write_Intel<ul><li><a href="src_gl-io.adb.html#l952" title="To spec">To spec</a></li><li><a href="src_gl-io.adb.html#l761" title="To body">To body</a></li></ul></span> (<a href="src_gl-io.adb.html#l20" title="defined at gl-io.adb:20:9">U32</a>&apos;(0));  <span class="comment">-- Length</span> </pre></li>
<li id="l980"><pre>      <span class="comment">-- End of AVI Header</span> </pre></li>
<li id="l981"><pre>      String&apos;Write (<a href="src_gl-io.adb.html#l950" title="defined at gl-io.adb:950:7">s</a>, <span class="string">&quot;LIST&quot;</span>); </pre></li>
<li id="l982"><pre>      <span class="droplink">Write_Intel<ul><li><a href="src_gl-io.adb.html#l952" title="To spec">To spec</a></li><li><a href="src_gl-io.adb.html#l761" title="To body">To body</a></li></ul></span> (<a href="src_gl-io.adb.html#l947" title="defined at gl-io.adb:947:7">second_list_size</a>); </pre></li>
<li id="l983"><pre>      String&apos;Write (<a href="src_gl-io.adb.html#l950" title="defined at gl-io.adb:950:7">s</a>, <span class="string">&quot;strl&quot;</span>); </pre></li>
<li id="l984"><pre>      <span class="comment">-- Begin of Str</span> </pre></li>
<li id="l985"><pre>      String&apos;Write (<a href="src_gl-io.adb.html#l950" title="defined at gl-io.adb:950:7">s</a>, <span class="string">&quot;strh&quot;</span>); </pre></li>
<li id="l986"><pre>      <span class="droplink">Write_Intel<ul><li><a href="src_gl-io.adb.html#l952" title="To spec">To spec</a></li><li><a href="src_gl-io.adb.html#l761" title="To body">To body</a></li></ul></span> (<a href="src_gl-io.adb.html#l20" title="defined at gl-io.adb:20:9">U32</a>&apos;(56)); </pre></li>
<li id="l987"><pre>      String&apos;Write (<a href="src_gl-io.adb.html#l950" title="defined at gl-io.adb:950:7">s</a>, <span class="string">&quot;vids&quot;</span>); </pre></li>
<li id="l988"><pre>      String&apos;Write (<a href="src_gl-io.adb.html#l950" title="defined at gl-io.adb:950:7">s</a>, <span class="string">&quot;DIB &quot;</span>); </pre></li>
<li id="l989"><pre>      <span class="droplink">Write_Intel<ul><li><a href="src_gl-io.adb.html#l952" title="To spec">To spec</a></li><li><a href="src_gl-io.adb.html#l761" title="To body">To body</a></li></ul></span> (<a href="src_gl-io.adb.html#l20" title="defined at gl-io.adb:20:9">U32</a>&apos;(0));     <span class="comment">-- flags</span> </pre></li>
<li id="l990"><pre>      <span class="droplink">Write_Intel<ul><li><a href="src_gl-io.adb.html#l952" title="To spec">To spec</a></li><li><a href="src_gl-io.adb.html#l761" title="To body">To body</a></li></ul></span> (<a href="src_gl-io.adb.html#l20" title="defined at gl-io.adb:20:9">U32</a>&apos;(0));     <span class="comment">-- priority</span> </pre></li>
<li id="l991"><pre>      <span class="droplink">Write_Intel<ul><li><a href="src_gl-io.adb.html#l952" title="To spec">To spec</a></li><li><a href="src_gl-io.adb.html#l761" title="To body">To body</a></li></ul></span> (<a href="src_gl-io.adb.html#l20" title="defined at gl-io.adb:20:9">U32</a>&apos;(0));     <span class="comment">-- initial frames</span> </pre></li>
<li id="l992"><pre>      <span class="droplink">Write_Intel<ul><li><a href="src_gl-io.adb.html#l952" title="To spec">To spec</a></li><li><a href="src_gl-io.adb.html#l761" title="To body">To body</a></li></ul></span> (<a href="src_gl-io.adb.html#l953" title="defined at gl-io.adb:953:7">microseconds_per_frame</a>); <span class="comment">-- Scale</span> </pre></li>
<li id="l993"><pre>      <span class="droplink">Write_Intel<ul><li><a href="src_gl-io.adb.html#l952" title="To spec">To spec</a></li><li><a href="src_gl-io.adb.html#l761" title="To body">To body</a></li></ul></span> (<a href="src_gl-io.adb.html#l20" title="defined at gl-io.adb:20:9">U32</a>&apos;(1_000_000));        <span class="comment">-- Rate</span> </pre></li>
<li id="l994"><pre>      <span class="droplink">Write_Intel<ul><li><a href="src_gl-io.adb.html#l952" title="To spec">To spec</a></li><li><a href="src_gl-io.adb.html#l761" title="To body">To body</a></li></ul></span> (<a href="src_gl-io.adb.html#l20" title="defined at gl-io.adb:20:9">U32</a>&apos;(0));                <span class="comment">-- Start</span> </pre></li>
<li id="l995"><pre>      <span class="droplink">Write_Intel<ul><li><a href="src_gl-io.adb.html#l952" title="To spec">To spec</a></li><li><a href="src_gl-io.adb.html#l761" title="To body">To body</a></li></ul></span> (<a href="src_gl-io.adb.html#l20" title="defined at gl-io.adb:20:9">U32</a> (<a href="src_gl-io.adb.html#l933" title="defined at gl-io.adb:933:4">frames</a>));            <span class="comment">-- Length</span> </pre></li>
<li id="l996"><pre>      <span class="droplink">Write_Intel<ul><li><a href="src_gl-io.adb.html#l952" title="To spec">To spec</a></li><li><a href="src_gl-io.adb.html#l761" title="To body">To body</a></li></ul></span> (<a href="src_gl-io.adb.html#l936" title="defined at gl-io.adb:936:4">bmp_size</a>);               <span class="comment">-- SuggestedBufferSize</span> </pre></li>
<li id="l997"><pre>      <span class="droplink">Write_Intel<ul><li><a href="src_gl-io.adb.html#l952" title="To spec">To spec</a></li><li><a href="src_gl-io.adb.html#l761" title="To body">To body</a></li></ul></span> (<a href="src_gl-io.adb.html#l20" title="defined at gl-io.adb:20:9">U32</a>&apos;(0));                <span class="comment">-- Quality</span> </pre></li>
<li id="l998"><pre>      <span class="droplink">Write_Intel<ul><li><a href="src_gl-io.adb.html#l952" title="To spec">To spec</a></li><li><a href="src_gl-io.adb.html#l761" title="To body">To body</a></li></ul></span> (<a href="src_gl-io.adb.html#l20" title="defined at gl-io.adb:20:9">U32</a>&apos;(0));                <span class="comment">-- SampleSize</span> </pre></li>
<li id="l999"><pre>      <span class="droplink">Write_Intel<ul><li><a href="src_gl-io.adb.html#l952" title="To spec">To spec</a></li><li><a href="src_gl-io.adb.html#l761" title="To body">To body</a></li></ul></span> (<a href="src_gl-io.adb.html#l20" title="defined at gl-io.adb:20:9">U32</a>&apos;(0)); </pre></li>
<li id="l1000"><pre>      <span class="droplink">Write_Intel<ul><li><a href="src_gl-io.adb.html#l951" title="To spec">To spec</a></li><li><a href="src_gl-io.adb.html#l761" title="To body">To body</a></li></ul></span> (<a href="src_gl-io.adb.html#l19" title="defined at gl-io.adb:19:9">U16</a> (<a href="src_gl-io.adb.html#l935" title="defined at gl-io.adb:935:4">width</a>)); </pre></li>
<li id="l1001"><pre>      <span class="droplink">Write_Intel<ul><li><a href="src_gl-io.adb.html#l951" title="To spec">To spec</a></li><li><a href="src_gl-io.adb.html#l761" title="To body">To body</a></li></ul></span> (<a href="src_gl-io.adb.html#l19" title="defined at gl-io.adb:19:9">U16</a> (<a href="src_gl-io.adb.html#l935" title="defined at gl-io.adb:935:11">height</a>)); </pre></li>
<li id="l1002"><pre>      <span class="comment">-- End of Str</span> </pre></li>
<li id="l1003"><pre>      String&apos;Write (<a href="src_gl-io.adb.html#l950" title="defined at gl-io.adb:950:7">s</a>, <span class="string">&quot;strf&quot;</span>); </pre></li>
<li id="l1004"><pre>      <span class="droplink">Write_Intel<ul><li><a href="src_gl-io.adb.html#l952" title="To spec">To spec</a></li><li><a href="src_gl-io.adb.html#l761" title="To body">To body</a></li></ul></span> (<a href="src_gl-io.adb.html#l20" title="defined at gl-io.adb:20:9">U32</a>&apos;(40)); </pre></li>
<li id="l1005"><pre>      <span class="comment">-- Begin of BMI</span> </pre></li>
<li id="l1006"><pre>      <span class="droplink">Write_Intel<ul><li><a href="src_gl-io.adb.html#l952" title="To spec">To spec</a></li><li><a href="src_gl-io.adb.html#l761" title="To body">To body</a></li></ul></span> (<a href="src_gl-io.adb.html#l20" title="defined at gl-io.adb:20:9">U32</a>&apos;(40));    <span class="comment">-- BM header size (like BMP)</span> </pre></li>
<li id="l1007"><pre>      <span class="droplink">Write_Intel<ul><li><a href="src_gl-io.adb.html#l952" title="To spec">To spec</a></li><li><a href="src_gl-io.adb.html#l761" title="To body">To body</a></li></ul></span> (<a href="src_gl-io.adb.html#l20" title="defined at gl-io.adb:20:9">U32</a> (<a href="src_gl-io.adb.html#l935" title="defined at gl-io.adb:935:4">width</a>)); </pre></li>
<li id="l1008"><pre>      <span class="droplink">Write_Intel<ul><li><a href="src_gl-io.adb.html#l952" title="To spec">To spec</a></li><li><a href="src_gl-io.adb.html#l761" title="To body">To body</a></li></ul></span> (<a href="src_gl-io.adb.html#l20" title="defined at gl-io.adb:20:9">U32</a> (<a href="src_gl-io.adb.html#l935" title="defined at gl-io.adb:935:11">height</a>)); </pre></li>
<li id="l1009"><pre>      <span class="droplink">Write_Intel<ul><li><a href="src_gl-io.adb.html#l951" title="To spec">To spec</a></li><li><a href="src_gl-io.adb.html#l761" title="To body">To body</a></li></ul></span> (<a href="src_gl-io.adb.html#l19" title="defined at gl-io.adb:19:9">U16</a>&apos;(1));     <span class="comment">-- Planes</span> </pre></li>
<li id="l1010"><pre>      <span class="droplink">Write_Intel<ul><li><a href="src_gl-io.adb.html#l951" title="To spec">To spec</a></li><li><a href="src_gl-io.adb.html#l761" title="To body">To body</a></li></ul></span> (<a href="src_gl-io.adb.html#l19" title="defined at gl-io.adb:19:9">U16</a>&apos;(24));    <span class="comment">-- BitCount</span> </pre></li>
<li id="l1011"><pre>      <span class="droplink">Write_Intel<ul><li><a href="src_gl-io.adb.html#l952" title="To spec">To spec</a></li><li><a href="src_gl-io.adb.html#l761" title="To body">To body</a></li></ul></span> (<a href="src_gl-io.adb.html#l20" title="defined at gl-io.adb:20:9">U32</a>&apos;(0));     <span class="comment">-- Compression</span> </pre></li>
<li id="l1012"><pre>      <span class="droplink">Write_Intel<ul><li><a href="src_gl-io.adb.html#l952" title="To spec">To spec</a></li><li><a href="src_gl-io.adb.html#l761" title="To body">To body</a></li></ul></span> (<a href="src_gl-io.adb.html#l936" title="defined at gl-io.adb:936:4">bmp_size</a>);    <span class="comment">-- SizeImage</span> </pre></li>
<li id="l1013"><pre>      <span class="droplink">Write_Intel<ul><li><a href="src_gl-io.adb.html#l952" title="To spec">To spec</a></li><li><a href="src_gl-io.adb.html#l761" title="To body">To body</a></li></ul></span> (<a href="src_gl-io.adb.html#l20" title="defined at gl-io.adb:20:9">U32</a>&apos;(3780));  <span class="comment">-- XPelsPerMeter</span> </pre></li>
<li id="l1014"><pre>      <span class="droplink">Write_Intel<ul><li><a href="src_gl-io.adb.html#l952" title="To spec">To spec</a></li><li><a href="src_gl-io.adb.html#l761" title="To body">To body</a></li></ul></span> (<a href="src_gl-io.adb.html#l20" title="defined at gl-io.adb:20:9">U32</a>&apos;(3780));  <span class="comment">-- YPelsPerMeter</span> </pre></li>
<li id="l1015"><pre>      <span class="droplink">Write_Intel<ul><li><a href="src_gl-io.adb.html#l952" title="To spec">To spec</a></li><li><a href="src_gl-io.adb.html#l761" title="To body">To body</a></li></ul></span> (<a href="src_gl-io.adb.html#l20" title="defined at gl-io.adb:20:9">U32</a>&apos;(0));     <span class="comment">-- ClrUsed</span> </pre></li>
<li id="l1016"><pre>      <span class="droplink">Write_Intel<ul><li><a href="src_gl-io.adb.html#l952" title="To spec">To spec</a></li><li><a href="src_gl-io.adb.html#l761" title="To body">To body</a></li></ul></span> (<a href="src_gl-io.adb.html#l20" title="defined at gl-io.adb:20:9">U32</a>&apos;(0));     <span class="comment">-- ClrImportant</span> </pre></li>
<li id="l1017"><pre>      <span class="comment">-- End of BMI</span> </pre></li>
<li id="l1018"><pre>      String&apos;Write (<a href="src_gl-io.adb.html#l950" title="defined at gl-io.adb:950:7">s</a>, <span class="string">&quot;LIST&quot;</span>); </pre></li>
<li id="l1019"><pre>      <span class="droplink">Write_Intel<ul><li><a href="src_gl-io.adb.html#l952" title="To spec">To spec</a></li><li><a href="src_gl-io.adb.html#l761" title="To body">To body</a></li></ul></span> (<a href="src_gl-io.adb.html#l946" title="defined at gl-io.adb:946:7">movie_size</a>); </pre></li>
<li id="l1020"><pre>      String&apos;Write (<a href="src_gl-io.adb.html#l950" title="defined at gl-io.adb:950:7">s</a>, <span class="string">&quot;movi&quot;</span>); </pre></li>
<li id="l1021"><pre>   <span class="keyword">end</span> <span class="droplink">Write_RIFF_headers<ul><li><a href="src_gl-io.adb.html#l938" title="To spec">To spec</a></li><li><a href="src_gl-io.adb.html#l938" title="To body">To body</a></li></ul></span>; </pre></li>
<li id="l1022"><pre> </pre></li>
<li id="l1023"><pre>   <span class="keyword">procedure</span> <span class="droplink">Start_Capture<ul><li><a href="gl-io.ads.html#gl-io.ads:133:13" title="To API doc">To API doc</a></li><li><a href="src_gl-io.ads.html#l133" title="To spec">To spec</a></li></ul></span> (<span class="droplink">AVI_Name<ul><li><a href="gl-io.ads.html#gl-io.ads:133:28" title="To API doc">To API doc</a></li><li><a href="src_gl-io.ads.html#l133" title="To spec">To spec</a></li></ul></span> : String; <span class="droplink">frame_rate<ul><li><a href="gl-io.ads.html#gl-io.ads:133:47" title="To API doc">To API doc</a></li><li><a href="src_gl-io.ads.html#l133" title="To spec">To spec</a></li></ul></span> : Positive) <span class="keyword">is</span> </pre></li>
<li id="l1024"><pre> </pre></li>
<li id="l1025"><pre>      Capture_Viewport  : <span class="keyword">array</span> (0 .. 3) <span class="keyword">of</span> <span class="keyword">aliased</span> <span class="droplink">GL.Int<ul><li><a href="gl.ads.html#gl.ads:121:9" title="To API doc">To API doc</a></li><li><a href="src_gl.ads.html#l121" title="To spec">To spec</a></li></ul></span>; </pre></li>
<li id="l1026"><pre> </pre></li>
<li id="l1027"><pre>      <span class="keyword">type</span> GL_Int_Pointer <span class="keyword">is</span> <span class="keyword">new</span> <span class="droplink">GL.intPointer<ul><li><a href="gl.ads.html#gl.ads:139:9" title="To API doc">To API doc</a></li><li><a href="src_gl.ads.html#l139" title="To spec">To spec</a></li></ul></span>; </pre></li>
<li id="l1028"><pre>      <span class="keyword">function</span> Cvt <span class="keyword">is</span> <span class="keyword">new</span> Ada.Unchecked_Conversion (System.Address, <a href="src_gl-io.adb.html#l1027" title="defined at gl-io.adb:1027:12">GL_Int_Pointer</a>); </pre></li>
<li id="l1029"><pre>      <span class="comment">-- This method is functionally identical as GNAT&apos;s Unrestricted_Access</span> </pre></li>
<li id="l1030"><pre>      <span class="comment">-- but has no type safety (cf GNAT Docs)</span> </pre></li>
<li id="l1031"><pre>      <span class="keyword">pragma</span> No_Strict_Aliasing (<a href="src_gl-io.adb.html#l1027" title="defined at gl-io.adb:1027:12">GL_Int_Pointer</a>); <span class="comment">-- recommended by GNAT 2005 +</span> </pre></li>
<li id="l1032"><pre> </pre></li>
<li id="l1033"><pre>   <span class="keyword">begin</span> </pre></li>
<li id="l1034"><pre>      Create (<a href="src_gl-io.adb.html#l932" title="defined at gl-io.adb:932:4">avi</a>, Out_File, <span class="droplink">AVI_Name<ul><li><a href="gl-io.ads.html#gl-io.ads:133:28" title="To API doc">To API doc</a></li><li><a href="src_gl-io.ads.html#l133" title="To spec">To spec</a></li></ul></span>); </pre></li>
<li id="l1035"><pre>      <a href="src_gl-io.adb.html#l933" title="defined at gl-io.adb:933:4">frames</a> := 0; </pre></li>
<li id="l1036"><pre>      <a href="src_gl-io.adb.html#l934" title="defined at gl-io.adb:934:4">rate</a> := <span class="droplink">frame_rate<ul><li><a href="gl-io.ads.html#gl-io.ads:133:47" title="To API doc">To API doc</a></li><li><a href="src_gl-io.ads.html#l133" title="To spec">To spec</a></li></ul></span>; </pre></li>
<li id="l1037"><pre>      <span class="droplink">GL.GetIntegerv<ul><li><a href="gl.ads.html#gl.ads:1198:14" title="To API doc">To API doc</a></li><li><a href="src_gl.ads.html#l1198" title="To spec">To spec</a></li><li><a href="src_gl.ads.html#l4148" title="To body">To body</a></li></ul></span> (GL.VIEWPORT, <span class="droplink">GL.intPointer<ul><li><a href="gl.ads.html#gl.ads:139:9" title="To API doc">To API doc</a></li><li><a href="src_gl.ads.html#l139" title="To spec">To spec</a></li></ul></span> (<a href="src_gl-io.adb.html#l1028" title="defined at gl-io.adb:1028:16">Cvt</a> (<a href="src_gl-io.adb.html#l1025" title="defined at gl-io.adb:1025:7">Capture_Viewport</a> (0)&apos;Address))); </pre></li>
<li id="l1038"><pre>      <a href="src_gl-io.adb.html#l935" title="defined at gl-io.adb:935:4">width</a> := Positive (<a href="src_gl-io.adb.html#l1025" title="defined at gl-io.adb:1025:7">Capture_Viewport</a> (2)); </pre></li>
<li id="l1039"><pre>      <a href="src_gl-io.adb.html#l935" title="defined at gl-io.adb:935:11">height</a> := Positive (<a href="src_gl-io.adb.html#l1025" title="defined at gl-io.adb:1025:7">Capture_Viewport</a> (3)); </pre></li>
<li id="l1040"><pre>      <span class="comment">-- NB : GL viewport resizing should be blocked during the video capture!</span> </pre></li>
<li id="l1041"><pre>      <span class="droplink">Write_RIFF_headers<ul><li><a href="src_gl-io.adb.html#l938" title="To spec">To spec</a></li><li><a href="src_gl-io.adb.html#l938" title="To body">To body</a></li></ul></span>; </pre></li>
<li id="l1042"><pre>   <span class="keyword">end</span> <span class="droplink">Start_Capture<ul><li><a href="gl-io.ads.html#gl-io.ads:133:13" title="To API doc">To API doc</a></li><li><a href="src_gl-io.ads.html#l133" title="To spec">To spec</a></li><li><a href="src_gl-io.adb.html#l1023" title="To body">To body</a></li></ul></span>; </pre></li>
<li id="l1043"><pre> </pre></li>
<li id="l1044"><pre>   <span class="keyword">procedure</span> <span class="droplink">Capture_Frame<ul><li><a href="gl-io.ads.html#gl-io.ads:135:13" title="To API doc">To API doc</a></li><li><a href="src_gl-io.ads.html#l135" title="To spec">To spec</a></li></ul></span> <span class="keyword">is</span> </pre></li>
<li id="l1045"><pre> </pre></li>
<li id="l1046"><pre>      s : <span class="keyword">constant</span> Stream_Access := Stream (<a href="src_gl-io.adb.html#l932" title="defined at gl-io.adb:932:4">avi</a>); </pre></li>
<li id="l1047"><pre>      <span class="keyword">procedure</span> <a href="src_gl-io.adb.html#l761" title="defined at gl-io.adb:1047:17">Write_Intel</a> <span class="keyword">is</span> <span class="keyword">new</span> <span class="droplink">Write_Intel_x86_number<ul><li><a href="src_gl-io.adb.html#l759" title="To spec">To spec</a></li><li><a href="src_gl-io.adb.html#l761" title="To body">To body</a></li></ul></span> (<a href="src_gl-io.adb.html#l20" title="defined at gl-io.adb:20:9">U32</a>, <a href="src_gl-io.adb.html#l1046" title="defined at gl-io.adb:1046:7">s</a>); </pre></li>
<li id="l1048"><pre> </pre></li>
<li id="l1049"><pre>   <span class="keyword">begin</span> </pre></li>
<li id="l1050"><pre>      String&apos;Write (<a href="src_gl-io.adb.html#l1046" title="defined at gl-io.adb:1046:7">s</a>, <span class="string">&quot;00db&quot;</span>); </pre></li>
<li id="l1051"><pre>      <span class="droplink">Write_Intel<ul><li><a href="src_gl-io.adb.html#l1047" title="To spec">To spec</a></li><li><a href="src_gl-io.adb.html#l761" title="To body">To body</a></li></ul></span> (<a href="src_gl-io.adb.html#l936" title="defined at gl-io.adb:936:4">bmp_size</a>); </pre></li>
<li id="l1052"><pre>      <span class="droplink">Write_raw_BGR_frame<ul><li><a href="src_gl-io.adb.html#l771" title="To spec">To spec</a></li><li><a href="src_gl-io.adb.html#l771" title="To body">To body</a></li></ul></span> (<a href="src_gl-io.adb.html#l1046" title="defined at gl-io.adb:1046:7">s</a>, <a href="src_gl-io.adb.html#l935" title="defined at gl-io.adb:935:4">width</a>, <a href="src_gl-io.adb.html#l935" title="defined at gl-io.adb:935:11">height</a>); </pre></li>
<li id="l1053"><pre>      <a href="src_gl-io.adb.html#l933" title="defined at gl-io.adb:933:4">frames</a> := <a href="src_gl-io.adb.html#l933" title="defined at gl-io.adb:933:4">frames</a> + 1; </pre></li>
<li id="l1054"><pre>   <span class="keyword">end</span> <span class="droplink">Capture_Frame<ul><li><a href="gl-io.ads.html#gl-io.ads:135:13" title="To API doc">To API doc</a></li><li><a href="src_gl-io.ads.html#l135" title="To spec">To spec</a></li><li><a href="src_gl-io.adb.html#l1044" title="To body">To body</a></li></ul></span>; </pre></li>
<li id="l1055"><pre> </pre></li>
<li id="l1056"><pre>   <span class="keyword">procedure</span> <span class="droplink">Stop_Capture<ul><li><a href="gl-io.ads.html#gl-io.ads:137:13" title="To API doc">To API doc</a></li><li><a href="src_gl-io.ads.html#l137" title="To spec">To spec</a></li></ul></span> <span class="keyword">is</span> </pre></li>
<li id="l1057"><pre> </pre></li>
<li id="l1058"><pre>      index_size : <span class="keyword">constant</span> <a href="src_gl-io.adb.html#l20" title="defined at gl-io.adb:20:9">U32</a> := <a href="src_gl-io.adb.html#l20" title="defined at gl-io.adb:20:9">U32</a> (<a href="src_gl-io.adb.html#l933" title="defined at gl-io.adb:933:4">frames</a>) * 16; </pre></li>
<li id="l1059"><pre>      s : <span class="keyword">constant</span> Stream_Access := Stream (<a href="src_gl-io.adb.html#l932" title="defined at gl-io.adb:932:4">avi</a>); </pre></li>
<li id="l1060"><pre>      <span class="keyword">procedure</span> <a href="src_gl-io.adb.html#l761" title="defined at gl-io.adb:1060:17">Write_Intel</a> <span class="keyword">is</span> <span class="keyword">new</span> <span class="droplink">Write_Intel_x86_number<ul><li><a href="src_gl-io.adb.html#l759" title="To spec">To spec</a></li><li><a href="src_gl-io.adb.html#l761" title="To body">To body</a></li></ul></span> (<a href="src_gl-io.adb.html#l20" title="defined at gl-io.adb:20:9">U32</a>, <a href="src_gl-io.adb.html#l1059" title="defined at gl-io.adb:1059:7">s</a>); </pre></li>
<li id="l1061"><pre>      ChunkOffset : <a href="src_gl-io.adb.html#l20" title="defined at gl-io.adb:20:9">U32</a> := 4; </pre></li>
<li id="l1062"><pre> </pre></li>
<li id="l1063"><pre>   <span class="keyword">begin</span> </pre></li>
<li id="l1064"><pre>      <span class="comment">-- write the index section</span> </pre></li>
<li id="l1065"><pre>      String&apos;Write (<a href="src_gl-io.adb.html#l1059" title="defined at gl-io.adb:1059:7">s</a>, <span class="string">&quot;idx1&quot;</span>); </pre></li>
<li id="l1066"><pre>      <span class="comment">--</span> </pre></li>
<li id="l1067"><pre>      <span class="droplink">Write_Intel<ul><li><a href="src_gl-io.adb.html#l1060" title="To spec">To spec</a></li><li><a href="src_gl-io.adb.html#l761" title="To body">To body</a></li></ul></span> (<a href="src_gl-io.adb.html#l1058" title="defined at gl-io.adb:1058:7">index_size</a>); </pre></li>
<li id="l1068"><pre>      <span class="keyword">for</span> f <span class="keyword">in</span> 1 .. <a href="src_gl-io.adb.html#l933" title="defined at gl-io.adb:933:4">frames</a> <span class="keyword">loop</span> </pre></li>
<li id="l1069"><pre>         String&apos;Write (<a href="src_gl-io.adb.html#l1059" title="defined at gl-io.adb:1059:7">s</a>, <span class="string">&quot;00db&quot;</span>); </pre></li>
<li id="l1070"><pre>         <span class="droplink">Write_Intel<ul><li><a href="src_gl-io.adb.html#l1060" title="To spec">To spec</a></li><li><a href="src_gl-io.adb.html#l761" title="To body">To body</a></li></ul></span> (<a href="src_gl-io.adb.html#l20" title="defined at gl-io.adb:20:9">U32</a>&apos;(16)); <span class="comment">-- keyframe</span> </pre></li>
<li id="l1071"><pre>         <span class="droplink">Write_Intel<ul><li><a href="src_gl-io.adb.html#l1060" title="To spec">To spec</a></li><li><a href="src_gl-io.adb.html#l761" title="To body">To body</a></li></ul></span> (<a href="src_gl-io.adb.html#l1061" title="defined at gl-io.adb:1061:7">ChunkOffset</a>); </pre></li>
<li id="l1072"><pre>         <a href="src_gl-io.adb.html#l1061" title="defined at gl-io.adb:1061:7">ChunkOffset</a> := <a href="src_gl-io.adb.html#l1061" title="defined at gl-io.adb:1061:7">ChunkOffset</a> + <a href="src_gl-io.adb.html#l936" title="defined at gl-io.adb:936:4">bmp_size</a> + 8; </pre></li>
<li id="l1073"><pre>         <span class="droplink">Write_Intel<ul><li><a href="src_gl-io.adb.html#l1060" title="To spec">To spec</a></li><li><a href="src_gl-io.adb.html#l761" title="To body">To body</a></li></ul></span> (<a href="src_gl-io.adb.html#l936" title="defined at gl-io.adb:936:4">bmp_size</a>); </pre></li>
<li id="l1074"><pre>      <span class="keyword">end</span> <span class="keyword">loop</span>; </pre></li>
<li id="l1075"><pre>      <span class="comment">-- Go back to file beginning .. .</span> </pre></li>
<li id="l1076"><pre>      Set_Index (<a href="src_gl-io.adb.html#l932" title="defined at gl-io.adb:932:4">avi</a>, 1); </pre></li>
<li id="l1077"><pre>      <span class="droplink">Write_RIFF_headers<ul><li><a href="src_gl-io.adb.html#l938" title="To spec">To spec</a></li><li><a href="src_gl-io.adb.html#l938" title="To body">To body</a></li></ul></span>; <span class="comment">-- rewrite headers with correct data</span> </pre></li>
<li id="l1078"><pre>      Close (<a href="src_gl-io.adb.html#l932" title="defined at gl-io.adb:932:4">avi</a>); </pre></li>
<li id="l1079"><pre>   <span class="keyword">end</span> <span class="droplink">Stop_Capture<ul><li><a href="gl-io.ads.html#gl-io.ads:137:13" title="To API doc">To API doc</a></li><li><a href="src_gl-io.ads.html#l137" title="To spec">To spec</a></li><li><a href="src_gl-io.adb.html#l1056" title="To body">To body</a></li></ul></span>; </pre></li>
<li id="l1080"><pre> </pre></li>
<li id="l1081"><pre><span class="keyword">end</span> <span class="droplink">GL.IO<ul><li><a href="gl-io.ads.html#gl-io.ads:45:12" title="To API doc">To API doc</a></li><li><a href="src_gl-io.ads.html#l45" title="To spec">To spec</a></li><li><a href="src_gl-io.adb.html#l14" title="To body">To body</a></li></ul></span>; </pre></li>
</ol></div>
</div>

</body>
</html>