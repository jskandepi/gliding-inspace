<?xml version='1.0' encoding='utf-8'?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN"  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html><head>
  <meta http-equiv="Content-Type" content="application/xhtml+xml; charset=UTF-8" />
  <meta http-equiv="Content-Script-Type" content="text/javascript"/>

  <title>
    File: unzip-decompress.adb
  </title>
  <link rel='stylesheet' href='support/docgen.css' type='text/css'/>
  <link rel='stylesheet' href='support/tags.css' type='text/css'/>
  <script src='support/docgen.js' type='text/javascript' charset='utf-8'></script>
</head>
<body onload="onloadDoc();">

<div id='leftSide'>
  <div id='leftSideInside'>
  <div id='header'>
    <h2 class="button">Documentation</h2>
    <a href='toc.html'><div class="button2">Table of Contents</div></a>

    <a href='tree.html'><div class="button2">Class Inheritance Tree</div></a>

  </div>
  </div>
</div> <!-- leftSide -->

<div class='subprograms'>
  <div class='details'><ol><li id="l1"><pre><span class="keyword">with</span> <span class="droplink">Zip.CRC<ul><li><a href="zip-crc.ads.html#zip-crc.ads:3:13" title="To API doc">To API doc</a></li><li><a href="src_zip-crc.ads.html#l3" title="To spec">To spec</a></li><li><a href="src_zip-crc.adb.html#l1" title="To body">To body</a></li></ul></span>, <span class="droplink">UnZip.Decompress.Huffman<ul><li><a href="unzip-decompress-huffman.ads.html#unzip-decompress-huffman.ads:6:34" title="To API doc">To API doc</a></li><li><a href="src_unzip-decompress-huffman.ads.html#l6" title="To spec">To spec</a></li><li><a href="src_unzip-decompress-huffman.adb.html#l5" title="To body">To body</a></li></ul></span>, <span class="droplink">BZip2<ul><li><a href="bzip2.ads.html#bzip2.ads:81:9" title="To API doc">To API doc</a></li><li><a href="src_bzip2.ads.html#l81" title="To spec">To spec</a></li><li><a href="src_bzip2.adb.html#l16" title="To body">To body</a></li></ul></span>; </pre></li>
<li id="l2"><pre><span class="keyword">with</span> Ada.Text_IO, Interfaces; </pre></li>
<li id="l3"><pre><span class="keyword">with</span> Ada.Streams.Stream_IO; </pre></li>
<li id="l4"><pre> </pre></li>
<li id="l5"><pre><span class="keyword">package</span> <span class="keyword">body</span> <span class="droplink">UnZip.Decompress<ul><li><a href="unzip-decompress.ads.html#unzip-decompress.ads:18:23" title="To API doc">To API doc</a></li><li><a href="src_unzip-decompress.ads.html#l18" title="To spec">To spec</a></li></ul></span> <span class="keyword">is</span> </pre></li>
<li id="l6"><pre> </pre></li>
<li id="l7"><pre>   <span class="keyword">procedure</span> <span class="droplink">Decompress_data<ul><li><a href="unzip-decompress.ads.html#unzip-decompress.ads:20:14" title="To API doc">To API doc</a></li><li><a href="src_unzip-decompress.ads.html#l20" title="To spec">To spec</a></li></ul></span> ( </pre></li>
<li id="l8"><pre>                              <span class="droplink">zip_file<ul><li><a href="unzip-decompress.ads.html#unzip-decompress.ads:21:5" title="To API doc">To API doc</a></li><li><a href="src_unzip-decompress.ads.html#l21" title="To spec">To spec</a></li></ul></span>             : <span class="droplink">Zip_Streams.Zipstream_Class<ul><li><a href="zip_streams.ads.html#zip_streams.ads:43:9" title="To API doc">To API doc</a></li><li><a href="src_zip_streams.ads.html#l43" title="To spec">To spec</a></li></ul></span>; </pre></li>
<li id="l9"><pre>                              <span class="droplink">format<ul><li><a href="unzip-decompress.ads.html#unzip-decompress.ads:24:5" title="To API doc">To API doc</a></li><li><a href="src_unzip-decompress.ads.html#l24" title="To spec">To spec</a></li></ul></span>               : <span class="droplink">PKZip_method<ul><li><a href="unzip.ads.html#unzip.ads:163:11" title="To API doc">To API doc</a></li><li><a href="src_unzip.ads.html#l163" title="To spec">To spec</a></li></ul></span>; </pre></li>
<li id="l10"><pre>                              <span class="droplink">mode<ul><li><a href="unzip-decompress.ads.html#unzip-decompress.ads:25:5" title="To API doc">To API doc</a></li><li><a href="src_unzip-decompress.ads.html#l25" title="To spec">To spec</a></li></ul></span>                 : <span class="droplink">Write_mode<ul><li><a href="unzip.ads.html#unzip.ads:298:8" title="To API doc">To API doc</a></li><li><a href="src_unzip.ads.html#l298" title="To spec">To spec</a></li></ul></span>; </pre></li>
<li id="l11"><pre>                              <span class="droplink">output_file_name<ul><li><a href="unzip-decompress.ads.html#unzip-decompress.ads:26:5" title="To API doc">To API doc</a></li><li><a href="src_unzip-decompress.ads.html#l26" title="To spec">To spec</a></li></ul></span>     : String; </pre></li>
<li id="l12"><pre>                              <span class="droplink">output_memory_access<ul><li><a href="unzip-decompress.ads.html#unzip-decompress.ads:27:5" title="To API doc">To API doc</a></li><li><a href="src_unzip-decompress.ads.html#l27" title="To spec">To spec</a></li></ul></span> : <span class="keyword">out</span> <span class="droplink">p_Stream_Element_Array<ul><li><a href="unzip.ads.html#unzip.ads:308:8" title="To API doc">To API doc</a></li><li><a href="src_unzip.ads.html#l308" title="To spec">To spec</a></li></ul></span>; </pre></li>
<li id="l13"><pre>                              <span class="droplink">feedback<ul><li><a href="unzip-decompress.ads.html#unzip-decompress.ads:28:5" title="To API doc">To API doc</a></li><li><a href="src_unzip-decompress.ads.html#l28" title="To spec">To spec</a></li></ul></span>             : <span class="droplink">Zip.Feedback_proc<ul><li><a href="zip.ads.html#zip.ads:203:8" title="To API doc">To API doc</a></li><li><a href="src_zip.ads.html#l203" title="To spec">To spec</a></li></ul></span>; </pre></li>
<li id="l14"><pre>                              <span class="droplink">explode_literal_tree<ul><li><a href="unzip-decompress.ads.html#unzip-decompress.ads:29:5" title="To API doc">To API doc</a></li><li><a href="src_unzip-decompress.ads.html#l29" title="To spec">To spec</a></li></ul></span> : Boolean; </pre></li>
<li id="l15"><pre>                              <span class="droplink">explode_slide_8KB<ul><li><a href="unzip-decompress.ads.html#unzip-decompress.ads:30:5" title="To API doc">To API doc</a></li><li><a href="src_unzip-decompress.ads.html#l30" title="To spec">To spec</a></li></ul></span>    : Boolean; </pre></li>
<li id="l16"><pre>                              <span class="droplink">end_data_descriptor<ul><li><a href="unzip-decompress.ads.html#unzip-decompress.ads:31:5" title="To API doc">To API doc</a></li><li><a href="src_unzip-decompress.ads.html#l31" title="To spec">To spec</a></li></ul></span>  : Boolean; </pre></li>
<li id="l17"><pre>                              <span class="droplink">encrypted<ul><li><a href="unzip-decompress.ads.html#unzip-decompress.ads:32:5" title="To API doc">To API doc</a></li><li><a href="src_unzip-decompress.ads.html#l32" title="To spec">To spec</a></li></ul></span>            : Boolean; </pre></li>
<li id="l18"><pre>                              <span class="droplink">password<ul><li><a href="unzip-decompress.ads.html#unzip-decompress.ads:33:5" title="To API doc">To API doc</a></li><li><a href="src_unzip-decompress.ads.html#l33" title="To spec">To spec</a></li></ul></span>             : <span class="keyword">in</span> <span class="keyword">out</span> Unbounded_String; </pre></li>
<li id="l19"><pre>                              <span class="droplink">get_new_password<ul><li><a href="unzip-decompress.ads.html#unzip-decompress.ads:34:5" title="To API doc">To API doc</a></li><li><a href="src_unzip-decompress.ads.html#l34" title="To spec">To spec</a></li></ul></span>     : <span class="droplink">Get_password_proc<ul><li><a href="unzip.ads.html#unzip.ads:186:8" title="To API doc">To API doc</a></li><li><a href="src_unzip.ads.html#l186" title="To spec">To spec</a></li></ul></span>; </pre></li>
<li id="l20"><pre>                              <span class="droplink">hint<ul><li><a href="unzip-decompress.ads.html#unzip-decompress.ads:35:5" title="To API doc">To API doc</a></li><li><a href="src_unzip-decompress.ads.html#l35" title="To spec">To spec</a></li></ul></span>                 : <span class="keyword">in</span> <span class="keyword">out</span> <span class="droplink">Zip.Headers.Data_descriptor<ul><li><a href="zip-headers.ads.html#zip-headers.ads:30:8" title="To API doc">To API doc</a></li><li><a href="src_zip-headers.ads.html#l30" title="To spec">To spec</a></li></ul></span> </pre></li>
<li id="l21"><pre>                             ) </pre></li>
<li id="l22"><pre>   <span class="keyword">is</span> </pre></li>
<li id="l23"><pre>      <span class="comment">-- Disable AdaControl rule for detecting global variables,</span> </pre></li>
<li id="l24"><pre>      <span class="comment">-- they have become local here.</span> </pre></li>
<li id="l25"><pre>      <span class="comment">--## RULE OFF Directly_Accessed_Globals</span> </pre></li>
<li id="l26"><pre>      <span class="comment">--</span> </pre></li>
<li id="l27"><pre>      <span class="comment">-- I/O Buffers sizes</span> </pre></li>
<li id="l28"><pre>      <span class="comment">--  Size of input buffer</span> </pre></li>
<li id="l29"><pre>      inbuf_size : <span class="keyword">constant</span> := 16#8000#;  <span class="comment">-- (orig : 16#1000# B =  4 KB)</span> </pre></li>
<li id="l30"><pre>      <span class="comment">--  Size of sliding dictionary and output buffer</span> </pre></li>
<li id="l31"><pre>      wsize      : <span class="keyword">constant</span> := 16#10000#; <span class="comment">-- (orig : 16#8000# B = 32 KB)</span> </pre></li>
<li id="l32"><pre> </pre></li>
<li id="l33"><pre>      <span class="comment">--------------------------------------</span> </pre></li>
<li id="l34"><pre>      <span class="comment">-- Specifications of UnZ_* packages --</span> </pre></li>
<li id="l35"><pre>      <span class="comment">--------------------------------------</span> </pre></li>
<li id="l36"><pre>      <span class="keyword">use</span> Interfaces; </pre></li>
<li id="l37"><pre> </pre></li>
<li id="l38"><pre>      <span class="keyword">package</span> UnZ_Glob <span class="keyword">is</span> </pre></li>
<li id="l39"><pre>         <span class="comment">-- I/O Buffers</span> </pre></li>
<li id="l40"><pre>         <span class="comment">-- &gt; Sliding dictionary for unzipping, and output buffer as well</span> </pre></li>
<li id="l41"><pre>         slide : <span class="droplink">Zip.Byte_Buffer<ul><li><a href="zip.ads.html#zip.ads:219:8" title="To API doc">To API doc</a></li><li><a href="src_zip.ads.html#l219" title="To spec">To spec</a></li></ul></span> (0 .. <a href="src_unzip-decompress.adb.html#l31" title="defined at unzip-decompress.adb:31:7">wsize</a>); </pre></li>
<li id="l42"><pre>         slide_index : Integer := 0; <span class="comment">-- Current Position in slide</span> </pre></li>
<li id="l43"><pre>         <span class="comment">-- &gt; Input buffer</span> </pre></li>
<li id="l44"><pre>         inbuf : <span class="droplink">Zip.Byte_Buffer<ul><li><a href="zip.ads.html#zip.ads:219:8" title="To API doc">To API doc</a></li><li><a href="src_zip.ads.html#l219" title="To spec">To spec</a></li></ul></span> (0 .. <a href="src_unzip-decompress.adb.html#l29" title="defined at unzip-decompress.adb:29:7">inbuf_size</a> - 1); </pre></li>
<li id="l45"><pre>         inpos, readpos : Integer;  <span class="comment">-- pos. in input buffer, pos. read from file</span> </pre></li>
<li id="l46"><pre>         compsize,            <span class="comment">-- compressed size of file</span> </pre></li>
<li id="l47"><pre>         reachedsize,         <span class="comment">-- number of bytes read from zipfile</span> </pre></li>
<li id="l48"><pre>         uncompsize,          <span class="comment">-- uncompressed size of file</span> </pre></li>
<li id="l49"><pre>         effective_writes  :   <span class="comment">-- count of effective bytes written (for feedback)</span> </pre></li>
<li id="l50"><pre>         <span class="droplink">UnZip.File_size_type<ul><li><a href="unzip.ads.html#unzip.ads:190:11" title="To API doc">To API doc</a></li><li><a href="src_unzip.ads.html#l190" title="To spec">To spec</a></li></ul></span>; </pre></li>
<li id="l51"><pre>         crc32val  : Unsigned_32;  <span class="comment">-- crc calculated from data</span> </pre></li>
<li id="l52"><pre>         Zip_EOF   : Boolean;      <span class="comment">-- read over end of zip section for this file</span> </pre></li>
<li id="l53"><pre>         uncompressed_index   : Ada.Streams.Stream_Element_Offset; </pre></li>
<li id="l54"><pre>      <span class="keyword">end</span> <a href="src_unzip-decompress.adb.html#l38" title="defined at unzip-decompress.adb:38:15">UnZ_Glob</a>; </pre></li>
<li id="l55"><pre> </pre></li>
<li id="l56"><pre>      <span class="keyword">package</span> <a href="src_unzip-decompress.adb.html#l129" title="defined at unzip-decompress.adb:56:15">UnZ_IO</a> <span class="keyword">is</span> </pre></li>
<li id="l57"><pre>         out_bin_file : Ada.Streams.Stream_IO.File_Type; </pre></li>
<li id="l58"><pre>         out_txt_file : Ada.Text_IO.File_Type; </pre></li>
<li id="l59"><pre>         last_char    : Character := <span class="string">&apos; &apos;</span>; </pre></li>
<li id="l60"><pre> </pre></li>
<li id="l61"><pre>         <span class="keyword">procedure</span> <a href="src_unzip-decompress.adb.html#l133" title="defined at unzip-decompress.adb:61:20">Init_Buffers</a>; </pre></li>
<li id="l62"><pre> </pre></li>
<li id="l63"><pre>         <span class="keyword">package</span> <a href="src_unzip-decompress.adb.html#l201" title="defined at unzip-decompress.adb:63:18">Decryption</a> <span class="keyword">is</span> </pre></li>
<li id="l64"><pre>            <span class="keyword">procedure</span> <a href="src_unzip-decompress.adb.html#l207" title="defined at unzip-decompress.adb:64:23">Set_mode</a> (crypted : Boolean); </pre></li>
<li id="l65"><pre>            <span class="keyword">function</span> <a href="src_unzip-decompress.adb.html#l212" title="defined at unzip-decompress.adb:65:22">Get_mode</a> <span class="keyword">return</span> Boolean; </pre></li>
<li id="l66"><pre>            <span class="keyword">procedure</span> <a href="src_unzip-decompress.adb.html#l236" title="defined at unzip-decompress.adb:66:23">Init</a> (passwrd : String; crc_check : Unsigned_32); </pre></li>
<li id="l67"><pre>            <span class="keyword">procedure</span> <a href="src_unzip-decompress.adb.html#l269" title="defined at unzip-decompress.adb:67:23">Decode</a> (b : <span class="keyword">in</span> <span class="keyword">out</span> Unsigned_8); </pre></li>
<li id="l68"><pre>            <span class="keyword">pragma</span> Inline (<span class="droplink">Decode<ul><li><a href="src_unzip-decompress.adb.html#l67" title="To spec">To spec</a></li><li><a href="src_unzip-decompress.adb.html#l269" title="To body">To body</a></li></ul></span>); </pre></li>
<li id="l69"><pre>         <span class="keyword">end</span> <span class="droplink">Decryption<ul><li><a href="src_unzip-decompress.adb.html#l63" title="To spec">To spec</a></li><li><a href="src_unzip-decompress.adb.html#l201" title="To body">To body</a></li></ul></span>; </pre></li>
<li id="l70"><pre> </pre></li>
<li id="l71"><pre>         <span class="keyword">procedure</span> <a href="src_unzip-decompress.adb.html#l279" title="defined at unzip-decompress.adb:71:20">Read_raw_byte</a> (bt  : <span class="keyword">out</span> Unsigned_8); </pre></li>
<li id="l72"><pre>         <span class="keyword">pragma</span> Inline (<span class="droplink">Read_raw_byte<ul><li><a href="src_unzip-decompress.adb.html#l71" title="To spec">To spec</a></li><li><a href="src_unzip-decompress.adb.html#l279" title="To body">To body</a></li></ul></span>); </pre></li>
<li id="l73"><pre> </pre></li>
<li id="l74"><pre>         <span class="keyword">package</span> <a href="src_unzip-decompress.adb.html#l285" title="defined at unzip-decompress.adb:74:18">Bit_buffer</a> <span class="keyword">is</span> </pre></li>
<li id="l75"><pre>            <span class="keyword">procedure</span> <a href="src_unzip-decompress.adb.html#l289" title="defined at unzip-decompress.adb:75:23">Init</a>; </pre></li>
<li id="l76"><pre>            <span class="comment">-- Read at least n bits into the bit buffer, returns the n first bits</span> </pre></li>
<li id="l77"><pre>            <span class="keyword">function</span> <a href="src_unzip-decompress.adb.html#l329" title="defined at unzip-decompress.adb:77:22">Read</a> (n : Natural) <span class="keyword">return</span> Integer; </pre></li>
<li id="l78"><pre>            <span class="keyword">pragma</span> Inline (<span class="droplink">Read<ul><li><a href="src_unzip-decompress.adb.html#l77" title="To spec">To spec</a></li><li><a href="src_unzip-decompress.adb.html#l329" title="To body">To body</a></li></ul></span>); </pre></li>
<li id="l79"><pre>            <span class="keyword">function</span> <a href="src_unzip-decompress.adb.html#l317" title="defined at unzip-decompress.adb:79:22">Read_U32</a> (n : Natural) <span class="keyword">return</span> Unsigned_32; </pre></li>
<li id="l80"><pre>            <span class="keyword">pragma</span> Inline (<span class="droplink">Read_U32<ul><li><a href="src_unzip-decompress.adb.html#l79" title="To spec">To spec</a></li><li><a href="src_unzip-decompress.adb.html#l317" title="To body">To body</a></li></ul></span>); </pre></li>
<li id="l81"><pre>            <span class="comment">-- Inverts (NOT operator) the result before masking by n bits</span> </pre></li>
<li id="l82"><pre>            <span class="keyword">function</span> <a href="src_unzip-decompress.adb.html#l323" title="defined at unzip-decompress.adb:82:22">Read_inverted</a> (n : Natural) <span class="keyword">return</span> Integer; </pre></li>
<li id="l83"><pre>            <span class="keyword">pragma</span> Inline (<span class="droplink">Read_inverted<ul><li><a href="src_unzip-decompress.adb.html#l82" title="To spec">To spec</a></li><li><a href="src_unzip-decompress.adb.html#l323" title="To body">To body</a></li></ul></span>); </pre></li>
<li id="l84"><pre>            <span class="comment">-- Dump n bits no longer needed from the bit buffer</span> </pre></li>
<li id="l85"><pre>            <span class="keyword">procedure</span> <a href="src_unzip-decompress.adb.html#l306" title="defined at unzip-decompress.adb:85:23">Dump</a> (n : Natural); </pre></li>
<li id="l86"><pre>            <span class="keyword">pragma</span> Inline (<span class="droplink">Dump<ul><li><a href="src_unzip-decompress.adb.html#l85" title="To spec">To spec</a></li><li><a href="src_unzip-decompress.adb.html#l306" title="To body">To body</a></li></ul></span>); </pre></li>
<li id="l87"><pre>            <span class="keyword">procedure</span> <a href="src_unzip-decompress.adb.html#l312" title="defined at unzip-decompress.adb:87:23">Dump_to_byte_boundary</a>; </pre></li>
<li id="l88"><pre>            <span class="keyword">function</span> <a href="src_unzip-decompress.adb.html#l334" title="defined at unzip-decompress.adb:88:22">Read_and_dump</a> (n : Natural) <span class="keyword">return</span> Integer; </pre></li>
<li id="l89"><pre>            <span class="keyword">pragma</span> Inline (<span class="droplink">Read_and_dump<ul><li><a href="src_unzip-decompress.adb.html#l88" title="To spec">To spec</a></li><li><a href="src_unzip-decompress.adb.html#l334" title="To body">To body</a></li></ul></span>); </pre></li>
<li id="l90"><pre>            <span class="keyword">function</span> <a href="src_unzip-decompress.adb.html#l342" title="defined at unzip-decompress.adb:90:22">Read_and_dump_U32</a> (n : Natural) <span class="keyword">return</span> Unsigned_32; </pre></li>
<li id="l91"><pre>            <span class="keyword">pragma</span> Inline (<span class="droplink">Read_and_dump_U32<ul><li><a href="src_unzip-decompress.adb.html#l90" title="To spec">To spec</a></li><li><a href="src_unzip-decompress.adb.html#l342" title="To body">To body</a></li></ul></span>); </pre></li>
<li id="l92"><pre>         <span class="keyword">end</span> <span class="droplink">Bit_buffer<ul><li><a href="src_unzip-decompress.adb.html#l74" title="To spec">To spec</a></li><li><a href="src_unzip-decompress.adb.html#l285" title="To body">To body</a></li></ul></span>; </pre></li>
<li id="l93"><pre> </pre></li>
<li id="l94"><pre>         <span class="keyword">procedure</span> <a href="src_unzip-decompress.adb.html#l352" title="defined at unzip-decompress.adb:94:20">Flush</a> (x : Natural); <span class="comment">-- directly from slide to output stream</span> </pre></li>
<li id="l95"><pre> </pre></li>
<li id="l96"><pre>         <span class="keyword">procedure</span> <a href="src_unzip-decompress.adb.html#l405" title="defined at unzip-decompress.adb:96:20">Flush_if_full</a> (W : <span class="keyword">in</span> <span class="keyword">out</span> Integer; unflushed : <span class="keyword">in</span> <span class="keyword">out</span> Boolean); </pre></li>
<li id="l97"><pre>         <span class="keyword">pragma</span> Inline (<span class="droplink">Flush_if_full<ul><li><a href="src_unzip-decompress.adb.html#l96" title="To spec">To spec</a></li><li><a href="src_unzip-decompress.adb.html#l405" title="To body">To body</a></li></ul></span>); </pre></li>
<li id="l98"><pre> </pre></li>
<li id="l99"><pre>         <span class="keyword">procedure</span> <a href="src_unzip-decompress.adb.html#l414" title="defined at unzip-decompress.adb:99:20">Flush_if_full</a> (W : <span class="keyword">in</span> <span class="keyword">out</span> Integer); </pre></li>
<li id="l100"><pre>         <span class="keyword">pragma</span> Inline (<span class="droplink">Flush_if_full<ul><li><a href="src_unzip-decompress.adb.html#l99" title="To spec">To spec</a></li><li><a href="src_unzip-decompress.adb.html#l414" title="To body">To body</a></li></ul></span>); </pre></li>
<li id="l101"><pre> </pre></li>
<li id="l102"><pre>         <span class="keyword">procedure</span> <a href="src_unzip-decompress.adb.html#l496" title="defined at unzip-decompress.adb:102:20">Copy</a> (distance, copy_length :        Natural; </pre></li>
<li id="l103"><pre>                         index                 : <span class="keyword">in</span> <span class="keyword">out</span> Natural); </pre></li>
<li id="l104"><pre>         <span class="keyword">pragma</span> Inline (<span class="droplink">Copy<ul><li><a href="src_unzip-decompress.adb.html#l102" title="To spec">To spec</a></li><li><a href="src_unzip-decompress.adb.html#l496" title="To body">To body</a></li></ul></span>); </pre></li>
<li id="l105"><pre> </pre></li>
<li id="l106"><pre>         <span class="keyword">procedure</span> <a href="src_unzip-decompress.adb.html#l520" title="defined at unzip-decompress.adb:106:20">Copy_or_zero</a> (distance, copy_length :        Natural; </pre></li>
<li id="l107"><pre>                                 index                 : <span class="keyword">in</span> <span class="keyword">out</span> Natural; </pre></li>
<li id="l108"><pre>                                 unflushed             : <span class="keyword">in</span> <span class="keyword">out</span> Boolean); </pre></li>
<li id="l109"><pre>         <span class="keyword">pragma</span> Inline (<span class="droplink">Copy_or_zero<ul><li><a href="src_unzip-decompress.adb.html#l106" title="To spec">To spec</a></li><li><a href="src_unzip-decompress.adb.html#l520" title="To body">To body</a></li></ul></span>); </pre></li>
<li id="l110"><pre> </pre></li>
<li id="l111"><pre>         <span class="keyword">procedure</span> <a href="src_unzip-decompress.adb.html#l543" title="defined at unzip-decompress.adb:111:20">Delete_output</a>; <span class="comment">-- an error has occured (bad compressed data)</span> </pre></li>
<li id="l112"><pre> </pre></li>
<li id="l113"><pre>      <span class="keyword">end</span> <span class="droplink">UnZ_IO<ul><li><a href="src_unzip-decompress.adb.html#l56" title="To spec">To spec</a></li><li><a href="src_unzip-decompress.adb.html#l129" title="To body">To body</a></li></ul></span>; </pre></li>
<li id="l114"><pre> </pre></li>
<li id="l115"><pre>      <span class="keyword">package</span> <a href="src_unzip-decompress.adb.html#l559" title="defined at unzip-decompress.adb:115:15">UnZ_Meth</a> <span class="keyword">is</span> </pre></li>
<li id="l116"><pre>         <span class="keyword">procedure</span> <a href="src_unzip-decompress.adb.html#l1427" title="defined at unzip-decompress.adb:116:20">Copy_stored</a>; </pre></li>
<li id="l117"><pre>         <span class="keyword">procedure</span> <a href="src_unzip-decompress.adb.html#l678" title="defined at unzip-decompress.adb:117:20">Unshrink</a>; </pre></li>
<li id="l118"><pre>         <span class="keyword">subtype</span> Reduction_factor <span class="keyword">is</span> Integer <span class="keyword">range</span> 1 .. 4; </pre></li>
<li id="l119"><pre>         <span class="keyword">procedure</span> <a href="src_unzip-decompress.adb.html#l806" title="defined at unzip-decompress.adb:119:20">Unreduce</a> (factor : <a href="src_unzip-decompress.adb.html#l118" title="defined at unzip-decompress.adb:118:18">Reduction_factor</a>); </pre></li>
<li id="l120"><pre>         <span class="keyword">procedure</span> <a href="src_unzip-decompress.adb.html#l1228" title="defined at unzip-decompress.adb:120:20">Explode</a> (literal_tree, slide_8_KB : Boolean); </pre></li>
<li id="l121"><pre>         deflate_e_mode : Boolean := False; </pre></li>
<li id="l122"><pre>         <span class="keyword">procedure</span> <a href="src_unzip-decompress.adb.html#l1845" title="defined at unzip-decompress.adb:122:20">Inflate</a>; </pre></li>
<li id="l123"><pre>         <span class="keyword">procedure</span> <a href="src_unzip-decompress.adb.html#l1870" title="defined at unzip-decompress.adb:123:20">Bunzip2</a>; <span class="comment">-- Nov - 2009</span> </pre></li>
<li id="l124"><pre>      <span class="keyword">end</span> <span class="droplink">UnZ_Meth<ul><li><a href="src_unzip-decompress.adb.html#l115" title="To spec">To spec</a></li><li><a href="src_unzip-decompress.adb.html#l559" title="To body">To body</a></li></ul></span>; </pre></li>
<li id="l125"><pre> </pre></li>
<li id="l126"><pre>      <span class="comment">------------------------------</span> </pre></li>
<li id="l127"><pre>      <span class="comment">-- Bodies of UnZ_* packages --</span> </pre></li>
<li id="l128"><pre>      <span class="comment">------------------------------</span> </pre></li>
<li id="l129"><pre>      <span class="keyword">package</span> <span class="keyword">body</span> <a href="src_unzip-decompress.adb.html#l56" title="defined at unzip-decompress.adb:56:15">UnZ_IO</a> <span class="keyword">is</span> </pre></li>
<li id="l130"><pre> </pre></li>
<li id="l131"><pre>         <span class="comment">-- Centralize buffer initialisations - 29 - Jun - 2001</span> </pre></li>
<li id="l132"><pre> </pre></li>
<li id="l133"><pre>         <span class="keyword">procedure</span> <a href="src_unzip-decompress.adb.html#l61" title="defined at unzip-decompress.adb:61:20">Init_Buffers</a> <span class="keyword">is</span> </pre></li>
<li id="l134"><pre>         <span class="keyword">begin</span> </pre></li>
<li id="l135"><pre>            <a href="src_unzip-decompress.adb.html#l45" title="defined at unzip-decompress.adb:45:10">UnZ_Glob.inpos</a>   :=  0;  <span class="comment">-- Input buffer position</span> </pre></li>
<li id="l136"><pre>            <a href="src_unzip-decompress.adb.html#l45" title="defined at unzip-decompress.adb:45:17">UnZ_Glob.readpos</a> := -1;  <span class="comment">-- Nothing read</span> </pre></li>
<li id="l137"><pre>            <a href="src_unzip-decompress.adb.html#l42" title="defined at unzip-decompress.adb:42:10">UnZ_Glob.slide_index</a> := 0; </pre></li>
<li id="l138"><pre>            <a href="src_unzip-decompress.adb.html#l47" title="defined at unzip-decompress.adb:47:10">UnZ_Glob.reachedsize</a>      := 0; </pre></li>
<li id="l139"><pre>            <a href="src_unzip-decompress.adb.html#l49" title="defined at unzip-decompress.adb:49:10">UnZ_Glob.effective_writes</a> := 0; </pre></li>
<li id="l140"><pre>            <a href="src_unzip-decompress.adb.html#l52" title="defined at unzip-decompress.adb:52:10">UnZ_Glob.Zip_EOF</a> := False; </pre></li>
<li id="l141"><pre>            <span class="droplink">Zip.CRC.Init<ul><li><a href="zip-crc.ads.html#zip-crc.ads:7:13" title="To API doc">To API doc</a></li><li><a href="src_zip-crc.ads.html#l7" title="To spec">To spec</a></li><li><a href="src_zip-crc.adb.html#l39" title="To body">To body</a></li></ul></span> (<a href="src_unzip-decompress.adb.html#l51" title="defined at unzip-decompress.adb:51:10">UnZ_Glob.crc32val</a>); </pre></li>
<li id="l142"><pre>            <span class="droplink">Bit_buffer.Init<ul><li><a href="src_unzip-decompress.adb.html#l75" title="To spec">To spec</a></li><li><a href="src_unzip-decompress.adb.html#l289" title="To body">To body</a></li></ul></span>; </pre></li>
<li id="l143"><pre>         <span class="keyword">end</span> <span class="droplink">Init_Buffers<ul><li><a href="src_unzip-decompress.adb.html#l61" title="To spec">To spec</a></li><li><a href="src_unzip-decompress.adb.html#l133" title="To body">To body</a></li></ul></span>; </pre></li>
<li id="l144"><pre> </pre></li>
<li id="l145"><pre>         <span class="keyword">procedure</span> Read_buffer <span class="keyword">is</span> </pre></li>
<li id="l146"><pre>         <span class="keyword">begin</span> </pre></li>
<li id="l147"><pre>            <span class="keyword">if</span> <span class="droplink">full_trace<ul><li><a href="unzip-decompress.ads.html#unzip-decompress.ads:51:3" title="To API doc">To API doc</a></li><li><a href="src_unzip-decompress.ads.html#l51" title="To spec">To spec</a></li></ul></span> <span class="keyword">then</span> </pre></li>
<li id="l148"><pre>               <span class="keyword">pragma</span> Warnings (Off, <span class="string">&quot;this code can never be executed and has been deleted&quot;</span>); </pre></li>
<li id="l149"><pre>               Ada.Text_IO.Put (<span class="string">&quot;[Read_buffer .. .&quot;</span>); </pre></li>
<li id="l150"><pre>               <span class="keyword">pragma</span> Warnings (On,  <span class="string">&quot;this code can never be executed and has been deleted&quot;</span>); </pre></li>
<li id="l151"><pre>            <span class="keyword">end</span> <span class="keyword">if</span>; </pre></li>
<li id="l152"><pre>            <span class="keyword">if</span> <a href="src_unzip-decompress.adb.html#l47" title="defined at unzip-decompress.adb:47:10">UnZ_Glob.reachedsize</a> &gt; <a href="src_unzip-decompress.adb.html#l46" title="defined at unzip-decompress.adb:46:10">UnZ_Glob.compsize</a> + 2 <span class="keyword">then</span> </pre></li>
<li id="l153"><pre>               <span class="comment">-- + 2 : last code is smaller than requested!</span> </pre></li>
<li id="l154"><pre>               <a href="src_unzip-decompress.adb.html#l45" title="defined at unzip-decompress.adb:45:17">UnZ_Glob.readpos</a> := <a href="src_unzip-decompress.adb.html#l44" title="defined at unzip-decompress.adb:44:10">UnZ_Glob.inbuf</a>&apos;Length; </pre></li>
<li id="l155"><pre>               <span class="comment">-- Simulates reading - &gt; no blocking</span> </pre></li>
<li id="l156"><pre>               <a href="src_unzip-decompress.adb.html#l52" title="defined at unzip-decompress.adb:52:10">UnZ_Glob.Zip_EOF</a> := True; </pre></li>
<li id="l157"><pre>            <span class="keyword">else</span> </pre></li>
<li id="l158"><pre>               <span class="keyword">begin</span> </pre></li>
<li id="l159"><pre>                  <span class="droplink">Zip.BlockRead<ul><li><a href="zip.ads.html#zip.ads:229:14" title="To API doc">To API doc</a></li><li><a href="src_zip.ads.html#l229" title="To spec">To spec</a></li><li><a href="src_zip.adb.html#l615" title="To body">To body</a></li></ul></span> ( </pre></li>
<li id="l160"><pre>                                 <span class="droplink">stream<ul><li><a href="zip.ads.html#zip.ads:229:25" title="To API doc">To API doc</a></li><li><a href="src_zip.ads.html#l229" title="To spec">To spec</a></li></ul></span>        =&gt; <span class="droplink">zip_file<ul><li><a href="unzip-decompress.ads.html#unzip-decompress.ads:21:5" title="To API doc">To API doc</a></li><li><a href="src_unzip-decompress.ads.html#l21" title="To spec">To spec</a></li></ul></span>, </pre></li>
<li id="l161"><pre>                                 <span class="droplink">buffer<ul><li><a href="zip.ads.html#zip.ads:230:25" title="To API doc">To API doc</a></li><li><a href="src_zip.ads.html#l230" title="To spec">To spec</a></li></ul></span>        =&gt; <a href="src_unzip-decompress.adb.html#l44" title="defined at unzip-decompress.adb:44:10">UnZ_Glob.inbuf</a>, </pre></li>
<li id="l162"><pre>                                 <span class="droplink">actually_read<ul><li><a href="zip.ads.html#zip.ads:231:25" title="To API doc">To API doc</a></li><li><a href="src_zip.ads.html#l231" title="To spec">To spec</a></li></ul></span> =&gt; <a href="src_unzip-decompress.adb.html#l45" title="defined at unzip-decompress.adb:45:17">UnZ_Glob.readpos</a> </pre></li>
<li id="l163"><pre>                                ); </pre></li>
<li id="l164"><pre>               <span class="keyword">exception</span> </pre></li>
<li id="l165"><pre>                  <span class="keyword">when</span> <span class="keyword">others</span> =&gt; <span class="comment">-- I/O error</span> </pre></li>
<li id="l166"><pre>                     <a href="src_unzip-decompress.adb.html#l45" title="defined at unzip-decompress.adb:45:17">UnZ_Glob.readpos</a> := <a href="src_unzip-decompress.adb.html#l44" title="defined at unzip-decompress.adb:44:10">UnZ_Glob.inbuf</a>&apos;Length; </pre></li>
<li id="l167"><pre>                     <span class="comment">-- Simulates reading - &gt; CRC error</span> </pre></li>
<li id="l168"><pre>                     <a href="src_unzip-decompress.adb.html#l52" title="defined at unzip-decompress.adb:52:10">UnZ_Glob.Zip_EOF</a> := True; </pre></li>
<li id="l169"><pre>               <span class="keyword">end</span>; </pre></li>
<li id="l170"><pre>               <span class="keyword">if</span> <a href="src_unzip-decompress.adb.html#l45" title="defined at unzip-decompress.adb:45:17">UnZ_Glob.readpos</a> = 0 <span class="keyword">then</span> </pre></li>
<li id="l171"><pre>                  <a href="src_unzip-decompress.adb.html#l45" title="defined at unzip-decompress.adb:45:17">UnZ_Glob.readpos</a> := <a href="src_unzip-decompress.adb.html#l44" title="defined at unzip-decompress.adb:44:10">UnZ_Glob.inbuf</a>&apos;Length; </pre></li>
<li id="l172"><pre>                  <span class="comment">-- Simulates reading - &gt; CRC error</span> </pre></li>
<li id="l173"><pre>                  <a href="src_unzip-decompress.adb.html#l52" title="defined at unzip-decompress.adb:52:10">UnZ_Glob.Zip_EOF</a> := True; </pre></li>
<li id="l174"><pre>               <span class="keyword">end</span> <span class="keyword">if</span>; </pre></li>
<li id="l175"><pre> </pre></li>
<li id="l176"><pre>               <a href="src_unzip-decompress.adb.html#l47" title="defined at unzip-decompress.adb:47:10">UnZ_Glob.reachedsize</a> := </pre></li>
<li id="l177"><pre>                 <a href="src_unzip-decompress.adb.html#l47" title="defined at unzip-decompress.adb:47:10">UnZ_Glob.reachedsize</a> + <span class="droplink">UnZip.File_size_type<ul><li><a href="unzip.ads.html#unzip.ads:190:11" title="To API doc">To API doc</a></li><li><a href="src_unzip.ads.html#l190" title="To spec">To spec</a></li></ul></span> (<a href="src_unzip-decompress.adb.html#l45" title="defined at unzip-decompress.adb:45:17">UnZ_Glob.readpos</a>); </pre></li>
<li id="l178"><pre>               <a href="src_unzip-decompress.adb.html#l45" title="defined at unzip-decompress.adb:45:17">UnZ_Glob.readpos</a> := <a href="src_unzip-decompress.adb.html#l45" title="defined at unzip-decompress.adb:45:17">UnZ_Glob.readpos</a> - 1; </pre></li>
<li id="l179"><pre>               <span class="comment">-- Reason : index of inbuf starts at 0</span> </pre></li>
<li id="l180"><pre>            <span class="keyword">end</span> <span class="keyword">if</span>; </pre></li>
<li id="l181"><pre>            <a href="src_unzip-decompress.adb.html#l45" title="defined at unzip-decompress.adb:45:10">UnZ_Glob.inpos</a> := 0; </pre></li>
<li id="l182"><pre>            <span class="keyword">if</span> <span class="droplink">full_trace<ul><li><a href="unzip-decompress.ads.html#unzip-decompress.ads:51:3" title="To API doc">To API doc</a></li><li><a href="src_unzip-decompress.ads.html#l51" title="To spec">To spec</a></li></ul></span> <span class="keyword">then</span> </pre></li>
<li id="l183"><pre>               <span class="keyword">pragma</span> Warnings (Off, <span class="string">&quot;this code can never be executed and has been deleted&quot;</span>); </pre></li>
<li id="l184"><pre>               Ada.Text_IO.Put_Line (<span class="string">&quot;finished]&quot;</span>); </pre></li>
<li id="l185"><pre>               <span class="keyword">pragma</span> Warnings (On,  <span class="string">&quot;this code can never be executed and has been deleted&quot;</span>); </pre></li>
<li id="l186"><pre>            <span class="keyword">end</span> <span class="keyword">if</span>; </pre></li>
<li id="l187"><pre>         <span class="keyword">end</span> Read_buffer; </pre></li>
<li id="l188"><pre> </pre></li>
<li id="l189"><pre>         <span class="keyword">procedure</span> Read_byte_no_decrypt (bt  : <span class="keyword">out</span> <span class="droplink">Zip.Byte<ul><li><a href="zip.ads.html#zip.ads:218:11" title="To API doc">To API doc</a></li><li><a href="src_zip.ads.html#l218" title="To spec">To spec</a></li></ul></span>) <span class="keyword">is</span> </pre></li>
<li id="l190"><pre>            <span class="keyword">pragma</span> Inline (Read_byte_no_decrypt); </pre></li>
<li id="l191"><pre>         <span class="keyword">begin</span> </pre></li>
<li id="l192"><pre>            <span class="keyword">if</span> <a href="src_unzip-decompress.adb.html#l45" title="defined at unzip-decompress.adb:45:10">UnZ_Glob.inpos</a> &gt; <a href="src_unzip-decompress.adb.html#l45" title="defined at unzip-decompress.adb:45:17">UnZ_Glob.readpos</a> <span class="keyword">then</span> </pre></li>
<li id="l193"><pre>               Read_buffer; </pre></li>
<li id="l194"><pre>            <span class="keyword">end</span> <span class="keyword">if</span>; </pre></li>
<li id="l195"><pre>            bt := <a href="src_unzip-decompress.adb.html#l44" title="defined at unzip-decompress.adb:44:10">UnZ_Glob.inbuf</a> (<a href="src_unzip-decompress.adb.html#l45" title="defined at unzip-decompress.adb:45:10">UnZ_Glob.inpos</a>); </pre></li>
<li id="l196"><pre>            <a href="src_unzip-decompress.adb.html#l45" title="defined at unzip-decompress.adb:45:10">UnZ_Glob.inpos</a> := <a href="src_unzip-decompress.adb.html#l45" title="defined at unzip-decompress.adb:45:10">UnZ_Glob.inpos</a> + 1; </pre></li>
<li id="l197"><pre>         <span class="keyword">end</span> Read_byte_no_decrypt; </pre></li>
<li id="l198"><pre> </pre></li>
<li id="l199"><pre>         <span class="comment">-- 27 - Jun - 2001 : Decryption - algorithm in Appnote.txt</span> </pre></li>
<li id="l200"><pre> </pre></li>
<li id="l201"><pre>         <span class="keyword">package</span> <span class="keyword">body</span> <a href="src_unzip-decompress.adb.html#l63" title="defined at unzip-decompress.adb:63:18">Decryption</a> <span class="keyword">is</span> </pre></li>
<li id="l202"><pre> </pre></li>
<li id="l203"><pre>            <span class="keyword">type</span> Decrypt_keys <span class="keyword">is</span> <span class="keyword">array</span> (0 .. 2) <span class="keyword">of</span> Unsigned_32; </pre></li>
<li id="l204"><pre>            the_keys      : Decrypt_keys; </pre></li>
<li id="l205"><pre>            decrypt_mode  : Boolean; </pre></li>
<li id="l206"><pre> </pre></li>
<li id="l207"><pre>            <span class="keyword">procedure</span> <a href="src_unzip-decompress.adb.html#l64" title="defined at unzip-decompress.adb:64:23">Set_mode</a> (<a href="src_unzip-decompress.adb.html#l64" title="defined at unzip-decompress.adb:64:33">crypted</a> : Boolean) <span class="keyword">is</span> </pre></li>
<li id="l208"><pre>            <span class="keyword">begin</span> </pre></li>
<li id="l209"><pre>               decrypt_mode := <a href="src_unzip-decompress.adb.html#l64" title="defined at unzip-decompress.adb:64:33">crypted</a>; </pre></li>
<li id="l210"><pre>            <span class="keyword">end</span> <span class="droplink">Set_mode<ul><li><a href="src_unzip-decompress.adb.html#l64" title="To spec">To spec</a></li><li><a href="src_unzip-decompress.adb.html#l207" title="To body">To body</a></li></ul></span>; </pre></li>
<li id="l211"><pre> </pre></li>
<li id="l212"><pre>            <span class="keyword">function</span> <a href="src_unzip-decompress.adb.html#l65" title="defined at unzip-decompress.adb:65:22">Get_mode</a> <span class="keyword">return</span> Boolean <span class="keyword">is</span> </pre></li>
<li id="l213"><pre>            <span class="keyword">begin</span> </pre></li>
<li id="l214"><pre>               <span class="keyword">return</span> decrypt_mode; </pre></li>
<li id="l215"><pre>            <span class="keyword">end</span> <span class="droplink">Get_mode<ul><li><a href="src_unzip-decompress.adb.html#l65" title="To spec">To spec</a></li><li><a href="src_unzip-decompress.adb.html#l212" title="To body">To body</a></li></ul></span>; </pre></li>
<li id="l216"><pre> </pre></li>
<li id="l217"><pre>            <span class="keyword">procedure</span> Update_keys (by : <span class="droplink">Zip.Byte<ul><li><a href="zip.ads.html#zip.ads:218:11" title="To API doc">To API doc</a></li><li><a href="src_zip.ads.html#l218" title="To spec">To spec</a></li></ul></span>; keys : <span class="keyword">in</span> <span class="keyword">out</span> Decrypt_keys) <span class="keyword">is</span> </pre></li>
<li id="l218"><pre>            <span class="keyword">begin</span> </pre></li>
<li id="l219"><pre>               <span class="droplink">Zip.CRC.Update<ul><li><a href="zip-crc.ads.html#zip-crc.ads:11:13" title="To API doc">To API doc</a></li><li><a href="src_zip-crc.ads.html#l11" title="To spec">To spec</a></li><li><a href="src_zip-crc.adb.html#l25" title="To body">To body</a></li></ul></span> (keys (0), (0 =&gt; by)); </pre></li>
<li id="l220"><pre>               keys (1) := keys (1) + (keys (0) <span class="keyword">and</span> 16#000000ff#); </pre></li>
<li id="l221"><pre>               keys (1) := keys (1) * 134775813 + 1; </pre></li>
<li id="l222"><pre>               <span class="droplink">Zip.CRC.Update<ul><li><a href="zip-crc.ads.html#zip-crc.ads:11:13" title="To API doc">To API doc</a></li><li><a href="src_zip-crc.ads.html#l11" title="To spec">To spec</a></li><li><a href="src_zip-crc.adb.html#l25" title="To body">To body</a></li></ul></span> ( </pre></li>
<li id="l223"><pre>                               keys (2), </pre></li>
<li id="l224"><pre>                               (0 =&gt; <span class="droplink">Zip.Byte<ul><li><a href="zip.ads.html#zip.ads:218:11" title="To API doc">To API doc</a></li><li><a href="src_zip.ads.html#l218" title="To spec">To spec</a></li></ul></span> (Shift_Right (keys (1), 24))) </pre></li>
<li id="l225"><pre>                              ); </pre></li>
<li id="l226"><pre>            <span class="keyword">end</span> Update_keys; </pre></li>
<li id="l227"><pre> </pre></li>
<li id="l228"><pre>            <span class="keyword">function</span> Decrypt_byte (Key_2 : Unsigned_32) <span class="keyword">return</span> <span class="droplink">Zip.Byte<ul><li><a href="zip.ads.html#zip.ads:218:11" title="To API doc">To API doc</a></li><li><a href="src_zip.ads.html#l218" title="To spec">To spec</a></li></ul></span> <span class="keyword">is</span> </pre></li>
<li id="l229"><pre>               temp : Unsigned_32; </pre></li>
<li id="l230"><pre>            <span class="keyword">begin</span> </pre></li>
<li id="l231"><pre>               temp := (Key_2 <span class="keyword">and</span> 16#ffff#) <span class="keyword">or</span> 2; </pre></li>
<li id="l232"><pre>               temp := temp * (16#ffff# <span class="keyword">and</span> (temp <span class="keyword">xor</span> 1)); </pre></li>
<li id="l233"><pre>               <span class="keyword">return</span> <span class="droplink">Zip.Byte<ul><li><a href="zip.ads.html#zip.ads:218:11" title="To API doc">To API doc</a></li><li><a href="src_zip.ads.html#l218" title="To spec">To spec</a></li></ul></span> (Shift_Right (temp, 8) <span class="keyword">and</span> 16#ff#); </pre></li>
<li id="l234"><pre>            <span class="keyword">end</span> Decrypt_byte; </pre></li>
<li id="l235"><pre> </pre></li>
<li id="l236"><pre>            <span class="keyword">procedure</span> <a href="src_unzip-decompress.adb.html#l66" title="defined at unzip-decompress.adb:66:23">Init</a> (<a href="src_unzip-decompress.adb.html#l66" title="defined at unzip-decompress.adb:66:29">passwrd</a> : String; <a href="src_unzip-decompress.adb.html#l66" title="defined at unzip-decompress.adb:66:47">crc_check</a> : Unsigned_32) <span class="keyword">is</span> </pre></li>
<li id="l237"><pre>               buffer : <span class="keyword">array</span> (0 .. 11) <span class="keyword">of</span> <span class="droplink">Zip.Byte<ul><li><a href="zip.ads.html#zip.ads:218:11" title="To API doc">To API doc</a></li><li><a href="src_zip.ads.html#l218" title="To spec">To spec</a></li></ul></span>; </pre></li>
<li id="l238"><pre>               c : <span class="droplink">Zip.Byte<ul><li><a href="zip.ads.html#zip.ads:218:11" title="To API doc">To API doc</a></li><li><a href="src_zip.ads.html#l218" title="To spec">To spec</a></li></ul></span>; </pre></li>
<li id="l239"><pre>            <span class="keyword">begin</span> </pre></li>
<li id="l240"><pre>               <span class="comment">-- Step 1 - Initializing the encryption keys</span> </pre></li>
<li id="l241"><pre> </pre></li>
<li id="l242"><pre>               the_keys := ( </pre></li>
<li id="l243"><pre>                            0 =&gt; 305419896, </pre></li>
<li id="l244"><pre>                            1 =&gt; 591751049, </pre></li>
<li id="l245"><pre>                            2 =&gt; 878082192 </pre></li>
<li id="l246"><pre>                           ); </pre></li>
<li id="l247"><pre> </pre></li>
<li id="l248"><pre>               <span class="keyword">for</span> i <span class="keyword">in</span> <a href="src_unzip-decompress.adb.html#l66" title="defined at unzip-decompress.adb:66:29">passwrd</a>&apos;Range <span class="keyword">loop</span> </pre></li>
<li id="l249"><pre>                  Update_keys (<span class="droplink">Zip.Byte<ul><li><a href="zip.ads.html#zip.ads:218:11" title="To API doc">To API doc</a></li><li><a href="src_zip.ads.html#l218" title="To spec">To spec</a></li></ul></span> (Character&apos;Pos (<a href="src_unzip-decompress.adb.html#l66" title="defined at unzip-decompress.adb:66:29">passwrd</a> (i))), the_keys); </pre></li>
<li id="l250"><pre>               <span class="keyword">end</span> <span class="keyword">loop</span>; </pre></li>
<li id="l251"><pre> </pre></li>
<li id="l252"><pre>               <span class="comment">-- Step 2 - Decrypting the encryption header</span> </pre></li>
<li id="l253"><pre> </pre></li>
<li id="l254"><pre>               <span class="keyword">for</span> i <span class="keyword">in</span> buffer&apos;Range <span class="keyword">loop</span> </pre></li>
<li id="l255"><pre>                  Read_byte_no_decrypt (c); </pre></li>
<li id="l256"><pre>                  c := c <span class="keyword">xor</span> Decrypt_byte (the_keys (2)); </pre></li>
<li id="l257"><pre>                  Update_keys (c, the_keys); </pre></li>
<li id="l258"><pre>                  buffer (i) := c; </pre></li>
<li id="l259"><pre>               <span class="keyword">end</span> <span class="keyword">loop</span>; </pre></li>
<li id="l260"><pre> </pre></li>
<li id="l261"><pre>               <span class="keyword">if</span> buffer (buffer&apos;Last) /= </pre></li>
<li id="l262"><pre>                 <span class="droplink">Zip.Byte<ul><li><a href="zip.ads.html#zip.ads:218:11" title="To API doc">To API doc</a></li><li><a href="src_zip.ads.html#l218" title="To spec">To spec</a></li></ul></span> (Shift_Right (<a href="src_unzip-decompress.adb.html#l66" title="defined at unzip-decompress.adb:66:47">crc_check</a>, 24)) </pre></li>
<li id="l263"><pre>               <span class="keyword">then</span> </pre></li>
<li id="l264"><pre>                  <span class="keyword">raise</span> <span class="droplink">UnZip.Wrong_password<ul><li><a href="unzip.ads.html#unzip.ads:289:3" title="To API doc">To API doc</a></li><li><a href="src_unzip.ads.html#l289" title="To spec">To spec</a></li></ul></span>; </pre></li>
<li id="l265"><pre>               <span class="keyword">end</span> <span class="keyword">if</span>; </pre></li>
<li id="l266"><pre> </pre></li>
<li id="l267"><pre>            <span class="keyword">end</span> <span class="droplink">Init<ul><li><a href="src_unzip-decompress.adb.html#l66" title="To spec">To spec</a></li><li><a href="src_unzip-decompress.adb.html#l236" title="To body">To body</a></li></ul></span>; </pre></li>
<li id="l268"><pre> </pre></li>
<li id="l269"><pre>            <span class="keyword">procedure</span> <a href="src_unzip-decompress.adb.html#l67" title="defined at unzip-decompress.adb:67:23">Decode</a> (<a href="src_unzip-decompress.adb.html#l67" title="defined at unzip-decompress.adb:67:31">b</a> : <span class="keyword">in</span> <span class="keyword">out</span> <span class="droplink">Zip.Byte<ul><li><a href="zip.ads.html#zip.ads:218:11" title="To API doc">To API doc</a></li><li><a href="src_zip.ads.html#l218" title="To spec">To spec</a></li></ul></span>) <span class="keyword">is</span> </pre></li>
<li id="l270"><pre>            <span class="keyword">begin</span> </pre></li>
<li id="l271"><pre>               <span class="keyword">if</span> decrypt_mode <span class="keyword">then</span> </pre></li>
<li id="l272"><pre>                  <a href="src_unzip-decompress.adb.html#l67" title="defined at unzip-decompress.adb:67:31">b</a> := <a href="src_unzip-decompress.adb.html#l67" title="defined at unzip-decompress.adb:67:31">b</a> <span class="keyword">xor</span> Decrypt_byte (the_keys (2)); </pre></li>
<li id="l273"><pre>                  Update_keys (<a href="src_unzip-decompress.adb.html#l67" title="defined at unzip-decompress.adb:67:31">b</a>, the_keys); </pre></li>
<li id="l274"><pre>               <span class="keyword">end</span> <span class="keyword">if</span>; </pre></li>
<li id="l275"><pre>            <span class="keyword">end</span> <span class="droplink">Decode<ul><li><a href="src_unzip-decompress.adb.html#l67" title="To spec">To spec</a></li><li><a href="src_unzip-decompress.adb.html#l269" title="To body">To body</a></li></ul></span>; </pre></li>
<li id="l276"><pre> </pre></li>
<li id="l277"><pre>         <span class="keyword">end</span> <span class="droplink">Decryption<ul><li><a href="src_unzip-decompress.adb.html#l63" title="To spec">To spec</a></li><li><a href="src_unzip-decompress.adb.html#l201" title="To body">To body</a></li></ul></span>; </pre></li>
<li id="l278"><pre> </pre></li>
<li id="l279"><pre>         <span class="keyword">procedure</span> <a href="src_unzip-decompress.adb.html#l71" title="defined at unzip-decompress.adb:71:20">Read_raw_byte</a> (<a href="src_unzip-decompress.adb.html#l71" title="defined at unzip-decompress.adb:71:35">bt</a>  : <span class="keyword">out</span> <span class="droplink">Zip.Byte<ul><li><a href="zip.ads.html#zip.ads:218:11" title="To API doc">To API doc</a></li><li><a href="src_zip.ads.html#l218" title="To spec">To spec</a></li></ul></span>) <span class="keyword">is</span> </pre></li>
<li id="l280"><pre>         <span class="keyword">begin</span> </pre></li>
<li id="l281"><pre>            Read_byte_no_decrypt (<a href="src_unzip-decompress.adb.html#l71" title="defined at unzip-decompress.adb:71:35">bt</a>); </pre></li>
<li id="l282"><pre>            <span class="droplink">Decryption.Decode<ul><li><a href="src_unzip-decompress.adb.html#l67" title="To spec">To spec</a></li><li><a href="src_unzip-decompress.adb.html#l269" title="To body">To body</a></li></ul></span> (<a href="src_unzip-decompress.adb.html#l71" title="defined at unzip-decompress.adb:71:35">bt</a>); </pre></li>
<li id="l283"><pre>         <span class="keyword">end</span> <span class="droplink">Read_raw_byte<ul><li><a href="src_unzip-decompress.adb.html#l71" title="To spec">To spec</a></li><li><a href="src_unzip-decompress.adb.html#l279" title="To body">To body</a></li></ul></span>; </pre></li>
<li id="l284"><pre> </pre></li>
<li id="l285"><pre>         <span class="keyword">package</span> <span class="keyword">body</span> <a href="src_unzip-decompress.adb.html#l74" title="defined at unzip-decompress.adb:74:18">Bit_buffer</a> <span class="keyword">is</span> </pre></li>
<li id="l286"><pre>            B  : Unsigned_32; </pre></li>
<li id="l287"><pre>            K  : Integer; </pre></li>
<li id="l288"><pre> </pre></li>
<li id="l289"><pre>            <span class="keyword">procedure</span> <a href="src_unzip-decompress.adb.html#l75" title="defined at unzip-decompress.adb:75:23">Init</a> <span class="keyword">is</span> </pre></li>
<li id="l290"><pre>            <span class="keyword">begin</span> </pre></li>
<li id="l291"><pre>               B := 0; </pre></li>
<li id="l292"><pre>               K := 0; </pre></li>
<li id="l293"><pre>            <span class="keyword">end</span> <span class="droplink">Init<ul><li><a href="src_unzip-decompress.adb.html#l75" title="To spec">To spec</a></li><li><a href="src_unzip-decompress.adb.html#l289" title="To body">To body</a></li></ul></span>; </pre></li>
<li id="l294"><pre> </pre></li>
<li id="l295"><pre>            <span class="keyword">procedure</span> Need (n  : Natural) <span class="keyword">is</span> </pre></li>
<li id="l296"><pre>               <span class="keyword">pragma</span> Inline (Need); </pre></li>
<li id="l297"><pre>               bt : <span class="droplink">Zip.Byte<ul><li><a href="zip.ads.html#zip.ads:218:11" title="To API doc">To API doc</a></li><li><a href="src_zip.ads.html#l218" title="To spec">To spec</a></li></ul></span>; </pre></li>
<li id="l298"><pre>            <span class="keyword">begin</span> </pre></li>
<li id="l299"><pre>               <span class="keyword">while</span> K &lt; n <span class="keyword">loop</span> </pre></li>
<li id="l300"><pre>                  <span class="droplink">Read_raw_byte<ul><li><a href="src_unzip-decompress.adb.html#l71" title="To spec">To spec</a></li><li><a href="src_unzip-decompress.adb.html#l279" title="To body">To body</a></li></ul></span> (bt); </pre></li>
<li id="l301"><pre>                  B := B <span class="keyword">or</span> Shift_Left (Unsigned_32 (bt), K); </pre></li>
<li id="l302"><pre>                  K := K + 8; </pre></li>
<li id="l303"><pre>               <span class="keyword">end</span> <span class="keyword">loop</span>; </pre></li>
<li id="l304"><pre>            <span class="keyword">end</span> Need; </pre></li>
<li id="l305"><pre> </pre></li>
<li id="l306"><pre>            <span class="keyword">procedure</span> <a href="src_unzip-decompress.adb.html#l85" title="defined at unzip-decompress.adb:85:23">Dump</a> (<a href="src_unzip-decompress.adb.html#l85" title="defined at unzip-decompress.adb:85:29">n</a>  : Natural) <span class="keyword">is</span> </pre></li>
<li id="l307"><pre>            <span class="keyword">begin</span> </pre></li>
<li id="l308"><pre>               B := Shift_Right (B, <a href="src_unzip-decompress.adb.html#l85" title="defined at unzip-decompress.adb:85:29">n</a>); </pre></li>
<li id="l309"><pre>               K := K - <a href="src_unzip-decompress.adb.html#l85" title="defined at unzip-decompress.adb:85:29">n</a>; </pre></li>
<li id="l310"><pre>            <span class="keyword">end</span> <span class="droplink">Dump<ul><li><a href="src_unzip-decompress.adb.html#l85" title="To spec">To spec</a></li><li><a href="src_unzip-decompress.adb.html#l306" title="To body">To body</a></li></ul></span>; </pre></li>
<li id="l311"><pre> </pre></li>
<li id="l312"><pre>            <span class="keyword">procedure</span> <a href="src_unzip-decompress.adb.html#l87" title="defined at unzip-decompress.adb:87:23">Dump_to_byte_boundary</a> <span class="keyword">is</span> </pre></li>
<li id="l313"><pre>            <span class="keyword">begin</span> </pre></li>
<li id="l314"><pre>               <span class="droplink">Dump<ul><li><a href="src_unzip-decompress.adb.html#l85" title="To spec">To spec</a></li><li><a href="src_unzip-decompress.adb.html#l306" title="To body">To body</a></li></ul></span> (K <span class="keyword">mod</span> 8); </pre></li>
<li id="l315"><pre>            <span class="keyword">end</span> <span class="droplink">Dump_to_byte_boundary<ul><li><a href="src_unzip-decompress.adb.html#l87" title="To spec">To spec</a></li><li><a href="src_unzip-decompress.adb.html#l312" title="To body">To body</a></li></ul></span>; </pre></li>
<li id="l316"><pre> </pre></li>
<li id="l317"><pre>            <span class="keyword">function</span> <a href="src_unzip-decompress.adb.html#l79" title="defined at unzip-decompress.adb:79:22">Read_U32</a> (<a href="src_unzip-decompress.adb.html#l79" title="defined at unzip-decompress.adb:79:32">n</a> : Natural) <span class="keyword">return</span> Unsigned_32 <span class="keyword">is</span> </pre></li>
<li id="l318"><pre>            <span class="keyword">begin</span> </pre></li>
<li id="l319"><pre>               Need (<a href="src_unzip-decompress.adb.html#l79" title="defined at unzip-decompress.adb:79:32">n</a>); </pre></li>
<li id="l320"><pre>               <span class="keyword">return</span> B <span class="keyword">and</span> (Shift_Left (1, <a href="src_unzip-decompress.adb.html#l79" title="defined at unzip-decompress.adb:79:32">n</a>) - 1); </pre></li>
<li id="l321"><pre>            <span class="keyword">end</span> <span class="droplink">Read_U32<ul><li><a href="src_unzip-decompress.adb.html#l79" title="To spec">To spec</a></li><li><a href="src_unzip-decompress.adb.html#l317" title="To body">To body</a></li></ul></span>; </pre></li>
<li id="l322"><pre> </pre></li>
<li id="l323"><pre>            <span class="keyword">function</span> <a href="src_unzip-decompress.adb.html#l82" title="defined at unzip-decompress.adb:82:22">Read_inverted</a> (<a href="src_unzip-decompress.adb.html#l82" title="defined at unzip-decompress.adb:82:37">n</a> : Natural) <span class="keyword">return</span> Integer <span class="keyword">is</span> </pre></li>
<li id="l324"><pre>            <span class="keyword">begin</span> </pre></li>
<li id="l325"><pre>               Need (<a href="src_unzip-decompress.adb.html#l82" title="defined at unzip-decompress.adb:82:37">n</a>); </pre></li>
<li id="l326"><pre>               <span class="keyword">return</span> Integer ((<span class="keyword">not</span> B) <span class="keyword">and</span> (Shift_Left (1, <a href="src_unzip-decompress.adb.html#l82" title="defined at unzip-decompress.adb:82:37">n</a>) - 1)); </pre></li>
<li id="l327"><pre>            <span class="keyword">end</span> <span class="droplink">Read_inverted<ul><li><a href="src_unzip-decompress.adb.html#l82" title="To spec">To spec</a></li><li><a href="src_unzip-decompress.adb.html#l323" title="To body">To body</a></li></ul></span>; </pre></li>
<li id="l328"><pre> </pre></li>
<li id="l329"><pre>            <span class="keyword">function</span> <a href="src_unzip-decompress.adb.html#l77" title="defined at unzip-decompress.adb:77:22">Read</a> (<a href="src_unzip-decompress.adb.html#l77" title="defined at unzip-decompress.adb:77:28">n</a> : Natural) <span class="keyword">return</span> Integer <span class="keyword">is</span> </pre></li>
<li id="l330"><pre>            <span class="keyword">begin</span> </pre></li>
<li id="l331"><pre>               <span class="keyword">return</span> Integer (<span class="droplink">Read_U32<ul><li><a href="src_unzip-decompress.adb.html#l79" title="To spec">To spec</a></li><li><a href="src_unzip-decompress.adb.html#l317" title="To body">To body</a></li></ul></span> (<a href="src_unzip-decompress.adb.html#l77" title="defined at unzip-decompress.adb:77:28">n</a>)); </pre></li>
<li id="l332"><pre>            <span class="keyword">end</span> <span class="droplink">Read<ul><li><a href="src_unzip-decompress.adb.html#l77" title="To spec">To spec</a></li><li><a href="src_unzip-decompress.adb.html#l329" title="To body">To body</a></li></ul></span>; </pre></li>
<li id="l333"><pre> </pre></li>
<li id="l334"><pre>            <span class="keyword">function</span> <a href="src_unzip-decompress.adb.html#l88" title="defined at unzip-decompress.adb:88:22">Read_and_dump</a> (<a href="src_unzip-decompress.adb.html#l88" title="defined at unzip-decompress.adb:88:37">n</a> : Natural) <span class="keyword">return</span> Integer <span class="keyword">is</span> </pre></li>
<li id="l335"><pre>               res : Integer; </pre></li>
<li id="l336"><pre>            <span class="keyword">begin</span> </pre></li>
<li id="l337"><pre>               res := <span class="droplink">Read<ul><li><a href="src_unzip-decompress.adb.html#l77" title="To spec">To spec</a></li><li><a href="src_unzip-decompress.adb.html#l329" title="To body">To body</a></li></ul></span> (<a href="src_unzip-decompress.adb.html#l88" title="defined at unzip-decompress.adb:88:37">n</a>); </pre></li>
<li id="l338"><pre>               <span class="droplink">Dump<ul><li><a href="src_unzip-decompress.adb.html#l85" title="To spec">To spec</a></li><li><a href="src_unzip-decompress.adb.html#l306" title="To body">To body</a></li></ul></span> (<a href="src_unzip-decompress.adb.html#l88" title="defined at unzip-decompress.adb:88:37">n</a>); </pre></li>
<li id="l339"><pre>               <span class="keyword">return</span> res; </pre></li>
<li id="l340"><pre>            <span class="keyword">end</span> <span class="droplink">Read_and_dump<ul><li><a href="src_unzip-decompress.adb.html#l88" title="To spec">To spec</a></li><li><a href="src_unzip-decompress.adb.html#l334" title="To body">To body</a></li></ul></span>; </pre></li>
<li id="l341"><pre> </pre></li>
<li id="l342"><pre>            <span class="keyword">function</span> <a href="src_unzip-decompress.adb.html#l90" title="defined at unzip-decompress.adb:90:22">Read_and_dump_U32</a> (<a href="src_unzip-decompress.adb.html#l90" title="defined at unzip-decompress.adb:90:41">n</a> : Natural) <span class="keyword">return</span> Unsigned_32 <span class="keyword">is</span> </pre></li>
<li id="l343"><pre>               res : Unsigned_32; </pre></li>
<li id="l344"><pre>            <span class="keyword">begin</span> </pre></li>
<li id="l345"><pre>               res := <span class="droplink">Read_U32<ul><li><a href="src_unzip-decompress.adb.html#l79" title="To spec">To spec</a></li><li><a href="src_unzip-decompress.adb.html#l317" title="To body">To body</a></li></ul></span> (<a href="src_unzip-decompress.adb.html#l90" title="defined at unzip-decompress.adb:90:41">n</a>); </pre></li>
<li id="l346"><pre>               <span class="droplink">Dump<ul><li><a href="src_unzip-decompress.adb.html#l85" title="To spec">To spec</a></li><li><a href="src_unzip-decompress.adb.html#l306" title="To body">To body</a></li></ul></span> (<a href="src_unzip-decompress.adb.html#l90" title="defined at unzip-decompress.adb:90:41">n</a>); </pre></li>
<li id="l347"><pre>               <span class="keyword">return</span> res; </pre></li>
<li id="l348"><pre>            <span class="keyword">end</span> <span class="droplink">Read_and_dump_U32<ul><li><a href="src_unzip-decompress.adb.html#l90" title="To spec">To spec</a></li><li><a href="src_unzip-decompress.adb.html#l342" title="To body">To body</a></li></ul></span>; </pre></li>
<li id="l349"><pre> </pre></li>
<li id="l350"><pre>         <span class="keyword">end</span> <span class="droplink">Bit_buffer<ul><li><a href="src_unzip-decompress.adb.html#l74" title="To spec">To spec</a></li><li><a href="src_unzip-decompress.adb.html#l285" title="To body">To body</a></li></ul></span>; </pre></li>
<li id="l351"><pre> </pre></li>
<li id="l352"><pre>         <span class="keyword">procedure</span> <a href="src_unzip-decompress.adb.html#l94" title="defined at unzip-decompress.adb:94:20">Flush</a> (<a href="src_unzip-decompress.adb.html#l94" title="defined at unzip-decompress.adb:94:27">x</a> : Natural) <span class="keyword">is</span> </pre></li>
<li id="l353"><pre>            <span class="keyword">use</span> <span class="droplink">Zip<ul><li><a href="zip.ads.html#zip.ads:45:9" title="To API doc">To API doc</a></li><li><a href="src_zip.ads.html#l45" title="To spec">To spec</a></li><li><a href="src_zip.adb.html#l9" title="To body">To body</a></li></ul></span>, <span class="droplink">UnZip<ul><li><a href="unzip.ads.html#unzip.ads:53:9" title="To API doc">To API doc</a></li><li><a href="src_unzip.ads.html#l53" title="To spec">To spec</a></li><li><a href="src_unzip.adb.html#l6" title="To body">To body</a></li></ul></span>, Ada.Streams; </pre></li>
<li id="l354"><pre>            user_aborting : Boolean; </pre></li>
<li id="l355"><pre>         <span class="keyword">begin</span> </pre></li>
<li id="l356"><pre>            <span class="keyword">if</span> <span class="droplink">full_trace<ul><li><a href="unzip-decompress.ads.html#unzip-decompress.ads:51:3" title="To API doc">To API doc</a></li><li><a href="src_unzip-decompress.ads.html#l51" title="To spec">To spec</a></li></ul></span> <span class="keyword">then</span> </pre></li>
<li id="l357"><pre>               <span class="keyword">pragma</span> Warnings (Off, <span class="string">&quot;this code can never be executed and has been deleted&quot;</span>); </pre></li>
<li id="l358"><pre>               Ada.Text_IO.Put (<span class="string">&quot;[Flush .. .&quot;</span>); </pre></li>
<li id="l359"><pre>               <span class="keyword">pragma</span> Warnings (On,  <span class="string">&quot;this code can never be executed and has been deleted&quot;</span>); </pre></li>
<li id="l360"><pre>            <span class="keyword">end</span> <span class="keyword">if</span>; </pre></li>
<li id="l361"><pre>            <span class="keyword">begin</span> </pre></li>
<li id="l362"><pre>               <span class="keyword">case</span> <span class="droplink">mode<ul><li><a href="unzip-decompress.ads.html#unzip-decompress.ads:25:5" title="To API doc">To API doc</a></li><li><a href="src_unzip-decompress.ads.html#l25" title="To spec">To spec</a></li><li><a href="src_unzip-decompress.adb.html#l10" title="To body">To body</a></li></ul></span> <span class="keyword">is</span> </pre></li>
<li id="l363"><pre>               <span class="keyword">when</span> write_to_binary_file =&gt; </pre></li>
<li id="l364"><pre>                  <span class="droplink">BlockWrite<ul><li><a href="zip.ads.html#zip.ads:244:14" title="To API doc">To API doc</a></li><li><a href="src_zip.ads.html#l244" title="To spec">To spec</a></li><li><a href="src_zip.adb.html#l653" title="To body">To body</a></li></ul></span> (Ada.Streams.Stream_IO.Stream (<a href="src_unzip-decompress.adb.html#l57" title="defined at unzip-decompress.adb:57:10">out_bin_file</a>).<span class="keyword">all</span>, <a href="src_unzip-decompress.adb.html#l41" title="defined at unzip-decompress.adb:41:10">UnZ_Glob.slide</a> (0 .. <a href="src_unzip-decompress.adb.html#l94" title="defined at unzip-decompress.adb:94:27">x</a> - 1)); </pre></li>
<li id="l365"><pre>               <span class="keyword">when</span> write_to_text_file =&gt; </pre></li>
<li id="l366"><pre>                  <span class="droplink">Zip.Write_as_text<ul><li><a href="zip.ads.html#zip.ads:262:13" title="To API doc">To API doc</a></li><li><a href="src_zip.ads.html#l262" title="To spec">To spec</a></li><li><a href="src_zip.adb.html#l745" title="To body">To body</a></li></ul></span> ( </pre></li>
<li id="l367"><pre>                                     <a href="src_unzip-decompress.adb.html#l58" title="defined at unzip-decompress.adb:58:10">UnZ_IO.out_txt_file</a>, <a href="src_unzip-decompress.adb.html#l41" title="defined at unzip-decompress.adb:41:10">UnZ_Glob.slide</a> (0 .. <a href="src_unzip-decompress.adb.html#l94" title="defined at unzip-decompress.adb:94:27">x</a> - 1), <a href="src_unzip-decompress.adb.html#l59" title="defined at unzip-decompress.adb:59:10">UnZ_IO.last_char</a> </pre></li>
<li id="l368"><pre>                                    ); </pre></li>
<li id="l369"><pre>               <span class="keyword">when</span> write_to_memory =&gt; </pre></li>
<li id="l370"><pre>                  <span class="keyword">for</span> i <span class="keyword">in</span> 0 .. <a href="src_unzip-decompress.adb.html#l94" title="defined at unzip-decompress.adb:94:27">x</a> - 1 <span class="keyword">loop</span> </pre></li>
<li id="l371"><pre>                     <span class="droplink">output_memory_access<ul><li><a href="unzip-decompress.ads.html#unzip-decompress.ads:27:5" title="To API doc">To API doc</a></li><li><a href="src_unzip-decompress.ads.html#l27" title="To spec">To spec</a></li></ul></span>.<span class="keyword">all</span> (<a href="src_unzip-decompress.adb.html#l53" title="defined at unzip-decompress.adb:53:10">UnZ_Glob.uncompressed_index</a>) := </pre></li>
<li id="l372"><pre>                       Ada.Streams.Stream_Element (<a href="src_unzip-decompress.adb.html#l41" title="defined at unzip-decompress.adb:41:10">UnZ_Glob.slide</a> (i)); </pre></li>
<li id="l373"><pre>                     <a href="src_unzip-decompress.adb.html#l53" title="defined at unzip-decompress.adb:53:10">UnZ_Glob.uncompressed_index</a> := <a href="src_unzip-decompress.adb.html#l53" title="defined at unzip-decompress.adb:53:10">UnZ_Glob.uncompressed_index</a> + 1; </pre></li>
<li id="l374"><pre>                  <span class="keyword">end</span> <span class="keyword">loop</span>; </pre></li>
<li id="l375"><pre>               <span class="keyword">when</span> just_test =&gt; </pre></li>
<li id="l376"><pre>                  <span class="keyword">null</span>; </pre></li>
<li id="l377"><pre>               <span class="keyword">end</span> <span class="keyword">case</span>; </pre></li>
<li id="l378"><pre>            <span class="keyword">exception</span> </pre></li>
<li id="l379"><pre>               <span class="keyword">when</span> <span class="keyword">others</span> =&gt; </pre></li>
<li id="l380"><pre>                  <span class="keyword">raise</span> <span class="droplink">UnZip.Write_Error<ul><li><a href="unzip.ads.html#unzip.ads:287:3" title="To API doc">To API doc</a></li><li><a href="src_unzip.ads.html#l287" title="To spec">To spec</a></li></ul></span>; </pre></li>
<li id="l381"><pre>            <span class="keyword">end</span>; </pre></li>
<li id="l382"><pre>            <span class="droplink">Zip.CRC.Update<ul><li><a href="zip-crc.ads.html#zip-crc.ads:11:13" title="To API doc">To API doc</a></li><li><a href="src_zip-crc.ads.html#l11" title="To spec">To spec</a></li><li><a href="src_zip-crc.adb.html#l25" title="To body">To body</a></li></ul></span> (<a href="src_unzip-decompress.adb.html#l51" title="defined at unzip-decompress.adb:51:10">UnZ_Glob.crc32val</a>, <a href="src_unzip-decompress.adb.html#l41" title="defined at unzip-decompress.adb:41:10">UnZ_Glob.slide</a> (0 .. <a href="src_unzip-decompress.adb.html#l94" title="defined at unzip-decompress.adb:94:27">x</a> - 1)); </pre></li>
<li id="l383"><pre>            <span class="keyword">if</span> <span class="droplink">feedback<ul><li><a href="unzip-decompress.ads.html#unzip-decompress.ads:28:5" title="To API doc">To API doc</a></li><li><a href="src_unzip-decompress.ads.html#l28" title="To spec">To spec</a></li></ul></span> /= <span class="keyword">null</span> <span class="keyword">then</span> <span class="comment">-- inform user</span> </pre></li>
<li id="l384"><pre>               <a href="src_unzip-decompress.adb.html#l49" title="defined at unzip-decompress.adb:49:10">UnZ_Glob.effective_writes</a> := </pre></li>
<li id="l385"><pre>                 <a href="src_unzip-decompress.adb.html#l49" title="defined at unzip-decompress.adb:49:10">UnZ_Glob.effective_writes</a> + <span class="droplink">File_size_type<ul><li><a href="unzip.ads.html#unzip.ads:190:11" title="To API doc">To API doc</a></li><li><a href="src_unzip.ads.html#l190" title="To spec">To spec</a></li></ul></span> (<a href="src_unzip-decompress.adb.html#l94" title="defined at unzip-decompress.adb:94:27">x</a>); </pre></li>
<li id="l386"><pre>               <span class="keyword">if</span> <a href="src_unzip-decompress.adb.html#l48" title="defined at unzip-decompress.adb:48:10">UnZ_Glob.uncompsize</a> &gt; 0 <span class="keyword">then</span> </pre></li>
<li id="l387"><pre>                  <span class="droplink">feedback<ul><li><a href="unzip-decompress.ads.html#unzip-decompress.ads:28:5" title="To API doc">To API doc</a></li><li><a href="src_unzip-decompress.ads.html#l28" title="To spec">To spec</a></li></ul></span>.<span class="keyword">all</span> ( </pre></li>
<li id="l388"><pre>                                percents_done =&gt; Natural ( </pre></li>
<li id="l389"><pre>                                                          (100.0 * Float (<a href="src_unzip-decompress.adb.html#l49" title="defined at unzip-decompress.adb:49:10">UnZ_Glob.effective_writes</a>)) / </pre></li>
<li id="l390"><pre>                                                            Float (<a href="src_unzip-decompress.adb.html#l48" title="defined at unzip-decompress.adb:48:10">UnZ_Glob.uncompsize</a>)), </pre></li>
<li id="l391"><pre>                                entry_skipped =&gt; False, </pre></li>
<li id="l392"><pre>                                user_abort    =&gt; user_aborting); </pre></li>
<li id="l393"><pre>                  <span class="keyword">if</span> user_aborting <span class="keyword">then</span> </pre></li>
<li id="l394"><pre>                     <span class="keyword">raise</span> <span class="droplink">User_abort<ul><li><a href="unzip.ads.html#unzip.ads:290:3" title="To API doc">To API doc</a></li><li><a href="src_unzip.ads.html#l290" title="To spec">To spec</a></li></ul></span>; </pre></li>
<li id="l395"><pre>                  <span class="keyword">end</span> <span class="keyword">if</span>; </pre></li>
<li id="l396"><pre>               <span class="keyword">end</span> <span class="keyword">if</span>; </pre></li>
<li id="l397"><pre>            <span class="keyword">end</span> <span class="keyword">if</span>; </pre></li>
<li id="l398"><pre>            <span class="keyword">if</span> <span class="droplink">full_trace<ul><li><a href="unzip-decompress.ads.html#unzip-decompress.ads:51:3" title="To API doc">To API doc</a></li><li><a href="src_unzip-decompress.ads.html#l51" title="To spec">To spec</a></li></ul></span> <span class="keyword">then</span> </pre></li>
<li id="l399"><pre>               <span class="keyword">pragma</span> Warnings (Off, <span class="string">&quot;this code can never be executed and has been deleted&quot;</span>); </pre></li>
<li id="l400"><pre>               Ada.Text_IO.Put_Line (<span class="string">&quot;finished]&quot;</span>); </pre></li>
<li id="l401"><pre>               <span class="keyword">pragma</span> Warnings (On,  <span class="string">&quot;this code can never be executed and has been deleted&quot;</span>); </pre></li>
<li id="l402"><pre>            <span class="keyword">end</span> <span class="keyword">if</span>; </pre></li>
<li id="l403"><pre>         <span class="keyword">end</span> <span class="droplink">Flush<ul><li><a href="src_unzip-decompress.adb.html#l94" title="To spec">To spec</a></li><li><a href="src_unzip-decompress.adb.html#l352" title="To body">To body</a></li></ul></span>; </pre></li>
<li id="l404"><pre> </pre></li>
<li id="l405"><pre>         <span class="keyword">procedure</span> <a href="src_unzip-decompress.adb.html#l96" title="defined at unzip-decompress.adb:96:20">Flush_if_full</a> (<a href="src_unzip-decompress.adb.html#l96" title="defined at unzip-decompress.adb:96:35">W</a> : <span class="keyword">in</span> <span class="keyword">out</span> Integer; <a href="src_unzip-decompress.adb.html#l96" title="defined at unzip-decompress.adb:96:55">unflushed</a> : <span class="keyword">in</span> <span class="keyword">out</span> Boolean) <span class="keyword">is</span> </pre></li>
<li id="l406"><pre>         <span class="keyword">begin</span> </pre></li>
<li id="l407"><pre>            <span class="keyword">if</span> <a href="src_unzip-decompress.adb.html#l96" title="defined at unzip-decompress.adb:96:35">W</a> = <a href="src_unzip-decompress.adb.html#l31" title="defined at unzip-decompress.adb:31:7">wsize</a> <span class="keyword">then</span> </pre></li>
<li id="l408"><pre>               <span class="droplink">Flush<ul><li><a href="src_unzip-decompress.adb.html#l94" title="To spec">To spec</a></li><li><a href="src_unzip-decompress.adb.html#l352" title="To body">To body</a></li></ul></span> (<a href="src_unzip-decompress.adb.html#l31" title="defined at unzip-decompress.adb:31:7">wsize</a>); </pre></li>
<li id="l409"><pre>               <a href="src_unzip-decompress.adb.html#l96" title="defined at unzip-decompress.adb:96:35">W</a> := 0; </pre></li>
<li id="l410"><pre>               <a href="src_unzip-decompress.adb.html#l96" title="defined at unzip-decompress.adb:96:55">unflushed</a> := False; </pre></li>
<li id="l411"><pre>            <span class="keyword">end</span> <span class="keyword">if</span>; </pre></li>
<li id="l412"><pre>         <span class="keyword">end</span> <span class="droplink">Flush_if_full<ul><li><a href="src_unzip-decompress.adb.html#l96" title="To spec">To spec</a></li><li><a href="src_unzip-decompress.adb.html#l405" title="To body">To body</a></li></ul></span>; </pre></li>
<li id="l413"><pre> </pre></li>
<li id="l414"><pre>         <span class="keyword">procedure</span> <a href="src_unzip-decompress.adb.html#l99" title="defined at unzip-decompress.adb:99:20">Flush_if_full</a> (<a href="src_unzip-decompress.adb.html#l99" title="defined at unzip-decompress.adb:99:35">W</a> : <span class="keyword">in</span> <span class="keyword">out</span> Integer) <span class="keyword">is</span> </pre></li>
<li id="l415"><pre>         <span class="keyword">begin</span> </pre></li>
<li id="l416"><pre>            <span class="keyword">if</span> <a href="src_unzip-decompress.adb.html#l99" title="defined at unzip-decompress.adb:99:35">W</a> = <a href="src_unzip-decompress.adb.html#l31" title="defined at unzip-decompress.adb:31:7">wsize</a> <span class="keyword">then</span> </pre></li>
<li id="l417"><pre>               <span class="droplink">Flush<ul><li><a href="src_unzip-decompress.adb.html#l94" title="To spec">To spec</a></li><li><a href="src_unzip-decompress.adb.html#l352" title="To body">To body</a></li></ul></span> (<a href="src_unzip-decompress.adb.html#l31" title="defined at unzip-decompress.adb:31:7">wsize</a>); </pre></li>
<li id="l418"><pre>               <a href="src_unzip-decompress.adb.html#l99" title="defined at unzip-decompress.adb:99:35">W</a> := 0; </pre></li>
<li id="l419"><pre>            <span class="keyword">end</span> <span class="keyword">if</span>; </pre></li>
<li id="l420"><pre>         <span class="keyword">end</span> <span class="droplink">Flush_if_full<ul><li><a href="src_unzip-decompress.adb.html#l99" title="To spec">To spec</a></li><li><a href="src_unzip-decompress.adb.html#l414" title="To body">To body</a></li></ul></span>; </pre></li>
<li id="l421"><pre> </pre></li>
<li id="l422"><pre>         <span class="comment">----------------------------------------------------</span> </pre></li>
<li id="l423"><pre>         <span class="comment">-- Reproduction of sequences in the output slide. --</span> </pre></li>
<li id="l424"><pre>         <span class="comment">----------------------------------------------------</span> </pre></li>
<li id="l425"><pre> </pre></li>
<li id="l426"><pre>         <span class="comment">-- Internal:</span> </pre></li>
<li id="l427"><pre> </pre></li>
<li id="l428"><pre>         <span class="keyword">procedure</span> Adjust_to_Slide ( </pre></li>
<li id="l429"><pre>                                    source          : <span class="keyword">in</span> <span class="keyword">out</span> Integer; </pre></li>
<li id="l430"><pre>                                    remain          : <span class="keyword">in</span> <span class="keyword">out</span> Natural; </pre></li>
<li id="l431"><pre>                                    part            :    <span class="keyword">out</span> Integer; </pre></li>
<li id="l432"><pre>                                    index :                  Integer) </pre></li>
<li id="l433"><pre>         <span class="keyword">is</span> </pre></li>
<li id="l434"><pre>            <span class="keyword">pragma</span> Inline (Adjust_to_Slide); </pre></li>
<li id="l435"><pre>         <span class="keyword">begin</span> </pre></li>
<li id="l436"><pre>            source := source <span class="keyword">mod</span> <a href="src_unzip-decompress.adb.html#l31" title="defined at unzip-decompress.adb:31:7">wsize</a>; </pre></li>
<li id="l437"><pre>            <span class="comment">-- source and index are now in 0 .. WSize - 1</span> </pre></li>
<li id="l438"><pre>            <span class="keyword">if</span>  source &gt; index <span class="keyword">then</span> </pre></li>
<li id="l439"><pre>               part := <a href="src_unzip-decompress.adb.html#l31" title="defined at unzip-decompress.adb:31:7">wsize</a> - source; </pre></li>
<li id="l440"><pre>            <span class="keyword">else</span> </pre></li>
<li id="l441"><pre>               part := <a href="src_unzip-decompress.adb.html#l31" title="defined at unzip-decompress.adb:31:7">wsize</a> - index; </pre></li>
<li id="l442"><pre>            <span class="keyword">end</span> <span class="keyword">if</span>; </pre></li>
<li id="l443"><pre>            <span class="comment">-- NB : part is in 1 .. WSize (part cannot be 0)</span> </pre></li>
<li id="l444"><pre>            <span class="keyword">if</span> part &gt; remain <span class="keyword">then</span> </pre></li>
<li id="l445"><pre>               part := remain; </pre></li>
<li id="l446"><pre>            <span class="keyword">end</span> <span class="keyword">if</span>; </pre></li>
<li id="l447"><pre>            <span class="comment">-- Now part &lt;= remain</span> </pre></li>
<li id="l448"><pre>            remain := remain - part; </pre></li>
<li id="l449"><pre>            <span class="comment">-- NB : remain cannot be &lt; 0</span> </pre></li>
<li id="l450"><pre>         <span class="keyword">end</span> Adjust_to_Slide; </pre></li>
<li id="l451"><pre> </pre></li>
<li id="l452"><pre>         <span class="keyword">procedure</span> Copy_range (source, index : <span class="keyword">in</span> <span class="keyword">out</span> Natural; amount : Positive) <span class="keyword">is</span> </pre></li>
<li id="l453"><pre>            <span class="keyword">pragma</span> Inline (Copy_range); </pre></li>
<li id="l454"><pre>         <span class="keyword">begin</span> </pre></li>
<li id="l455"><pre>            <span class="keyword">if</span> <span class="droplink">full_trace<ul><li><a href="unzip-decompress.ads.html#unzip-decompress.ads:51:3" title="To API doc">To API doc</a></li><li><a href="src_unzip-decompress.ads.html#l51" title="To spec">To spec</a></li></ul></span> <span class="keyword">then</span> </pre></li>
<li id="l456"><pre>               <span class="keyword">pragma</span> Warnings (Off, <span class="string">&quot;this code can never be executed and has been deleted&quot;</span>); </pre></li>
<li id="l457"><pre>               Ada.Text_IO.Put ( </pre></li>
<li id="l458"><pre>                                <span class="string">&quot; (Copy_range : source=&quot;</span> &amp; Integer&apos;Image (source) &amp; </pre></li>
<li id="l459"><pre>                                  <span class="string">&quot; index=&quot;</span> &amp; Integer&apos;Image (index) &amp; </pre></li>
<li id="l460"><pre>                                  <span class="string">&quot; amount=&quot;</span> &amp; Integer&apos;Image (amount)); </pre></li>
<li id="l461"><pre>               <span class="keyword">pragma</span> Warnings (On,  <span class="string">&quot;this code can never be executed and has been deleted&quot;</span>); </pre></li>
<li id="l462"><pre>            <span class="keyword">end</span> <span class="keyword">if</span>; </pre></li>
<li id="l463"><pre>            <span class="keyword">if</span> <span class="keyword">abs</span> (index - source) &lt; amount <span class="keyword">then</span> </pre></li>
<li id="l464"><pre>               <span class="keyword">if</span> <span class="droplink">full_trace<ul><li><a href="unzip-decompress.ads.html#unzip-decompress.ads:51:3" title="To API doc">To API doc</a></li><li><a href="src_unzip-decompress.ads.html#l51" title="To spec">To spec</a></li></ul></span> <span class="keyword">and</span> <span class="keyword">then</span> source &lt; index <span class="keyword">then</span> </pre></li>
<li id="l465"><pre>                  <span class="keyword">pragma</span> Warnings (Off, <span class="string">&quot;this code can never be executed and has been deleted&quot;</span>); </pre></li>
<li id="l466"><pre>                  Ada.Text_IO.Put ( </pre></li>
<li id="l467"><pre>                                   <span class="string">&quot;; replicates&quot;</span> &amp; </pre></li>
<li id="l468"><pre>                                     Integer&apos;Image (amount) &amp; <span class="string">&quot; /&quot;</span> &amp; Integer&apos;Image (index - source) &amp; </pre></li>
<li id="l469"><pre>                                     <span class="string">&quot;)&quot;</span> </pre></li>
<li id="l470"><pre>                                  ); </pre></li>
<li id="l471"><pre>                  <span class="comment">-- . .. times the range source .. index - 1</span> </pre></li>
<li id="l472"><pre>                  <span class="keyword">pragma</span> Warnings (On,  <span class="string">&quot;this code can never be executed and has been deleted&quot;</span>); </pre></li>
<li id="l473"><pre>               <span class="keyword">end</span> <span class="keyword">if</span>; </pre></li>
<li id="l474"><pre>               <span class="comment">-- if source &gt;= index, the effect of copy is</span> </pre></li>
<li id="l475"><pre>               <span class="comment">-- just like the non - overlapping case</span> </pre></li>
<li id="l476"><pre>               <span class="keyword">for</span> count <span class="keyword">in</span> <span class="keyword">reverse</span> 1 .. amount <span class="keyword">loop</span> </pre></li>
<li id="l477"><pre>                  <a href="src_unzip-decompress.adb.html#l41" title="defined at unzip-decompress.adb:41:10">UnZ_Glob.slide</a> (index) := <a href="src_unzip-decompress.adb.html#l41" title="defined at unzip-decompress.adb:41:10">UnZ_Glob.slide</a> (source); </pre></li>
<li id="l478"><pre>                  index := index  + 1; </pre></li>
<li id="l479"><pre>                  source := source + 1; </pre></li>
<li id="l480"><pre>               <span class="keyword">end</span> <span class="keyword">loop</span>; </pre></li>
<li id="l481"><pre>            <span class="keyword">else</span> <span class="comment">-- non - overlapping - &gt; copy slice</span> </pre></li>
<li id="l482"><pre>               <a href="src_unzip-decompress.adb.html#l41" title="defined at unzip-decompress.adb:41:10">UnZ_Glob.slide</a> (index .. index + amount - 1) := </pre></li>
<li id="l483"><pre>                 <a href="src_unzip-decompress.adb.html#l41" title="defined at unzip-decompress.adb:41:10">UnZ_Glob.slide</a> (source .. source + amount - 1); </pre></li>
<li id="l484"><pre>               index := index  + amount; </pre></li>
<li id="l485"><pre>               source := source + amount; </pre></li>
<li id="l486"><pre>            <span class="keyword">end</span> <span class="keyword">if</span>; </pre></li>
<li id="l487"><pre>            <span class="keyword">if</span> <span class="droplink">full_trace<ul><li><a href="unzip-decompress.ads.html#unzip-decompress.ads:51:3" title="To API doc">To API doc</a></li><li><a href="src_unzip-decompress.ads.html#l51" title="To spec">To spec</a></li></ul></span> <span class="keyword">then</span> </pre></li>
<li id="l488"><pre>               <span class="keyword">pragma</span> Warnings (Off, <span class="string">&quot;this code can never be executed and has been deleted&quot;</span>); </pre></li>
<li id="l489"><pre>               Ada.Text_IO.Put (<span class="string">&apos;)&apos;</span>); </pre></li>
<li id="l490"><pre>               <span class="keyword">pragma</span> Warnings (On,  <span class="string">&quot;this code can never be executed and has been deleted&quot;</span>); </pre></li>
<li id="l491"><pre>            <span class="keyword">end</span> <span class="keyword">if</span>; </pre></li>
<li id="l492"><pre>         <span class="keyword">end</span> Copy_range; </pre></li>
<li id="l493"><pre> </pre></li>
<li id="l494"><pre>         <span class="comment">-- The copying routines:</span> </pre></li>
<li id="l495"><pre> </pre></li>
<li id="l496"><pre>         <span class="keyword">procedure</span> <a href="src_unzip-decompress.adb.html#l102" title="defined at unzip-decompress.adb:102:20">Copy</a> ( </pre></li>
<li id="l497"><pre>                         <a href="src_unzip-decompress.adb.html#l102" title="defined at unzip-decompress.adb:102:26">distance</a>, <a href="src_unzip-decompress.adb.html#l102" title="defined at unzip-decompress.adb:102:36">copy_length</a> :        Natural; </pre></li>
<li id="l498"><pre>                         <a href="src_unzip-decompress.adb.html#l103" title="defined at unzip-decompress.adb:103:26">index</a>            : <span class="keyword">in</span> <span class="keyword">out</span> Natural) </pre></li>
<li id="l499"><pre>         <span class="keyword">is</span> </pre></li>
<li id="l500"><pre>            source, part, remain : Integer; </pre></li>
<li id="l501"><pre>         <span class="keyword">begin</span> </pre></li>
<li id="l502"><pre>            <span class="keyword">if</span> <span class="droplink">full_trace<ul><li><a href="unzip-decompress.ads.html#unzip-decompress.ads:51:3" title="To API doc">To API doc</a></li><li><a href="src_unzip-decompress.ads.html#l51" title="To spec">To spec</a></li></ul></span> <span class="keyword">or</span> <span class="keyword">else</span> (<span class="droplink">some_trace<ul><li><a href="unzip-decompress.ads.html#unzip-decompress.ads:50:3" title="To API doc">To API doc</a></li><li><a href="src_unzip-decompress.ads.html#l50" title="To spec">To spec</a></li></ul></span> <span class="keyword">and</span> <span class="keyword">then</span> <a href="src_unzip-decompress.adb.html#l102" title="defined at unzip-decompress.adb:102:26">distance</a> &gt; 32768 + 3) <span class="keyword">then</span> </pre></li>
<li id="l503"><pre>               <span class="keyword">pragma</span> Warnings (Off, <span class="string">&quot;this code can never be executed and has been deleted&quot;</span>); </pre></li>
<li id="l504"><pre>               Ada.Text_IO.Put ( </pre></li>
<li id="l505"><pre>                                <span class="string">&quot;DLE (distance=&quot;</span> &amp; Integer&apos;Image (<a href="src_unzip-decompress.adb.html#l102" title="defined at unzip-decompress.adb:102:26">distance</a>) &amp; </pre></li>
<li id="l506"><pre>                                  <span class="string">&quot; length=&quot;</span> &amp; Integer&apos;Image (<a href="src_unzip-decompress.adb.html#l102" title="defined at unzip-decompress.adb:102:36">copy_length</a>) &amp; <span class="string">&quot;)&quot;</span> </pre></li>
<li id="l507"><pre>                               ); </pre></li>
<li id="l508"><pre>               <span class="keyword">pragma</span> Warnings (On,  <span class="string">&quot;this code can never be executed and has been deleted&quot;</span>); </pre></li>
<li id="l509"><pre>            <span class="keyword">end</span> <span class="keyword">if</span>; </pre></li>
<li id="l510"><pre>            source := <a href="src_unzip-decompress.adb.html#l103" title="defined at unzip-decompress.adb:103:26">index</a> - <a href="src_unzip-decompress.adb.html#l102" title="defined at unzip-decompress.adb:102:26">distance</a>; </pre></li>
<li id="l511"><pre>            remain := <a href="src_unzip-decompress.adb.html#l102" title="defined at unzip-decompress.adb:102:36">copy_length</a>; </pre></li>
<li id="l512"><pre>            <span class="keyword">loop</span> </pre></li>
<li id="l513"><pre>               Adjust_to_Slide (source, remain, part, <a href="src_unzip-decompress.adb.html#l103" title="defined at unzip-decompress.adb:103:26">index</a>); </pre></li>
<li id="l514"><pre>               Copy_range (source, <a href="src_unzip-decompress.adb.html#l103" title="defined at unzip-decompress.adb:103:26">index</a>, part); </pre></li>
<li id="l515"><pre>               <span class="droplink">Flush_if_full<ul><li><a href="src_unzip-decompress.adb.html#l99" title="To spec">To spec</a></li><li><a href="src_unzip-decompress.adb.html#l414" title="To body">To body</a></li></ul></span> (<a href="src_unzip-decompress.adb.html#l103" title="defined at unzip-decompress.adb:103:26">index</a>); </pre></li>
<li id="l516"><pre>               <span class="keyword">exit</span> <span class="keyword">when</span> remain = 0; </pre></li>
<li id="l517"><pre>            <span class="keyword">end</span> <span class="keyword">loop</span>; </pre></li>
<li id="l518"><pre>         <span class="keyword">end</span> <span class="droplink">Copy<ul><li><a href="src_unzip-decompress.adb.html#l102" title="To spec">To spec</a></li><li><a href="src_unzip-decompress.adb.html#l496" title="To body">To body</a></li></ul></span>; </pre></li>
<li id="l519"><pre> </pre></li>
<li id="l520"><pre>         <span class="keyword">procedure</span> <a href="src_unzip-decompress.adb.html#l106" title="defined at unzip-decompress.adb:106:20">Copy_or_zero</a> ( </pre></li>
<li id="l521"><pre>                                 <a href="src_unzip-decompress.adb.html#l106" title="defined at unzip-decompress.adb:106:34">distance</a>, <a href="src_unzip-decompress.adb.html#l106" title="defined at unzip-decompress.adb:106:44">copy_length</a> :        Natural; </pre></li>
<li id="l522"><pre>                                 <a href="src_unzip-decompress.adb.html#l107" title="defined at unzip-decompress.adb:107:34">index</a>            : <span class="keyword">in</span> <span class="keyword">out</span> Natural; </pre></li>
<li id="l523"><pre>                                 <a href="src_unzip-decompress.adb.html#l108" title="defined at unzip-decompress.adb:108:34">unflushed</a>        : <span class="keyword">in</span> <span class="keyword">out</span> Boolean) </pre></li>
<li id="l524"><pre>         <span class="keyword">is</span> </pre></li>
<li id="l525"><pre>            source, part, remain : Integer; </pre></li>
<li id="l526"><pre>         <span class="keyword">begin</span> </pre></li>
<li id="l527"><pre>            source := <a href="src_unzip-decompress.adb.html#l107" title="defined at unzip-decompress.adb:107:34">index</a> - <a href="src_unzip-decompress.adb.html#l106" title="defined at unzip-decompress.adb:106:34">distance</a>; </pre></li>
<li id="l528"><pre>            remain := <a href="src_unzip-decompress.adb.html#l106" title="defined at unzip-decompress.adb:106:44">copy_length</a>; </pre></li>
<li id="l529"><pre>            <span class="keyword">loop</span> </pre></li>
<li id="l530"><pre>               Adjust_to_Slide (source, remain, part, <a href="src_unzip-decompress.adb.html#l107" title="defined at unzip-decompress.adb:107:34">index</a>); </pre></li>
<li id="l531"><pre>               <span class="keyword">if</span> <a href="src_unzip-decompress.adb.html#l108" title="defined at unzip-decompress.adb:108:34">unflushed</a> <span class="keyword">and</span> <span class="keyword">then</span> <a href="src_unzip-decompress.adb.html#l107" title="defined at unzip-decompress.adb:107:34">index</a> &lt;= source <span class="keyword">then</span> </pre></li>
<li id="l532"><pre>                  <a href="src_unzip-decompress.adb.html#l41" title="defined at unzip-decompress.adb:41:10">UnZ_Glob.slide</a> (<a href="src_unzip-decompress.adb.html#l107" title="defined at unzip-decompress.adb:107:34">index</a> .. <a href="src_unzip-decompress.adb.html#l107" title="defined at unzip-decompress.adb:107:34">index</a> + part - 1) := (<span class="keyword">others</span> =&gt; 0); </pre></li>
<li id="l533"><pre>                  <a href="src_unzip-decompress.adb.html#l107" title="defined at unzip-decompress.adb:107:34">index</a> := <a href="src_unzip-decompress.adb.html#l107" title="defined at unzip-decompress.adb:107:34">index</a>  + part; </pre></li>
<li id="l534"><pre>                  source := source + part; </pre></li>
<li id="l535"><pre>               <span class="keyword">else</span> </pre></li>
<li id="l536"><pre>                  Copy_range (source, <a href="src_unzip-decompress.adb.html#l107" title="defined at unzip-decompress.adb:107:34">index</a>, part); </pre></li>
<li id="l537"><pre>               <span class="keyword">end</span> <span class="keyword">if</span>; </pre></li>
<li id="l538"><pre>               <span class="droplink">Flush_if_full<ul><li><a href="src_unzip-decompress.adb.html#l96" title="To spec">To spec</a></li><li><a href="src_unzip-decompress.adb.html#l405" title="To body">To body</a></li></ul></span> (<a href="src_unzip-decompress.adb.html#l107" title="defined at unzip-decompress.adb:107:34">index</a>, <a href="src_unzip-decompress.adb.html#l108" title="defined at unzip-decompress.adb:108:34">unflushed</a>); </pre></li>
<li id="l539"><pre>               <span class="keyword">exit</span> <span class="keyword">when</span> remain = 0; </pre></li>
<li id="l540"><pre>            <span class="keyword">end</span> <span class="keyword">loop</span>; </pre></li>
<li id="l541"><pre>         <span class="keyword">end</span> <span class="droplink">Copy_or_zero<ul><li><a href="src_unzip-decompress.adb.html#l106" title="To spec">To spec</a></li><li><a href="src_unzip-decompress.adb.html#l520" title="To body">To body</a></li></ul></span>; </pre></li>
<li id="l542"><pre> </pre></li>
<li id="l543"><pre>         <span class="keyword">procedure</span> <a href="src_unzip-decompress.adb.html#l111" title="defined at unzip-decompress.adb:111:20">Delete_output</a> <span class="keyword">is</span> <span class="comment">-- an error has occured (bad compressed data)</span> </pre></li>
<li id="l544"><pre>         <span class="keyword">begin</span> </pre></li>
<li id="l545"><pre>            <span class="keyword">if</span> <span class="droplink">no_trace<ul><li><a href="unzip-decompress.ads.html#unzip-decompress.ads:49:3" title="To API doc">To API doc</a></li><li><a href="src_unzip-decompress.ads.html#l49" title="To spec">To spec</a></li></ul></span> <span class="keyword">then</span> <span class="comment">-- if there is a trace, we are debugging</span> </pre></li>
<li id="l546"><pre>               <span class="keyword">case</span> <span class="droplink">mode<ul><li><a href="unzip-decompress.ads.html#unzip-decompress.ads:25:5" title="To API doc">To API doc</a></li><li><a href="src_unzip-decompress.ads.html#l25" title="To spec">To spec</a></li><li><a href="src_unzip-decompress.adb.html#l10" title="To body">To body</a></li></ul></span> <span class="keyword">is</span>   <span class="comment">--  and want to keep the malformed file</span> </pre></li>
<li id="l547"><pre>               <span class="keyword">when</span> write_to_binary_file =&gt; </pre></li>
<li id="l548"><pre>                  Ada.Streams.Stream_IO.Delete (<a href="src_unzip-decompress.adb.html#l57" title="defined at unzip-decompress.adb:57:10">UnZ_IO.out_bin_file</a>); </pre></li>
<li id="l549"><pre>               <span class="keyword">when</span> write_to_text_file =&gt; </pre></li>
<li id="l550"><pre>                  Ada.Text_IO.Delete (<a href="src_unzip-decompress.adb.html#l58" title="defined at unzip-decompress.adb:58:10">UnZ_IO.out_txt_file</a>); </pre></li>
<li id="l551"><pre>               <span class="keyword">when</span> <span class="keyword">others</span> =&gt; </pre></li>
<li id="l552"><pre>                  <span class="keyword">null</span>; </pre></li>
<li id="l553"><pre>               <span class="keyword">end</span> <span class="keyword">case</span>; </pre></li>
<li id="l554"><pre>            <span class="keyword">end</span> <span class="keyword">if</span>; </pre></li>
<li id="l555"><pre>         <span class="keyword">end</span> <span class="droplink">Delete_output<ul><li><a href="src_unzip-decompress.adb.html#l111" title="To spec">To spec</a></li><li><a href="src_unzip-decompress.adb.html#l543" title="To body">To body</a></li></ul></span>; </pre></li>
<li id="l556"><pre> </pre></li>
<li id="l557"><pre>      <span class="keyword">end</span> <span class="droplink">UnZ_IO<ul><li><a href="src_unzip-decompress.adb.html#l56" title="To spec">To spec</a></li><li><a href="src_unzip-decompress.adb.html#l129" title="To body">To body</a></li></ul></span>; </pre></li>
<li id="l558"><pre> </pre></li>
<li id="l559"><pre>      <span class="keyword">package</span> <span class="keyword">body</span> <a href="src_unzip-decompress.adb.html#l115" title="defined at unzip-decompress.adb:115:15">UnZ_Meth</a> <span class="keyword">is</span> </pre></li>
<li id="l560"><pre> </pre></li>
<li id="l561"><pre>         <span class="comment">--------[ Method : Unshrink ] --------</span> </pre></li>
<li id="l562"><pre> </pre></li>
<li id="l563"><pre>         <span class="comment">-- Original in Pascal written by Christian Ghisler.</span> </pre></li>
<li id="l564"><pre> </pre></li>
<li id="l565"><pre>         Max_Code   : <span class="keyword">constant</span> := 8192; </pre></li>
<li id="l566"><pre>         Max_Stack  : <span class="keyword">constant</span> := 8192; </pre></li>
<li id="l567"><pre>         Initial_Code_Size  : <span class="keyword">constant</span> := 9; </pre></li>
<li id="l568"><pre>         Maximum_Code_Size  : <span class="keyword">constant</span> := 13; </pre></li>
<li id="l569"><pre>         First_Entry        : <span class="keyword">constant</span> := 257; </pre></li>
<li id="l570"><pre> </pre></li>
<li id="l571"><pre>         <span class="comment">-- Rest of slide=write buffer =766 bytes</span> </pre></li>
<li id="l572"><pre> </pre></li>
<li id="l573"><pre>         Write_Max  : <span class="keyword">constant</span> := <a href="src_unzip-decompress.adb.html#l31" title="defined at unzip-decompress.adb:31:7">wsize</a> - 3 * (Max_Code - 256) - Max_Stack - 2; </pre></li>
<li id="l574"><pre> </pre></li>
<li id="l575"><pre>         Previous_Code : <span class="keyword">array</span> (First_Entry .. Max_Code) <span class="keyword">of</span> Integer; </pre></li>
<li id="l576"><pre>         Actual_Code   : <span class="keyword">array</span> (First_Entry .. Max_Code) <span class="keyword">of</span> <span class="droplink">Zip.Byte<ul><li><a href="zip.ads.html#zip.ads:218:11" title="To API doc">To API doc</a></li><li><a href="src_zip.ads.html#l218" title="To spec">To spec</a></li></ul></span>; </pre></li>
<li id="l577"><pre> </pre></li>
<li id="l578"><pre>         Next_Free  : Integer;      <span class="comment">-- Next free code in trie</span> </pre></li>
<li id="l579"><pre>         Write_Ptr  : Integer;      <span class="comment">-- Pointer to output buffer</span> </pre></li>
<li id="l580"><pre> </pre></li>
<li id="l581"><pre>         Writebuf  : <span class="droplink">Zip.Byte_Buffer<ul><li><a href="zip.ads.html#zip.ads:219:8" title="To API doc">To API doc</a></li><li><a href="src_zip.ads.html#l219" title="To spec">To spec</a></li></ul></span> (0 .. Write_Max);  <span class="comment">-- Write buffer</span> </pre></li>
<li id="l582"><pre> </pre></li>
<li id="l583"><pre>         <span class="keyword">procedure</span> Unshrink_Flush <span class="keyword">is</span> </pre></li>
<li id="l584"><pre>            <span class="keyword">use</span> <span class="droplink">Zip<ul><li><a href="zip.ads.html#zip.ads:45:9" title="To API doc">To API doc</a></li><li><a href="src_zip.ads.html#l45" title="To spec">To spec</a></li><li><a href="src_zip.adb.html#l9" title="To body">To body</a></li></ul></span>, <span class="droplink">UnZip<ul><li><a href="unzip.ads.html#unzip.ads:53:9" title="To API doc">To API doc</a></li><li><a href="src_unzip.ads.html#l53" title="To spec">To spec</a></li><li><a href="src_unzip.adb.html#l6" title="To body">To body</a></li></ul></span>, Ada.Streams, Ada.Streams.Stream_IO; </pre></li>
<li id="l585"><pre>            user_aborting : Boolean; </pre></li>
<li id="l586"><pre>         <span class="keyword">begin</span> </pre></li>
<li id="l587"><pre>            <span class="keyword">if</span> <span class="droplink">full_trace<ul><li><a href="unzip-decompress.ads.html#unzip-decompress.ads:51:3" title="To API doc">To API doc</a></li><li><a href="src_unzip-decompress.ads.html#l51" title="To spec">To spec</a></li></ul></span> <span class="keyword">then</span> </pre></li>
<li id="l588"><pre>               <span class="keyword">pragma</span> Warnings (Off, <span class="string">&quot;this code can never be executed and has been deleted&quot;</span>); </pre></li>
<li id="l589"><pre>               Ada.Text_IO.Put (<span class="string">&quot;[Unshrink_Flush]&quot;</span>); </pre></li>
<li id="l590"><pre>               <span class="keyword">pragma</span> Warnings (On,  <span class="string">&quot;this code can never be executed and has been deleted&quot;</span>); </pre></li>
<li id="l591"><pre>            <span class="keyword">end</span> <span class="keyword">if</span>; </pre></li>
<li id="l592"><pre>            <span class="keyword">begin</span> </pre></li>
<li id="l593"><pre>               <span class="keyword">case</span> <span class="droplink">mode<ul><li><a href="unzip-decompress.ads.html#unzip-decompress.ads:25:5" title="To API doc">To API doc</a></li><li><a href="src_unzip-decompress.ads.html#l25" title="To spec">To spec</a></li><li><a href="src_unzip-decompress.adb.html#l10" title="To body">To body</a></li></ul></span> <span class="keyword">is</span> </pre></li>
<li id="l594"><pre>               <span class="keyword">when</span> write_to_binary_file =&gt; </pre></li>
<li id="l595"><pre>                  <span class="droplink">BlockWrite<ul><li><a href="zip.ads.html#zip.ads:244:14" title="To API doc">To API doc</a></li><li><a href="src_zip.ads.html#l244" title="To spec">To spec</a></li><li><a href="src_zip.adb.html#l653" title="To body">To body</a></li></ul></span> (Stream (<a href="src_unzip-decompress.adb.html#l57" title="defined at unzip-decompress.adb:57:10">UnZ_IO.out_bin_file</a>).<span class="keyword">all</span>, Writebuf (0 .. Write_Ptr - 1)); </pre></li>
<li id="l596"><pre>               <span class="keyword">when</span> write_to_text_file =&gt; </pre></li>
<li id="l597"><pre>                  <span class="droplink">Zip.Write_as_text<ul><li><a href="zip.ads.html#zip.ads:262:13" title="To API doc">To API doc</a></li><li><a href="src_zip.ads.html#l262" title="To spec">To spec</a></li><li><a href="src_zip.adb.html#l745" title="To body">To body</a></li></ul></span> (<a href="src_unzip-decompress.adb.html#l58" title="defined at unzip-decompress.adb:58:10">UnZ_IO.out_txt_file</a>, Writebuf (0 .. Write_Ptr - 1), <a href="src_unzip-decompress.adb.html#l59" title="defined at unzip-decompress.adb:59:10">UnZ_IO.last_char</a>); </pre></li>
<li id="l598"><pre>               <span class="keyword">when</span> write_to_memory =&gt; </pre></li>
<li id="l599"><pre>                  <span class="keyword">for</span> I <span class="keyword">in</span> 0 .. Write_Ptr - 1 <span class="keyword">loop</span> </pre></li>
<li id="l600"><pre>                     <span class="droplink">output_memory_access<ul><li><a href="unzip-decompress.ads.html#unzip-decompress.ads:27:5" title="To API doc">To API doc</a></li><li><a href="src_unzip-decompress.ads.html#l27" title="To spec">To spec</a></li></ul></span>.<span class="keyword">all</span> (<a href="src_unzip-decompress.adb.html#l53" title="defined at unzip-decompress.adb:53:10">UnZ_Glob.uncompressed_index</a>) := </pre></li>
<li id="l601"><pre>                       Stream_Element (Writebuf (I)); </pre></li>
<li id="l602"><pre>                     <a href="src_unzip-decompress.adb.html#l53" title="defined at unzip-decompress.adb:53:10">UnZ_Glob.uncompressed_index</a> :=  <a href="src_unzip-decompress.adb.html#l53" title="defined at unzip-decompress.adb:53:10">UnZ_Glob.uncompressed_index</a> + 1; </pre></li>
<li id="l603"><pre>                  <span class="keyword">end</span> <span class="keyword">loop</span>; </pre></li>
<li id="l604"><pre>               <span class="keyword">when</span> just_test =&gt; </pre></li>
<li id="l605"><pre>                  <span class="keyword">null</span>; </pre></li>
<li id="l606"><pre>               <span class="keyword">end</span> <span class="keyword">case</span>; </pre></li>
<li id="l607"><pre>            <span class="keyword">exception</span> </pre></li>
<li id="l608"><pre>               <span class="keyword">when</span> <span class="keyword">others</span> =&gt; </pre></li>
<li id="l609"><pre>                  <span class="keyword">raise</span> <span class="droplink">UnZip.Write_Error<ul><li><a href="unzip.ads.html#unzip.ads:287:3" title="To API doc">To API doc</a></li><li><a href="src_unzip.ads.html#l287" title="To spec">To spec</a></li></ul></span>; </pre></li>
<li id="l610"><pre>            <span class="keyword">end</span>; </pre></li>
<li id="l611"><pre>            <span class="droplink">Zip.CRC.Update<ul><li><a href="zip-crc.ads.html#zip-crc.ads:11:13" title="To API doc">To API doc</a></li><li><a href="src_zip-crc.ads.html#l11" title="To spec">To spec</a></li><li><a href="src_zip-crc.adb.html#l25" title="To body">To body</a></li></ul></span> (<a href="src_unzip-decompress.adb.html#l51" title="defined at unzip-decompress.adb:51:10">UnZ_Glob.crc32val</a>, Writebuf (0 .. Write_Ptr - 1)); </pre></li>
<li id="l612"><pre>            <span class="keyword">if</span> <span class="droplink">feedback<ul><li><a href="unzip-decompress.ads.html#unzip-decompress.ads:28:5" title="To API doc">To API doc</a></li><li><a href="src_unzip-decompress.ads.html#l28" title="To spec">To spec</a></li></ul></span> /= <span class="keyword">null</span> <span class="keyword">then</span> <span class="comment">-- inform user</span> </pre></li>
<li id="l613"><pre>               <a href="src_unzip-decompress.adb.html#l49" title="defined at unzip-decompress.adb:49:10">UnZ_Glob.effective_writes</a> := </pre></li>
<li id="l614"><pre>                 <a href="src_unzip-decompress.adb.html#l49" title="defined at unzip-decompress.adb:49:10">UnZ_Glob.effective_writes</a> + <span class="droplink">File_size_type<ul><li><a href="unzip.ads.html#unzip.ads:190:11" title="To API doc">To API doc</a></li><li><a href="src_unzip.ads.html#l190" title="To spec">To spec</a></li></ul></span> (Write_Ptr); </pre></li>
<li id="l615"><pre>               <span class="droplink">feedback<ul><li><a href="unzip-decompress.ads.html#unzip-decompress.ads:28:5" title="To API doc">To API doc</a></li><li><a href="src_unzip-decompress.ads.html#l28" title="To spec">To spec</a></li></ul></span>.<span class="keyword">all</span> ( </pre></li>
<li id="l616"><pre>                             percents_done =&gt; Natural ( </pre></li>
<li id="l617"><pre>                                                       (100.0 * Float (<a href="src_unzip-decompress.adb.html#l49" title="defined at unzip-decompress.adb:49:10">UnZ_Glob.effective_writes</a>)) / </pre></li>
<li id="l618"><pre>                                                         Float (<a href="src_unzip-decompress.adb.html#l48" title="defined at unzip-decompress.adb:48:10">UnZ_Glob.uncompsize</a>) </pre></li>
<li id="l619"><pre>                                                      ), </pre></li>
<li id="l620"><pre>                             entry_skipped =&gt; False, </pre></li>
<li id="l621"><pre>                             user_abort    =&gt; user_aborting); </pre></li>
<li id="l622"><pre>               <span class="keyword">if</span> user_aborting <span class="keyword">then</span> </pre></li>
<li id="l623"><pre>                  <span class="keyword">raise</span> <span class="droplink">User_abort<ul><li><a href="unzip.ads.html#unzip.ads:290:3" title="To API doc">To API doc</a></li><li><a href="src_unzip.ads.html#l290" title="To spec">To spec</a></li></ul></span>; </pre></li>
<li id="l624"><pre>               <span class="keyword">end</span> <span class="keyword">if</span>; </pre></li>
<li id="l625"><pre>            <span class="keyword">end</span> <span class="keyword">if</span>; </pre></li>
<li id="l626"><pre>         <span class="keyword">end</span> Unshrink_Flush; </pre></li>
<li id="l627"><pre> </pre></li>
<li id="l628"><pre>         <span class="keyword">procedure</span> Write_Byte (B : <span class="droplink">Zip.Byte<ul><li><a href="zip.ads.html#zip.ads:218:11" title="To API doc">To API doc</a></li><li><a href="src_zip.ads.html#l218" title="To spec">To spec</a></li></ul></span>) <span class="keyword">is</span> </pre></li>
<li id="l629"><pre>         <span class="keyword">begin</span> </pre></li>
<li id="l630"><pre>            Writebuf (Write_Ptr) := B; </pre></li>
<li id="l631"><pre>            Write_Ptr := Write_Ptr + 1; </pre></li>
<li id="l632"><pre>            <span class="keyword">if</span> Write_Ptr &gt; Write_Max <span class="keyword">then</span> </pre></li>
<li id="l633"><pre>               Unshrink_Flush; </pre></li>
<li id="l634"><pre>               Write_Ptr := 0; </pre></li>
<li id="l635"><pre>            <span class="keyword">end</span> <span class="keyword">if</span>; </pre></li>
<li id="l636"><pre>         <span class="keyword">end</span> Write_Byte; </pre></li>
<li id="l637"><pre> </pre></li>
<li id="l638"><pre>         <span class="keyword">procedure</span> Clear_Leaf_Nodes <span class="keyword">is</span> </pre></li>
<li id="l639"><pre>            Pc            : Integer;  <span class="comment">-- previous code</span> </pre></li>
<li id="l640"><pre>            Act_Max_Code  : Integer;  <span class="comment">-- max code to be searched for leaf nodes</span> </pre></li>
<li id="l641"><pre> </pre></li>
<li id="l642"><pre>         <span class="keyword">begin</span> </pre></li>
<li id="l643"><pre>            Act_Max_Code := Next_Free - 1; </pre></li>
<li id="l644"><pre>            <span class="keyword">for</span> I <span class="keyword">in</span> First_Entry .. Act_Max_Code <span class="keyword">loop</span> </pre></li>
<li id="l645"><pre>               Previous_Code (I) := </pre></li>
<li id="l646"><pre>                 Integer (Unsigned_32 (Previous_Code (I)) <span class="keyword">or</span> 16#8000#); </pre></li>
<li id="l647"><pre>            <span class="keyword">end</span> <span class="keyword">loop</span>; </pre></li>
<li id="l648"><pre> </pre></li>
<li id="l649"><pre>            <span class="keyword">for</span> I <span class="keyword">in</span> First_Entry .. Act_Max_Code <span class="keyword">loop</span> </pre></li>
<li id="l650"><pre>               Pc := Previous_Code (I) <span class="keyword">mod</span> 16#8000#; </pre></li>
<li id="l651"><pre>               <span class="keyword">if</span>  Pc &gt; 256 <span class="keyword">then</span> </pre></li>
<li id="l652"><pre>                  Previous_Code (Pc) := Previous_Code (Pc) <span class="keyword">mod</span> 16#8000#; </pre></li>
<li id="l653"><pre>               <span class="keyword">end</span> <span class="keyword">if</span>; </pre></li>
<li id="l654"><pre>            <span class="keyword">end</span> <span class="keyword">loop</span>; </pre></li>
<li id="l655"><pre> </pre></li>
<li id="l656"><pre>            <span class="comment">-- Build new free list</span> </pre></li>
<li id="l657"><pre>            Pc := -1; </pre></li>
<li id="l658"><pre>            Next_Free := -1; </pre></li>
<li id="l659"><pre>            <span class="keyword">for</span> I <span class="keyword">in</span> First_Entry .. Act_Max_Code <span class="keyword">loop</span> </pre></li>
<li id="l660"><pre>               <span class="comment">-- Either free before or marked now</span> </pre></li>
<li id="l661"><pre>               <span class="keyword">if</span> (Unsigned_32 (Previous_Code (I)) <span class="keyword">and</span> 16#C000#)  /= 0 <span class="keyword">then</span> </pre></li>
<li id="l662"><pre>                  <span class="comment">-- Link last item to this item</span> </pre></li>
<li id="l663"><pre>                  <span class="keyword">if</span> Pc = -1 <span class="keyword">then</span> </pre></li>
<li id="l664"><pre>                     Next_Free := I; </pre></li>
<li id="l665"><pre>                  <span class="keyword">else</span> </pre></li>
<li id="l666"><pre>                     Previous_Code (Pc) := -I; </pre></li>
<li id="l667"><pre>                  <span class="keyword">end</span> <span class="keyword">if</span>; </pre></li>
<li id="l668"><pre>                  Pc := I; </pre></li>
<li id="l669"><pre>               <span class="keyword">end</span> <span class="keyword">if</span>; </pre></li>
<li id="l670"><pre>            <span class="keyword">end</span> <span class="keyword">loop</span>; </pre></li>
<li id="l671"><pre> </pre></li>
<li id="l672"><pre>            <span class="keyword">if</span> Pc /= -1 <span class="keyword">then</span> </pre></li>
<li id="l673"><pre>               Previous_Code (Pc) := -Act_Max_Code - 1; </pre></li>
<li id="l674"><pre>            <span class="keyword">end</span> <span class="keyword">if</span>; </pre></li>
<li id="l675"><pre> </pre></li>
<li id="l676"><pre>         <span class="keyword">end</span> Clear_Leaf_Nodes; </pre></li>
<li id="l677"><pre> </pre></li>
<li id="l678"><pre>         <span class="keyword">procedure</span> <a href="src_unzip-decompress.adb.html#l117" title="defined at unzip-decompress.adb:117:20">Unshrink</a> <span class="keyword">is</span> </pre></li>
<li id="l679"><pre>            Incode       : Integer;  <span class="comment">-- Code read in</span> </pre></li>
<li id="l680"><pre>            Last_Incode  : Integer; </pre></li>
<li id="l681"><pre>            Last_Outcode : <span class="droplink">Zip.Byte<ul><li><a href="zip.ads.html#zip.ads:218:11" title="To API doc">To API doc</a></li><li><a href="src_zip.ads.html#l218" title="To spec">To spec</a></li></ul></span>; </pre></li>
<li id="l682"><pre>            Code_Size    : Integer := Initial_Code_Size; <span class="comment">-- Actual code size (9 .. 13)</span> </pre></li>
<li id="l683"><pre>            Stack        : <span class="droplink">Zip.Byte_Buffer<ul><li><a href="zip.ads.html#zip.ads:219:8" title="To API doc">To API doc</a></li><li><a href="src_zip.ads.html#l219" title="To spec">To spec</a></li></ul></span> (0 .. Max_Stack);  <span class="comment">-- Stack for output</span> </pre></li>
<li id="l684"><pre>            Stack_Ptr    : Integer := Max_Stack; </pre></li>
<li id="l685"><pre>            New_Code     : Integer;  <span class="comment">-- Save new normal code read</span> </pre></li>
<li id="l686"><pre> </pre></li>
<li id="l687"><pre>            Code_for_Special   : <span class="keyword">constant</span> := 256; </pre></li>
<li id="l688"><pre>            Code_Increase_size : <span class="keyword">constant</span> := 1; </pre></li>
<li id="l689"><pre>            Code_Clear_table   : <span class="keyword">constant</span> := 2; </pre></li>
<li id="l690"><pre> </pre></li>
<li id="l691"><pre>            S : <span class="droplink">UnZip.File_size_type<ul><li><a href="unzip.ads.html#unzip.ads:190:11" title="To API doc">To API doc</a></li><li><a href="src_unzip.ads.html#l190" title="To spec">To spec</a></li></ul></span> := <a href="src_unzip-decompress.adb.html#l48" title="defined at unzip-decompress.adb:48:10">UnZ_Glob.uncompsize</a>; </pre></li>
<li id="l692"><pre>            <span class="comment">-- Fix Jan - 2009 : replaces a remaining bits counter as Unsigned_*32* .. .</span> </pre></li>
<li id="l693"><pre> </pre></li>
<li id="l694"><pre>            <span class="keyword">procedure</span> Read_Code <span class="keyword">is</span> </pre></li>
<li id="l695"><pre>               <span class="keyword">pragma</span> Inline (Read_Code); </pre></li>
<li id="l696"><pre>            <span class="keyword">begin</span> </pre></li>
<li id="l697"><pre>               Incode := <span class="droplink">UnZ_IO.Bit_buffer.Read_and_dump<ul><li><a href="src_unzip-decompress.adb.html#l88" title="To spec">To spec</a></li><li><a href="src_unzip-decompress.adb.html#l334" title="To body">To body</a></li></ul></span> (Code_Size); </pre></li>
<li id="l698"><pre>            <span class="keyword">end</span> Read_Code; </pre></li>
<li id="l699"><pre> </pre></li>
<li id="l700"><pre>         <span class="keyword">begin</span> </pre></li>
<li id="l701"><pre>            Previous_Code := (<span class="keyword">others</span> =&gt; 0); </pre></li>
<li id="l702"><pre>            Actual_Code  := (<span class="keyword">others</span> =&gt; 0); </pre></li>
<li id="l703"><pre>            Stack        := (<span class="keyword">others</span> =&gt; 0); </pre></li>
<li id="l704"><pre>            Writebuf     := (<span class="keyword">others</span> =&gt; 0); </pre></li>
<li id="l705"><pre> </pre></li>
<li id="l706"><pre>            <span class="keyword">if</span> <a href="src_unzip-decompress.adb.html#l46" title="defined at unzip-decompress.adb:46:10">UnZ_Glob.compsize</a> = Unsigned_32&apos;Last <span class="keyword">then</span> </pre></li>
<li id="l707"><pre>               <span class="comment">-- Compressed Size was not in header!</span> </pre></li>
<li id="l708"><pre>               <span class="keyword">raise</span> <span class="droplink">UnZip.Not_supported<ul><li><a href="unzip.ads.html#unzip.ads:291:3" title="To API doc">To API doc</a></li><li><a href="src_unzip.ads.html#l291" title="To spec">To spec</a></li></ul></span>; </pre></li>
<li id="l709"><pre>            <span class="keyword">elsif</span> <a href="src_unzip-decompress.adb.html#l48" title="defined at unzip-decompress.adb:48:10">UnZ_Glob.uncompsize</a> = 0 <span class="keyword">then</span> </pre></li>
<li id="l710"><pre>               <span class="keyword">return</span>; <span class="comment">-- compression of a 0 - file with Shrink.pas</span> </pre></li>
<li id="l711"><pre>            <span class="keyword">end</span> <span class="keyword">if</span>; </pre></li>
<li id="l712"><pre> </pre></li>
<li id="l713"><pre>            <span class="comment">-- initialize free codes list</span> </pre></li>
<li id="l714"><pre> </pre></li>
<li id="l715"><pre>            <span class="keyword">for</span> I <span class="keyword">in</span> Previous_Code&apos;Range <span class="keyword">loop</span> </pre></li>
<li id="l716"><pre>               Previous_Code (I) := -(I + 1); </pre></li>
<li id="l717"><pre>            <span class="keyword">end</span> <span class="keyword">loop</span>; </pre></li>
<li id="l718"><pre> </pre></li>
<li id="l719"><pre>            Next_Free := First_Entry; </pre></li>
<li id="l720"><pre>            Write_Ptr := 0; </pre></li>
<li id="l721"><pre> </pre></li>
<li id="l722"><pre>            Read_Code; </pre></li>
<li id="l723"><pre>            Last_Incode  := Incode; </pre></li>
<li id="l724"><pre>            Last_Outcode := <span class="droplink">Zip.Byte<ul><li><a href="zip.ads.html#zip.ads:218:11" title="To API doc">To API doc</a></li><li><a href="src_zip.ads.html#l218" title="To spec">To spec</a></li></ul></span> (Incode); </pre></li>
<li id="l725"><pre>            Write_Byte (Last_Outcode); </pre></li>
<li id="l726"><pre>            S := S - 1; </pre></li>
<li id="l727"><pre> </pre></li>
<li id="l728"><pre>            <span class="keyword">while</span> S &gt; 0 <span class="keyword">and</span> <span class="keyword">then</span> <span class="keyword">not</span> <a href="src_unzip-decompress.adb.html#l52" title="defined at unzip-decompress.adb:52:10">UnZ_Glob.Zip_EOF</a> <span class="keyword">loop</span> </pre></li>
<li id="l729"><pre>               Read_Code; </pre></li>
<li id="l730"><pre>               <span class="keyword">if</span> Incode = Code_for_Special <span class="keyword">then</span> </pre></li>
<li id="l731"><pre>                  Read_Code; </pre></li>
<li id="l732"><pre>                  <span class="keyword">case</span> Incode <span class="keyword">is</span> </pre></li>
<li id="l733"><pre>                  <span class="keyword">when</span> Code_Increase_size =&gt; </pre></li>
<li id="l734"><pre>                     Code_Size := Code_Size + 1; </pre></li>
<li id="l735"><pre>                     <span class="keyword">if</span> <span class="droplink">some_trace<ul><li><a href="unzip-decompress.ads.html#unzip-decompress.ads:50:3" title="To API doc">To API doc</a></li><li><a href="src_unzip-decompress.ads.html#l50" title="To spec">To spec</a></li></ul></span> <span class="keyword">then</span> </pre></li>
<li id="l736"><pre>                        <span class="keyword">pragma</span> Warnings (Off, <span class="string">&quot;this code can never be executed and has been deleted&quot;</span>); </pre></li>
<li id="l737"><pre>                        Ada.Text_IO.Put ( </pre></li>
<li id="l738"><pre>                                         <span class="string">&quot;[LZW code size - &gt;&quot;</span> &amp; Integer&apos;Image (Code_Size) &amp; <span class="string">&apos;]&apos;</span> </pre></li>
<li id="l739"><pre>                                        ); </pre></li>
<li id="l740"><pre>                        <span class="keyword">pragma</span> Warnings (On,  <span class="string">&quot;this code can never be executed and has been deleted&quot;</span>); </pre></li>
<li id="l741"><pre>                     <span class="keyword">end</span> <span class="keyword">if</span>; </pre></li>
<li id="l742"><pre>                     <span class="keyword">if</span>  Code_Size &gt; Maximum_Code_Size <span class="keyword">then</span> </pre></li>
<li id="l743"><pre>                        <span class="keyword">raise</span> <span class="droplink">Zip.Zip_file_Error<ul><li><a href="zip.ads.html#zip.ads:72:3" title="To API doc">To API doc</a></li><li><a href="src_zip.ads.html#l72" title="To spec">To spec</a></li></ul></span>; </pre></li>
<li id="l744"><pre>                     <span class="keyword">end</span> <span class="keyword">if</span>; </pre></li>
<li id="l745"><pre>                  <span class="keyword">when</span> Code_Clear_table =&gt; </pre></li>
<li id="l746"><pre>                     Clear_Leaf_Nodes; </pre></li>
<li id="l747"><pre>                  <span class="keyword">when</span> <span class="keyword">others</span> =&gt; </pre></li>
<li id="l748"><pre>                     <span class="keyword">raise</span> <span class="droplink">Zip.Zip_file_Error<ul><li><a href="zip.ads.html#zip.ads:72:3" title="To API doc">To API doc</a></li><li><a href="src_zip.ads.html#l72" title="To spec">To spec</a></li></ul></span>; </pre></li>
<li id="l749"><pre>                  <span class="keyword">end</span> <span class="keyword">case</span>; </pre></li>
<li id="l750"><pre> </pre></li>
<li id="l751"><pre>               <span class="keyword">else</span> <span class="comment">-- Normal code</span> </pre></li>
<li id="l752"><pre>                  New_Code := Incode; </pre></li>
<li id="l753"><pre>                  <span class="keyword">if</span> Incode &lt; 256 <span class="keyword">then</span>          <span class="comment">-- Simple char</span> </pre></li>
<li id="l754"><pre>                     Last_Outcode :=  <span class="droplink">Zip.Byte<ul><li><a href="zip.ads.html#zip.ads:218:11" title="To API doc">To API doc</a></li><li><a href="src_zip.ads.html#l218" title="To spec">To spec</a></li></ul></span> (Incode); </pre></li>
<li id="l755"><pre>                     Write_Byte (Last_Outcode); </pre></li>
<li id="l756"><pre>                     S := S - 1; </pre></li>
<li id="l757"><pre>                  <span class="keyword">else</span> </pre></li>
<li id="l758"><pre>                     <span class="keyword">if</span> Previous_Code (Incode) &lt; 0 <span class="keyword">then</span> </pre></li>
<li id="l759"><pre>                        Stack (Stack_Ptr) := Last_Outcode; </pre></li>
<li id="l760"><pre>                        Stack_Ptr := Stack_Ptr - 1; </pre></li>
<li id="l761"><pre>                        Incode := Last_Incode; </pre></li>
<li id="l762"><pre>                     <span class="keyword">end</span> <span class="keyword">if</span>; </pre></li>
<li id="l763"><pre>                     <span class="keyword">while</span> Incode &gt; 256 <span class="keyword">loop</span> </pre></li>
<li id="l764"><pre>                        <span class="comment">-- Test added 11 - Dec - 2007 for situations</span> </pre></li>
<li id="l765"><pre>                        <span class="comment">--     happening on corrupt files:</span> </pre></li>
<li id="l766"><pre>                        <span class="keyword">if</span> Stack_Ptr &lt; Stack&apos;First <span class="keyword">or</span> <span class="keyword">else</span> </pre></li>
<li id="l767"><pre>                          Incode &gt; Actual_Code&apos;Last </pre></li>
<li id="l768"><pre>                        <span class="keyword">then</span> </pre></li>
<li id="l769"><pre>                           <span class="keyword">raise</span> <span class="droplink">Zip.Zip_file_Error<ul><li><a href="zip.ads.html#zip.ads:72:3" title="To API doc">To API doc</a></li><li><a href="src_zip.ads.html#l72" title="To spec">To spec</a></li></ul></span>; </pre></li>
<li id="l770"><pre>                        <span class="keyword">end</span> <span class="keyword">if</span>; </pre></li>
<li id="l771"><pre>                        Stack (Stack_Ptr) := Actual_Code (Incode); </pre></li>
<li id="l772"><pre>                        Stack_Ptr := Stack_Ptr - 1; </pre></li>
<li id="l773"><pre>                        Incode := Previous_Code (Incode); </pre></li>
<li id="l774"><pre>                     <span class="keyword">end</span> <span class="keyword">loop</span>; </pre></li>
<li id="l775"><pre> </pre></li>
<li id="l776"><pre>                     Last_Outcode := <span class="droplink">Zip.Byte<ul><li><a href="zip.ads.html#zip.ads:218:11" title="To API doc">To API doc</a></li><li><a href="src_zip.ads.html#l218" title="To spec">To spec</a></li></ul></span> (Incode <span class="keyword">mod</span> 256); </pre></li>
<li id="l777"><pre>                     Write_Byte (Last_Outcode); </pre></li>
<li id="l778"><pre> </pre></li>
<li id="l779"><pre>                     <span class="keyword">for</span> I <span class="keyword">in</span> Stack_Ptr + 1 .. Max_Stack  <span class="keyword">loop</span> </pre></li>
<li id="l780"><pre>                        Write_Byte (Stack (I)); </pre></li>
<li id="l781"><pre>                     <span class="keyword">end</span> <span class="keyword">loop</span>; </pre></li>
<li id="l782"><pre>                     S := S - <span class="droplink">UnZip.File_size_type<ul><li><a href="unzip.ads.html#unzip.ads:190:11" title="To API doc">To API doc</a></li><li><a href="src_unzip.ads.html#l190" title="To spec">To spec</a></li></ul></span> (Max_Stack - Stack_Ptr + 1); </pre></li>
<li id="l783"><pre> </pre></li>
<li id="l784"><pre>                     Stack_Ptr := Max_Stack; </pre></li>
<li id="l785"><pre>                  <span class="keyword">end</span> <span class="keyword">if</span>; </pre></li>
<li id="l786"><pre>                  Incode := Next_Free; </pre></li>
<li id="l787"><pre>                  <span class="keyword">if</span> Incode &lt;= Max_Code <span class="keyword">then</span> </pre></li>
<li id="l788"><pre>                     Next_Free := -Previous_Code (Incode); </pre></li>
<li id="l789"><pre>                     <span class="comment">-- Next node in free list</span> </pre></li>
<li id="l790"><pre>                     Previous_Code (Incode) := Last_Incode; </pre></li>
<li id="l791"><pre>                     Actual_Code  (Incode) := Last_Outcode; </pre></li>
<li id="l792"><pre>                  <span class="keyword">end</span> <span class="keyword">if</span>; </pre></li>
<li id="l793"><pre>                  Last_Incode := New_Code; </pre></li>
<li id="l794"><pre>               <span class="keyword">end</span> <span class="keyword">if</span>; </pre></li>
<li id="l795"><pre>            <span class="keyword">end</span> <span class="keyword">loop</span>; </pre></li>
<li id="l796"><pre>            <span class="keyword">if</span> <span class="droplink">some_trace<ul><li><a href="unzip-decompress.ads.html#unzip-decompress.ads:50:3" title="To API doc">To API doc</a></li><li><a href="src_unzip-decompress.ads.html#l50" title="To spec">To spec</a></li></ul></span> <span class="keyword">then</span> </pre></li>
<li id="l797"><pre>               <span class="keyword">pragma</span> Warnings (Off, <span class="string">&quot;this code can never be executed and has been deleted&quot;</span>); </pre></li>
<li id="l798"><pre>               Ada.Text_IO.Put (<span class="string">&quot;[ Unshrink main loop finished ]&quot;</span>); </pre></li>
<li id="l799"><pre>               <span class="keyword">pragma</span> Warnings (On,  <span class="string">&quot;this code can never be executed and has been deleted&quot;</span>); </pre></li>
<li id="l800"><pre>            <span class="keyword">end</span> <span class="keyword">if</span>; </pre></li>
<li id="l801"><pre>            Unshrink_Flush; </pre></li>
<li id="l802"><pre>         <span class="keyword">end</span> <span class="droplink">Unshrink<ul><li><a href="src_unzip-decompress.adb.html#l117" title="To spec">To spec</a></li><li><a href="src_unzip-decompress.adb.html#l678" title="To body">To body</a></li></ul></span>; </pre></li>
<li id="l803"><pre> </pre></li>
<li id="l804"><pre>         <span class="comment">--------[ Method : Unreduce ] --------</span> </pre></li>
<li id="l805"><pre> </pre></li>
<li id="l806"><pre>         <span class="keyword">procedure</span> <a href="src_unzip-decompress.adb.html#l119" title="defined at unzip-decompress.adb:119:20">Unreduce</a> (<a href="src_unzip-decompress.adb.html#l119" title="defined at unzip-decompress.adb:119:30">factor</a> : <a href="src_unzip-decompress.adb.html#l118" title="defined at unzip-decompress.adb:118:18">Reduction_factor</a>) <span class="keyword">is</span> </pre></li>
<li id="l807"><pre> </pre></li>
<li id="l808"><pre>            <span class="comment">-- Original slide limit : 16#4000#</span> </pre></li>
<li id="l809"><pre>            DLE_code : <span class="keyword">constant</span> := 144; </pre></li>
<li id="l810"><pre>            <span class="keyword">subtype</span> Symbol_range <span class="keyword">is</span> Integer <span class="keyword">range</span> 0 .. 255; </pre></li>
<li id="l811"><pre>            <span class="keyword">subtype</span> Follower_range <span class="keyword">is</span> Integer <span class="keyword">range</span> 0 .. 63; <span class="comment">-- Appnote : &lt;= 32 !</span> </pre></li>
<li id="l812"><pre>            Followers : <span class="keyword">array</span> (Symbol_range, Follower_range) <span class="keyword">of</span> Symbol_range := </pre></li>
<li id="l813"><pre>              (<span class="keyword">others</span> =&gt; (<span class="keyword">others</span> =&gt; 0)); </pre></li>
<li id="l814"><pre>            Slen : <span class="keyword">array</span> (Symbol_range) <span class="keyword">of</span> Follower_range; </pre></li>
<li id="l815"><pre> </pre></li>
<li id="l816"><pre>            <span class="comment">-- Bits taken by (x - 1) mod 256:</span> </pre></li>
<li id="l817"><pre>            B_Table : <span class="keyword">constant</span> <span class="keyword">array</span> (Symbol_range) <span class="keyword">of</span> Integer := </pre></li>
<li id="l818"><pre>              (0      =&gt; 8, </pre></li>
<li id="l819"><pre>               1 .. 2   =&gt; 1, </pre></li>
<li id="l820"><pre>               3 .. 4   =&gt; 2, </pre></li>
<li id="l821"><pre>               5 .. 8   =&gt; 3, </pre></li>
<li id="l822"><pre>               9 .. 16  =&gt; 4, </pre></li>
<li id="l823"><pre>               17 .. 32  =&gt; 5, </pre></li>
<li id="l824"><pre>               33 .. 64  =&gt; 6, </pre></li>
<li id="l825"><pre>               65 .. 128 =&gt; 7, </pre></li>
<li id="l826"><pre>               129 .. 255 =&gt; 8); </pre></li>
<li id="l827"><pre> </pre></li>
<li id="l828"><pre>            <span class="keyword">procedure</span> LoadFollowers <span class="keyword">is</span> </pre></li>
<li id="l829"><pre>               list_followers : <span class="keyword">constant</span> Boolean := <span class="droplink">some_trace<ul><li><a href="unzip-decompress.ads.html#unzip-decompress.ads:50:3" title="To API doc">To API doc</a></li><li><a href="src_unzip-decompress.ads.html#l50" title="To spec">To spec</a></li></ul></span>; </pre></li>
<li id="l830"><pre>               <span class="keyword">procedure</span> Show_symbol (S : Symbol_range) <span class="keyword">is</span> </pre></li>
<li id="l831"><pre>               <span class="keyword">begin</span> </pre></li>
<li id="l832"><pre>                  <span class="keyword">if</span> S <span class="keyword">in</span> 32 .. 254 <span class="keyword">then</span> </pre></li>
<li id="l833"><pre>                     Ada.Text_IO.Put (Character&apos;Val (S)); </pre></li>
<li id="l834"><pre>                  <span class="keyword">else</span> </pre></li>
<li id="l835"><pre>                     Ada.Text_IO.Put (<span class="string">&apos;{&apos;</span> &amp; Symbol_range&apos;Image (S) &amp; <span class="string">&apos;}&apos;</span>); </pre></li>
<li id="l836"><pre>                  <span class="keyword">end</span> <span class="keyword">if</span>; </pre></li>
<li id="l837"><pre>               <span class="keyword">end</span> Show_symbol; </pre></li>
<li id="l838"><pre>            <span class="keyword">begin</span> </pre></li>
<li id="l839"><pre>               <span class="keyword">for</span> X <span class="keyword">in</span> <span class="keyword">reverse</span> Symbol_range <span class="keyword">loop</span> </pre></li>
<li id="l840"><pre>                  Slen (X) := <span class="droplink">UnZ_IO.Bit_buffer.Read_and_dump<ul><li><a href="src_unzip-decompress.adb.html#l88" title="To spec">To spec</a></li><li><a href="src_unzip-decompress.adb.html#l334" title="To body">To body</a></li></ul></span> (6); </pre></li>
<li id="l841"><pre>                  <span class="keyword">if</span> list_followers <span class="keyword">then</span> </pre></li>
<li id="l842"><pre>                     <span class="keyword">pragma</span> Warnings (Off, <span class="string">&quot;this code can never be executed and has been deleted&quot;</span>); </pre></li>
<li id="l843"><pre>                     Show_symbol (X); </pre></li>
<li id="l844"><pre>                     Ada.Text_IO.Put (<span class="string">&quot; - &gt; (&quot;</span> &amp; Integer&apos;Image (Slen (X)) &amp; <span class="string">&quot;) &quot;</span>); </pre></li>
<li id="l845"><pre>                     <span class="keyword">pragma</span> Warnings (On,  <span class="string">&quot;this code can never be executed and has been deleted&quot;</span>); </pre></li>
<li id="l846"><pre>                  <span class="keyword">end</span> <span class="keyword">if</span>; </pre></li>
<li id="l847"><pre>                  <span class="keyword">for</span> I <span class="keyword">in</span> 0 .. Slen (X) - 1  <span class="keyword">loop</span> </pre></li>
<li id="l848"><pre>                     Followers (X, I) := <span class="droplink">UnZ_IO.Bit_buffer.Read_and_dump<ul><li><a href="src_unzip-decompress.adb.html#l88" title="To spec">To spec</a></li><li><a href="src_unzip-decompress.adb.html#l334" title="To body">To body</a></li></ul></span> (8); </pre></li>
<li id="l849"><pre>                     <span class="keyword">if</span> list_followers <span class="keyword">then</span> </pre></li>
<li id="l850"><pre>                        <span class="keyword">pragma</span> Warnings (Off, <span class="string">&quot;this code can never be executed and has been deleted&quot;</span>); </pre></li>
<li id="l851"><pre>                        Show_symbol (Followers (X, I)); </pre></li>
<li id="l852"><pre>                        <span class="keyword">pragma</span> Warnings (On,  <span class="string">&quot;this code can never be executed and has been deleted&quot;</span>); </pre></li>
<li id="l853"><pre>                     <span class="keyword">end</span> <span class="keyword">if</span>; </pre></li>
<li id="l854"><pre>                  <span class="keyword">end</span> <span class="keyword">loop</span>; </pre></li>
<li id="l855"><pre>                  <span class="keyword">if</span> list_followers <span class="keyword">then</span> </pre></li>
<li id="l856"><pre>                     <span class="keyword">pragma</span> Warnings (Off, <span class="string">&quot;this code can never be executed and has been deleted&quot;</span>); </pre></li>
<li id="l857"><pre>                     Ada.Text_IO.New_Line; </pre></li>
<li id="l858"><pre>                     <span class="keyword">pragma</span> Warnings (On,  <span class="string">&quot;this code can never be executed and has been deleted&quot;</span>); </pre></li>
<li id="l859"><pre>                  <span class="keyword">end</span> <span class="keyword">if</span>; </pre></li>
<li id="l860"><pre>               <span class="keyword">end</span> <span class="keyword">loop</span>; </pre></li>
<li id="l861"><pre>            <span class="keyword">end</span> LoadFollowers; </pre></li>
<li id="l862"><pre> </pre></li>
<li id="l863"><pre>            unreduce_length, </pre></li>
<li id="l864"><pre>            char_read, </pre></li>
<li id="l865"><pre>            last_char : Integer := 0; </pre></li>
<li id="l866"><pre>            <span class="comment">-- ^ some := 0 are useless, just to calm down ObjectAda 7.2.2</span> </pre></li>
<li id="l867"><pre>            S : <span class="droplink">UnZip.File_size_type<ul><li><a href="unzip.ads.html#unzip.ads:190:11" title="To API doc">To API doc</a></li><li><a href="src_unzip.ads.html#l190" title="To spec">To spec</a></li></ul></span> := <a href="src_unzip-decompress.adb.html#l48" title="defined at unzip-decompress.adb:48:10">UnZ_Glob.uncompsize</a>; </pre></li>
<li id="l868"><pre>            <span class="comment">-- number of bytes left to decompress</span> </pre></li>
<li id="l869"><pre>            unflushed : Boolean := True; </pre></li>
<li id="l870"><pre>            maximum_AND_mask : <span class="keyword">constant</span> Unsigned_32 := Shift_Left (1, 8 - <a href="src_unzip-decompress.adb.html#l119" title="defined at unzip-decompress.adb:119:30">factor</a>) - 1; </pre></li>
<li id="l871"><pre> </pre></li>
<li id="l872"><pre>            <span class="keyword">procedure</span> Out_byte (b : <span class="droplink">Zip.Byte<ul><li><a href="zip.ads.html#zip.ads:218:11" title="To API doc">To API doc</a></li><li><a href="src_zip.ads.html#l218" title="To spec">To spec</a></li></ul></span>) <span class="keyword">is</span> </pre></li>
<li id="l873"><pre>            <span class="keyword">begin</span> </pre></li>
<li id="l874"><pre>               S := S - 1; </pre></li>
<li id="l875"><pre>               <a href="src_unzip-decompress.adb.html#l41" title="defined at unzip-decompress.adb:41:10">UnZ_Glob.slide</a> (<a href="src_unzip-decompress.adb.html#l42" title="defined at unzip-decompress.adb:42:10">UnZ_Glob.slide_index</a>) := b; </pre></li>
<li id="l876"><pre>               <a href="src_unzip-decompress.adb.html#l42" title="defined at unzip-decompress.adb:42:10">UnZ_Glob.slide_index</a> := <a href="src_unzip-decompress.adb.html#l42" title="defined at unzip-decompress.adb:42:10">UnZ_Glob.slide_index</a> + 1; </pre></li>
<li id="l877"><pre>               <span class="droplink">UnZ_IO.Flush_if_full<ul><li><a href="src_unzip-decompress.adb.html#l96" title="To spec">To spec</a></li><li><a href="src_unzip-decompress.adb.html#l405" title="To body">To body</a></li></ul></span> (<a href="src_unzip-decompress.adb.html#l42" title="defined at unzip-decompress.adb:42:10">UnZ_Glob.slide_index</a>, unflushed); </pre></li>
<li id="l878"><pre>            <span class="keyword">end</span> Out_byte; </pre></li>
<li id="l879"><pre> </pre></li>
<li id="l880"><pre>            V : Unsigned_32 := 0; </pre></li>
<li id="l881"><pre>            <span class="keyword">type</span> State_type <span class="keyword">is</span> (normal, length_a, length_b, distance); </pre></li>
<li id="l882"><pre>            state : State_type := normal; </pre></li>
<li id="l883"><pre> </pre></li>
<li id="l884"><pre>         <span class="keyword">begin</span> </pre></li>
<li id="l885"><pre>            LoadFollowers; </pre></li>
<li id="l886"><pre> </pre></li>
<li id="l887"><pre>            <span class="keyword">while</span> S &gt; 0 <span class="keyword">and</span> <span class="keyword">then</span> <span class="keyword">not</span> <a href="src_unzip-decompress.adb.html#l52" title="defined at unzip-decompress.adb:52:10">UnZ_Glob.Zip_EOF</a> <span class="keyword">loop</span> </pre></li>
<li id="l888"><pre> </pre></li>
<li id="l889"><pre>               <span class="comment">-- 1/ Probabilistic expansion</span> </pre></li>
<li id="l890"><pre>               <span class="keyword">if</span> Slen (last_char) = 0 <span class="keyword">then</span> </pre></li>
<li id="l891"><pre>                  <span class="comment">-- follower set is empty for this character</span> </pre></li>
<li id="l892"><pre>                  char_read := <span class="droplink">UnZ_IO.Bit_buffer.Read_and_dump<ul><li><a href="src_unzip-decompress.adb.html#l88" title="To spec">To spec</a></li><li><a href="src_unzip-decompress.adb.html#l334" title="To body">To body</a></li></ul></span> (8); </pre></li>
<li id="l893"><pre>               <span class="keyword">elsif</span> <span class="droplink">UnZ_IO.Bit_buffer.Read_and_dump<ul><li><a href="src_unzip-decompress.adb.html#l88" title="To spec">To spec</a></li><li><a href="src_unzip-decompress.adb.html#l334" title="To body">To body</a></li></ul></span> (1) = 0  <span class="keyword">then</span> </pre></li>
<li id="l894"><pre>                  char_read := Followers ( </pre></li>
<li id="l895"><pre>                                          last_char, </pre></li>
<li id="l896"><pre>                                          <span class="droplink">UnZ_IO.Bit_buffer.Read_and_dump<ul><li><a href="src_unzip-decompress.adb.html#l88" title="To spec">To spec</a></li><li><a href="src_unzip-decompress.adb.html#l334" title="To body">To body</a></li></ul></span> (B_Table (Slen (last_char))) </pre></li>
<li id="l897"><pre>                                         ); </pre></li>
<li id="l898"><pre>               <span class="keyword">else</span> </pre></li>
<li id="l899"><pre>                  char_read := <span class="droplink">UnZ_IO.Bit_buffer.Read_and_dump<ul><li><a href="src_unzip-decompress.adb.html#l88" title="To spec">To spec</a></li><li><a href="src_unzip-decompress.adb.html#l334" title="To body">To body</a></li></ul></span> (8); </pre></li>
<li id="l900"><pre>               <span class="keyword">end</span> <span class="keyword">if</span>; </pre></li>
<li id="l901"><pre> </pre></li>
<li id="l902"><pre>               <span class="comment">-- 2/ Expand the resulting Zip.Byte into repeated sequences</span> </pre></li>
<li id="l903"><pre>               <span class="keyword">case</span> state <span class="keyword">is</span> </pre></li>
<li id="l904"><pre> </pre></li>
<li id="l905"><pre>               <span class="keyword">when</span> normal =&gt; </pre></li>
<li id="l906"><pre>                  <span class="keyword">if</span> char_read = DLE_code <span class="keyword">then</span> </pre></li>
<li id="l907"><pre>                     <span class="comment">-- &gt;&gt; Next will be a DLE</span> </pre></li>
<li id="l908"><pre>                     state := length_a; </pre></li>
<li id="l909"><pre>                  <span class="keyword">else</span> </pre></li>
<li id="l910"><pre>                     <span class="comment">-- &gt;&gt; A single char</span> </pre></li>
<li id="l911"><pre>                     Out_byte (<span class="droplink">Zip.Byte<ul><li><a href="zip.ads.html#zip.ads:218:11" title="To API doc">To API doc</a></li><li><a href="src_zip.ads.html#l218" title="To spec">To spec</a></li></ul></span> (char_read)); </pre></li>
<li id="l912"><pre>                  <span class="keyword">end</span> <span class="keyword">if</span>; </pre></li>
<li id="l913"><pre> </pre></li>
<li id="l914"><pre>               <span class="keyword">when</span> length_a =&gt; </pre></li>
<li id="l915"><pre>                  <span class="keyword">if</span> char_read = 0 <span class="keyword">then</span> </pre></li>
<li id="l916"><pre>                     <span class="comment">-- &gt;&gt; DLE_code &amp; 0 - &gt; was just the Zip.Byte coded DLE_code</span> </pre></li>
<li id="l917"><pre>                     Out_byte (DLE_code); </pre></li>
<li id="l918"><pre>                     state := normal; </pre></li>
<li id="l919"><pre>                  <span class="keyword">else</span> </pre></li>
<li id="l920"><pre>                     V := Unsigned_32 (char_read); </pre></li>
<li id="l921"><pre>                     unreduce_length := Integer (V <span class="keyword">and</span> maximum_AND_mask); </pre></li>
<li id="l922"><pre>                     <span class="comment">-- The remaining bits of V will be used for the distance</span> </pre></li>
<li id="l923"><pre>                     <span class="keyword">if</span> unreduce_length = Integer (maximum_AND_mask) <span class="keyword">then</span> </pre></li>
<li id="l924"><pre>                        state := length_b; </pre></li>
<li id="l925"><pre>                        <span class="comment">-- &gt;&gt; length must be completed before reading distance</span> </pre></li>
<li id="l926"><pre>                     <span class="keyword">else</span> </pre></li>
<li id="l927"><pre>                        state := distance; </pre></li>
<li id="l928"><pre>                     <span class="keyword">end</span> <span class="keyword">if</span>; </pre></li>
<li id="l929"><pre>                  <span class="keyword">end</span> <span class="keyword">if</span>; </pre></li>
<li id="l930"><pre> </pre></li>
<li id="l931"><pre>               <span class="keyword">when</span> length_b =&gt; </pre></li>
<li id="l932"><pre>                  unreduce_length := unreduce_length + char_read; </pre></li>
<li id="l933"><pre>                  state := distance; </pre></li>
<li id="l934"><pre> </pre></li>
<li id="l935"><pre>               <span class="keyword">when</span> distance =&gt; </pre></li>
<li id="l936"><pre>                  unreduce_length := unreduce_length + 3; </pre></li>
<li id="l937"><pre>                  S := S - <span class="droplink">UnZip.File_size_type<ul><li><a href="unzip.ads.html#unzip.ads:190:11" title="To API doc">To API doc</a></li><li><a href="src_unzip.ads.html#l190" title="To spec">To spec</a></li></ul></span> (unreduce_length); </pre></li>
<li id="l938"><pre> </pre></li>
<li id="l939"><pre>                  <span class="droplink">UnZ_IO.Copy_or_zero<ul><li><a href="src_unzip-decompress.adb.html#l106" title="To spec">To spec</a></li><li><a href="src_unzip-decompress.adb.html#l520" title="To body">To body</a></li></ul></span> ( </pre></li>
<li id="l940"><pre>                                       <a href="src_unzip-decompress.adb.html#l106" title="defined at unzip-decompress.adb:106:34">distance</a>   =&gt; char_read + 1 + Integer (Shift_Right (V, 8 - <a href="src_unzip-decompress.adb.html#l119" title="defined at unzip-decompress.adb:119:30">factor</a>) * 2**8), </pre></li>
<li id="l941"><pre>                                       <a href="src_unzip-decompress.adb.html#l106" title="defined at unzip-decompress.adb:106:44">copy_length</a>     =&gt; unreduce_length, </pre></li>
<li id="l942"><pre>                                       <a href="src_unzip-decompress.adb.html#l107" title="defined at unzip-decompress.adb:107:34">index</a>      =&gt; <a href="src_unzip-decompress.adb.html#l42" title="defined at unzip-decompress.adb:42:10">UnZ_Glob.slide_index</a>, </pre></li>
<li id="l943"><pre>                                       <a href="src_unzip-decompress.adb.html#l108" title="defined at unzip-decompress.adb:108:34">unflushed</a>  =&gt; unflushed </pre></li>
<li id="l944"><pre>                                      ); </pre></li>
<li id="l945"><pre>                  state := normal; </pre></li>
<li id="l946"><pre> </pre></li>
<li id="l947"><pre>               <span class="keyword">end</span> <span class="keyword">case</span>; </pre></li>
<li id="l948"><pre> </pre></li>
<li id="l949"><pre>               last_char := char_read;  <span class="comment">-- store character for next iteration</span> </pre></li>
<li id="l950"><pre>            <span class="keyword">end</span> <span class="keyword">loop</span>; </pre></li>
<li id="l951"><pre> </pre></li>
<li id="l952"><pre>            <span class="droplink">UnZ_IO.Flush<ul><li><a href="src_unzip-decompress.adb.html#l94" title="To spec">To spec</a></li><li><a href="src_unzip-decompress.adb.html#l352" title="To body">To body</a></li></ul></span> (<a href="src_unzip-decompress.adb.html#l42" title="defined at unzip-decompress.adb:42:10">UnZ_Glob.slide_index</a>); </pre></li>
<li id="l953"><pre>         <span class="keyword">end</span> <span class="droplink">Unreduce<ul><li><a href="src_unzip-decompress.adb.html#l119" title="To spec">To spec</a></li><li><a href="src_unzip-decompress.adb.html#l806" title="To body">To body</a></li></ul></span>; </pre></li>
<li id="l954"><pre> </pre></li>
<li id="l955"><pre>         <span class="comment">--------[ Method : Explode ] --------</span> </pre></li>
<li id="l956"><pre> </pre></li>
<li id="l957"><pre>         <span class="comment">-- C code by info - zip group, translated to Pascal by Christian Ghisler</span> </pre></li>
<li id="l958"><pre>         <span class="comment">-- based on unz51g.zip</span> </pre></li>
<li id="l959"><pre> </pre></li>
<li id="l960"><pre>         <span class="keyword">use</span> <span class="droplink">UnZip.Decompress.Huffman<ul><li><a href="unzip-decompress-huffman.ads.html#unzip-decompress-huffman.ads:6:34" title="To API doc">To API doc</a></li><li><a href="src_unzip-decompress-huffman.ads.html#l6" title="To spec">To spec</a></li><li><a href="src_unzip-decompress-huffman.adb.html#l5" title="To body">To body</a></li></ul></span>; </pre></li>
<li id="l961"><pre> </pre></li>
<li id="l962"><pre>         <span class="keyword">procedure</span> Get_Tree (L : <span class="keyword">out</span> <span class="droplink">Length_array<ul><li><a href="unzip-decompress-huffman.ads.html#unzip-decompress-huffman.ads:34:8" title="To API doc">To API doc</a></li><li><a href="src_unzip-decompress-huffman.ads.html#l34" title="To spec">To spec</a></li></ul></span>) <span class="keyword">is</span> </pre></li>
<li id="l963"><pre>            I, K, J, B  : Unsigned_32; </pre></li>
<li id="l964"><pre>            N           : <span class="keyword">constant</span> Unsigned_32 := L&apos;Length; </pre></li>
<li id="l965"><pre>            L_Idx       : Integer    := L&apos;First; </pre></li>
<li id="l966"><pre>            Bytebuf     : <span class="droplink">Zip.Byte<ul><li><a href="zip.ads.html#zip.ads:218:11" title="To API doc">To API doc</a></li><li><a href="src_zip.ads.html#l218" title="To spec">To spec</a></li></ul></span>; </pre></li>
<li id="l967"><pre> </pre></li>
<li id="l968"><pre>         <span class="keyword">begin</span> </pre></li>
<li id="l969"><pre>            <span class="keyword">if</span> <span class="droplink">full_trace<ul><li><a href="unzip-decompress.ads.html#unzip-decompress.ads:51:3" title="To API doc">To API doc</a></li><li><a href="src_unzip-decompress.ads.html#l51" title="To spec">To spec</a></li></ul></span> <span class="keyword">then</span> </pre></li>
<li id="l970"><pre>               <span class="keyword">pragma</span> Warnings (Off, <span class="string">&quot;this code can never be executed and has been deleted&quot;</span>); </pre></li>
<li id="l971"><pre>               Ada.Text_IO.Put_Line (<span class="string">&quot;Begin UnZ_Expl.Get_tree&quot;</span>); </pre></li>
<li id="l972"><pre>               <span class="keyword">pragma</span> Warnings (On,  <span class="string">&quot;this code can never be executed and has been deleted&quot;</span>); </pre></li>
<li id="l973"><pre>            <span class="keyword">end</span> <span class="keyword">if</span>; </pre></li>
<li id="l974"><pre> </pre></li>
<li id="l975"><pre>            <span class="droplink">UnZ_IO.Read_raw_byte<ul><li><a href="src_unzip-decompress.adb.html#l71" title="To spec">To spec</a></li><li><a href="src_unzip-decompress.adb.html#l279" title="To body">To body</a></li></ul></span> (Bytebuf); </pre></li>
<li id="l976"><pre>            I := Unsigned_32 (Bytebuf) + 1; </pre></li>
<li id="l977"><pre>            K := 0; </pre></li>
<li id="l978"><pre> </pre></li>
<li id="l979"><pre>            <span class="keyword">loop</span> </pre></li>
<li id="l980"><pre>               <span class="droplink">UnZ_IO.Read_raw_byte<ul><li><a href="src_unzip-decompress.adb.html#l71" title="To spec">To spec</a></li><li><a href="src_unzip-decompress.adb.html#l279" title="To body">To body</a></li></ul></span> (Bytebuf); </pre></li>
<li id="l981"><pre>               J := Unsigned_32 (Bytebuf); </pre></li>
<li id="l982"><pre>               B := (J  <span class="keyword">and</span>  16#0F#) + 1; </pre></li>
<li id="l983"><pre>               J := (J  <span class="keyword">and</span>  16#F0#) / 16 + 1; </pre></li>
<li id="l984"><pre>               <span class="keyword">if</span>  K + J &gt; N <span class="keyword">then</span> </pre></li>
<li id="l985"><pre>                  <span class="keyword">raise</span> <span class="droplink">Zip.Zip_file_Error<ul><li><a href="zip.ads.html#zip.ads:72:3" title="To API doc">To API doc</a></li><li><a href="src_zip.ads.html#l72" title="To spec">To spec</a></li></ul></span>; </pre></li>
<li id="l986"><pre>               <span class="keyword">end</span> <span class="keyword">if</span>; </pre></li>
<li id="l987"><pre> </pre></li>
<li id="l988"><pre>               <span class="keyword">loop</span> </pre></li>
<li id="l989"><pre>                  L (L_Idx) := Natural (B); </pre></li>
<li id="l990"><pre>                  L_Idx := L_Idx + 1; </pre></li>
<li id="l991"><pre>                  K := K + 1; </pre></li>
<li id="l992"><pre>                  J := J - 1; </pre></li>
<li id="l993"><pre>                  <span class="keyword">exit</span> <span class="keyword">when</span>  J = 0; </pre></li>
<li id="l994"><pre>               <span class="keyword">end</span> <span class="keyword">loop</span>; </pre></li>
<li id="l995"><pre> </pre></li>
<li id="l996"><pre>               I := I - 1; </pre></li>
<li id="l997"><pre>               <span class="keyword">exit</span> <span class="keyword">when</span>  I = 0; </pre></li>
<li id="l998"><pre>            <span class="keyword">end</span> <span class="keyword">loop</span>; </pre></li>
<li id="l999"><pre> </pre></li>
<li id="l1000"><pre>            <span class="keyword">if</span>  K /= N <span class="keyword">then</span> </pre></li>
<li id="l1001"><pre>               <span class="keyword">raise</span> <span class="droplink">Zip.Zip_file_Error<ul><li><a href="zip.ads.html#zip.ads:72:3" title="To API doc">To API doc</a></li><li><a href="src_zip.ads.html#l72" title="To spec">To spec</a></li></ul></span>; </pre></li>
<li id="l1002"><pre>            <span class="keyword">end</span> <span class="keyword">if</span>; </pre></li>
<li id="l1003"><pre> </pre></li>
<li id="l1004"><pre>            <span class="keyword">if</span> <span class="droplink">full_trace<ul><li><a href="unzip-decompress.ads.html#unzip-decompress.ads:51:3" title="To API doc">To API doc</a></li><li><a href="src_unzip-decompress.ads.html#l51" title="To spec">To spec</a></li></ul></span> <span class="keyword">then</span> </pre></li>
<li id="l1005"><pre>               <span class="keyword">pragma</span> Warnings (Off, <span class="string">&quot;this code can never be executed and has been deleted&quot;</span>); </pre></li>
<li id="l1006"><pre>               Ada.Text_IO.Put_Line (<span class="string">&quot;End   UnZ_Expl.Get_tree&quot;</span>); </pre></li>
<li id="l1007"><pre>               <span class="keyword">pragma</span> Warnings (On,  <span class="string">&quot;this code can never be executed and has been deleted&quot;</span>); </pre></li>
<li id="l1008"><pre>            <span class="keyword">end</span> <span class="keyword">if</span>; </pre></li>
<li id="l1009"><pre>         <span class="keyword">end</span> Get_Tree; </pre></li>
<li id="l1010"><pre> </pre></li>
<li id="l1011"><pre>         <span class="keyword">procedure</span> Explode_Lit ( <span class="comment">-- method with 3 trees</span> </pre></li>
<li id="l1012"><pre>                                Needed : Integer; </pre></li>
<li id="l1013"><pre>                                Tb, Tl, Td  : <span class="droplink">p_Table_list<ul><li><a href="unzip-decompress-huffman.ads.html#unzip-decompress-huffman.ads:27:8" title="To API doc">To API doc</a></li><li><a href="src_unzip-decompress-huffman.ads.html#l27" title="To spec">To spec</a></li></ul></span>; </pre></li>
<li id="l1014"><pre>                                Bb, Bl, Bd  : Integer </pre></li>
<li id="l1015"><pre>                               ) </pre></li>
<li id="l1016"><pre>         <span class="keyword">is</span> </pre></li>
<li id="l1017"><pre>            S        : Unsigned_32; </pre></li>
<li id="l1018"><pre>            E, N, D  : Integer; </pre></li>
<li id="l1019"><pre> </pre></li>
<li id="l1020"><pre>            W  : Integer := 0; </pre></li>
<li id="l1021"><pre>            Ct  : <span class="droplink">p_HufT_table<ul><li><a href="unzip-decompress-huffman.ads.html#unzip-decompress-huffman.ads:9:8" title="To API doc">To API doc</a></li><li><a href="src_unzip-decompress-huffman.ads.html#l9" title="To spec">To spec</a></li></ul></span>; <span class="comment">-- current table</span> </pre></li>
<li id="l1022"><pre>            Ci  : Natural;                               <span class="comment">-- current index</span> </pre></li>
<li id="l1023"><pre>            unflushed : Boolean := True; <span class="comment">-- true while slide not yet unflushed</span> </pre></li>
<li id="l1024"><pre> </pre></li>
<li id="l1025"><pre>         <span class="keyword">begin</span> </pre></li>
<li id="l1026"><pre>            <span class="keyword">if</span> <span class="droplink">full_trace<ul><li><a href="unzip-decompress.ads.html#unzip-decompress.ads:51:3" title="To API doc">To API doc</a></li><li><a href="src_unzip-decompress.ads.html#l51" title="To spec">To spec</a></li></ul></span> <span class="keyword">then</span> </pre></li>
<li id="l1027"><pre>               <span class="keyword">pragma</span> Warnings (Off, <span class="string">&quot;this code can never be executed and has been deleted&quot;</span>); </pre></li>
<li id="l1028"><pre>               Ada.Text_IO.Put_Line (<span class="string">&quot;Begin Explode_lit&quot;</span>); </pre></li>
<li id="l1029"><pre>               <span class="keyword">pragma</span> Warnings (On,  <span class="string">&quot;this code can never be executed and has been deleted&quot;</span>); </pre></li>
<li id="l1030"><pre>            <span class="keyword">end</span> <span class="keyword">if</span>; </pre></li>
<li id="l1031"><pre> </pre></li>
<li id="l1032"><pre>            <span class="droplink">UnZ_IO.Bit_buffer.Init<ul><li><a href="src_unzip-decompress.adb.html#l75" title="To spec">To spec</a></li><li><a href="src_unzip-decompress.adb.html#l289" title="To body">To body</a></li></ul></span>; </pre></li>
<li id="l1033"><pre> </pre></li>
<li id="l1034"><pre>            S := <a href="src_unzip-decompress.adb.html#l48" title="defined at unzip-decompress.adb:48:10">UnZ_Glob.uncompsize</a>; </pre></li>
<li id="l1035"><pre>            <span class="keyword">while</span>  S &gt; 0 <span class="keyword">and</span> <span class="keyword">then</span> <span class="keyword">not</span> <a href="src_unzip-decompress.adb.html#l52" title="defined at unzip-decompress.adb:52:10">UnZ_Glob.Zip_EOF</a>  <span class="keyword">loop</span> </pre></li>
<li id="l1036"><pre>               <span class="keyword">if</span> <span class="droplink">UnZ_IO.Bit_buffer.Read_and_dump<ul><li><a href="src_unzip-decompress.adb.html#l88" title="To spec">To spec</a></li><li><a href="src_unzip-decompress.adb.html#l334" title="To body">To body</a></li></ul></span> (1) /= 0 <span class="keyword">then</span>  <span class="comment">-- 1 : Litteral</span> </pre></li>
<li id="l1037"><pre>                  S := S - 1; </pre></li>
<li id="l1038"><pre>                  Ct := Tb.<span class="keyword">all</span>.table; </pre></li>
<li id="l1039"><pre>                  Ci := <span class="droplink">UnZ_IO.Bit_buffer.Read_inverted<ul><li><a href="src_unzip-decompress.adb.html#l82" title="To spec">To spec</a></li><li><a href="src_unzip-decompress.adb.html#l323" title="To body">To body</a></li></ul></span> (Bb); </pre></li>
<li id="l1040"><pre> </pre></li>
<li id="l1041"><pre>                  <span class="keyword">loop</span> </pre></li>
<li id="l1042"><pre>                     E :=  Ct.<span class="keyword">all</span> (Ci).extra_bits; </pre></li>
<li id="l1043"><pre>                     <span class="keyword">exit</span> <span class="keyword">when</span> E &lt;= 16; </pre></li>
<li id="l1044"><pre> </pre></li>
<li id="l1045"><pre>                     <span class="keyword">if</span> E = <span class="droplink">invalid<ul><li><a href="unzip-decompress-huffman.ads.html#unzip-decompress-huffman.ads:18:3" title="To API doc">To API doc</a></li><li><a href="src_unzip-decompress-huffman.ads.html#l18" title="To spec">To spec</a></li></ul></span> <span class="keyword">then</span> </pre></li>
<li id="l1046"><pre>                        <span class="keyword">raise</span> <span class="droplink">Zip.Zip_file_Error<ul><li><a href="zip.ads.html#zip.ads:72:3" title="To API doc">To API doc</a></li><li><a href="src_zip.ads.html#l72" title="To spec">To spec</a></li></ul></span>; </pre></li>
<li id="l1047"><pre>                     <span class="keyword">end</span> <span class="keyword">if</span>; </pre></li>
<li id="l1048"><pre> </pre></li>
<li id="l1049"><pre>                     <span class="droplink">UnZ_IO.Bit_buffer.Dump<ul><li><a href="src_unzip-decompress.adb.html#l85" title="To spec">To spec</a></li><li><a href="src_unzip-decompress.adb.html#l306" title="To body">To body</a></li></ul></span> (Ct.<span class="keyword">all</span> (Ci).bits); </pre></li>
<li id="l1050"><pre>                     E := E - 16; </pre></li>
<li id="l1051"><pre>                     Ct := Ct.<span class="keyword">all</span> (Ci).next_table; </pre></li>
<li id="l1052"><pre>                     Ci := <span class="droplink">UnZ_IO.Bit_buffer.Read_inverted<ul><li><a href="src_unzip-decompress.adb.html#l82" title="To spec">To spec</a></li><li><a href="src_unzip-decompress.adb.html#l323" title="To body">To body</a></li></ul></span> (E); </pre></li>
<li id="l1053"><pre>                  <span class="keyword">end</span> <span class="keyword">loop</span>; </pre></li>
<li id="l1054"><pre> </pre></li>
<li id="l1055"><pre>                  <span class="droplink">UnZ_IO.Bit_buffer.Dump<ul><li><a href="src_unzip-decompress.adb.html#l85" title="To spec">To spec</a></li><li><a href="src_unzip-decompress.adb.html#l306" title="To body">To body</a></li></ul></span> (Ct.<span class="keyword">all</span> (Ci).bits); </pre></li>
<li id="l1056"><pre>                  <a href="src_unzip-decompress.adb.html#l41" title="defined at unzip-decompress.adb:41:10">UnZ_Glob.slide</a> (W) :=  <span class="droplink">Zip.Byte<ul><li><a href="zip.ads.html#zip.ads:218:11" title="To API doc">To API doc</a></li><li><a href="src_zip.ads.html#l218" title="To spec">To spec</a></li></ul></span> (Ct.<span class="keyword">all</span> (Ci).n); </pre></li>
<li id="l1057"><pre>                  W := W + 1; </pre></li>
<li id="l1058"><pre>                  <span class="droplink">UnZ_IO.Flush_if_full<ul><li><a href="src_unzip-decompress.adb.html#l96" title="To spec">To spec</a></li><li><a href="src_unzip-decompress.adb.html#l405" title="To body">To body</a></li></ul></span> (W, unflushed); </pre></li>
<li id="l1059"><pre> </pre></li>
<li id="l1060"><pre>               <span class="keyword">else</span>                                       <span class="comment">-- 0 : Copy</span> </pre></li>
<li id="l1061"><pre>                  D := <span class="droplink">UnZ_IO.Bit_buffer.Read_and_dump<ul><li><a href="src_unzip-decompress.adb.html#l88" title="To spec">To spec</a></li><li><a href="src_unzip-decompress.adb.html#l334" title="To body">To body</a></li></ul></span> (Needed); </pre></li>
<li id="l1062"><pre>                  Ct := Td.<span class="keyword">all</span>.table; </pre></li>
<li id="l1063"><pre>                  Ci := <span class="droplink">UnZ_IO.Bit_buffer.Read_inverted<ul><li><a href="src_unzip-decompress.adb.html#l82" title="To spec">To spec</a></li><li><a href="src_unzip-decompress.adb.html#l323" title="To body">To body</a></li></ul></span> (Bd); </pre></li>
<li id="l1064"><pre> </pre></li>
<li id="l1065"><pre>                  <span class="keyword">loop</span> </pre></li>
<li id="l1066"><pre>                     E := Ct.<span class="keyword">all</span> (Ci).extra_bits; </pre></li>
<li id="l1067"><pre>                     <span class="keyword">exit</span> <span class="keyword">when</span>  E &lt;= 16; </pre></li>
<li id="l1068"><pre> </pre></li>
<li id="l1069"><pre>                     <span class="keyword">if</span> E = <span class="droplink">invalid<ul><li><a href="unzip-decompress-huffman.ads.html#unzip-decompress-huffman.ads:18:3" title="To API doc">To API doc</a></li><li><a href="src_unzip-decompress-huffman.ads.html#l18" title="To spec">To spec</a></li></ul></span> <span class="keyword">then</span> </pre></li>
<li id="l1070"><pre>                        <span class="keyword">raise</span> <span class="droplink">Zip.Zip_file_Error<ul><li><a href="zip.ads.html#zip.ads:72:3" title="To API doc">To API doc</a></li><li><a href="src_zip.ads.html#l72" title="To spec">To spec</a></li></ul></span>; </pre></li>
<li id="l1071"><pre>                     <span class="keyword">end</span> <span class="keyword">if</span>; </pre></li>
<li id="l1072"><pre> </pre></li>
<li id="l1073"><pre>                     <span class="droplink">UnZ_IO.Bit_buffer.Dump<ul><li><a href="src_unzip-decompress.adb.html#l85" title="To spec">To spec</a></li><li><a href="src_unzip-decompress.adb.html#l306" title="To body">To body</a></li></ul></span> (Ct.<span class="keyword">all</span> (Ci).bits); </pre></li>
<li id="l1074"><pre>                     E := E - 16; </pre></li>
<li id="l1075"><pre>                     Ct := Ct.<span class="keyword">all</span> (Ci).next_table; </pre></li>
<li id="l1076"><pre>                     Ci := <span class="droplink">UnZ_IO.Bit_buffer.Read_inverted<ul><li><a href="src_unzip-decompress.adb.html#l82" title="To spec">To spec</a></li><li><a href="src_unzip-decompress.adb.html#l323" title="To body">To body</a></li></ul></span> (E); </pre></li>
<li id="l1077"><pre>                  <span class="keyword">end</span> <span class="keyword">loop</span>; </pre></li>
<li id="l1078"><pre> </pre></li>
<li id="l1079"><pre>                  <span class="droplink">UnZ_IO.Bit_buffer.Dump<ul><li><a href="src_unzip-decompress.adb.html#l85" title="To spec">To spec</a></li><li><a href="src_unzip-decompress.adb.html#l306" title="To body">To body</a></li></ul></span> (Ct.<span class="keyword">all</span> (Ci).bits); </pre></li>
<li id="l1080"><pre>                  D := D + Ct.<span class="keyword">all</span> (Ci).n; </pre></li>
<li id="l1081"><pre> </pre></li>
<li id="l1082"><pre>                  Ct := Tl.<span class="keyword">all</span>.table; </pre></li>
<li id="l1083"><pre>                  Ci := <span class="droplink">UnZ_IO.Bit_buffer.Read_inverted<ul><li><a href="src_unzip-decompress.adb.html#l82" title="To spec">To spec</a></li><li><a href="src_unzip-decompress.adb.html#l323" title="To body">To body</a></li></ul></span> (Bl); </pre></li>
<li id="l1084"><pre> </pre></li>
<li id="l1085"><pre>                  <span class="keyword">loop</span> </pre></li>
<li id="l1086"><pre>                     E := Ct.<span class="keyword">all</span> (Ci).extra_bits; </pre></li>
<li id="l1087"><pre>                     <span class="keyword">exit</span> <span class="keyword">when</span>  E &lt;= 16; </pre></li>
<li id="l1088"><pre> </pre></li>
<li id="l1089"><pre>                     <span class="keyword">if</span> E = <span class="droplink">invalid<ul><li><a href="unzip-decompress-huffman.ads.html#unzip-decompress-huffman.ads:18:3" title="To API doc">To API doc</a></li><li><a href="src_unzip-decompress-huffman.ads.html#l18" title="To spec">To spec</a></li></ul></span> <span class="keyword">then</span> </pre></li>
<li id="l1090"><pre>                        <span class="keyword">raise</span> <span class="droplink">Zip.Zip_file_Error<ul><li><a href="zip.ads.html#zip.ads:72:3" title="To API doc">To API doc</a></li><li><a href="src_zip.ads.html#l72" title="To spec">To spec</a></li></ul></span>; </pre></li>
<li id="l1091"><pre>                     <span class="keyword">end</span> <span class="keyword">if</span>; </pre></li>
<li id="l1092"><pre> </pre></li>
<li id="l1093"><pre>                     <span class="droplink">UnZ_IO.Bit_buffer.Dump<ul><li><a href="src_unzip-decompress.adb.html#l85" title="To spec">To spec</a></li><li><a href="src_unzip-decompress.adb.html#l306" title="To body">To body</a></li></ul></span> (Ct.<span class="keyword">all</span> (Ci).bits); </pre></li>
<li id="l1094"><pre>                     E := E - 16; </pre></li>
<li id="l1095"><pre>                     Ct := Ct.<span class="keyword">all</span> (Ci).next_table; </pre></li>
<li id="l1096"><pre>                     Ci := <span class="droplink">UnZ_IO.Bit_buffer.Read_inverted<ul><li><a href="src_unzip-decompress.adb.html#l82" title="To spec">To spec</a></li><li><a href="src_unzip-decompress.adb.html#l323" title="To body">To body</a></li></ul></span> (E); </pre></li>
<li id="l1097"><pre>                  <span class="keyword">end</span> <span class="keyword">loop</span>; </pre></li>
<li id="l1098"><pre> </pre></li>
<li id="l1099"><pre>                  <span class="droplink">UnZ_IO.Bit_buffer.Dump<ul><li><a href="src_unzip-decompress.adb.html#l85" title="To spec">To spec</a></li><li><a href="src_unzip-decompress.adb.html#l306" title="To body">To body</a></li></ul></span> (Ct.<span class="keyword">all</span> (Ci).bits); </pre></li>
<li id="l1100"><pre> </pre></li>
<li id="l1101"><pre>                  N :=  Ct.<span class="keyword">all</span> (Ci).n; </pre></li>
<li id="l1102"><pre>                  <span class="keyword">if</span>  E /= 0 <span class="keyword">then</span> </pre></li>
<li id="l1103"><pre>                     N := N + <span class="droplink">UnZ_IO.Bit_buffer.Read_and_dump<ul><li><a href="src_unzip-decompress.adb.html#l88" title="To spec">To spec</a></li><li><a href="src_unzip-decompress.adb.html#l334" title="To body">To body</a></li></ul></span> (8); </pre></li>
<li id="l1104"><pre>                  <span class="keyword">end</span> <span class="keyword">if</span>; </pre></li>
<li id="l1105"><pre>                  S := S - Unsigned_32 (N); </pre></li>
<li id="l1106"><pre> </pre></li>
<li id="l1107"><pre>                  <span class="droplink">UnZ_IO.Copy_or_zero<ul><li><a href="src_unzip-decompress.adb.html#l106" title="To spec">To spec</a></li><li><a href="src_unzip-decompress.adb.html#l520" title="To body">To body</a></li></ul></span> ( </pre></li>
<li id="l1108"><pre>                                       <a href="src_unzip-decompress.adb.html#l106" title="defined at unzip-decompress.adb:106:34">distance</a>   =&gt; D, </pre></li>
<li id="l1109"><pre>                                       <a href="src_unzip-decompress.adb.html#l106" title="defined at unzip-decompress.adb:106:44">copy_length</a>     =&gt; N, </pre></li>
<li id="l1110"><pre>                                       <a href="src_unzip-decompress.adb.html#l107" title="defined at unzip-decompress.adb:107:34">index</a>      =&gt; W, </pre></li>
<li id="l1111"><pre>                                       <a href="src_unzip-decompress.adb.html#l108" title="defined at unzip-decompress.adb:108:34">unflushed</a>  =&gt; unflushed </pre></li>
<li id="l1112"><pre>                                      ); </pre></li>
<li id="l1113"><pre> </pre></li>
<li id="l1114"><pre>               <span class="keyword">end</span> <span class="keyword">if</span>; </pre></li>
<li id="l1115"><pre>            <span class="keyword">end</span> <span class="keyword">loop</span>; </pre></li>
<li id="l1116"><pre> </pre></li>
<li id="l1117"><pre>            <span class="droplink">UnZ_IO.Flush<ul><li><a href="src_unzip-decompress.adb.html#l94" title="To spec">To spec</a></li><li><a href="src_unzip-decompress.adb.html#l352" title="To body">To body</a></li></ul></span> (W); </pre></li>
<li id="l1118"><pre>            <span class="keyword">if</span> <a href="src_unzip-decompress.adb.html#l52" title="defined at unzip-decompress.adb:52:10">UnZ_Glob.Zip_EOF</a> <span class="keyword">then</span> </pre></li>
<li id="l1119"><pre>               <span class="keyword">raise</span> <span class="droplink">UnZip.Read_Error<ul><li><a href="unzip.ads.html#unzip.ads:288:3" title="To API doc">To API doc</a></li><li><a href="src_unzip.ads.html#l288" title="To spec">To spec</a></li></ul></span>; </pre></li>
<li id="l1120"><pre>            <span class="keyword">end</span> <span class="keyword">if</span>; </pre></li>
<li id="l1121"><pre> </pre></li>
<li id="l1122"><pre>            <span class="keyword">if</span> <span class="droplink">full_trace<ul><li><a href="unzip-decompress.ads.html#unzip-decompress.ads:51:3" title="To API doc">To API doc</a></li><li><a href="src_unzip-decompress.ads.html#l51" title="To spec">To spec</a></li></ul></span> <span class="keyword">then</span> </pre></li>
<li id="l1123"><pre>               <span class="keyword">pragma</span> Warnings (Off, <span class="string">&quot;this code can never be executed and has been deleted&quot;</span>); </pre></li>
<li id="l1124"><pre>               Ada.Text_IO.Put_Line (<span class="string">&quot;End   Explode_lit&quot;</span>); </pre></li>
<li id="l1125"><pre>               <span class="keyword">pragma</span> Warnings (On,  <span class="string">&quot;this code can never be executed and has been deleted&quot;</span>); </pre></li>
<li id="l1126"><pre>            <span class="keyword">end</span> <span class="keyword">if</span>; </pre></li>
<li id="l1127"><pre>         <span class="keyword">end</span> Explode_Lit; </pre></li>
<li id="l1128"><pre> </pre></li>
<li id="l1129"><pre>         <span class="keyword">procedure</span> Explode_Nolit ( <span class="comment">-- method with 2 trees</span> </pre></li>
<li id="l1130"><pre>                                  Needed : Integer; </pre></li>
<li id="l1131"><pre>                                  Tl, Td  : <span class="droplink">p_Table_list<ul><li><a href="unzip-decompress-huffman.ads.html#unzip-decompress-huffman.ads:27:8" title="To API doc">To API doc</a></li><li><a href="src_unzip-decompress-huffman.ads.html#l27" title="To spec">To spec</a></li></ul></span>; </pre></li>
<li id="l1132"><pre>                                  Bl, Bd  : Integer </pre></li>
<li id="l1133"><pre>                                 ) </pre></li>
<li id="l1134"><pre>         <span class="keyword">is</span> </pre></li>
<li id="l1135"><pre>            S        : Unsigned_32; </pre></li>
<li id="l1136"><pre>            E, N, D  : Integer; </pre></li>
<li id="l1137"><pre>            W  : Integer := 0; </pre></li>
<li id="l1138"><pre>            Ct  : <span class="droplink">p_HufT_table<ul><li><a href="unzip-decompress-huffman.ads.html#unzip-decompress-huffman.ads:9:8" title="To API doc">To API doc</a></li><li><a href="src_unzip-decompress-huffman.ads.html#l9" title="To spec">To spec</a></li></ul></span>; <span class="comment">-- current table</span> </pre></li>
<li id="l1139"><pre>            Ci  : Natural;                               <span class="comment">-- current index</span> </pre></li>
<li id="l1140"><pre>            unflushed : Boolean := True; <span class="comment">-- true while slide not yet unflushed</span> </pre></li>
<li id="l1141"><pre> </pre></li>
<li id="l1142"><pre>         <span class="keyword">begin</span> </pre></li>
<li id="l1143"><pre>            <span class="keyword">if</span> <span class="droplink">full_trace<ul><li><a href="unzip-decompress.ads.html#unzip-decompress.ads:51:3" title="To API doc">To API doc</a></li><li><a href="src_unzip-decompress.ads.html#l51" title="To spec">To spec</a></li></ul></span> <span class="keyword">then</span> </pre></li>
<li id="l1144"><pre>               <span class="keyword">pragma</span> Warnings (Off, <span class="string">&quot;this code can never be executed and has been deleted&quot;</span>); </pre></li>
<li id="l1145"><pre>               Ada.Text_IO.Put_Line (<span class="string">&quot;Begin Explode_nolit&quot;</span>); </pre></li>
<li id="l1146"><pre>               <span class="keyword">pragma</span> Warnings (On,  <span class="string">&quot;this code can never be executed and has been deleted&quot;</span>); </pre></li>
<li id="l1147"><pre>            <span class="keyword">end</span> <span class="keyword">if</span>; </pre></li>
<li id="l1148"><pre> </pre></li>
<li id="l1149"><pre>            <span class="droplink">UnZ_IO.Bit_buffer.Init<ul><li><a href="src_unzip-decompress.adb.html#l75" title="To spec">To spec</a></li><li><a href="src_unzip-decompress.adb.html#l289" title="To body">To body</a></li></ul></span>; </pre></li>
<li id="l1150"><pre>            S := <a href="src_unzip-decompress.adb.html#l48" title="defined at unzip-decompress.adb:48:10">UnZ_Glob.uncompsize</a>; </pre></li>
<li id="l1151"><pre>            <span class="keyword">while</span>  S &gt; 0 <span class="keyword">and</span> <span class="keyword">then</span> <span class="keyword">not</span> <a href="src_unzip-decompress.adb.html#l52" title="defined at unzip-decompress.adb:52:10">UnZ_Glob.Zip_EOF</a>  <span class="keyword">loop</span> </pre></li>
<li id="l1152"><pre>               <span class="keyword">if</span> <span class="droplink">UnZ_IO.Bit_buffer.Read_and_dump<ul><li><a href="src_unzip-decompress.adb.html#l88" title="To spec">To spec</a></li><li><a href="src_unzip-decompress.adb.html#l334" title="To body">To body</a></li></ul></span> (1) /= 0 <span class="keyword">then</span>  <span class="comment">-- 1 : Litteral</span> </pre></li>
<li id="l1153"><pre>                  S := S - 1; </pre></li>
<li id="l1154"><pre>                  <a href="src_unzip-decompress.adb.html#l41" title="defined at unzip-decompress.adb:41:10">UnZ_Glob.slide</a> (W) := </pre></li>
<li id="l1155"><pre>                    <span class="droplink">Zip.Byte<ul><li><a href="zip.ads.html#zip.ads:218:11" title="To API doc">To API doc</a></li><li><a href="src_zip.ads.html#l218" title="To spec">To spec</a></li></ul></span> (<span class="droplink">UnZ_IO.Bit_buffer.Read_and_dump<ul><li><a href="src_unzip-decompress.adb.html#l88" title="To spec">To spec</a></li><li><a href="src_unzip-decompress.adb.html#l334" title="To body">To body</a></li></ul></span> (8)); </pre></li>
<li id="l1156"><pre>                  W := W + 1; </pre></li>
<li id="l1157"><pre>                  <span class="droplink">UnZ_IO.Flush_if_full<ul><li><a href="src_unzip-decompress.adb.html#l96" title="To spec">To spec</a></li><li><a href="src_unzip-decompress.adb.html#l405" title="To body">To body</a></li></ul></span> (W, unflushed); </pre></li>
<li id="l1158"><pre>               <span class="keyword">else</span>                                       <span class="comment">-- 0 : Copy</span> </pre></li>
<li id="l1159"><pre>                  D := <span class="droplink">UnZ_IO.Bit_buffer.Read_and_dump<ul><li><a href="src_unzip-decompress.adb.html#l88" title="To spec">To spec</a></li><li><a href="src_unzip-decompress.adb.html#l334" title="To body">To body</a></li></ul></span> (Needed); </pre></li>
<li id="l1160"><pre>                  Ct := Td.<span class="keyword">all</span>.table; </pre></li>
<li id="l1161"><pre>                  Ci := <span class="droplink">UnZ_IO.Bit_buffer.Read_inverted<ul><li><a href="src_unzip-decompress.adb.html#l82" title="To spec">To spec</a></li><li><a href="src_unzip-decompress.adb.html#l323" title="To body">To body</a></li></ul></span> (Bd); </pre></li>
<li id="l1162"><pre> </pre></li>
<li id="l1163"><pre>                  <span class="keyword">loop</span> </pre></li>
<li id="l1164"><pre>                     E := Ct.<span class="keyword">all</span> (Ci).extra_bits; </pre></li>
<li id="l1165"><pre>                     <span class="keyword">exit</span> <span class="keyword">when</span>  E &lt;= 16; </pre></li>
<li id="l1166"><pre> </pre></li>
<li id="l1167"><pre>                     <span class="keyword">if</span> E = <span class="droplink">invalid<ul><li><a href="unzip-decompress-huffman.ads.html#unzip-decompress-huffman.ads:18:3" title="To API doc">To API doc</a></li><li><a href="src_unzip-decompress-huffman.ads.html#l18" title="To spec">To spec</a></li></ul></span> <span class="keyword">then</span> </pre></li>
<li id="l1168"><pre>                        <span class="keyword">raise</span> <span class="droplink">Zip.Zip_file_Error<ul><li><a href="zip.ads.html#zip.ads:72:3" title="To API doc">To API doc</a></li><li><a href="src_zip.ads.html#l72" title="To spec">To spec</a></li></ul></span>; </pre></li>
<li id="l1169"><pre>                     <span class="keyword">end</span> <span class="keyword">if</span>; </pre></li>
<li id="l1170"><pre> </pre></li>
<li id="l1171"><pre>                     <span class="droplink">UnZ_IO.Bit_buffer.Dump<ul><li><a href="src_unzip-decompress.adb.html#l85" title="To spec">To spec</a></li><li><a href="src_unzip-decompress.adb.html#l306" title="To body">To body</a></li></ul></span> (Ct.<span class="keyword">all</span> (Ci).bits); </pre></li>
<li id="l1172"><pre>                     E := E - 16; </pre></li>
<li id="l1173"><pre>                     Ct := Ct.<span class="keyword">all</span> (Ci).next_table; </pre></li>
<li id="l1174"><pre>                     Ci := <span class="droplink">UnZ_IO.Bit_buffer.Read_inverted<ul><li><a href="src_unzip-decompress.adb.html#l82" title="To spec">To spec</a></li><li><a href="src_unzip-decompress.adb.html#l323" title="To body">To body</a></li></ul></span> (E); </pre></li>
<li id="l1175"><pre>                  <span class="keyword">end</span> <span class="keyword">loop</span>; </pre></li>
<li id="l1176"><pre> </pre></li>
<li id="l1177"><pre>                  <span class="droplink">UnZ_IO.Bit_buffer.Dump<ul><li><a href="src_unzip-decompress.adb.html#l85" title="To spec">To spec</a></li><li><a href="src_unzip-decompress.adb.html#l306" title="To body">To body</a></li></ul></span> (Ct.<span class="keyword">all</span> (Ci).bits); </pre></li>
<li id="l1178"><pre> </pre></li>
<li id="l1179"><pre>                  D :=  D + Ct.<span class="keyword">all</span> (Ci).n; </pre></li>
<li id="l1180"><pre>                  Ct := Tl.<span class="keyword">all</span>.table; </pre></li>
<li id="l1181"><pre>                  Ci := <span class="droplink">UnZ_IO.Bit_buffer.Read_inverted<ul><li><a href="src_unzip-decompress.adb.html#l82" title="To spec">To spec</a></li><li><a href="src_unzip-decompress.adb.html#l323" title="To body">To body</a></li></ul></span> (Bl); </pre></li>
<li id="l1182"><pre> </pre></li>
<li id="l1183"><pre>                  <span class="keyword">loop</span> </pre></li>
<li id="l1184"><pre>                     E := Ct.<span class="keyword">all</span> (Ci).extra_bits; </pre></li>
<li id="l1185"><pre>                     <span class="keyword">exit</span> <span class="keyword">when</span>  E &lt;= 16; </pre></li>
<li id="l1186"><pre> </pre></li>
<li id="l1187"><pre>                     <span class="keyword">if</span> E = <span class="droplink">invalid<ul><li><a href="unzip-decompress-huffman.ads.html#unzip-decompress-huffman.ads:18:3" title="To API doc">To API doc</a></li><li><a href="src_unzip-decompress-huffman.ads.html#l18" title="To spec">To spec</a></li></ul></span> <span class="keyword">then</span> </pre></li>
<li id="l1188"><pre>                        <span class="keyword">raise</span> <span class="droplink">Zip.Zip_file_Error<ul><li><a href="zip.ads.html#zip.ads:72:3" title="To API doc">To API doc</a></li><li><a href="src_zip.ads.html#l72" title="To spec">To spec</a></li></ul></span>; </pre></li>
<li id="l1189"><pre>                     <span class="keyword">end</span> <span class="keyword">if</span>; </pre></li>
<li id="l1190"><pre> </pre></li>
<li id="l1191"><pre>                     <span class="droplink">UnZ_IO.Bit_buffer.Dump<ul><li><a href="src_unzip-decompress.adb.html#l85" title="To spec">To spec</a></li><li><a href="src_unzip-decompress.adb.html#l306" title="To body">To body</a></li></ul></span> (Ct.<span class="keyword">all</span> (Ci).bits); </pre></li>
<li id="l1192"><pre>                     E := E - 16; </pre></li>
<li id="l1193"><pre>                     Ct := Ct.<span class="keyword">all</span> (Ci).next_table; </pre></li>
<li id="l1194"><pre>                     Ci := <span class="droplink">UnZ_IO.Bit_buffer.Read_inverted<ul><li><a href="src_unzip-decompress.adb.html#l82" title="To spec">To spec</a></li><li><a href="src_unzip-decompress.adb.html#l323" title="To body">To body</a></li></ul></span> (E); </pre></li>
<li id="l1195"><pre>                  <span class="keyword">end</span> <span class="keyword">loop</span>; </pre></li>
<li id="l1196"><pre> </pre></li>
<li id="l1197"><pre>                  <span class="droplink">UnZ_IO.Bit_buffer.Dump<ul><li><a href="src_unzip-decompress.adb.html#l85" title="To spec">To spec</a></li><li><a href="src_unzip-decompress.adb.html#l306" title="To body">To body</a></li></ul></span> (Ct.<span class="keyword">all</span> (Ci).bits); </pre></li>
<li id="l1198"><pre> </pre></li>
<li id="l1199"><pre>                  N := Ct.<span class="keyword">all</span> (Ci).n; </pre></li>
<li id="l1200"><pre>                  <span class="keyword">if</span>  E /= 0 <span class="keyword">then</span> </pre></li>
<li id="l1201"><pre>                     N := N + <span class="droplink">UnZ_IO.Bit_buffer.Read_and_dump<ul><li><a href="src_unzip-decompress.adb.html#l88" title="To spec">To spec</a></li><li><a href="src_unzip-decompress.adb.html#l334" title="To body">To body</a></li></ul></span> (8); </pre></li>
<li id="l1202"><pre>                  <span class="keyword">end</span> <span class="keyword">if</span>; </pre></li>
<li id="l1203"><pre>                  S := S - Unsigned_32 (N); </pre></li>
<li id="l1204"><pre> </pre></li>
<li id="l1205"><pre>                  <span class="droplink">UnZ_IO.Copy_or_zero<ul><li><a href="src_unzip-decompress.adb.html#l106" title="To spec">To spec</a></li><li><a href="src_unzip-decompress.adb.html#l520" title="To body">To body</a></li></ul></span> ( </pre></li>
<li id="l1206"><pre>                                       <a href="src_unzip-decompress.adb.html#l106" title="defined at unzip-decompress.adb:106:34">distance</a>   =&gt; D, </pre></li>
<li id="l1207"><pre>                                       <a href="src_unzip-decompress.adb.html#l106" title="defined at unzip-decompress.adb:106:44">copy_length</a>     =&gt; N, </pre></li>
<li id="l1208"><pre>                                       <a href="src_unzip-decompress.adb.html#l107" title="defined at unzip-decompress.adb:107:34">index</a>      =&gt; W, </pre></li>
<li id="l1209"><pre>                                       <a href="src_unzip-decompress.adb.html#l108" title="defined at unzip-decompress.adb:108:34">unflushed</a>  =&gt; unflushed </pre></li>
<li id="l1210"><pre>                                      ); </pre></li>
<li id="l1211"><pre> </pre></li>
<li id="l1212"><pre>               <span class="keyword">end</span> <span class="keyword">if</span>; </pre></li>
<li id="l1213"><pre>            <span class="keyword">end</span> <span class="keyword">loop</span>; </pre></li>
<li id="l1214"><pre> </pre></li>
<li id="l1215"><pre>            <span class="droplink">UnZ_IO.Flush<ul><li><a href="src_unzip-decompress.adb.html#l94" title="To spec">To spec</a></li><li><a href="src_unzip-decompress.adb.html#l352" title="To body">To body</a></li></ul></span> (W); </pre></li>
<li id="l1216"><pre>            <span class="keyword">if</span> <a href="src_unzip-decompress.adb.html#l52" title="defined at unzip-decompress.adb:52:10">UnZ_Glob.Zip_EOF</a> <span class="keyword">then</span> </pre></li>
<li id="l1217"><pre>               <span class="keyword">raise</span> <span class="droplink">UnZip.Read_Error<ul><li><a href="unzip.ads.html#unzip.ads:288:3" title="To API doc">To API doc</a></li><li><a href="src_unzip.ads.html#l288" title="To spec">To spec</a></li></ul></span>; </pre></li>
<li id="l1218"><pre>            <span class="keyword">end</span> <span class="keyword">if</span>; </pre></li>
<li id="l1219"><pre> </pre></li>
<li id="l1220"><pre>            <span class="keyword">if</span> <span class="droplink">full_trace<ul><li><a href="unzip-decompress.ads.html#unzip-decompress.ads:51:3" title="To API doc">To API doc</a></li><li><a href="src_unzip-decompress.ads.html#l51" title="To spec">To spec</a></li></ul></span> <span class="keyword">then</span> </pre></li>
<li id="l1221"><pre>               <span class="keyword">pragma</span> Warnings (Off, <span class="string">&quot;this code can never be executed and has been deleted&quot;</span>); </pre></li>
<li id="l1222"><pre>               Ada.Text_IO.Put_Line (<span class="string">&quot;End   Explode_nolit&quot;</span>); </pre></li>
<li id="l1223"><pre>               <span class="keyword">pragma</span> Warnings (On,  <span class="string">&quot;this code can never be executed and has been deleted&quot;</span>); </pre></li>
<li id="l1224"><pre>            <span class="keyword">end</span> <span class="keyword">if</span>; </pre></li>
<li id="l1225"><pre> </pre></li>
<li id="l1226"><pre>         <span class="keyword">end</span> Explode_Nolit; </pre></li>
<li id="l1227"><pre> </pre></li>
<li id="l1228"><pre>         <span class="keyword">procedure</span> <a href="src_unzip-decompress.adb.html#l120" title="defined at unzip-decompress.adb:120:20">Explode</a> (<a href="src_unzip-decompress.adb.html#l120" title="defined at unzip-decompress.adb:120:29">literal_tree</a>, <a href="src_unzip-decompress.adb.html#l120" title="defined at unzip-decompress.adb:120:43">slide_8_KB</a> : Boolean) <span class="keyword">is</span> </pre></li>
<li id="l1229"><pre> </pre></li>
<li id="l1230"><pre>            Tb, Tl, Td  : <span class="droplink">p_Table_list<ul><li><a href="unzip-decompress-huffman.ads.html#unzip-decompress-huffman.ads:27:8" title="To API doc">To API doc</a></li><li><a href="src_unzip-decompress-huffman.ads.html#l27" title="To spec">To spec</a></li></ul></span>; </pre></li>
<li id="l1231"><pre>            Bb, Bl, Bd  : Integer; </pre></li>
<li id="l1232"><pre>            L :  <span class="droplink">Length_array<ul><li><a href="unzip-decompress-huffman.ads.html#unzip-decompress-huffman.ads:34:8" title="To API doc">To API doc</a></li><li><a href="src_unzip-decompress-huffman.ads.html#l34" title="To spec">To spec</a></li></ul></span> (0 .. 255); </pre></li>
<li id="l1233"><pre>            huft_incomplete  : Boolean; </pre></li>
<li id="l1234"><pre> </pre></li>
<li id="l1235"><pre>            cp_length_2_trees : </pre></li>
<li id="l1236"><pre>            <span class="keyword">constant</span> <span class="droplink">Length_array<ul><li><a href="unzip-decompress-huffman.ads.html#unzip-decompress-huffman.ads:34:8" title="To API doc">To API doc</a></li><li><a href="src_unzip-decompress-huffman.ads.html#l34" title="To spec">To spec</a></li></ul></span> (0 .. 63) := </pre></li>
<li id="l1237"><pre>              (2,  3,  4,  5,  6,  7,  8,  9, 10, 11, 12, 13, 14, 15, 16, 17, </pre></li>
<li id="l1238"><pre>               18, 19, 20, 21, 22, 23, 24, 25, 26, 27, 28, 29, 30, 31, 32, 33, 34, </pre></li>
<li id="l1239"><pre>               35, 36, 37, 38, 39, 40, 41, 42, 43, 44, 45, 46, 47, 48, 49, 50, 51, </pre></li>
<li id="l1240"><pre>               52, 53, 54, 55, 56, 57, 58, 59, 60, 61, 62, 63, 64, 65); </pre></li>
<li id="l1241"><pre> </pre></li>
<li id="l1242"><pre>            cp_length_3_trees : </pre></li>
<li id="l1243"><pre>            <span class="keyword">constant</span> <span class="droplink">Length_array<ul><li><a href="unzip-decompress-huffman.ads.html#unzip-decompress-huffman.ads:34:8" title="To API doc">To API doc</a></li><li><a href="src_unzip-decompress-huffman.ads.html#l34" title="To spec">To spec</a></li></ul></span> (0 .. 63) := </pre></li>
<li id="l1244"><pre>              (3,  4,  5,  6,  7,  8,  9, 10, 11, 12, 13, 14, 15, 16, 17, 18, </pre></li>
<li id="l1245"><pre>               19, 20, 21, 22, 23, 24, 25, 26, 27, 28, 29, 30, 31, 32, 33, 34, 35, </pre></li>
<li id="l1246"><pre>               36, 37, 38, 39, 40, 41, 42, 43, 44, 45, 46, 47, 48, 49, 50, 51, 52, </pre></li>
<li id="l1247"><pre>               53, 54, 55, 56, 57, 58, 59, 60, 61, 62, 63, 64, 65, 66); </pre></li>
<li id="l1248"><pre> </pre></li>
<li id="l1249"><pre>            cp_dist_4KB : </pre></li>
<li id="l1250"><pre>            <span class="keyword">constant</span> <span class="droplink">Length_array<ul><li><a href="unzip-decompress-huffman.ads.html#unzip-decompress-huffman.ads:34:8" title="To API doc">To API doc</a></li><li><a href="src_unzip-decompress-huffman.ads.html#l34" title="To spec">To spec</a></li></ul></span> (0 .. 63) := </pre></li>
<li id="l1251"><pre>              (1, 65, 129, 193, 257, 321, 385, 449, 513, 577, 641, 705, </pre></li>
<li id="l1252"><pre>               769, 833, 897, 961, 1025, 1089, 1153, 1217, 1281, 1345, 1409, 1473, </pre></li>
<li id="l1253"><pre>               1537, 1601, 1665, 1729, 1793, 1857, 1921, 1985, 2049, 2113, 2177, </pre></li>
<li id="l1254"><pre>               2241, 2305, 2369, 2433, 2497, 2561, 2625, 2689, 2753, 2817, 2881, </pre></li>
<li id="l1255"><pre>               2945, 3009, 3073, 3137, 3201, 3265, 3329, 3393, 3457, 3521, 3585, </pre></li>
<li id="l1256"><pre>               3649, 3713, 3777, 3841, 3905, 3969, 4033); </pre></li>
<li id="l1257"><pre> </pre></li>
<li id="l1258"><pre>            cp_dist_8KB : </pre></li>
<li id="l1259"><pre>            <span class="keyword">constant</span> <span class="droplink">Length_array<ul><li><a href="unzip-decompress-huffman.ads.html#unzip-decompress-huffman.ads:34:8" title="To API doc">To API doc</a></li><li><a href="src_unzip-decompress-huffman.ads.html#l34" title="To spec">To spec</a></li></ul></span> (0 .. 63) := </pre></li>
<li id="l1260"><pre>              (1,  129,  257,  385,  513,  641,  769,  897, 1025, 1153, 1281, </pre></li>
<li id="l1261"><pre>               1409, 1537, 1665, 1793, 1921, 2049, 2177, 2305, 2433, 2561, 2689, </pre></li>
<li id="l1262"><pre>               2817, 2945, 3073, 3201, 3329, 3457, 3585, 3713, 3841, 3969, 4097, </pre></li>
<li id="l1263"><pre>               4225, 4353, 4481, 4609, 4737, 4865, 4993, 5121, 5249, 5377, 5505, </pre></li>
<li id="l1264"><pre>               5633, 5761, 5889, 6017, 6145, 6273, 6401, 6529, 6657, 6785, 6913, </pre></li>
<li id="l1265"><pre>               7041, 7169, 7297, 7425, 7553, 7681, 7809, 7937, 8065); </pre></li>
<li id="l1266"><pre> </pre></li>
<li id="l1267"><pre>            extra : </pre></li>
<li id="l1268"><pre>            <span class="keyword">constant</span> <span class="droplink">Length_array<ul><li><a href="unzip-decompress-huffman.ads.html#unzip-decompress-huffman.ads:34:8" title="To API doc">To API doc</a></li><li><a href="src_unzip-decompress-huffman.ads.html#l34" title="To spec">To spec</a></li></ul></span> (0 .. 63) := (0 .. 62 =&gt; 0, 63 =&gt; 8); </pre></li>
<li id="l1269"><pre> </pre></li>
<li id="l1270"><pre>         <span class="keyword">begin</span> </pre></li>
<li id="l1271"><pre>            Bl := 7; </pre></li>
<li id="l1272"><pre>            <span class="keyword">if</span> <a href="src_unzip-decompress.adb.html#l46" title="defined at unzip-decompress.adb:46:10">UnZ_Glob.compsize</a> &gt; 200000 <span class="keyword">then</span> </pre></li>
<li id="l1273"><pre>               Bd := 8; </pre></li>
<li id="l1274"><pre>            <span class="keyword">else</span> </pre></li>
<li id="l1275"><pre>               Bd := 7; </pre></li>
<li id="l1276"><pre>            <span class="keyword">end</span> <span class="keyword">if</span>; </pre></li>
<li id="l1277"><pre> </pre></li>
<li id="l1278"><pre>            <span class="keyword">if</span> <a href="src_unzip-decompress.adb.html#l120" title="defined at unzip-decompress.adb:120:29">literal_tree</a> <span class="keyword">then</span> </pre></li>
<li id="l1279"><pre>               Bb := 9; </pre></li>
<li id="l1280"><pre>               Get_Tree (L); </pre></li>
<li id="l1281"><pre>               <span class="keyword">begin</span> </pre></li>
<li id="l1282"><pre>                  <span class="droplink">HufT_build<ul><li><a href="unzip-decompress-huffman.ads.html#unzip-decompress-huffman.ads:42:13" title="To API doc">To API doc</a></li><li><a href="src_unzip-decompress-huffman.ads.html#l42" title="To spec">To spec</a></li><li><a href="src_unzip-decompress-huffman.adb.html#l50" title="To body">To body</a></li></ul></span> (L, 256, <span class="droplink">empty<ul><li><a href="unzip-decompress-huffman.ads.html#unzip-decompress-huffman.ads:36:3" title="To API doc">To API doc</a></li><li><a href="src_unzip-decompress-huffman.ads.html#l36" title="To spec">To spec</a></li></ul></span>, <span class="droplink">empty<ul><li><a href="unzip-decompress-huffman.ads.html#unzip-decompress-huffman.ads:36:3" title="To API doc">To API doc</a></li><li><a href="src_unzip-decompress-huffman.ads.html#l36" title="To spec">To spec</a></li></ul></span>, Tb, Bb, huft_incomplete); </pre></li>
<li id="l1283"><pre>                  <span class="keyword">if</span> huft_incomplete <span class="keyword">then</span> </pre></li>
<li id="l1284"><pre>                     <span class="droplink">HufT_free<ul><li><a href="unzip-decompress-huffman.ads.html#unzip-decompress-huffman.ads:39:13" title="To API doc">To API doc</a></li><li><a href="src_unzip-decompress-huffman.ads.html#l39" title="To spec">To spec</a></li><li><a href="src_unzip-decompress-huffman.adb.html#l13" title="To body">To body</a></li></ul></span> (Tb); </pre></li>
<li id="l1285"><pre>                     <span class="keyword">raise</span> <span class="droplink">Zip.Zip_file_Error<ul><li><a href="zip.ads.html#zip.ads:72:3" title="To API doc">To API doc</a></li><li><a href="src_zip.ads.html#l72" title="To spec">To spec</a></li></ul></span>; </pre></li>
<li id="l1286"><pre>                  <span class="keyword">end</span> <span class="keyword">if</span>; </pre></li>
<li id="l1287"><pre>               <span class="keyword">exception</span> </pre></li>
<li id="l1288"><pre>                  <span class="keyword">when</span> <span class="keyword">others</span> =&gt; </pre></li>
<li id="l1289"><pre>                     <span class="keyword">raise</span> <span class="droplink">Zip.Zip_file_Error<ul><li><a href="zip.ads.html#zip.ads:72:3" title="To API doc">To API doc</a></li><li><a href="src_zip.ads.html#l72" title="To spec">To spec</a></li></ul></span>; </pre></li>
<li id="l1290"><pre>               <span class="keyword">end</span>; </pre></li>
<li id="l1291"><pre> </pre></li>
<li id="l1292"><pre>               <span class="keyword">begin</span> </pre></li>
<li id="l1293"><pre>                  Get_Tree (L (0 .. 63)); </pre></li>
<li id="l1294"><pre>               <span class="keyword">exception</span> </pre></li>
<li id="l1295"><pre>                  <span class="keyword">when</span> <span class="keyword">others</span> =&gt; </pre></li>
<li id="l1296"><pre>                     <span class="droplink">HufT_free<ul><li><a href="unzip-decompress-huffman.ads.html#unzip-decompress-huffman.ads:39:13" title="To API doc">To API doc</a></li><li><a href="src_unzip-decompress-huffman.ads.html#l39" title="To spec">To spec</a></li><li><a href="src_unzip-decompress-huffman.adb.html#l13" title="To body">To body</a></li></ul></span> (Tb); </pre></li>
<li id="l1297"><pre>                     <span class="keyword">raise</span> <span class="droplink">Zip.Zip_file_Error<ul><li><a href="zip.ads.html#zip.ads:72:3" title="To API doc">To API doc</a></li><li><a href="src_zip.ads.html#l72" title="To spec">To spec</a></li></ul></span>; </pre></li>
<li id="l1298"><pre>               <span class="keyword">end</span>; </pre></li>
<li id="l1299"><pre> </pre></li>
<li id="l1300"><pre>               <span class="keyword">begin</span> </pre></li>
<li id="l1301"><pre>                  <span class="droplink">HufT_build<ul><li><a href="unzip-decompress-huffman.ads.html#unzip-decompress-huffman.ads:42:13" title="To API doc">To API doc</a></li><li><a href="src_unzip-decompress-huffman.ads.html#l42" title="To spec">To spec</a></li><li><a href="src_unzip-decompress-huffman.adb.html#l50" title="To body">To body</a></li></ul></span> ( </pre></li>
<li id="l1302"><pre>                              L (0 .. 63), 0, cp_length_3_trees, extra, Tl, Bl, huft_incomplete </pre></li>
<li id="l1303"><pre>                             ); </pre></li>
<li id="l1304"><pre>                  <span class="keyword">if</span> huft_incomplete <span class="keyword">then</span> </pre></li>
<li id="l1305"><pre>                     <span class="droplink">HufT_free<ul><li><a href="unzip-decompress-huffman.ads.html#unzip-decompress-huffman.ads:39:13" title="To API doc">To API doc</a></li><li><a href="src_unzip-decompress-huffman.ads.html#l39" title="To spec">To spec</a></li><li><a href="src_unzip-decompress-huffman.adb.html#l13" title="To body">To body</a></li></ul></span> (Tl); </pre></li>
<li id="l1306"><pre>                     <span class="droplink">HufT_free<ul><li><a href="unzip-decompress-huffman.ads.html#unzip-decompress-huffman.ads:39:13" title="To API doc">To API doc</a></li><li><a href="src_unzip-decompress-huffman.ads.html#l39" title="To spec">To spec</a></li><li><a href="src_unzip-decompress-huffman.adb.html#l13" title="To body">To body</a></li></ul></span> (Tb); </pre></li>
<li id="l1307"><pre>                     <span class="keyword">raise</span> <span class="droplink">Zip.Zip_file_Error<ul><li><a href="zip.ads.html#zip.ads:72:3" title="To API doc">To API doc</a></li><li><a href="src_zip.ads.html#l72" title="To spec">To spec</a></li></ul></span>; </pre></li>
<li id="l1308"><pre>                  <span class="keyword">end</span> <span class="keyword">if</span>; </pre></li>
<li id="l1309"><pre>               <span class="keyword">exception</span> </pre></li>
<li id="l1310"><pre>                  <span class="keyword">when</span> <span class="keyword">others</span> =&gt; </pre></li>
<li id="l1311"><pre>                     <span class="droplink">HufT_free<ul><li><a href="unzip-decompress-huffman.ads.html#unzip-decompress-huffman.ads:39:13" title="To API doc">To API doc</a></li><li><a href="src_unzip-decompress-huffman.ads.html#l39" title="To spec">To spec</a></li><li><a href="src_unzip-decompress-huffman.adb.html#l13" title="To body">To body</a></li></ul></span> (Tb); </pre></li>
<li id="l1312"><pre>                     <span class="keyword">raise</span> <span class="droplink">Zip.Zip_file_Error<ul><li><a href="zip.ads.html#zip.ads:72:3" title="To API doc">To API doc</a></li><li><a href="src_zip.ads.html#l72" title="To spec">To spec</a></li></ul></span>; </pre></li>
<li id="l1313"><pre>               <span class="keyword">end</span>; </pre></li>
<li id="l1314"><pre> </pre></li>
<li id="l1315"><pre>               <span class="keyword">begin</span> </pre></li>
<li id="l1316"><pre>                  Get_Tree (L (0 .. 63)); </pre></li>
<li id="l1317"><pre>               <span class="keyword">exception</span> </pre></li>
<li id="l1318"><pre>                  <span class="keyword">when</span> <span class="keyword">others</span> =&gt; </pre></li>
<li id="l1319"><pre>                     <span class="droplink">HufT_free<ul><li><a href="unzip-decompress-huffman.ads.html#unzip-decompress-huffman.ads:39:13" title="To API doc">To API doc</a></li><li><a href="src_unzip-decompress-huffman.ads.html#l39" title="To spec">To spec</a></li><li><a href="src_unzip-decompress-huffman.adb.html#l13" title="To body">To body</a></li></ul></span> (Tb); </pre></li>
<li id="l1320"><pre>                     <span class="droplink">HufT_free<ul><li><a href="unzip-decompress-huffman.ads.html#unzip-decompress-huffman.ads:39:13" title="To API doc">To API doc</a></li><li><a href="src_unzip-decompress-huffman.ads.html#l39" title="To spec">To spec</a></li><li><a href="src_unzip-decompress-huffman.adb.html#l13" title="To body">To body</a></li></ul></span> (Tl); </pre></li>
<li id="l1321"><pre>                     <span class="keyword">raise</span> <span class="droplink">Zip.Zip_file_Error<ul><li><a href="zip.ads.html#zip.ads:72:3" title="To API doc">To API doc</a></li><li><a href="src_zip.ads.html#l72" title="To spec">To spec</a></li></ul></span>; </pre></li>
<li id="l1322"><pre>               <span class="keyword">end</span>; </pre></li>
<li id="l1323"><pre> </pre></li>
<li id="l1324"><pre>               <span class="keyword">begin</span> </pre></li>
<li id="l1325"><pre>                  <span class="keyword">if</span> <a href="src_unzip-decompress.adb.html#l120" title="defined at unzip-decompress.adb:120:43">slide_8_KB</a> <span class="keyword">then</span> </pre></li>
<li id="l1326"><pre>                     <span class="droplink">HufT_build<ul><li><a href="unzip-decompress-huffman.ads.html#unzip-decompress-huffman.ads:42:13" title="To API doc">To API doc</a></li><li><a href="src_unzip-decompress-huffman.ads.html#l42" title="To spec">To spec</a></li><li><a href="src_unzip-decompress-huffman.adb.html#l50" title="To body">To body</a></li></ul></span> ( </pre></li>
<li id="l1327"><pre>                                 L (0 .. 63), 0, cp_dist_8KB, extra, Td, Bd, huft_incomplete </pre></li>
<li id="l1328"><pre>                                ); </pre></li>
<li id="l1329"><pre>                     <span class="keyword">if</span> huft_incomplete <span class="keyword">then</span> </pre></li>
<li id="l1330"><pre>                        <span class="droplink">HufT_free<ul><li><a href="unzip-decompress-huffman.ads.html#unzip-decompress-huffman.ads:39:13" title="To API doc">To API doc</a></li><li><a href="src_unzip-decompress-huffman.ads.html#l39" title="To spec">To spec</a></li><li><a href="src_unzip-decompress-huffman.adb.html#l13" title="To body">To body</a></li></ul></span> (Td); </pre></li>
<li id="l1331"><pre>                        <span class="droplink">HufT_free<ul><li><a href="unzip-decompress-huffman.ads.html#unzip-decompress-huffman.ads:39:13" title="To API doc">To API doc</a></li><li><a href="src_unzip-decompress-huffman.ads.html#l39" title="To spec">To spec</a></li><li><a href="src_unzip-decompress-huffman.adb.html#l13" title="To body">To body</a></li></ul></span> (Tl); </pre></li>
<li id="l1332"><pre>                        <span class="droplink">HufT_free<ul><li><a href="unzip-decompress-huffman.ads.html#unzip-decompress-huffman.ads:39:13" title="To API doc">To API doc</a></li><li><a href="src_unzip-decompress-huffman.ads.html#l39" title="To spec">To spec</a></li><li><a href="src_unzip-decompress-huffman.adb.html#l13" title="To body">To body</a></li></ul></span> (Tb); </pre></li>
<li id="l1333"><pre>                        <span class="keyword">raise</span> <span class="droplink">Zip.Zip_file_Error<ul><li><a href="zip.ads.html#zip.ads:72:3" title="To API doc">To API doc</a></li><li><a href="src_zip.ads.html#l72" title="To spec">To spec</a></li></ul></span>; </pre></li>
<li id="l1334"><pre>                     <span class="keyword">end</span> <span class="keyword">if</span>; </pre></li>
<li id="l1335"><pre>                     <span class="comment">-- Exploding, method : 8k slide, 3 trees</span> </pre></li>
<li id="l1336"><pre>                     Explode_Lit (7, Tb, Tl, Td, Bb, Bl, Bd); </pre></li>
<li id="l1337"><pre>                  <span class="keyword">else</span> </pre></li>
<li id="l1338"><pre>                     <span class="droplink">HufT_build<ul><li><a href="unzip-decompress-huffman.ads.html#unzip-decompress-huffman.ads:42:13" title="To API doc">To API doc</a></li><li><a href="src_unzip-decompress-huffman.ads.html#l42" title="To spec">To spec</a></li><li><a href="src_unzip-decompress-huffman.adb.html#l50" title="To body">To body</a></li></ul></span> ( </pre></li>
<li id="l1339"><pre>                                 L (0 .. 63), 0, cp_dist_4KB, extra, Td, Bd, huft_incomplete </pre></li>
<li id="l1340"><pre>                                ); </pre></li>
<li id="l1341"><pre>                     <span class="keyword">if</span> huft_incomplete <span class="keyword">then</span> </pre></li>
<li id="l1342"><pre>                        <span class="droplink">HufT_free<ul><li><a href="unzip-decompress-huffman.ads.html#unzip-decompress-huffman.ads:39:13" title="To API doc">To API doc</a></li><li><a href="src_unzip-decompress-huffman.ads.html#l39" title="To spec">To spec</a></li><li><a href="src_unzip-decompress-huffman.adb.html#l13" title="To body">To body</a></li></ul></span> (Td); </pre></li>
<li id="l1343"><pre>                        <span class="droplink">HufT_free<ul><li><a href="unzip-decompress-huffman.ads.html#unzip-decompress-huffman.ads:39:13" title="To API doc">To API doc</a></li><li><a href="src_unzip-decompress-huffman.ads.html#l39" title="To spec">To spec</a></li><li><a href="src_unzip-decompress-huffman.adb.html#l13" title="To body">To body</a></li></ul></span> (Tl); </pre></li>
<li id="l1344"><pre>                        <span class="droplink">HufT_free<ul><li><a href="unzip-decompress-huffman.ads.html#unzip-decompress-huffman.ads:39:13" title="To API doc">To API doc</a></li><li><a href="src_unzip-decompress-huffman.ads.html#l39" title="To spec">To spec</a></li><li><a href="src_unzip-decompress-huffman.adb.html#l13" title="To body">To body</a></li></ul></span> (Tb); </pre></li>
<li id="l1345"><pre>                        <span class="keyword">raise</span> <span class="droplink">Zip.Zip_file_Error<ul><li><a href="zip.ads.html#zip.ads:72:3" title="To API doc">To API doc</a></li><li><a href="src_zip.ads.html#l72" title="To spec">To spec</a></li></ul></span>; </pre></li>
<li id="l1346"><pre>                     <span class="keyword">end</span> <span class="keyword">if</span>; </pre></li>
<li id="l1347"><pre>                     <span class="comment">-- Exploding, method : 4k slide, 3 trees</span> </pre></li>
<li id="l1348"><pre>                     Explode_Lit (6, Tb, Tl, Td, Bb, Bl, Bd); </pre></li>
<li id="l1349"><pre>                  <span class="keyword">end</span> <span class="keyword">if</span>; </pre></li>
<li id="l1350"><pre>               <span class="keyword">exception</span> </pre></li>
<li id="l1351"><pre>                  <span class="keyword">when</span>  <span class="keyword">others</span> =&gt; </pre></li>
<li id="l1352"><pre>                     <span class="droplink">HufT_free<ul><li><a href="unzip-decompress-huffman.ads.html#unzip-decompress-huffman.ads:39:13" title="To API doc">To API doc</a></li><li><a href="src_unzip-decompress-huffman.ads.html#l39" title="To spec">To spec</a></li><li><a href="src_unzip-decompress-huffman.adb.html#l13" title="To body">To body</a></li></ul></span> (Tl); </pre></li>
<li id="l1353"><pre>                     <span class="droplink">HufT_free<ul><li><a href="unzip-decompress-huffman.ads.html#unzip-decompress-huffman.ads:39:13" title="To API doc">To API doc</a></li><li><a href="src_unzip-decompress-huffman.ads.html#l39" title="To spec">To spec</a></li><li><a href="src_unzip-decompress-huffman.adb.html#l13" title="To body">To body</a></li></ul></span> (Tb); </pre></li>
<li id="l1354"><pre>                     <span class="keyword">raise</span> <span class="droplink">Zip.Zip_file_Error<ul><li><a href="zip.ads.html#zip.ads:72:3" title="To API doc">To API doc</a></li><li><a href="src_zip.ads.html#l72" title="To spec">To spec</a></li></ul></span>; </pre></li>
<li id="l1355"><pre>               <span class="keyword">end</span>; </pre></li>
<li id="l1356"><pre>               <span class="droplink">HufT_free<ul><li><a href="unzip-decompress-huffman.ads.html#unzip-decompress-huffman.ads:39:13" title="To API doc">To API doc</a></li><li><a href="src_unzip-decompress-huffman.ads.html#l39" title="To spec">To spec</a></li><li><a href="src_unzip-decompress-huffman.adb.html#l13" title="To body">To body</a></li></ul></span> (Td); </pre></li>
<li id="l1357"><pre>               <span class="droplink">HufT_free<ul><li><a href="unzip-decompress-huffman.ads.html#unzip-decompress-huffman.ads:39:13" title="To API doc">To API doc</a></li><li><a href="src_unzip-decompress-huffman.ads.html#l39" title="To spec">To spec</a></li><li><a href="src_unzip-decompress-huffman.adb.html#l13" title="To body">To body</a></li></ul></span> (Tl); </pre></li>
<li id="l1358"><pre>               <span class="droplink">HufT_free<ul><li><a href="unzip-decompress-huffman.ads.html#unzip-decompress-huffman.ads:39:13" title="To API doc">To API doc</a></li><li><a href="src_unzip-decompress-huffman.ads.html#l39" title="To spec">To spec</a></li><li><a href="src_unzip-decompress-huffman.adb.html#l13" title="To body">To body</a></li></ul></span> (Tb); </pre></li>
<li id="l1359"><pre> </pre></li>
<li id="l1360"><pre>            <span class="keyword">else</span>         <span class="comment">-- No literal tree</span> </pre></li>
<li id="l1361"><pre> </pre></li>
<li id="l1362"><pre>               <span class="keyword">begin</span> </pre></li>
<li id="l1363"><pre>                  Get_Tree (L (0 .. 63)); </pre></li>
<li id="l1364"><pre>               <span class="keyword">exception</span> </pre></li>
<li id="l1365"><pre>                  <span class="keyword">when</span> <span class="keyword">others</span> =&gt; </pre></li>
<li id="l1366"><pre>                     <span class="keyword">raise</span> <span class="droplink">Zip.Zip_file_Error<ul><li><a href="zip.ads.html#zip.ads:72:3" title="To API doc">To API doc</a></li><li><a href="src_zip.ads.html#l72" title="To spec">To spec</a></li></ul></span>; </pre></li>
<li id="l1367"><pre>               <span class="keyword">end</span>; </pre></li>
<li id="l1368"><pre> </pre></li>
<li id="l1369"><pre>               <span class="keyword">begin</span> </pre></li>
<li id="l1370"><pre>                  <span class="droplink">HufT_build<ul><li><a href="unzip-decompress-huffman.ads.html#unzip-decompress-huffman.ads:42:13" title="To API doc">To API doc</a></li><li><a href="src_unzip-decompress-huffman.ads.html#l42" title="To spec">To spec</a></li><li><a href="src_unzip-decompress-huffman.adb.html#l50" title="To body">To body</a></li></ul></span> ( </pre></li>
<li id="l1371"><pre>                              L (0 .. 63), 0, cp_length_2_trees, extra, Tl, Bl, huft_incomplete </pre></li>
<li id="l1372"><pre>                             ); </pre></li>
<li id="l1373"><pre>                  <span class="keyword">if</span> huft_incomplete <span class="keyword">then</span> </pre></li>
<li id="l1374"><pre>                     <span class="droplink">HufT_free<ul><li><a href="unzip-decompress-huffman.ads.html#unzip-decompress-huffman.ads:39:13" title="To API doc">To API doc</a></li><li><a href="src_unzip-decompress-huffman.ads.html#l39" title="To spec">To spec</a></li><li><a href="src_unzip-decompress-huffman.adb.html#l13" title="To body">To body</a></li></ul></span> (Tl); </pre></li>
<li id="l1375"><pre>                     <span class="keyword">raise</span> <span class="droplink">Zip.Zip_file_Error<ul><li><a href="zip.ads.html#zip.ads:72:3" title="To API doc">To API doc</a></li><li><a href="src_zip.ads.html#l72" title="To spec">To spec</a></li></ul></span>; </pre></li>
<li id="l1376"><pre>                  <span class="keyword">end</span> <span class="keyword">if</span>; </pre></li>
<li id="l1377"><pre>               <span class="keyword">exception</span> </pre></li>
<li id="l1378"><pre>                  <span class="keyword">when</span> <span class="keyword">others</span> =&gt; </pre></li>
<li id="l1379"><pre>                     <span class="keyword">raise</span> <span class="droplink">Zip.Zip_file_Error<ul><li><a href="zip.ads.html#zip.ads:72:3" title="To API doc">To API doc</a></li><li><a href="src_zip.ads.html#l72" title="To spec">To spec</a></li></ul></span>; </pre></li>
<li id="l1380"><pre>               <span class="keyword">end</span>; </pre></li>
<li id="l1381"><pre> </pre></li>
<li id="l1382"><pre>               <span class="keyword">begin</span> </pre></li>
<li id="l1383"><pre>                  Get_Tree (L (0 .. 63)); </pre></li>
<li id="l1384"><pre>               <span class="keyword">exception</span> </pre></li>
<li id="l1385"><pre>                  <span class="keyword">when</span> <span class="keyword">others</span> =&gt; </pre></li>
<li id="l1386"><pre>                     <span class="droplink">HufT_free<ul><li><a href="unzip-decompress-huffman.ads.html#unzip-decompress-huffman.ads:39:13" title="To API doc">To API doc</a></li><li><a href="src_unzip-decompress-huffman.ads.html#l39" title="To spec">To spec</a></li><li><a href="src_unzip-decompress-huffman.adb.html#l13" title="To body">To body</a></li></ul></span> (Tl); </pre></li>
<li id="l1387"><pre>                     <span class="keyword">raise</span> <span class="droplink">Zip.Zip_file_Error<ul><li><a href="zip.ads.html#zip.ads:72:3" title="To API doc">To API doc</a></li><li><a href="src_zip.ads.html#l72" title="To spec">To spec</a></li></ul></span>; </pre></li>
<li id="l1388"><pre>               <span class="keyword">end</span>; </pre></li>
<li id="l1389"><pre> </pre></li>
<li id="l1390"><pre>               <span class="keyword">begin</span> </pre></li>
<li id="l1391"><pre>                  <span class="keyword">if</span> <a href="src_unzip-decompress.adb.html#l120" title="defined at unzip-decompress.adb:120:43">slide_8_KB</a> <span class="keyword">then</span> </pre></li>
<li id="l1392"><pre>                     <span class="droplink">HufT_build<ul><li><a href="unzip-decompress-huffman.ads.html#unzip-decompress-huffman.ads:42:13" title="To API doc">To API doc</a></li><li><a href="src_unzip-decompress-huffman.ads.html#l42" title="To spec">To spec</a></li><li><a href="src_unzip-decompress-huffman.adb.html#l50" title="To body">To body</a></li></ul></span> ( </pre></li>
<li id="l1393"><pre>                                 L (0 .. 63), 0, cp_dist_8KB, extra, Td, Bd, huft_incomplete </pre></li>
<li id="l1394"><pre>                                ); </pre></li>
<li id="l1395"><pre>                     <span class="keyword">if</span> huft_incomplete <span class="keyword">then</span> </pre></li>
<li id="l1396"><pre>                        <span class="droplink">HufT_free<ul><li><a href="unzip-decompress-huffman.ads.html#unzip-decompress-huffman.ads:39:13" title="To API doc">To API doc</a></li><li><a href="src_unzip-decompress-huffman.ads.html#l39" title="To spec">To spec</a></li><li><a href="src_unzip-decompress-huffman.adb.html#l13" title="To body">To body</a></li></ul></span> (Td); </pre></li>
<li id="l1397"><pre>                        <span class="droplink">HufT_free<ul><li><a href="unzip-decompress-huffman.ads.html#unzip-decompress-huffman.ads:39:13" title="To API doc">To API doc</a></li><li><a href="src_unzip-decompress-huffman.ads.html#l39" title="To spec">To spec</a></li><li><a href="src_unzip-decompress-huffman.adb.html#l13" title="To body">To body</a></li></ul></span> (Tl); </pre></li>
<li id="l1398"><pre>                        <span class="keyword">raise</span> <span class="droplink">Zip.Zip_file_Error<ul><li><a href="zip.ads.html#zip.ads:72:3" title="To API doc">To API doc</a></li><li><a href="src_zip.ads.html#l72" title="To spec">To spec</a></li></ul></span>; </pre></li>
<li id="l1399"><pre>                     <span class="keyword">end</span> <span class="keyword">if</span>; </pre></li>
<li id="l1400"><pre>                     <span class="comment">-- Exploding, method : 8k slide, 2 trees</span> </pre></li>
<li id="l1401"><pre>                     Explode_Nolit (7, Tl, Td, Bl, Bd); </pre></li>
<li id="l1402"><pre>                  <span class="keyword">else</span> </pre></li>
<li id="l1403"><pre>                     <span class="droplink">HufT_build<ul><li><a href="unzip-decompress-huffman.ads.html#unzip-decompress-huffman.ads:42:13" title="To API doc">To API doc</a></li><li><a href="src_unzip-decompress-huffman.ads.html#l42" title="To spec">To spec</a></li><li><a href="src_unzip-decompress-huffman.adb.html#l50" title="To body">To body</a></li></ul></span> ( </pre></li>
<li id="l1404"><pre>                                 L (0 .. 63), 0, cp_dist_4KB, extra, Td, Bd, huft_incomplete </pre></li>
<li id="l1405"><pre>                                ); </pre></li>
<li id="l1406"><pre>                     <span class="keyword">if</span> huft_incomplete <span class="keyword">then</span> </pre></li>
<li id="l1407"><pre>                        <span class="droplink">HufT_free<ul><li><a href="unzip-decompress-huffman.ads.html#unzip-decompress-huffman.ads:39:13" title="To API doc">To API doc</a></li><li><a href="src_unzip-decompress-huffman.ads.html#l39" title="To spec">To spec</a></li><li><a href="src_unzip-decompress-huffman.adb.html#l13" title="To body">To body</a></li></ul></span> (Td); </pre></li>
<li id="l1408"><pre>                        <span class="droplink">HufT_free<ul><li><a href="unzip-decompress-huffman.ads.html#unzip-decompress-huffman.ads:39:13" title="To API doc">To API doc</a></li><li><a href="src_unzip-decompress-huffman.ads.html#l39" title="To spec">To spec</a></li><li><a href="src_unzip-decompress-huffman.adb.html#l13" title="To body">To body</a></li></ul></span> (Tl); </pre></li>
<li id="l1409"><pre>                        <span class="keyword">raise</span> <span class="droplink">Zip.Zip_file_Error<ul><li><a href="zip.ads.html#zip.ads:72:3" title="To API doc">To API doc</a></li><li><a href="src_zip.ads.html#l72" title="To spec">To spec</a></li></ul></span>; </pre></li>
<li id="l1410"><pre>                     <span class="keyword">end</span> <span class="keyword">if</span>; </pre></li>
<li id="l1411"><pre>                     <span class="comment">-- Exploding, method : 4k slide, 2 trees</span> </pre></li>
<li id="l1412"><pre>                     Explode_Nolit (6, Tl, Td, Bl, Bd); </pre></li>
<li id="l1413"><pre>                  <span class="keyword">end</span> <span class="keyword">if</span>; </pre></li>
<li id="l1414"><pre>               <span class="keyword">exception</span> </pre></li>
<li id="l1415"><pre>                  <span class="keyword">when</span> <span class="keyword">others</span> =&gt; </pre></li>
<li id="l1416"><pre>                     <span class="droplink">HufT_free<ul><li><a href="unzip-decompress-huffman.ads.html#unzip-decompress-huffman.ads:39:13" title="To API doc">To API doc</a></li><li><a href="src_unzip-decompress-huffman.ads.html#l39" title="To spec">To spec</a></li><li><a href="src_unzip-decompress-huffman.adb.html#l13" title="To body">To body</a></li></ul></span> (Tl); </pre></li>
<li id="l1417"><pre>                     <span class="keyword">raise</span> <span class="droplink">Zip.Zip_file_Error<ul><li><a href="zip.ads.html#zip.ads:72:3" title="To API doc">To API doc</a></li><li><a href="src_zip.ads.html#l72" title="To spec">To spec</a></li></ul></span>; </pre></li>
<li id="l1418"><pre>               <span class="keyword">end</span>; </pre></li>
<li id="l1419"><pre>               <span class="droplink">HufT_free<ul><li><a href="unzip-decompress-huffman.ads.html#unzip-decompress-huffman.ads:39:13" title="To API doc">To API doc</a></li><li><a href="src_unzip-decompress-huffman.ads.html#l39" title="To spec">To spec</a></li><li><a href="src_unzip-decompress-huffman.adb.html#l13" title="To body">To body</a></li></ul></span> (Td); </pre></li>
<li id="l1420"><pre>               <span class="droplink">HufT_free<ul><li><a href="unzip-decompress-huffman.ads.html#unzip-decompress-huffman.ads:39:13" title="To API doc">To API doc</a></li><li><a href="src_unzip-decompress-huffman.ads.html#l39" title="To spec">To spec</a></li><li><a href="src_unzip-decompress-huffman.adb.html#l13" title="To body">To body</a></li></ul></span> (Tl); </pre></li>
<li id="l1421"><pre>            <span class="keyword">end</span> <span class="keyword">if</span>; </pre></li>
<li id="l1422"><pre> </pre></li>
<li id="l1423"><pre>         <span class="keyword">end</span> <span class="droplink">Explode<ul><li><a href="src_unzip-decompress.adb.html#l120" title="To spec">To spec</a></li><li><a href="src_unzip-decompress.adb.html#l1228" title="To body">To body</a></li></ul></span>; </pre></li>
<li id="l1424"><pre> </pre></li>
<li id="l1425"><pre>         <span class="comment">--------[ Method : Copy stored ] --------</span> </pre></li>
<li id="l1426"><pre> </pre></li>
<li id="l1427"><pre>         <span class="keyword">procedure</span> <a href="src_unzip-decompress.adb.html#l116" title="defined at unzip-decompress.adb:116:20">Copy_stored</a> <span class="keyword">is</span> </pre></li>
<li id="l1428"><pre>            size : <span class="keyword">constant</span> <span class="droplink">UnZip.File_size_type<ul><li><a href="unzip.ads.html#unzip.ads:190:11" title="To API doc">To API doc</a></li><li><a href="src_unzip.ads.html#l190" title="To spec">To spec</a></li></ul></span> := <a href="src_unzip-decompress.adb.html#l46" title="defined at unzip-decompress.adb:46:10">UnZ_Glob.compsize</a>; </pre></li>
<li id="l1429"><pre>            read_in, absorbed  : <span class="droplink">UnZip.File_size_type<ul><li><a href="unzip.ads.html#unzip.ads:190:11" title="To API doc">To API doc</a></li><li><a href="src_unzip.ads.html#l190" title="To spec">To spec</a></li></ul></span>; </pre></li>
<li id="l1430"><pre>         <span class="keyword">begin</span> </pre></li>
<li id="l1431"><pre>            absorbed := 0; </pre></li>
<li id="l1432"><pre>            <span class="keyword">if</span> <span class="droplink">UnZ_IO.Decryption.Get_mode<ul><li><a href="src_unzip-decompress.adb.html#l65" title="To spec">To spec</a></li><li><a href="src_unzip-decompress.adb.html#l212" title="To body">To body</a></li></ul></span> <span class="keyword">then</span> </pre></li>
<li id="l1433"><pre>               absorbed := 12; </pre></li>
<li id="l1434"><pre>            <span class="keyword">end</span> <span class="keyword">if</span>; </pre></li>
<li id="l1435"><pre>            <span class="keyword">while</span> absorbed &lt; size <span class="keyword">loop</span> </pre></li>
<li id="l1436"><pre>               read_in := size - absorbed; </pre></li>
<li id="l1437"><pre>               <span class="keyword">if</span> read_in &gt; <a href="src_unzip-decompress.adb.html#l31" title="defined at unzip-decompress.adb:31:7">wsize</a> <span class="keyword">then</span> </pre></li>
<li id="l1438"><pre>                  read_in := <a href="src_unzip-decompress.adb.html#l31" title="defined at unzip-decompress.adb:31:7">wsize</a>; </pre></li>
<li id="l1439"><pre>               <span class="keyword">end</span> <span class="keyword">if</span>; </pre></li>
<li id="l1440"><pre>               <span class="keyword">begin</span> </pre></li>
<li id="l1441"><pre>                  <span class="keyword">for</span> I <span class="keyword">in</span> 0 .. read_in - 1 <span class="keyword">loop</span> </pre></li>
<li id="l1442"><pre>                     <span class="droplink">UnZ_IO.Read_raw_byte<ul><li><a href="src_unzip-decompress.adb.html#l71" title="To spec">To spec</a></li><li><a href="src_unzip-decompress.adb.html#l279" title="To body">To body</a></li></ul></span> (<a href="src_unzip-decompress.adb.html#l41" title="defined at unzip-decompress.adb:41:10">UnZ_Glob.slide</a> (Natural (I))); </pre></li>
<li id="l1443"><pre>                  <span class="keyword">end</span> <span class="keyword">loop</span>; </pre></li>
<li id="l1444"><pre>               <span class="keyword">exception</span> </pre></li>
<li id="l1445"><pre>                  <span class="keyword">when</span> <span class="keyword">others</span> =&gt; </pre></li>
<li id="l1446"><pre>                     <span class="keyword">raise</span> <span class="droplink">UnZip.Read_Error<ul><li><a href="unzip.ads.html#unzip.ads:288:3" title="To API doc">To API doc</a></li><li><a href="src_unzip.ads.html#l288" title="To spec">To spec</a></li></ul></span>; </pre></li>
<li id="l1447"><pre>               <span class="keyword">end</span>; </pre></li>
<li id="l1448"><pre>               <span class="keyword">begin</span> </pre></li>
<li id="l1449"><pre>                  <span class="droplink">UnZ_IO.Flush<ul><li><a href="src_unzip-decompress.adb.html#l94" title="To spec">To spec</a></li><li><a href="src_unzip-decompress.adb.html#l352" title="To body">To body</a></li></ul></span> (Natural (read_in));  <span class="comment">-- Takes care of CRC too</span> </pre></li>
<li id="l1450"><pre>               <span class="keyword">exception</span> </pre></li>
<li id="l1451"><pre>                  <span class="keyword">when</span> <span class="keyword">others</span> =&gt; </pre></li>
<li id="l1452"><pre>                     <span class="keyword">raise</span> <span class="droplink">UnZip.Write_Error<ul><li><a href="unzip.ads.html#unzip.ads:287:3" title="To API doc">To API doc</a></li><li><a href="src_unzip.ads.html#l287" title="To spec">To spec</a></li></ul></span>; </pre></li>
<li id="l1453"><pre>               <span class="keyword">end</span>; </pre></li>
<li id="l1454"><pre>               absorbed := absorbed + read_in; </pre></li>
<li id="l1455"><pre>            <span class="keyword">end</span> <span class="keyword">loop</span>; </pre></li>
<li id="l1456"><pre>         <span class="keyword">end</span> <span class="droplink">Copy_stored<ul><li><a href="src_unzip-decompress.adb.html#l116" title="To spec">To spec</a></li><li><a href="src_unzip-decompress.adb.html#l1427" title="To body">To body</a></li></ul></span>; </pre></li>
<li id="l1457"><pre> </pre></li>
<li id="l1458"><pre>         <span class="comment">--------[ Method : Inflate ] --------</span> </pre></li>
<li id="l1459"><pre> </pre></li>
<li id="l1460"><pre>         <span class="keyword">procedure</span> Inflate_Codes (Tl, Td : <span class="droplink">p_Table_list<ul><li><a href="unzip-decompress-huffman.ads.html#unzip-decompress-huffman.ads:27:8" title="To API doc">To API doc</a></li><li><a href="src_unzip-decompress-huffman.ads.html#l27" title="To spec">To spec</a></li></ul></span>; Bl, Bd : Integer) <span class="keyword">is</span> </pre></li>
<li id="l1461"><pre>            CTE              : <span class="droplink">p_HufT<ul><li><a href="unzip-decompress-huffman.ads.html#unzip-decompress-huffman.ads:22:8" title="To API doc">To API doc</a></li><li><a href="src_unzip-decompress-huffman.ads.html#l22" title="To spec">To spec</a></li></ul></span>;       <span class="comment">-- current table element</span> </pre></li>
<li id="l1462"><pre>            inflate_length   : Natural; </pre></li>
<li id="l1463"><pre>            E                : Integer;      <span class="comment">-- table entry flag/number of extra bits</span> </pre></li>
<li id="l1464"><pre>            W                : Integer := <a href="src_unzip-decompress.adb.html#l42" title="defined at unzip-decompress.adb:42:10">UnZ_Glob.slide_index</a>; </pre></li>
<li id="l1465"><pre>            <span class="comment">-- more local variable for slide index</span> </pre></li>
<li id="l1466"><pre>         <span class="keyword">begin</span> </pre></li>
<li id="l1467"><pre>            <span class="keyword">if</span> <span class="droplink">full_trace<ul><li><a href="unzip-decompress.ads.html#unzip-decompress.ads:51:3" title="To API doc">To API doc</a></li><li><a href="src_unzip-decompress.ads.html#l51" title="To spec">To spec</a></li></ul></span> <span class="keyword">then</span> </pre></li>
<li id="l1468"><pre>               <span class="keyword">pragma</span> Warnings (Off, <span class="string">&quot;this code can never be executed and has been deleted&quot;</span>); </pre></li>
<li id="l1469"><pre>               Ada.Text_IO.Put_Line (<span class="string">&quot;Begin Inflate_codes&quot;</span>); </pre></li>
<li id="l1470"><pre>               <span class="keyword">pragma</span> Warnings (On,  <span class="string">&quot;this code can never be executed and has been deleted&quot;</span>); </pre></li>
<li id="l1471"><pre>            <span class="keyword">end</span> <span class="keyword">if</span>; </pre></li>
<li id="l1472"><pre> </pre></li>
<li id="l1473"><pre>            <span class="comment">-- inflate the coded data</span> </pre></li>
<li id="l1474"><pre><span class="comment">--              pragma Warnings (Off, &quot;variable &quot;&quot;Zip_EOF&quot;&quot; is not modified in loop body&quot;);</span> </pre></li>
<li id="l1475"><pre>            <span class="comment">-- The loop is left through an &quot;exit main_loop&quot; statement.</span> </pre></li>
<li id="l1476"><pre>            <span class="comment">-- Should be restructured.</span> </pre></li>
<li id="l1477"><pre>            main_loop : </pre></li>
<li id="l1478"><pre>            <span class="keyword">loop</span> </pre></li>
<li id="l1479"><pre><span class="comment">--              while not UnZ_Glob.Zip_EOF loop</span> </pre></li>
<li id="l1480"><pre><span class="comment">--                 pragma Warnings (On, &quot;variable &quot;&quot;Zip_EOF&quot;&quot; is not modified in loop body&quot;);</span> </pre></li>
<li id="l1481"><pre>               CTE := Tl.<span class="keyword">all</span>.table.<span class="keyword">all</span> (<span class="droplink">UnZ_IO.Bit_buffer.Read<ul><li><a href="src_unzip-decompress.adb.html#l77" title="To spec">To spec</a></li><li><a href="src_unzip-decompress.adb.html#l329" title="To body">To body</a></li></ul></span> (Bl))&apos;Access; </pre></li>
<li id="l1482"><pre> </pre></li>
<li id="l1483"><pre>               <span class="keyword">loop</span> </pre></li>
<li id="l1484"><pre>                  E := CTE.<span class="keyword">all</span>.extra_bits; </pre></li>
<li id="l1485"><pre>                  <span class="keyword">exit</span> <span class="keyword">when</span> E &lt;= 16; </pre></li>
<li id="l1486"><pre>                  <span class="keyword">if</span> E = <span class="droplink">invalid<ul><li><a href="unzip-decompress-huffman.ads.html#unzip-decompress-huffman.ads:18:3" title="To API doc">To API doc</a></li><li><a href="src_unzip-decompress-huffman.ads.html#l18" title="To spec">To spec</a></li></ul></span> <span class="keyword">then</span> </pre></li>
<li id="l1487"><pre>                     <span class="keyword">raise</span> <span class="droplink">Zip.Zip_file_Error<ul><li><a href="zip.ads.html#zip.ads:72:3" title="To API doc">To API doc</a></li><li><a href="src_zip.ads.html#l72" title="To spec">To spec</a></li></ul></span>; </pre></li>
<li id="l1488"><pre>                  <span class="keyword">end</span> <span class="keyword">if</span>; </pre></li>
<li id="l1489"><pre> </pre></li>
<li id="l1490"><pre>                  <span class="comment">-- then it&apos;s a literal</span> </pre></li>
<li id="l1491"><pre>                  <span class="droplink">UnZ_IO.Bit_buffer.Dump<ul><li><a href="src_unzip-decompress.adb.html#l85" title="To spec">To spec</a></li><li><a href="src_unzip-decompress.adb.html#l306" title="To body">To body</a></li></ul></span> (CTE.<span class="keyword">all</span>.bits); </pre></li>
<li id="l1492"><pre>                  E := E - 16; </pre></li>
<li id="l1493"><pre>                  CTE := CTE.<span class="keyword">all</span>.next_table.<span class="keyword">all</span> (<span class="droplink">UnZ_IO.Bit_buffer.Read<ul><li><a href="src_unzip-decompress.adb.html#l77" title="To spec">To spec</a></li><li><a href="src_unzip-decompress.adb.html#l329" title="To body">To body</a></li></ul></span> (E))&apos;Access; </pre></li>
<li id="l1494"><pre>               <span class="keyword">end</span> <span class="keyword">loop</span>; </pre></li>
<li id="l1495"><pre> </pre></li>
<li id="l1496"><pre>               <span class="droplink">UnZ_IO.Bit_buffer.Dump<ul><li><a href="src_unzip-decompress.adb.html#l85" title="To spec">To spec</a></li><li><a href="src_unzip-decompress.adb.html#l306" title="To body">To body</a></li></ul></span> (CTE.<span class="keyword">all</span>.bits); </pre></li>
<li id="l1497"><pre> </pre></li>
<li id="l1498"><pre>               <span class="keyword">case</span> E <span class="keyword">is</span> </pre></li>
<li id="l1499"><pre>               <span class="keyword">when</span> 16 =&gt;     <span class="comment">-- CTE.N is a Litteral</span> </pre></li>
<li id="l1500"><pre>                  <a href="src_unzip-decompress.adb.html#l41" title="defined at unzip-decompress.adb:41:10">UnZ_Glob.slide</a> (W) :=  <span class="droplink">Zip.Byte<ul><li><a href="zip.ads.html#zip.ads:218:11" title="To API doc">To API doc</a></li><li><a href="src_zip.ads.html#l218" title="To spec">To spec</a></li></ul></span> (CTE.<span class="keyword">all</span>.n); </pre></li>
<li id="l1501"><pre>                  W := W + 1; </pre></li>
<li id="l1502"><pre>                  <span class="droplink">UnZ_IO.Flush_if_full<ul><li><a href="src_unzip-decompress.adb.html#l99" title="To spec">To spec</a></li><li><a href="src_unzip-decompress.adb.html#l414" title="To body">To body</a></li></ul></span> (W); </pre></li>
<li id="l1503"><pre> </pre></li>
<li id="l1504"><pre>               <span class="keyword">when</span> 15 =&gt;     <span class="comment">-- End of block (EOB, code 256)</span> </pre></li>
<li id="l1505"><pre>                  <span class="keyword">if</span> <span class="droplink">full_trace<ul><li><a href="unzip-decompress.ads.html#unzip-decompress.ads:51:3" title="To API doc">To API doc</a></li><li><a href="src_unzip-decompress.ads.html#l51" title="To spec">To spec</a></li></ul></span> <span class="keyword">then</span> </pre></li>
<li id="l1506"><pre>                     <span class="keyword">pragma</span> Warnings (Off, <span class="string">&quot;this code can never be executed and has been deleted&quot;</span>); </pre></li>
<li id="l1507"><pre>                     Ada.Text_IO.Put_Line (<span class="string">&quot;Exit  Inflate_codes, e=15 - &gt; EOB&quot;</span>); </pre></li>
<li id="l1508"><pre>                     <span class="keyword">pragma</span> Warnings (On,  <span class="string">&quot;this code can never be executed and has been deleted&quot;</span>); </pre></li>
<li id="l1509"><pre>                  <span class="keyword">end</span> <span class="keyword">if</span>; </pre></li>
<li id="l1510"><pre>                  <span class="keyword">exit</span> main_loop; </pre></li>
<li id="l1511"><pre> </pre></li>
<li id="l1512"><pre>                  <span class="keyword">when</span> <span class="keyword">others</span> =&gt; <span class="comment">-- We have a length/distance</span> </pre></li>
<li id="l1513"><pre> </pre></li>
<li id="l1514"><pre>                  <span class="comment">-- Get length of block to copy:</span> </pre></li>
<li id="l1515"><pre>                  inflate_length := CTE.<span class="keyword">all</span>.n + <span class="droplink">UnZ_IO.Bit_buffer.Read_and_dump<ul><li><a href="src_unzip-decompress.adb.html#l88" title="To spec">To spec</a></li><li><a href="src_unzip-decompress.adb.html#l334" title="To body">To body</a></li></ul></span> (E); </pre></li>
<li id="l1516"><pre> </pre></li>
<li id="l1517"><pre>                  <span class="comment">-- Decode distance of block to copy:</span> </pre></li>
<li id="l1518"><pre>                  CTE := Td.<span class="keyword">all</span>.table.<span class="keyword">all</span> (<span class="droplink">UnZ_IO.Bit_buffer.Read<ul><li><a href="src_unzip-decompress.adb.html#l77" title="To spec">To spec</a></li><li><a href="src_unzip-decompress.adb.html#l329" title="To body">To body</a></li></ul></span> (Bd))&apos;Access; </pre></li>
<li id="l1519"><pre>                  <span class="keyword">loop</span> </pre></li>
<li id="l1520"><pre>                     E := CTE.<span class="keyword">all</span>.extra_bits; </pre></li>
<li id="l1521"><pre>                     <span class="keyword">exit</span> <span class="keyword">when</span> E &lt;= 16; </pre></li>
<li id="l1522"><pre>                     <span class="keyword">if</span> E = <span class="droplink">invalid<ul><li><a href="unzip-decompress-huffman.ads.html#unzip-decompress-huffman.ads:18:3" title="To API doc">To API doc</a></li><li><a href="src_unzip-decompress-huffman.ads.html#l18" title="To spec">To spec</a></li></ul></span> <span class="keyword">then</span> </pre></li>
<li id="l1523"><pre>                        <span class="keyword">raise</span> <span class="droplink">Zip.Zip_file_Error<ul><li><a href="zip.ads.html#zip.ads:72:3" title="To API doc">To API doc</a></li><li><a href="src_zip.ads.html#l72" title="To spec">To spec</a></li></ul></span>; </pre></li>
<li id="l1524"><pre>                     <span class="keyword">end</span> <span class="keyword">if</span>; </pre></li>
<li id="l1525"><pre>                     <span class="droplink">UnZ_IO.Bit_buffer.Dump<ul><li><a href="src_unzip-decompress.adb.html#l85" title="To spec">To spec</a></li><li><a href="src_unzip-decompress.adb.html#l306" title="To body">To body</a></li></ul></span> (CTE.<span class="keyword">all</span>.bits); </pre></li>
<li id="l1526"><pre>                     E := E - 16; </pre></li>
<li id="l1527"><pre>                     CTE := CTE.<span class="keyword">all</span>.next_table.<span class="keyword">all</span> (<span class="droplink">UnZ_IO.Bit_buffer.Read<ul><li><a href="src_unzip-decompress.adb.html#l77" title="To spec">To spec</a></li><li><a href="src_unzip-decompress.adb.html#l329" title="To body">To body</a></li></ul></span> (E))&apos;Access; </pre></li>
<li id="l1528"><pre>                  <span class="keyword">end</span> <span class="keyword">loop</span>; </pre></li>
<li id="l1529"><pre>                  <span class="droplink">UnZ_IO.Bit_buffer.Dump<ul><li><a href="src_unzip-decompress.adb.html#l85" title="To spec">To spec</a></li><li><a href="src_unzip-decompress.adb.html#l306" title="To body">To body</a></li></ul></span> (CTE.<span class="keyword">all</span>.bits); </pre></li>
<li id="l1530"><pre>                  <span class="droplink">UnZ_IO.Copy<ul><li><a href="src_unzip-decompress.adb.html#l102" title="To spec">To spec</a></li><li><a href="src_unzip-decompress.adb.html#l496" title="To body">To body</a></li></ul></span> ( </pre></li>
<li id="l1531"><pre>                               <a href="src_unzip-decompress.adb.html#l102" title="defined at unzip-decompress.adb:102:26">distance</a> =&gt; CTE.<span class="keyword">all</span>.n + <span class="droplink">UnZ_IO.Bit_buffer.Read_and_dump<ul><li><a href="src_unzip-decompress.adb.html#l88" title="To spec">To spec</a></li><li><a href="src_unzip-decompress.adb.html#l334" title="To body">To body</a></li></ul></span> (E), </pre></li>
<li id="l1532"><pre>                               <a href="src_unzip-decompress.adb.html#l102" title="defined at unzip-decompress.adb:102:36">copy_length</a>   =&gt; inflate_length, </pre></li>
<li id="l1533"><pre>                               <a href="src_unzip-decompress.adb.html#l103" title="defined at unzip-decompress.adb:103:26">index</a>    =&gt; W </pre></li>
<li id="l1534"><pre>                              ); </pre></li>
<li id="l1535"><pre>               <span class="keyword">end</span> <span class="keyword">case</span>; </pre></li>
<li id="l1536"><pre>            <span class="keyword">end</span> <span class="keyword">loop</span> main_loop; </pre></li>
<li id="l1537"><pre> </pre></li>
<li id="l1538"><pre>            <a href="src_unzip-decompress.adb.html#l42" title="defined at unzip-decompress.adb:42:10">UnZ_Glob.slide_index</a> := W; </pre></li>
<li id="l1539"><pre> </pre></li>
<li id="l1540"><pre>            <span class="keyword">if</span> <span class="droplink">full_trace<ul><li><a href="unzip-decompress.ads.html#unzip-decompress.ads:51:3" title="To API doc">To API doc</a></li><li><a href="src_unzip-decompress.ads.html#l51" title="To spec">To spec</a></li></ul></span> <span class="keyword">then</span> </pre></li>
<li id="l1541"><pre>               <span class="keyword">pragma</span> Warnings (Off, <span class="string">&quot;this code can never be executed and has been deleted&quot;</span>); </pre></li>
<li id="l1542"><pre>               Ada.Text_IO.Put_Line (<span class="string">&quot;End   Inflate_codes&quot;</span>); </pre></li>
<li id="l1543"><pre>               <span class="keyword">pragma</span> Warnings (On,  <span class="string">&quot;this code can never be executed and has been deleted&quot;</span>); </pre></li>
<li id="l1544"><pre>            <span class="keyword">end</span> <span class="keyword">if</span>; </pre></li>
<li id="l1545"><pre>         <span class="keyword">end</span> Inflate_Codes; </pre></li>
<li id="l1546"><pre> </pre></li>
<li id="l1547"><pre>         <span class="keyword">procedure</span> Inflate_stored_block <span class="keyword">is</span> <span class="comment">-- Actually, nothing to inflate</span> </pre></li>
<li id="l1548"><pre>            N  : Integer; </pre></li>
<li id="l1549"><pre>         <span class="keyword">begin</span> </pre></li>
<li id="l1550"><pre>            <span class="keyword">if</span> <span class="droplink">full_trace<ul><li><a href="unzip-decompress.ads.html#unzip-decompress.ads:51:3" title="To API doc">To API doc</a></li><li><a href="src_unzip-decompress.ads.html#l51" title="To spec">To spec</a></li></ul></span> <span class="keyword">then</span> </pre></li>
<li id="l1551"><pre>               <span class="keyword">pragma</span> Warnings (Off, <span class="string">&quot;this code can never be executed and has been deleted&quot;</span>); </pre></li>
<li id="l1552"><pre>               Ada.Text_IO.Put_Line (<span class="string">&quot;Begin Inflate_stored_block&quot;</span>); </pre></li>
<li id="l1553"><pre>               <span class="keyword">pragma</span> Warnings (On,  <span class="string">&quot;this code can never be executed and has been deleted&quot;</span>); </pre></li>
<li id="l1554"><pre>            <span class="keyword">end</span> <span class="keyword">if</span>; </pre></li>
<li id="l1555"><pre>            <span class="droplink">UnZ_IO.Bit_buffer.Dump_to_byte_boundary<ul><li><a href="src_unzip-decompress.adb.html#l87" title="To spec">To spec</a></li><li><a href="src_unzip-decompress.adb.html#l312" title="To body">To body</a></li></ul></span>; </pre></li>
<li id="l1556"><pre> </pre></li>
<li id="l1557"><pre>            <span class="comment">-- Get the block length and its complement</span> </pre></li>
<li id="l1558"><pre>            N := <span class="droplink">UnZ_IO.Bit_buffer.Read_and_dump<ul><li><a href="src_unzip-decompress.adb.html#l88" title="To spec">To spec</a></li><li><a href="src_unzip-decompress.adb.html#l334" title="To body">To body</a></li></ul></span> (16); </pre></li>
<li id="l1559"><pre>            <span class="keyword">if</span>  N /= Integer ( </pre></li>
<li id="l1560"><pre>                              (<span class="keyword">not</span> <span class="droplink">UnZ_IO.Bit_buffer.Read_and_dump_U32<ul><li><a href="src_unzip-decompress.adb.html#l90" title="To spec">To spec</a></li><li><a href="src_unzip-decompress.adb.html#l342" title="To body">To body</a></li></ul></span> (16)) </pre></li>
<li id="l1561"><pre>                              <span class="keyword">and</span> 16#ffff#) </pre></li>
<li id="l1562"><pre>            <span class="keyword">then</span> </pre></li>
<li id="l1563"><pre>               <span class="keyword">raise</span> <span class="droplink">Zip.Zip_file_Error<ul><li><a href="zip.ads.html#zip.ads:72:3" title="To API doc">To API doc</a></li><li><a href="src_zip.ads.html#l72" title="To spec">To spec</a></li></ul></span>; </pre></li>
<li id="l1564"><pre>            <span class="keyword">end</span> <span class="keyword">if</span>; </pre></li>
<li id="l1565"><pre>            <span class="keyword">while</span> N &gt; 0  <span class="keyword">and</span> <span class="keyword">then</span> <span class="keyword">not</span> <a href="src_unzip-decompress.adb.html#l52" title="defined at unzip-decompress.adb:52:10">UnZ_Glob.Zip_EOF</a> <span class="keyword">loop</span> </pre></li>
<li id="l1566"><pre>               <span class="comment">-- Read and output the non - compressed data</span> </pre></li>
<li id="l1567"><pre>               N := N - 1; </pre></li>
<li id="l1568"><pre>               <a href="src_unzip-decompress.adb.html#l41" title="defined at unzip-decompress.adb:41:10">UnZ_Glob.slide</a> (<a href="src_unzip-decompress.adb.html#l42" title="defined at unzip-decompress.adb:42:10">UnZ_Glob.slide_index</a>) := </pre></li>
<li id="l1569"><pre>                 <span class="droplink">Zip.Byte<ul><li><a href="zip.ads.html#zip.ads:218:11" title="To API doc">To API doc</a></li><li><a href="src_zip.ads.html#l218" title="To spec">To spec</a></li></ul></span> (<span class="droplink">UnZ_IO.Bit_buffer.Read_and_dump<ul><li><a href="src_unzip-decompress.adb.html#l88" title="To spec">To spec</a></li><li><a href="src_unzip-decompress.adb.html#l334" title="To body">To body</a></li></ul></span> (8)); </pre></li>
<li id="l1570"><pre>               <a href="src_unzip-decompress.adb.html#l42" title="defined at unzip-decompress.adb:42:10">UnZ_Glob.slide_index</a> := <a href="src_unzip-decompress.adb.html#l42" title="defined at unzip-decompress.adb:42:10">UnZ_Glob.slide_index</a> + 1; </pre></li>
<li id="l1571"><pre>               <span class="droplink">UnZ_IO.Flush_if_full<ul><li><a href="src_unzip-decompress.adb.html#l99" title="To spec">To spec</a></li><li><a href="src_unzip-decompress.adb.html#l414" title="To body">To body</a></li></ul></span> (<a href="src_unzip-decompress.adb.html#l42" title="defined at unzip-decompress.adb:42:10">UnZ_Glob.slide_index</a>); </pre></li>
<li id="l1572"><pre>            <span class="keyword">end</span> <span class="keyword">loop</span>; </pre></li>
<li id="l1573"><pre>            <span class="keyword">if</span> <span class="droplink">full_trace<ul><li><a href="unzip-decompress.ads.html#unzip-decompress.ads:51:3" title="To API doc">To API doc</a></li><li><a href="src_unzip-decompress.ads.html#l51" title="To spec">To spec</a></li></ul></span> <span class="keyword">then</span> </pre></li>
<li id="l1574"><pre>               <span class="keyword">pragma</span> Warnings (Off, <span class="string">&quot;this code can never be executed and has been deleted&quot;</span>); </pre></li>
<li id="l1575"><pre>               Ada.Text_IO.Put_Line (<span class="string">&quot;End   Inflate_stored_block&quot;</span>); </pre></li>
<li id="l1576"><pre>               <span class="keyword">pragma</span> Warnings (On,  <span class="string">&quot;this code can never be executed and has been deleted&quot;</span>); </pre></li>
<li id="l1577"><pre>            <span class="keyword">end</span> <span class="keyword">if</span>; </pre></li>
<li id="l1578"><pre>         <span class="keyword">end</span> Inflate_stored_block; </pre></li>
<li id="l1579"><pre> </pre></li>
<li id="l1580"><pre>         <span class="comment">-- Copy lengths for literal codes 257 .. 285</span> </pre></li>
<li id="l1581"><pre> </pre></li>
<li id="l1582"><pre>         copy_lengths_literal  : <span class="droplink">Length_array<ul><li><a href="unzip-decompress-huffman.ads.html#unzip-decompress-huffman.ads:34:8" title="To API doc">To API doc</a></li><li><a href="src_unzip-decompress-huffman.ads.html#l34" title="To spec">To spec</a></li></ul></span> (0 .. 30) := </pre></li>
<li id="l1583"><pre>           (3,  4,  5,  6,  7,  8,  9, 10, 11, 13, 15, 17, 19, 23, 27, 31, </pre></li>
<li id="l1584"><pre>            35, 43, 51, 59, 67, 83, 99, 115, 131, 163, 195, 227, 258, 0, 0); </pre></li>
<li id="l1585"><pre> </pre></li>
<li id="l1586"><pre>         <span class="comment">-- Extra bits for literal codes 257 .. 285</span> </pre></li>
<li id="l1587"><pre> </pre></li>
<li id="l1588"><pre>         extra_bits_literal  : <span class="droplink">Length_array<ul><li><a href="unzip-decompress-huffman.ads.html#unzip-decompress-huffman.ads:34:8" title="To API doc">To API doc</a></li><li><a href="src_unzip-decompress-huffman.ads.html#l34" title="To spec">To spec</a></li></ul></span> (0 .. 30) := </pre></li>
<li id="l1589"><pre>           (0, 0, 0, 0, 0, 0, 0, 0, 1, 1, 1, 1, 2, 2, 2, 2, </pre></li>
<li id="l1590"><pre>            3, 3, 3, 3, 4, 4, 4, 4, 5, 5, 5, 5, 0, <span class="droplink">invalid<ul><li><a href="unzip-decompress-huffman.ads.html#unzip-decompress-huffman.ads:18:3" title="To API doc">To API doc</a></li><li><a href="src_unzip-decompress-huffman.ads.html#l18" title="To spec">To spec</a></li></ul></span>, <span class="droplink">invalid<ul><li><a href="unzip-decompress-huffman.ads.html#unzip-decompress-huffman.ads:18:3" title="To API doc">To API doc</a></li><li><a href="src_unzip-decompress-huffman.ads.html#l18" title="To spec">To spec</a></li></ul></span>); </pre></li>
<li id="l1591"><pre> </pre></li>
<li id="l1592"><pre>         <span class="comment">-- Copy offsets for distance codes 0 .. 29 (30 .. 31 : deflate_e)</span> </pre></li>
<li id="l1593"><pre> </pre></li>
<li id="l1594"><pre>         copy_offset_distance  : <span class="keyword">constant</span> <span class="droplink">Length_array<ul><li><a href="unzip-decompress-huffman.ads.html#unzip-decompress-huffman.ads:34:8" title="To API doc">To API doc</a></li><li><a href="src_unzip-decompress-huffman.ads.html#l34" title="To spec">To spec</a></li></ul></span> (0 .. 31) := </pre></li>
<li id="l1595"><pre>           (1, 2, 3, 4, 5, 7, 9, 13, 17, 25, 33, 49, 65, 97, 129, 193, </pre></li>
<li id="l1596"><pre>            257, 385, 513, 769, 1025, 1537, 2049, 3073, 4097, 6145, </pre></li>
<li id="l1597"><pre>            8193, 12289, 16385, 24577, 32769, 49153); </pre></li>
<li id="l1598"><pre> </pre></li>
<li id="l1599"><pre>         <span class="comment">-- Extra bits for distance codes</span> </pre></li>
<li id="l1600"><pre> </pre></li>
<li id="l1601"><pre>         extra_bits_distance  : <span class="keyword">constant</span> <span class="droplink">Length_array<ul><li><a href="unzip-decompress-huffman.ads.html#unzip-decompress-huffman.ads:34:8" title="To API doc">To API doc</a></li><li><a href="src_unzip-decompress-huffman.ads.html#l34" title="To spec">To spec</a></li></ul></span> (0 .. 31) := </pre></li>
<li id="l1602"><pre>           (0, 0, 0, 0, 1, 1, 2, 2, 3, 3, 4, 4, 5, 5, 6, 6, </pre></li>
<li id="l1603"><pre>            7, 7, 8, 8, 9, 9, 10, 10, 11, 11, 12, 12, 13, 13, 14, 14); </pre></li>
<li id="l1604"><pre> </pre></li>
<li id="l1605"><pre>         max_dist : Integer := 29; <span class="comment">-- changed to 31 for deflate_e</span> </pre></li>
<li id="l1606"><pre> </pre></li>
<li id="l1607"><pre>         <span class="keyword">procedure</span> Inflate_fixed_block <span class="keyword">is</span> </pre></li>
<li id="l1608"><pre>            Tl,                        <span class="comment">-- literal/length code table</span> </pre></li>
<li id="l1609"><pre>            Td  : <span class="droplink">p_Table_list<ul><li><a href="unzip-decompress-huffman.ads.html#unzip-decompress-huffman.ads:27:8" title="To API doc">To API doc</a></li><li><a href="src_unzip-decompress-huffman.ads.html#l27" title="To spec">To spec</a></li></ul></span>;            <span class="comment">-- distance code table</span> </pre></li>
<li id="l1610"><pre>            Bl, Bd  : Integer;          <span class="comment">-- lookup bits for tl/bd</span> </pre></li>
<li id="l1611"><pre>            huft_incomplete  : Boolean; </pre></li>
<li id="l1612"><pre> </pre></li>
<li id="l1613"><pre>            <span class="comment">-- length list for HufT_build (literal table)</span> </pre></li>
<li id="l1614"><pre>            L : <span class="keyword">constant</span> <span class="droplink">Length_array<ul><li><a href="unzip-decompress-huffman.ads.html#unzip-decompress-huffman.ads:34:8" title="To API doc">To API doc</a></li><li><a href="src_unzip-decompress-huffman.ads.html#l34" title="To spec">To spec</a></li></ul></span> (0 .. 287) := </pre></li>
<li id="l1615"><pre>              (0 .. 143 =&gt; 8, 144 .. 255 =&gt; 9, 256 .. 279 =&gt; 7, 280 .. 287 =&gt; 8); </pre></li>
<li id="l1616"><pre> </pre></li>
<li id="l1617"><pre>         <span class="keyword">begin</span> </pre></li>
<li id="l1618"><pre>            <span class="keyword">if</span> <span class="droplink">some_trace<ul><li><a href="unzip-decompress.ads.html#unzip-decompress.ads:50:3" title="To API doc">To API doc</a></li><li><a href="src_unzip-decompress.ads.html#l50" title="To spec">To spec</a></li></ul></span> <span class="keyword">then</span> </pre></li>
<li id="l1619"><pre>               <span class="keyword">pragma</span> Warnings (Off, <span class="string">&quot;this code can never be executed and has been deleted&quot;</span>); </pre></li>
<li id="l1620"><pre>               Ada.Text_IO.Put_Line (<span class="string">&quot;Begin Inflate_fixed_block&quot;</span>); </pre></li>
<li id="l1621"><pre>               <span class="keyword">pragma</span> Warnings (On,  <span class="string">&quot;this code can never be executed and has been deleted&quot;</span>); </pre></li>
<li id="l1622"><pre>            <span class="keyword">end</span> <span class="keyword">if</span>; </pre></li>
<li id="l1623"><pre> </pre></li>
<li id="l1624"><pre>            <span class="comment">-- make a complete, but wrong code set</span> </pre></li>
<li id="l1625"><pre>            Bl := 7; </pre></li>
<li id="l1626"><pre>            <span class="droplink">HufT_build<ul><li><a href="unzip-decompress-huffman.ads.html#unzip-decompress-huffman.ads:42:13" title="To API doc">To API doc</a></li><li><a href="src_unzip-decompress-huffman.ads.html#l42" title="To spec">To spec</a></li><li><a href="src_unzip-decompress-huffman.adb.html#l50" title="To body">To body</a></li></ul></span> ( </pre></li>
<li id="l1627"><pre>                        L, 257, copy_lengths_literal, extra_bits_literal, </pre></li>
<li id="l1628"><pre>                        Tl, Bl, huft_incomplete </pre></li>
<li id="l1629"><pre>                       ); </pre></li>
<li id="l1630"><pre> </pre></li>
<li id="l1631"><pre>            <span class="comment">-- Make an incomplete code set</span> </pre></li>
<li id="l1632"><pre>            Bd := 5; </pre></li>
<li id="l1633"><pre>            <span class="keyword">begin</span> </pre></li>
<li id="l1634"><pre>               <span class="droplink">HufT_build<ul><li><a href="unzip-decompress-huffman.ads.html#unzip-decompress-huffman.ads:42:13" title="To API doc">To API doc</a></li><li><a href="src_unzip-decompress-huffman.ads.html#l42" title="To spec">To spec</a></li><li><a href="src_unzip-decompress-huffman.adb.html#l50" title="To body">To body</a></li></ul></span> ( </pre></li>
<li id="l1635"><pre>                           (0 .. max_dist =&gt; 5), 0, </pre></li>
<li id="l1636"><pre>                           copy_offset_distance, extra_bits_distance, </pre></li>
<li id="l1637"><pre>                           Td, Bd, huft_incomplete </pre></li>
<li id="l1638"><pre>                          ); </pre></li>
<li id="l1639"><pre>               <span class="keyword">if</span> huft_incomplete <span class="keyword">then</span> </pre></li>
<li id="l1640"><pre>                  <span class="keyword">if</span> <span class="droplink">full_trace<ul><li><a href="unzip-decompress.ads.html#unzip-decompress.ads:51:3" title="To API doc">To API doc</a></li><li><a href="src_unzip-decompress.ads.html#l51" title="To spec">To spec</a></li></ul></span> <span class="keyword">then</span> </pre></li>
<li id="l1641"><pre>                     <span class="keyword">pragma</span> Warnings (Off, <span class="string">&quot;this code can never be executed and has been deleted&quot;</span>); </pre></li>
<li id="l1642"><pre>                     Ada.Text_IO.Put_Line ( </pre></li>
<li id="l1643"><pre>                                           <span class="string">&quot;td is incomplete, pointer=null : &quot;</span> &amp; </pre></li>
<li id="l1644"><pre>                                             Boolean&apos;Image (Td = <span class="keyword">null</span>) </pre></li>
<li id="l1645"><pre>                                          ); </pre></li>
<li id="l1646"><pre>                     <span class="keyword">pragma</span> Warnings (On,  <span class="string">&quot;this code can never be executed and has been deleted&quot;</span>); </pre></li>
<li id="l1647"><pre>                  <span class="keyword">end</span> <span class="keyword">if</span>; </pre></li>
<li id="l1648"><pre>               <span class="keyword">end</span> <span class="keyword">if</span>; </pre></li>
<li id="l1649"><pre>            <span class="keyword">exception</span> </pre></li>
<li id="l1650"><pre>               <span class="keyword">when</span> <span class="droplink">huft_out_of_memory<ul><li><a href="unzip-decompress-huffman.ads.html#unzip-decompress-huffman.ads:51:3" title="To API doc">To API doc</a></li><li><a href="src_unzip-decompress-huffman.ads.html#l51" title="To spec">To spec</a></li></ul></span> | <span class="droplink">huft_error<ul><li><a href="unzip-decompress-huffman.ads.html#unzip-decompress-huffman.ads:50:3" title="To API doc">To API doc</a></li><li><a href="src_unzip-decompress-huffman.ads.html#l50" title="To spec">To spec</a></li></ul></span> =&gt; </pre></li>
<li id="l1651"><pre>                  <span class="droplink">HufT_free<ul><li><a href="unzip-decompress-huffman.ads.html#unzip-decompress-huffman.ads:39:13" title="To API doc">To API doc</a></li><li><a href="src_unzip-decompress-huffman.ads.html#l39" title="To spec">To spec</a></li><li><a href="src_unzip-decompress-huffman.adb.html#l13" title="To body">To body</a></li></ul></span> (Tl); </pre></li>
<li id="l1652"><pre>                  <span class="keyword">raise</span> <span class="droplink">Zip.Zip_file_Error<ul><li><a href="zip.ads.html#zip.ads:72:3" title="To API doc">To API doc</a></li><li><a href="src_zip.ads.html#l72" title="To spec">To spec</a></li></ul></span>; </pre></li>
<li id="l1653"><pre>            <span class="keyword">end</span>; </pre></li>
<li id="l1654"><pre> </pre></li>
<li id="l1655"><pre>            Inflate_Codes (Tl, Td, Bl, Bd); </pre></li>
<li id="l1656"><pre> </pre></li>
<li id="l1657"><pre>            <span class="droplink">HufT_free<ul><li><a href="unzip-decompress-huffman.ads.html#unzip-decompress-huffman.ads:39:13" title="To API doc">To API doc</a></li><li><a href="src_unzip-decompress-huffman.ads.html#l39" title="To spec">To spec</a></li><li><a href="src_unzip-decompress-huffman.adb.html#l13" title="To body">To body</a></li></ul></span> (Tl); <span class="keyword">pragma</span> Unreferenced (Tl); </pre></li>
<li id="l1658"><pre>            <span class="droplink">HufT_free<ul><li><a href="unzip-decompress-huffman.ads.html#unzip-decompress-huffman.ads:39:13" title="To API doc">To API doc</a></li><li><a href="src_unzip-decompress-huffman.ads.html#l39" title="To spec">To spec</a></li><li><a href="src_unzip-decompress-huffman.adb.html#l13" title="To body">To body</a></li></ul></span> (Td); <span class="keyword">pragma</span> Unreferenced (Td); </pre></li>
<li id="l1659"><pre> </pre></li>
<li id="l1660"><pre>            <span class="keyword">if</span> <span class="droplink">some_trace<ul><li><a href="unzip-decompress.ads.html#unzip-decompress.ads:50:3" title="To API doc">To API doc</a></li><li><a href="src_unzip-decompress.ads.html#l50" title="To spec">To spec</a></li></ul></span> <span class="keyword">then</span> </pre></li>
<li id="l1661"><pre>               <span class="keyword">pragma</span> Warnings (Off, <span class="string">&quot;this code can never be executed and has been deleted&quot;</span>); </pre></li>
<li id="l1662"><pre>               Ada.Text_IO.Put_Line (<span class="string">&quot;End   Inflate_fixed_block&quot;</span>); </pre></li>
<li id="l1663"><pre>               <span class="keyword">pragma</span> Warnings (On,  <span class="string">&quot;this code can never be executed and has been deleted&quot;</span>); </pre></li>
<li id="l1664"><pre>            <span class="keyword">end</span> <span class="keyword">if</span>; </pre></li>
<li id="l1665"><pre>         <span class="keyword">end</span> Inflate_fixed_block; </pre></li>
<li id="l1666"><pre> </pre></li>
<li id="l1667"><pre>         <span class="keyword">procedure</span> Inflate_dynamic_block <span class="keyword">is</span> </pre></li>
<li id="l1668"><pre>            bit_order  : <span class="keyword">constant</span> <span class="keyword">array</span> (0 .. 18) <span class="keyword">of</span> Natural := </pre></li>
<li id="l1669"><pre>              (16, 17, 18, 0, 8, 7, 9, 6, 10, 5, 11, 4, 12, 3, 13, 2, 14, 1, 15); </pre></li>
<li id="l1670"><pre> </pre></li>
<li id="l1671"><pre>            Lbits  : <span class="keyword">constant</span> := 9; </pre></li>
<li id="l1672"><pre>            Dbits  : <span class="keyword">constant</span> := 6; </pre></li>
<li id="l1673"><pre> </pre></li>
<li id="l1674"><pre>            current_length : Natural; </pre></li>
<li id="l1675"><pre>            defined, number_of_lengths : Natural; </pre></li>
<li id="l1676"><pre> </pre></li>
<li id="l1677"><pre>            Tl,                             <span class="comment">-- literal/length code tables</span> </pre></li>
<li id="l1678"><pre>            Td  : <span class="droplink">p_Table_list<ul><li><a href="unzip-decompress-huffman.ads.html#unzip-decompress-huffman.ads:27:8" title="To API doc">To API doc</a></li><li><a href="src_unzip-decompress-huffman.ads.html#l27" title="To spec">To spec</a></li></ul></span>;            <span class="comment">-- distance code tables</span> </pre></li>
<li id="l1679"><pre> </pre></li>
<li id="l1680"><pre>            CTE  : <span class="droplink">p_HufT<ul><li><a href="unzip-decompress-huffman.ads.html#unzip-decompress-huffman.ads:22:8" title="To API doc">To API doc</a></li><li><a href="src_unzip-decompress-huffman.ads.html#l22" title="To spec">To spec</a></li></ul></span>;  <span class="comment">-- current table element</span> </pre></li>
<li id="l1681"><pre> </pre></li>
<li id="l1682"><pre>            Bl, Bd  : Integer;                  <span class="comment">-- lookup bits for tl/bd</span> </pre></li>
<li id="l1683"><pre>            Nb  : Natural;  <span class="comment">-- number of bit length codes</span> </pre></li>
<li id="l1684"><pre>            Nl  : Natural;  <span class="comment">-- number of literal length codes</span> </pre></li>
<li id="l1685"><pre>            Nd  : Natural;  <span class="comment">-- number of distance codes</span> </pre></li>
<li id="l1686"><pre> </pre></li>
<li id="l1687"><pre>            <span class="comment">-- literal/length and distance code lengths</span> </pre></li>
<li id="l1688"><pre>            Ll : <span class="droplink">Length_array<ul><li><a href="unzip-decompress-huffman.ads.html#unzip-decompress-huffman.ads:34:8" title="To API doc">To API doc</a></li><li><a href="src_unzip-decompress-huffman.ads.html#l34" title="To spec">To spec</a></li></ul></span> (0 .. 288 + 32 - 1) := (<span class="keyword">others</span> =&gt; 0); </pre></li>
<li id="l1689"><pre> </pre></li>
<li id="l1690"><pre>            huft_incomplete  : Boolean; </pre></li>
<li id="l1691"><pre> </pre></li>
<li id="l1692"><pre>            <span class="keyword">procedure</span> Repeat_length_code (amount : Natural) <span class="keyword">is</span> </pre></li>
<li id="l1693"><pre>            <span class="keyword">begin</span> </pre></li>
<li id="l1694"><pre>               <span class="keyword">if</span> defined + amount &gt; number_of_lengths <span class="keyword">then</span> </pre></li>
<li id="l1695"><pre>                  <span class="keyword">raise</span> <span class="droplink">Zip.Zip_file_Error<ul><li><a href="zip.ads.html#zip.ads:72:3" title="To API doc">To API doc</a></li><li><a href="src_zip.ads.html#l72" title="To spec">To spec</a></li></ul></span>; </pre></li>
<li id="l1696"><pre>               <span class="keyword">end</span> <span class="keyword">if</span>; </pre></li>
<li id="l1697"><pre>               <span class="keyword">for</span> c <span class="keyword">in</span> <span class="keyword">reverse</span> 1 .. amount <span class="keyword">loop</span> </pre></li>
<li id="l1698"><pre>                  Ll (defined) := current_length; </pre></li>
<li id="l1699"><pre>                  defined := defined + 1; </pre></li>
<li id="l1700"><pre>               <span class="keyword">end</span> <span class="keyword">loop</span>; </pre></li>
<li id="l1701"><pre>            <span class="keyword">end</span> Repeat_length_code; </pre></li>
<li id="l1702"><pre> </pre></li>
<li id="l1703"><pre>         <span class="keyword">begin</span> </pre></li>
<li id="l1704"><pre>            <span class="keyword">if</span> <span class="droplink">some_trace<ul><li><a href="unzip-decompress.ads.html#unzip-decompress.ads:50:3" title="To API doc">To API doc</a></li><li><a href="src_unzip-decompress.ads.html#l50" title="To spec">To spec</a></li></ul></span> <span class="keyword">then</span> </pre></li>
<li id="l1705"><pre>               <span class="keyword">pragma</span> Warnings (Off, <span class="string">&quot;this code can never be executed and has been deleted&quot;</span>); </pre></li>
<li id="l1706"><pre>               Ada.Text_IO.Put_Line (<span class="string">&quot;Begin Inflate_dynamic_block&quot;</span>); </pre></li>
<li id="l1707"><pre>               <span class="keyword">pragma</span> Warnings (On,  <span class="string">&quot;this code can never be executed and has been deleted&quot;</span>); </pre></li>
<li id="l1708"><pre>            <span class="keyword">end</span> <span class="keyword">if</span>; </pre></li>
<li id="l1709"><pre> </pre></li>
<li id="l1710"><pre>            <span class="comment">-- Read in table lengths</span> </pre></li>
<li id="l1711"><pre>            Nl := 257 + <span class="droplink">UnZ_IO.Bit_buffer.Read_and_dump<ul><li><a href="src_unzip-decompress.adb.html#l88" title="To spec">To spec</a></li><li><a href="src_unzip-decompress.adb.html#l334" title="To body">To body</a></li></ul></span> (5); </pre></li>
<li id="l1712"><pre>            Nd :=   1 + <span class="droplink">UnZ_IO.Bit_buffer.Read_and_dump<ul><li><a href="src_unzip-decompress.adb.html#l88" title="To spec">To spec</a></li><li><a href="src_unzip-decompress.adb.html#l334" title="To body">To body</a></li></ul></span> (5); </pre></li>
<li id="l1713"><pre>            Nb :=   4 + <span class="droplink">UnZ_IO.Bit_buffer.Read_and_dump<ul><li><a href="src_unzip-decompress.adb.html#l88" title="To spec">To spec</a></li><li><a href="src_unzip-decompress.adb.html#l334" title="To body">To body</a></li></ul></span> (4); </pre></li>
<li id="l1714"><pre> </pre></li>
<li id="l1715"><pre>            <span class="keyword">if</span> Nl &gt; 288 <span class="keyword">or</span> <span class="keyword">else</span> Nd &gt; 32 <span class="keyword">then</span> </pre></li>
<li id="l1716"><pre>               <span class="keyword">raise</span> <span class="droplink">Zip.Zip_file_Error<ul><li><a href="zip.ads.html#zip.ads:72:3" title="To API doc">To API doc</a></li><li><a href="src_zip.ads.html#l72" title="To spec">To spec</a></li></ul></span>; </pre></li>
<li id="l1717"><pre>            <span class="keyword">end</span> <span class="keyword">if</span>; </pre></li>
<li id="l1718"><pre> </pre></li>
<li id="l1719"><pre>            <span class="comment">-- Read in bit - length - code lengths.</span> </pre></li>
<li id="l1720"><pre>            <span class="comment">-- The rest, Ll (Bit_Order (Nb .. 18)), is already = 0</span> </pre></li>
<li id="l1721"><pre>            <span class="keyword">for</span> J <span class="keyword">in</span>  0 .. Nb - 1  <span class="keyword">loop</span> </pre></li>
<li id="l1722"><pre>               Ll (bit_order (J)) := <span class="droplink">UnZ_IO.Bit_buffer.Read_and_dump<ul><li><a href="src_unzip-decompress.adb.html#l88" title="To spec">To spec</a></li><li><a href="src_unzip-decompress.adb.html#l334" title="To body">To body</a></li></ul></span> (3); </pre></li>
<li id="l1723"><pre>            <span class="keyword">end</span> <span class="keyword">loop</span>; </pre></li>
<li id="l1724"><pre> </pre></li>
<li id="l1725"><pre>            <span class="comment">-- Build decoding table for trees --single level, 7 bit lookup</span> </pre></li>
<li id="l1726"><pre>            Bl := 7; </pre></li>
<li id="l1727"><pre>            <span class="keyword">begin</span> </pre></li>
<li id="l1728"><pre>               <span class="droplink">HufT_build<ul><li><a href="unzip-decompress-huffman.ads.html#unzip-decompress-huffman.ads:42:13" title="To API doc">To API doc</a></li><li><a href="src_unzip-decompress-huffman.ads.html#l42" title="To spec">To spec</a></li><li><a href="src_unzip-decompress-huffman.adb.html#l50" title="To body">To body</a></li></ul></span> ( </pre></li>
<li id="l1729"><pre>                           Ll (0 .. 18), 19, <span class="droplink">empty<ul><li><a href="unzip-decompress-huffman.ads.html#unzip-decompress-huffman.ads:36:3" title="To API doc">To API doc</a></li><li><a href="src_unzip-decompress-huffman.ads.html#l36" title="To spec">To spec</a></li></ul></span>, <span class="droplink">empty<ul><li><a href="unzip-decompress-huffman.ads.html#unzip-decompress-huffman.ads:36:3" title="To API doc">To API doc</a></li><li><a href="src_unzip-decompress-huffman.ads.html#l36" title="To spec">To spec</a></li></ul></span>, Tl, Bl, huft_incomplete </pre></li>
<li id="l1730"><pre>                          ); </pre></li>
<li id="l1731"><pre>               <span class="keyword">if</span> huft_incomplete <span class="keyword">then</span> </pre></li>
<li id="l1732"><pre>                  <span class="droplink">HufT_free<ul><li><a href="unzip-decompress-huffman.ads.html#unzip-decompress-huffman.ads:39:13" title="To API doc">To API doc</a></li><li><a href="src_unzip-decompress-huffman.ads.html#l39" title="To spec">To spec</a></li><li><a href="src_unzip-decompress-huffman.adb.html#l13" title="To body">To body</a></li></ul></span> (Tl); </pre></li>
<li id="l1733"><pre>                  <span class="keyword">raise</span> <span class="droplink">Zip.Zip_file_Error<ul><li><a href="zip.ads.html#zip.ads:72:3" title="To API doc">To API doc</a></li><li><a href="src_zip.ads.html#l72" title="To spec">To spec</a></li></ul></span>; </pre></li>
<li id="l1734"><pre>               <span class="keyword">end</span> <span class="keyword">if</span>; </pre></li>
<li id="l1735"><pre>            <span class="keyword">exception</span> </pre></li>
<li id="l1736"><pre>               <span class="keyword">when</span> <span class="keyword">others</span> =&gt; </pre></li>
<li id="l1737"><pre>                  <span class="keyword">raise</span> <span class="droplink">Zip.Zip_file_Error<ul><li><a href="zip.ads.html#zip.ads:72:3" title="To API doc">To API doc</a></li><li><a href="src_zip.ads.html#l72" title="To spec">To spec</a></li></ul></span>; </pre></li>
<li id="l1738"><pre>            <span class="keyword">end</span>; </pre></li>
<li id="l1739"><pre> </pre></li>
<li id="l1740"><pre>            <span class="comment">-- Read in literal and distance code lengths</span> </pre></li>
<li id="l1741"><pre>            number_of_lengths := Nl + Nd; </pre></li>
<li id="l1742"><pre>            defined := 0; </pre></li>
<li id="l1743"><pre>            current_length := 0; </pre></li>
<li id="l1744"><pre> </pre></li>
<li id="l1745"><pre>            <span class="keyword">while</span>  defined &lt; number_of_lengths  <span class="keyword">loop</span> </pre></li>
<li id="l1746"><pre>               CTE := Tl.<span class="keyword">all</span>.table.<span class="keyword">all</span> (<span class="droplink">UnZ_IO.Bit_buffer.Read<ul><li><a href="src_unzip-decompress.adb.html#l77" title="To spec">To spec</a></li><li><a href="src_unzip-decompress.adb.html#l329" title="To body">To body</a></li></ul></span> (Bl))&apos;Access; </pre></li>
<li id="l1747"><pre>               <span class="droplink">UnZ_IO.Bit_buffer.Dump<ul><li><a href="src_unzip-decompress.adb.html#l85" title="To spec">To spec</a></li><li><a href="src_unzip-decompress.adb.html#l306" title="To body">To body</a></li></ul></span> (CTE.<span class="keyword">all</span>.bits); </pre></li>
<li id="l1748"><pre> </pre></li>
<li id="l1749"><pre>               <span class="keyword">case</span> CTE.<span class="keyword">all</span>.n <span class="keyword">is</span> </pre></li>
<li id="l1750"><pre>               <span class="keyword">when</span> 0 .. 15 =&gt;       <span class="comment">-- length of code in bits (0 .. 15)</span> </pre></li>
<li id="l1751"><pre>                  current_length := CTE.<span class="keyword">all</span>.n; </pre></li>
<li id="l1752"><pre>                  Ll (defined) := current_length; </pre></li>
<li id="l1753"><pre>                  defined := defined + 1; </pre></li>
<li id="l1754"><pre> </pre></li>
<li id="l1755"><pre>               <span class="keyword">when</span> 16 =&gt;          <span class="comment">-- repeat last length 3 to 6 times</span> </pre></li>
<li id="l1756"><pre>                  Repeat_length_code (3 + <span class="droplink">UnZ_IO.Bit_buffer.Read_and_dump<ul><li><a href="src_unzip-decompress.adb.html#l88" title="To spec">To spec</a></li><li><a href="src_unzip-decompress.adb.html#l334" title="To body">To body</a></li></ul></span> (2)); </pre></li>
<li id="l1757"><pre> </pre></li>
<li id="l1758"><pre>               <span class="keyword">when</span> 17 =&gt;          <span class="comment">-- 3 to 10 zero length codes</span> </pre></li>
<li id="l1759"><pre>                  current_length := 0; </pre></li>
<li id="l1760"><pre>                  Repeat_length_code (3 + <span class="droplink">UnZ_IO.Bit_buffer.Read_and_dump<ul><li><a href="src_unzip-decompress.adb.html#l88" title="To spec">To spec</a></li><li><a href="src_unzip-decompress.adb.html#l334" title="To body">To body</a></li></ul></span> (3)); </pre></li>
<li id="l1761"><pre> </pre></li>
<li id="l1762"><pre>               <span class="keyword">when</span> 18 =&gt;          <span class="comment">-- 11 to 138 zero length codes</span> </pre></li>
<li id="l1763"><pre>                  current_length := 0; </pre></li>
<li id="l1764"><pre>                  Repeat_length_code (11 + <span class="droplink">UnZ_IO.Bit_buffer.Read_and_dump<ul><li><a href="src_unzip-decompress.adb.html#l88" title="To spec">To spec</a></li><li><a href="src_unzip-decompress.adb.html#l334" title="To body">To body</a></li></ul></span> (7)); </pre></li>
<li id="l1765"><pre> </pre></li>
<li id="l1766"><pre>               <span class="keyword">when</span> <span class="keyword">others</span> =&gt; </pre></li>
<li id="l1767"><pre>                  <span class="keyword">if</span> <span class="droplink">full_trace<ul><li><a href="unzip-decompress.ads.html#unzip-decompress.ads:51:3" title="To API doc">To API doc</a></li><li><a href="src_unzip-decompress.ads.html#l51" title="To spec">To spec</a></li></ul></span> <span class="keyword">then</span> </pre></li>
<li id="l1768"><pre>                     <span class="keyword">pragma</span> Warnings (Off, <span class="string">&quot;this code can never be executed and has been deleted&quot;</span>); </pre></li>
<li id="l1769"><pre>                     Ada.Text_IO.Put_Line ( </pre></li>
<li id="l1770"><pre>                                           <span class="string">&quot;Illegal length code : &quot;</span> &amp; </pre></li>
<li id="l1771"><pre>                                             Integer&apos;Image (CTE.n) </pre></li>
<li id="l1772"><pre>                                          ); </pre></li>
<li id="l1773"><pre>                     <span class="keyword">pragma</span> Warnings (On,  <span class="string">&quot;this code can never be executed and has been deleted&quot;</span>); </pre></li>
<li id="l1774"><pre>                  <span class="keyword">end</span> <span class="keyword">if</span>; </pre></li>
<li id="l1775"><pre> </pre></li>
<li id="l1776"><pre>               <span class="keyword">end</span> <span class="keyword">case</span>; </pre></li>
<li id="l1777"><pre>            <span class="keyword">end</span> <span class="keyword">loop</span>; </pre></li>
<li id="l1778"><pre> </pre></li>
<li id="l1779"><pre>            <span class="keyword">pragma</span> Warnings (Off, <span class="string">&quot;&quot;</span><span class="string">&quot;Tl&quot;</span><span class="string">&quot; modified by call, but value overwritten at line 1789&quot;</span>); </pre></li>
<li id="l1780"><pre>            <span class="droplink">HufT_free<ul><li><a href="unzip-decompress-huffman.ads.html#unzip-decompress-huffman.ads:39:13" title="To API doc">To API doc</a></li><li><a href="src_unzip-decompress-huffman.ads.html#l39" title="To spec">To spec</a></li><li><a href="src_unzip-decompress-huffman.adb.html#l13" title="To body">To body</a></li></ul></span> (Tl);      <span class="comment">-- free decoding table for trees</span> </pre></li>
<li id="l1781"><pre>            <span class="keyword">pragma</span> Warnings (On,  <span class="string">&quot;&quot;</span><span class="string">&quot;Tl&quot;</span><span class="string">&quot; modified by call, but value overwritten at line 1789&quot;</span>); </pre></li>
<li id="l1782"><pre> </pre></li>
<li id="l1783"><pre>            <span class="comment">-- Build the decoding tables for literal/length codes</span> </pre></li>
<li id="l1784"><pre>            Bl := Lbits; </pre></li>
<li id="l1785"><pre>            <span class="keyword">begin</span> </pre></li>
<li id="l1786"><pre>               <span class="droplink">HufT_build<ul><li><a href="unzip-decompress-huffman.ads.html#unzip-decompress-huffman.ads:42:13" title="To API doc">To API doc</a></li><li><a href="src_unzip-decompress-huffman.ads.html#l42" title="To spec">To spec</a></li><li><a href="src_unzip-decompress-huffman.adb.html#l50" title="To body">To body</a></li></ul></span> ( </pre></li>
<li id="l1787"><pre>                           Ll (0 .. Nl - 1), 257, </pre></li>
<li id="l1788"><pre>                           copy_lengths_literal, extra_bits_literal, </pre></li>
<li id="l1789"><pre>                           Tl, Bl, huft_incomplete </pre></li>
<li id="l1790"><pre>                          ); </pre></li>
<li id="l1791"><pre>               <span class="keyword">if</span> huft_incomplete <span class="keyword">then</span> </pre></li>
<li id="l1792"><pre>                  <span class="droplink">HufT_free<ul><li><a href="unzip-decompress-huffman.ads.html#unzip-decompress-huffman.ads:39:13" title="To API doc">To API doc</a></li><li><a href="src_unzip-decompress-huffman.ads.html#l39" title="To spec">To spec</a></li><li><a href="src_unzip-decompress-huffman.adb.html#l13" title="To body">To body</a></li></ul></span> (Tl); </pre></li>
<li id="l1793"><pre>                  <span class="keyword">raise</span> <span class="droplink">Zip.Zip_file_Error<ul><li><a href="zip.ads.html#zip.ads:72:3" title="To API doc">To API doc</a></li><li><a href="src_zip.ads.html#l72" title="To spec">To spec</a></li></ul></span>; </pre></li>
<li id="l1794"><pre>               <span class="keyword">end</span> <span class="keyword">if</span>; </pre></li>
<li id="l1795"><pre>            <span class="keyword">exception</span> </pre></li>
<li id="l1796"><pre>               <span class="keyword">when</span> <span class="keyword">others</span> =&gt; </pre></li>
<li id="l1797"><pre>                  <span class="keyword">raise</span> <span class="droplink">Zip.Zip_file_Error<ul><li><a href="zip.ads.html#zip.ads:72:3" title="To API doc">To API doc</a></li><li><a href="src_zip.ads.html#l72" title="To spec">To spec</a></li></ul></span>; </pre></li>
<li id="l1798"><pre>            <span class="keyword">end</span>; </pre></li>
<li id="l1799"><pre> </pre></li>
<li id="l1800"><pre>            <span class="comment">-- Build the decoding tables for distance codes</span> </pre></li>
<li id="l1801"><pre>            Bd := Dbits; </pre></li>
<li id="l1802"><pre>            <span class="keyword">begin</span> </pre></li>
<li id="l1803"><pre>               <span class="droplink">HufT_build<ul><li><a href="unzip-decompress-huffman.ads.html#unzip-decompress-huffman.ads:42:13" title="To API doc">To API doc</a></li><li><a href="src_unzip-decompress-huffman.ads.html#l42" title="To spec">To spec</a></li><li><a href="src_unzip-decompress-huffman.adb.html#l50" title="To body">To body</a></li></ul></span> ( </pre></li>
<li id="l1804"><pre>                           Ll (Nl .. Nl + Nd - 1), 0, </pre></li>
<li id="l1805"><pre>                           copy_offset_distance, extra_bits_distance, </pre></li>
<li id="l1806"><pre>                           Td, Bd, huft_incomplete </pre></li>
<li id="l1807"><pre>                          ); </pre></li>
<li id="l1808"><pre>               <span class="keyword">if</span> huft_incomplete <span class="keyword">then</span> <span class="comment">-- do nothing!</span> </pre></li>
<li id="l1809"><pre>                  <span class="keyword">if</span> <span class="droplink">some_trace<ul><li><a href="unzip-decompress.ads.html#unzip-decompress.ads:50:3" title="To API doc">To API doc</a></li><li><a href="src_unzip-decompress.ads.html#l50" title="To spec">To spec</a></li></ul></span> <span class="keyword">then</span> </pre></li>
<li id="l1810"><pre>                     <span class="keyword">pragma</span> Warnings (Off, <span class="string">&quot;this code can never be executed and has been deleted&quot;</span>); </pre></li>
<li id="l1811"><pre>                     Ada.Text_IO.Put_Line (<span class="string">&quot;PKZIP 1.93a bug workaround&quot;</span>); </pre></li>
<li id="l1812"><pre>                     <span class="keyword">pragma</span> Warnings (On,  <span class="string">&quot;this code can never be executed and has been deleted&quot;</span>); </pre></li>
<li id="l1813"><pre>                  <span class="keyword">end</span> <span class="keyword">if</span>; </pre></li>
<li id="l1814"><pre>               <span class="keyword">end</span> <span class="keyword">if</span>; </pre></li>
<li id="l1815"><pre>            <span class="keyword">exception</span> </pre></li>
<li id="l1816"><pre>               <span class="keyword">when</span> <span class="droplink">huft_out_of_memory<ul><li><a href="unzip-decompress-huffman.ads.html#unzip-decompress-huffman.ads:51:3" title="To API doc">To API doc</a></li><li><a href="src_unzip-decompress-huffman.ads.html#l51" title="To spec">To spec</a></li></ul></span> | <span class="droplink">huft_error<ul><li><a href="unzip-decompress-huffman.ads.html#unzip-decompress-huffman.ads:50:3" title="To API doc">To API doc</a></li><li><a href="src_unzip-decompress-huffman.ads.html#l50" title="To spec">To spec</a></li></ul></span> =&gt; </pre></li>
<li id="l1817"><pre>                  <span class="droplink">HufT_free<ul><li><a href="unzip-decompress-huffman.ads.html#unzip-decompress-huffman.ads:39:13" title="To API doc">To API doc</a></li><li><a href="src_unzip-decompress-huffman.ads.html#l39" title="To spec">To spec</a></li><li><a href="src_unzip-decompress-huffman.adb.html#l13" title="To body">To body</a></li></ul></span> (Tl); </pre></li>
<li id="l1818"><pre>                  <span class="keyword">raise</span> <span class="droplink">Zip.Zip_file_Error<ul><li><a href="zip.ads.html#zip.ads:72:3" title="To API doc">To API doc</a></li><li><a href="src_zip.ads.html#l72" title="To spec">To spec</a></li></ul></span>; </pre></li>
<li id="l1819"><pre>            <span class="keyword">end</span>; </pre></li>
<li id="l1820"><pre> </pre></li>
<li id="l1821"><pre>            <span class="comment">-- Decompress until an end - of - block code</span> </pre></li>
<li id="l1822"><pre> </pre></li>
<li id="l1823"><pre>            Inflate_Codes (Tl, Td, Bl, Bd); </pre></li>
<li id="l1824"><pre>            <span class="droplink">HufT_free<ul><li><a href="unzip-decompress-huffman.ads.html#unzip-decompress-huffman.ads:39:13" title="To API doc">To API doc</a></li><li><a href="src_unzip-decompress-huffman.ads.html#l39" title="To spec">To spec</a></li><li><a href="src_unzip-decompress-huffman.adb.html#l13" title="To body">To body</a></li></ul></span> (Tl); <span class="keyword">pragma</span> Unreferenced (Tl); </pre></li>
<li id="l1825"><pre>            <span class="droplink">HufT_free<ul><li><a href="unzip-decompress-huffman.ads.html#unzip-decompress-huffman.ads:39:13" title="To API doc">To API doc</a></li><li><a href="src_unzip-decompress-huffman.ads.html#l39" title="To spec">To spec</a></li><li><a href="src_unzip-decompress-huffman.adb.html#l13" title="To body">To body</a></li></ul></span> (Td); <span class="keyword">pragma</span> Unreferenced (Td); </pre></li>
<li id="l1826"><pre> </pre></li>
<li id="l1827"><pre>            <span class="keyword">if</span> <span class="droplink">some_trace<ul><li><a href="unzip-decompress.ads.html#unzip-decompress.ads:50:3" title="To API doc">To API doc</a></li><li><a href="src_unzip-decompress.ads.html#l50" title="To spec">To spec</a></li></ul></span> <span class="keyword">then</span> </pre></li>
<li id="l1828"><pre>               <span class="keyword">pragma</span> Warnings (Off, <span class="string">&quot;this code can never be executed and has been deleted&quot;</span>); </pre></li>
<li id="l1829"><pre>               Ada.Text_IO.Put_Line (<span class="string">&quot;End   Inflate_dynamic_block&quot;</span>); </pre></li>
<li id="l1830"><pre>               <span class="keyword">pragma</span> Warnings (On,  <span class="string">&quot;this code can never be executed and has been deleted&quot;</span>); </pre></li>
<li id="l1831"><pre>            <span class="keyword">end</span> <span class="keyword">if</span>; </pre></li>
<li id="l1832"><pre>         <span class="keyword">end</span> Inflate_dynamic_block; </pre></li>
<li id="l1833"><pre> </pre></li>
<li id="l1834"><pre>         <span class="keyword">procedure</span> Inflate_Block (last_block : <span class="keyword">out</span> Boolean) <span class="keyword">is</span> </pre></li>
<li id="l1835"><pre>         <span class="keyword">begin</span> </pre></li>
<li id="l1836"><pre>            last_block := Boolean&apos;Val (<span class="droplink">UnZ_IO.Bit_buffer.Read_and_dump<ul><li><a href="src_unzip-decompress.adb.html#l88" title="To spec">To spec</a></li><li><a href="src_unzip-decompress.adb.html#l334" title="To body">To body</a></li></ul></span> (1)); </pre></li>
<li id="l1837"><pre>            <span class="keyword">case</span> <span class="droplink">UnZ_IO.Bit_buffer.Read_and_dump<ul><li><a href="src_unzip-decompress.adb.html#l88" title="To spec">To spec</a></li><li><a href="src_unzip-decompress.adb.html#l334" title="To body">To body</a></li></ul></span> (2) <span class="keyword">is</span> <span class="comment">-- Block type = 0, 1, 2, 3</span> </pre></li>
<li id="l1838"><pre>            <span class="keyword">when</span> 0 =&gt;      Inflate_stored_block; </pre></li>
<li id="l1839"><pre>            <span class="keyword">when</span> 1 =&gt;      Inflate_fixed_block; </pre></li>
<li id="l1840"><pre>            <span class="keyword">when</span> 2 =&gt;      Inflate_dynamic_block; </pre></li>
<li id="l1841"><pre>            <span class="keyword">when</span> <span class="keyword">others</span> =&gt; <span class="keyword">raise</span> <span class="droplink">Zip.Zip_file_Error<ul><li><a href="zip.ads.html#zip.ads:72:3" title="To API doc">To API doc</a></li><li><a href="src_zip.ads.html#l72" title="To spec">To spec</a></li></ul></span>; <span class="comment">-- Bad block type (3)</span> </pre></li>
<li id="l1842"><pre>            <span class="keyword">end</span> <span class="keyword">case</span>; </pre></li>
<li id="l1843"><pre>         <span class="keyword">end</span> Inflate_Block; </pre></li>
<li id="l1844"><pre> </pre></li>
<li id="l1845"><pre>         <span class="keyword">procedure</span> <a href="src_unzip-decompress.adb.html#l122" title="defined at unzip-decompress.adb:122:20">Inflate</a> <span class="keyword">is</span> </pre></li>
<li id="l1846"><pre>            is_last_block : Boolean; </pre></li>
<li id="l1847"><pre>            blocks : Positive := 1; </pre></li>
<li id="l1848"><pre>         <span class="keyword">begin</span> </pre></li>
<li id="l1849"><pre>            <span class="keyword">if</span> <a href="src_unzip-decompress.adb.html#l121" title="defined at unzip-decompress.adb:121:10">deflate_e_mode</a> <span class="keyword">then</span> </pre></li>
<li id="l1850"><pre>               copy_lengths_literal (28) := 3; <span class="comment">-- instead of 258</span> </pre></li>
<li id="l1851"><pre>               extra_bits_literal (28) := 16;  <span class="comment">-- instead of 0</span> </pre></li>
<li id="l1852"><pre>               max_dist := 31; </pre></li>
<li id="l1853"><pre>            <span class="keyword">end</span> <span class="keyword">if</span>; </pre></li>
<li id="l1854"><pre>            <span class="keyword">loop</span> </pre></li>
<li id="l1855"><pre>               Inflate_Block (is_last_block); </pre></li>
<li id="l1856"><pre>               <span class="keyword">exit</span> <span class="keyword">when</span> is_last_block; </pre></li>
<li id="l1857"><pre>               blocks := blocks + 1; </pre></li>
<li id="l1858"><pre>            <span class="keyword">end</span> <span class="keyword">loop</span>; </pre></li>
<li id="l1859"><pre>            <span class="droplink">UnZ_IO.Flush<ul><li><a href="src_unzip-decompress.adb.html#l94" title="To spec">To spec</a></li><li><a href="src_unzip-decompress.adb.html#l352" title="To body">To body</a></li></ul></span> (<a href="src_unzip-decompress.adb.html#l42" title="defined at unzip-decompress.adb:42:10">UnZ_Glob.slide_index</a>); </pre></li>
<li id="l1860"><pre>            <a href="src_unzip-decompress.adb.html#l42" title="defined at unzip-decompress.adb:42:10">UnZ_Glob.slide_index</a> := 0; </pre></li>
<li id="l1861"><pre>            <span class="keyword">if</span> <span class="droplink">some_trace<ul><li><a href="unzip-decompress.ads.html#unzip-decompress.ads:50:3" title="To API doc">To API doc</a></li><li><a href="src_unzip-decompress.ads.html#l50" title="To spec">To spec</a></li></ul></span> <span class="keyword">then</span> </pre></li>
<li id="l1862"><pre>               <span class="keyword">pragma</span> Warnings (Off, <span class="string">&quot;this code can never be executed and has been deleted&quot;</span>); </pre></li>
<li id="l1863"><pre>               Ada.Text_IO.Put (<span class="string">&quot;# blocks:&quot;</span> &amp; Integer&apos;Image (blocks)); </pre></li>
<li id="l1864"><pre>               <span class="keyword">pragma</span> Warnings (On,  <span class="string">&quot;this code can never be executed and has been deleted&quot;</span>); </pre></li>
<li id="l1865"><pre>            <span class="keyword">end</span> <span class="keyword">if</span>; </pre></li>
<li id="l1866"><pre>         <span class="keyword">end</span> <span class="droplink">Inflate<ul><li><a href="src_unzip-decompress.adb.html#l122" title="To spec">To spec</a></li><li><a href="src_unzip-decompress.adb.html#l1845" title="To body">To body</a></li></ul></span>; </pre></li>
<li id="l1867"><pre> </pre></li>
<li id="l1868"><pre>         <span class="comment">--------[ Method : BZip2 ] --------</span> </pre></li>
<li id="l1869"><pre> </pre></li>
<li id="l1870"><pre>         <span class="keyword">procedure</span> <a href="src_unzip-decompress.adb.html#l123" title="defined at unzip-decompress.adb:123:20">Bunzip2</a> <span class="keyword">is</span> </pre></li>
<li id="l1871"><pre>            <span class="keyword">type</span> BZ_Buffer <span class="keyword">is</span> <span class="keyword">array</span> (Natural <span class="keyword">range</span> &lt;&gt;) <span class="keyword">of</span> Interfaces.Unsigned_8; </pre></li>
<li id="l1872"><pre>            <span class="keyword">procedure</span> Read (b : <span class="keyword">out</span> BZ_Buffer) <span class="keyword">is</span> </pre></li>
<li id="l1873"><pre>            <span class="keyword">begin</span> </pre></li>
<li id="l1874"><pre>               <span class="keyword">for</span> i <span class="keyword">in</span> b&apos;Range <span class="keyword">loop</span> </pre></li>
<li id="l1875"><pre>                  <span class="keyword">exit</span> <span class="keyword">when</span> <a href="src_unzip-decompress.adb.html#l52" title="defined at unzip-decompress.adb:52:10">UnZ_Glob.Zip_EOF</a>; </pre></li>
<li id="l1876"><pre>                  <span class="droplink">UnZ_IO.Read_raw_byte<ul><li><a href="src_unzip-decompress.adb.html#l71" title="To spec">To spec</a></li><li><a href="src_unzip-decompress.adb.html#l279" title="To body">To body</a></li></ul></span> (b (i)); </pre></li>
<li id="l1877"><pre>               <span class="keyword">end</span> <span class="keyword">loop</span>; </pre></li>
<li id="l1878"><pre>            <span class="keyword">end</span> Read; </pre></li>
<li id="l1879"><pre>            <span class="keyword">procedure</span> Write (b : BZ_Buffer) <span class="keyword">is</span> </pre></li>
<li id="l1880"><pre>            <span class="keyword">begin</span> </pre></li>
<li id="l1881"><pre>               <span class="keyword">for</span> i <span class="keyword">in</span> b&apos;Range <span class="keyword">loop</span> </pre></li>
<li id="l1882"><pre>                  <a href="src_unzip-decompress.adb.html#l41" title="defined at unzip-decompress.adb:41:10">UnZ_Glob.slide</a> (<a href="src_unzip-decompress.adb.html#l42" title="defined at unzip-decompress.adb:42:10">UnZ_Glob.slide_index</a>) := b (i); </pre></li>
<li id="l1883"><pre>                  <a href="src_unzip-decompress.adb.html#l42" title="defined at unzip-decompress.adb:42:10">UnZ_Glob.slide_index</a> := <a href="src_unzip-decompress.adb.html#l42" title="defined at unzip-decompress.adb:42:10">UnZ_Glob.slide_index</a> + 1; </pre></li>
<li id="l1884"><pre>                  <span class="droplink">UnZ_IO.Flush_if_full<ul><li><a href="src_unzip-decompress.adb.html#l99" title="To spec">To spec</a></li><li><a href="src_unzip-decompress.adb.html#l414" title="To body">To body</a></li></ul></span> (<a href="src_unzip-decompress.adb.html#l42" title="defined at unzip-decompress.adb:42:10">UnZ_Glob.slide_index</a>); </pre></li>
<li id="l1885"><pre>               <span class="keyword">end</span> <span class="keyword">loop</span>; </pre></li>
<li id="l1886"><pre>            <span class="keyword">end</span> Write; </pre></li>
<li id="l1887"><pre>            <span class="keyword">package</span> My_BZip2 <span class="keyword">is</span> <span class="keyword">new</span> <span class="droplink">BZip2<ul><li><a href="bzip2.ads.html#bzip2.ads:81:9" title="To API doc">To API doc</a></li><li><a href="src_bzip2.ads.html#l81" title="To spec">To spec</a></li><li><a href="src_bzip2.adb.html#l16" title="To body">To body</a></li></ul></span> </pre></li>
<li id="l1888"><pre>              (<span class="droplink">Buffer<ul><li><a href="bzip2.ads.html#bzip2.ads:72:8" title="To API doc">To API doc</a></li><li><a href="src_bzip2.ads.html#l72" title="To spec">To spec</a></li></ul></span>    =&gt; BZ_Buffer, </pre></li>
<li id="l1889"><pre>               <span class="droplink">check_CRC<ul><li><a href="bzip2.ads.html#bzip2.ads:74:3" title="To API doc">To API doc</a></li><li><a href="src_bzip2.ads.html#l74" title="To spec">To spec</a></li></ul></span> =&gt; False, <span class="comment">-- Already done by UnZ_IO</span> </pre></li>
<li id="l1890"><pre>               <span class="droplink">Read<ul><li><a href="bzip2.ads.html#bzip2.ads:78:18" title="To API doc">To API doc</a></li><li><a href="src_bzip2.ads.html#l78" title="To spec">To spec</a></li></ul></span>      =&gt; Read, </pre></li>
<li id="l1891"><pre>               <span class="droplink">Write<ul><li><a href="bzip2.ads.html#bzip2.ads:79:18" title="To API doc">To API doc</a></li><li><a href="src_bzip2.ads.html#l79" title="To spec">To spec</a></li></ul></span>     =&gt; Write </pre></li>
<li id="l1892"><pre>              ); </pre></li>
<li id="l1893"><pre>         <span class="keyword">begin</span> </pre></li>
<li id="l1894"><pre>            <span class="droplink">My_BZip2.Decompress<ul><li><a href="bzip2.ads.html#bzip2.ads:89:13" title="To API doc">To API doc</a></li><li><a href="src_bzip2.ads.html#l89" title="To spec">To spec</a></li><li><a href="src_bzip2.adb.html#l18" title="To body">To body</a></li></ul></span>; </pre></li>
<li id="l1895"><pre>            <span class="droplink">UnZ_IO.Flush<ul><li><a href="src_unzip-decompress.adb.html#l94" title="To spec">To spec</a></li><li><a href="src_unzip-decompress.adb.html#l352" title="To body">To body</a></li></ul></span> (<a href="src_unzip-decompress.adb.html#l42" title="defined at unzip-decompress.adb:42:10">UnZ_Glob.slide_index</a>); </pre></li>
<li id="l1896"><pre>         <span class="keyword">end</span> <span class="droplink">Bunzip2<ul><li><a href="src_unzip-decompress.adb.html#l123" title="To spec">To spec</a></li><li><a href="src_unzip-decompress.adb.html#l1870" title="To body">To body</a></li></ul></span>; </pre></li>
<li id="l1897"><pre> </pre></li>
<li id="l1898"><pre>      <span class="keyword">end</span> <span class="droplink">UnZ_Meth<ul><li><a href="src_unzip-decompress.adb.html#l115" title="To spec">To spec</a></li><li><a href="src_unzip-decompress.adb.html#l559" title="To body">To body</a></li></ul></span>; </pre></li>
<li id="l1899"><pre> </pre></li>
<li id="l1900"><pre>      <span class="keyword">procedure</span> Process (descriptor : <span class="keyword">out</span> <span class="droplink">Zip.Headers.Data_descriptor<ul><li><a href="zip-headers.ads.html#zip-headers.ads:30:8" title="To API doc">To API doc</a></li><li><a href="src_zip-headers.ads.html#l30" title="To spec">To spec</a></li></ul></span>) </pre></li>
<li id="l1901"><pre>      <span class="keyword">is</span> </pre></li>
<li id="l1902"><pre>         start : Integer; </pre></li>
<li id="l1903"><pre>         b : Unsigned_8; </pre></li>
<li id="l1904"><pre>         dd_buffer : <span class="droplink">Zip.Byte_Buffer<ul><li><a href="zip.ads.html#zip.ads:219:8" title="To API doc">To API doc</a></li><li><a href="src_zip.ads.html#l219" title="To spec">To spec</a></li></ul></span> (1 .. 30); </pre></li>
<li id="l1905"><pre>      <span class="keyword">begin</span> </pre></li>
<li id="l1906"><pre>         <span class="droplink">UnZ_IO.Bit_buffer.Dump_to_byte_boundary<ul><li><a href="src_unzip-decompress.adb.html#l87" title="To spec">To spec</a></li><li><a href="src_unzip-decompress.adb.html#l312" title="To body">To body</a></li></ul></span>; </pre></li>
<li id="l1907"><pre>         <span class="droplink">UnZ_IO.Read_raw_byte<ul><li><a href="src_unzip-decompress.adb.html#l71" title="To spec">To spec</a></li><li><a href="src_unzip-decompress.adb.html#l279" title="To body">To body</a></li></ul></span> (<a href="src_unzip-decompress.adb.html#l1903" title="defined at unzip-decompress.adb:1903:10">b</a>); </pre></li>
<li id="l1908"><pre>         <span class="keyword">if</span> <a href="src_unzip-decompress.adb.html#l1903" title="defined at unzip-decompress.adb:1903:10">b</a> = 75 <span class="keyword">then</span> <span class="comment">-- &apos;K&apos; (&apos;P&apos; is before, Java/JAR bug!)</span> </pre></li>
<li id="l1909"><pre>            <a href="src_unzip-decompress.adb.html#l1904" title="defined at unzip-decompress.adb:1904:10">dd_buffer</a> (1) := 80; </pre></li>
<li id="l1910"><pre>            <a href="src_unzip-decompress.adb.html#l1904" title="defined at unzip-decompress.adb:1904:10">dd_buffer</a> (2) := 75; </pre></li>
<li id="l1911"><pre>            <a href="src_unzip-decompress.adb.html#l1902" title="defined at unzip-decompress.adb:1902:10">start</a> := 3; </pre></li>
<li id="l1912"><pre>         <span class="keyword">else</span> </pre></li>
<li id="l1913"><pre>            <a href="src_unzip-decompress.adb.html#l1904" title="defined at unzip-decompress.adb:1904:10">dd_buffer</a> (1) := <a href="src_unzip-decompress.adb.html#l1903" title="defined at unzip-decompress.adb:1903:10">b</a>; <span class="comment">-- hopefully = 80</span> </pre></li>
<li id="l1914"><pre>            <a href="src_unzip-decompress.adb.html#l1902" title="defined at unzip-decompress.adb:1902:10">start</a> := 2; </pre></li>
<li id="l1915"><pre>         <span class="keyword">end</span> <span class="keyword">if</span>; </pre></li>
<li id="l1916"><pre>         <span class="keyword">for</span> i <span class="keyword">in</span> <a href="src_unzip-decompress.adb.html#l1902" title="defined at unzip-decompress.adb:1902:10">start</a> .. 16 <span class="keyword">loop</span> </pre></li>
<li id="l1917"><pre>            <span class="droplink">UnZ_IO.Read_raw_byte<ul><li><a href="src_unzip-decompress.adb.html#l71" title="To spec">To spec</a></li><li><a href="src_unzip-decompress.adb.html#l279" title="To body">To body</a></li></ul></span> (<a href="src_unzip-decompress.adb.html#l1904" title="defined at unzip-decompress.adb:1904:10">dd_buffer</a> (i)); </pre></li>
<li id="l1918"><pre>         <span class="keyword">end</span> <span class="keyword">loop</span>; </pre></li>
<li id="l1919"><pre>         <span class="droplink">Zip.Headers.Copy_and_check<ul><li><a href="zip-headers.ads.html#zip-headers.ads:41:13" title="To API doc">To API doc</a></li><li><a href="src_zip-headers.ads.html#l41" title="To spec">To spec</a></li><li><a href="src_zip-headers.adb.html#l307" title="To body">To body</a></li></ul></span> (<a href="src_unzip-decompress.adb.html#l1904" title="defined at unzip-decompress.adb:1904:10">dd_buffer</a>, <a href="src_unzip-decompress.adb.html#l1900" title="defined at unzip-decompress.adb:1900:26">descriptor</a>); </pre></li>
<li id="l1920"><pre>      <span class="keyword">end</span> <span class="droplink">Process<ul><li><a href="src_unzip-decompress.adb.html#l1900" title="To spec">To spec</a></li><li><a href="src_unzip-decompress.adb.html#l1900" title="To body">To body</a></li></ul></span>; </pre></li>
<li id="l1921"><pre> </pre></li>
<li id="l1922"><pre>      tolerance_wrong_password : <span class="keyword">constant</span> := 4; <span class="comment">-- after that, error !</span> </pre></li>
<li id="l1923"><pre>      work_index : Ada.Streams.Stream_IO.Positive_Count; </pre></li>
<li id="l1924"><pre>      <span class="keyword">use</span> <span class="droplink">Zip<ul><li><a href="zip.ads.html#zip.ads:45:9" title="To API doc">To API doc</a></li><li><a href="src_zip.ads.html#l45" title="To spec">To spec</a></li><li><a href="src_zip.adb.html#l9" title="To body">To body</a></li></ul></span>, <span class="droplink">UnZ_Meth<ul><li><a href="src_unzip-decompress.adb.html#l115" title="To spec">To spec</a></li><li><a href="src_unzip-decompress.adb.html#l559" title="To body">To body</a></li></ul></span>; </pre></li>
<li id="l1925"><pre> </pre></li>
<li id="l1926"><pre>   <span class="keyword">begin</span> <span class="comment">-- Decompress_Data</span> </pre></li>
<li id="l1927"><pre>      <span class="droplink">output_memory_access<ul><li><a href="unzip-decompress.ads.html#unzip-decompress.ads:27:5" title="To API doc">To API doc</a></li><li><a href="src_unzip-decompress.ads.html#l27" title="To spec">To spec</a></li></ul></span> := <span class="keyword">null</span>; </pre></li>
<li id="l1928"><pre>      <span class="comment">-- ^ this is an &apos;out&apos; parameter, we have to set it anyway</span> </pre></li>
<li id="l1929"><pre>      <span class="keyword">case</span> <span class="droplink">mode<ul><li><a href="unzip-decompress.ads.html#unzip-decompress.ads:25:5" title="To API doc">To API doc</a></li><li><a href="src_unzip-decompress.ads.html#l25" title="To spec">To spec</a></li><li><a href="src_unzip-decompress.adb.html#l10" title="To body">To body</a></li></ul></span> <span class="keyword">is</span> </pre></li>
<li id="l1930"><pre>      <span class="keyword">when</span> write_to_binary_file =&gt; </pre></li>
<li id="l1931"><pre>         Ada.Streams.Stream_IO.Create (<a href="src_unzip-decompress.adb.html#l57" title="defined at unzip-decompress.adb:57:10">UnZ_IO.out_bin_file</a>, Ada.Streams.Stream_IO.Out_File, <span class="droplink">output_file_name<ul><li><a href="unzip-decompress.ads.html#unzip-decompress.ads:26:5" title="To API doc">To API doc</a></li><li><a href="src_unzip-decompress.ads.html#l26" title="To spec">To spec</a></li></ul></span>, </pre></li>
<li id="l1932"><pre>                                       Form =&gt; To_String (<span class="droplink">Zip.Form_For_IO_Open_N_Create<ul><li><a href="zip.ads.html#zip.ads:77:3" title="To API doc">To API doc</a></li><li><a href="src_zip.ads.html#l77" title="To spec">To spec</a></li></ul></span>)); </pre></li>
<li id="l1933"><pre>      <span class="keyword">when</span> write_to_text_file =&gt; </pre></li>
<li id="l1934"><pre>         Ada.Text_IO.Create (<a href="src_unzip-decompress.adb.html#l58" title="defined at unzip-decompress.adb:58:10">UnZ_IO.out_txt_file</a>, Ada.Text_IO.Out_File, <span class="droplink">output_file_name<ul><li><a href="unzip-decompress.ads.html#unzip-decompress.ads:26:5" title="To API doc">To API doc</a></li><li><a href="src_unzip-decompress.ads.html#l26" title="To spec">To spec</a></li></ul></span>, </pre></li>
<li id="l1935"><pre>                             Form =&gt; To_String (<span class="droplink">Zip.Form_For_IO_Open_N_Create<ul><li><a href="zip.ads.html#zip.ads:77:3" title="To API doc">To API doc</a></li><li><a href="src_zip.ads.html#l77" title="To spec">To spec</a></li></ul></span>)); </pre></li>
<li id="l1936"><pre>      <span class="keyword">when</span> write_to_memory =&gt; </pre></li>
<li id="l1937"><pre>         <span class="droplink">output_memory_access<ul><li><a href="unzip-decompress.ads.html#unzip-decompress.ads:27:5" title="To API doc">To API doc</a></li><li><a href="src_unzip-decompress.ads.html#l27" title="To spec">To spec</a></li></ul></span> := <span class="keyword">new</span> </pre></li>
<li id="l1938"><pre>           Ada.Streams.Stream_Element_Array ( </pre></li>
<li id="l1939"><pre>                                             1 .. Ada.Streams.Stream_Element_Offset (hint.uncompressed_size) </pre></li>
<li id="l1940"><pre>                                            ); </pre></li>
<li id="l1941"><pre>         <a href="src_unzip-decompress.adb.html#l53" title="defined at unzip-decompress.adb:53:10">UnZ_Glob.uncompressed_index</a> := <span class="droplink">output_memory_access<ul><li><a href="unzip-decompress.ads.html#unzip-decompress.ads:27:5" title="To API doc">To API doc</a></li><li><a href="src_unzip-decompress.ads.html#l27" title="To spec">To spec</a></li></ul></span>&apos;First; </pre></li>
<li id="l1942"><pre>      <span class="keyword">when</span> just_test =&gt; </pre></li>
<li id="l1943"><pre>         <span class="keyword">null</span>; </pre></li>
<li id="l1944"><pre>      <span class="keyword">end</span> <span class="keyword">case</span>; </pre></li>
<li id="l1945"><pre> </pre></li>
<li id="l1946"><pre>      <a href="src_unzip-decompress.adb.html#l46" title="defined at unzip-decompress.adb:46:10">UnZ_Glob.compsize</a>  := hint.compressed_size; </pre></li>
<li id="l1947"><pre>      <span class="comment">-- 2008 : from TT&apos;s version:</span> </pre></li>
<li id="l1948"><pre>      <span class="comment">-- Avoid wraparound in read_buffer, when File_size_type&apos;Last is given</span> </pre></li>
<li id="l1949"><pre>      <span class="comment">-- as hint.compressed_size (unknown size)</span> </pre></li>
<li id="l1950"><pre>      <span class="keyword">if</span> <a href="src_unzip-decompress.adb.html#l46" title="defined at unzip-decompress.adb:46:10">UnZ_Glob.compsize</a> &gt; <span class="droplink">File_size_type<ul><li><a href="unzip.ads.html#unzip.ads:190:11" title="To API doc">To API doc</a></li><li><a href="src_unzip.ads.html#l190" title="To spec">To spec</a></li></ul></span>&apos;Last - 2 <span class="keyword">then</span> </pre></li>
<li id="l1951"><pre>         <a href="src_unzip-decompress.adb.html#l46" title="defined at unzip-decompress.adb:46:10">UnZ_Glob.compsize</a> := <span class="droplink">File_size_type<ul><li><a href="unzip.ads.html#unzip.ads:190:11" title="To API doc">To API doc</a></li><li><a href="src_unzip.ads.html#l190" title="To spec">To spec</a></li></ul></span>&apos;Last - 2; </pre></li>
<li id="l1952"><pre>      <span class="keyword">end</span> <span class="keyword">if</span>; </pre></li>
<li id="l1953"><pre>      <a href="src_unzip-decompress.adb.html#l48" title="defined at unzip-decompress.adb:48:10">UnZ_Glob.uncompsize</a> := hint.uncompressed_size; </pre></li>
<li id="l1954"><pre>      <span class="droplink">UnZ_IO.Init_Buffers<ul><li><a href="src_unzip-decompress.adb.html#l61" title="To spec">To spec</a></li><li><a href="src_unzip-decompress.adb.html#l133" title="To body">To body</a></li></ul></span>; </pre></li>
<li id="l1955"><pre>      <span class="droplink">UnZ_IO.Decryption.Set_mode<ul><li><a href="src_unzip-decompress.adb.html#l64" title="To spec">To spec</a></li><li><a href="src_unzip-decompress.adb.html#l207" title="To body">To body</a></li></ul></span> (<span class="droplink">encrypted<ul><li><a href="unzip-decompress.ads.html#unzip-decompress.ads:32:5" title="To API doc">To API doc</a></li><li><a href="src_unzip-decompress.ads.html#l32" title="To spec">To spec</a></li></ul></span>); </pre></li>
<li id="l1956"><pre>      <span class="keyword">if</span> <span class="droplink">encrypted<ul><li><a href="unzip-decompress.ads.html#unzip-decompress.ads:32:5" title="To API doc">To API doc</a></li><li><a href="src_unzip-decompress.ads.html#l32" title="To spec">To spec</a></li></ul></span> <span class="keyword">then</span> </pre></li>
<li id="l1957"><pre>         <a href="src_unzip-decompress.adb.html#l1923" title="defined at unzip-decompress.adb:1923:7">work_index</a> := Ada.Streams.Stream_IO.Positive_Count (<span class="droplink">Zip_Streams.Index<ul><li><a href="zip_streams.ads.html#zip_streams.ads:50:13" title="To API doc">To API doc</a></li><li><a href="src_zip_streams.ads.html#l50" title="To spec">To spec</a></li></ul></span> (<span class="droplink">zip_file<ul><li><a href="unzip-decompress.ads.html#unzip-decompress.ads:21:5" title="To API doc">To API doc</a></li><li><a href="src_unzip-decompress.ads.html#l21" title="To spec">To spec</a></li></ul></span>)); </pre></li>
<li id="l1958"><pre>         password_passes : <span class="keyword">for</span> p <span class="keyword">in</span> 1 .. <a href="src_unzip-decompress.adb.html#l1922" title="defined at unzip-decompress.adb:1922:7">tolerance_wrong_password</a> <span class="keyword">loop</span> </pre></li>
<li id="l1959"><pre>            <span class="keyword">begin</span> </pre></li>
<li id="l1960"><pre>               <span class="droplink">UnZ_IO.Decryption.Init<ul><li><a href="src_unzip-decompress.adb.html#l66" title="To spec">To spec</a></li><li><a href="src_unzip-decompress.adb.html#l236" title="To body">To body</a></li></ul></span> (To_String (<span class="droplink">password<ul><li><a href="unzip-decompress.ads.html#unzip-decompress.ads:33:5" title="To API doc">To API doc</a></li><li><a href="src_unzip-decompress.ads.html#l33" title="To spec">To spec</a></li><li><a href="src_unzip-decompress.adb.html#l18" title="To body">To body</a></li></ul></span>), hint.crc_32); </pre></li>
<li id="l1961"><pre>               <span class="keyword">exit</span> password_passes; <span class="comment">-- the current password fits, then go on!</span> </pre></li>
<li id="l1962"><pre>            <span class="keyword">exception</span> </pre></li>
<li id="l1963"><pre>               <span class="keyword">when</span> <span class="droplink">Wrong_password<ul><li><a href="unzip.ads.html#unzip.ads:289:3" title="To API doc">To API doc</a></li><li><a href="src_unzip.ads.html#l289" title="To spec">To spec</a></li></ul></span> =&gt; </pre></li>
<li id="l1964"><pre>                  <span class="keyword">if</span> p = <a href="src_unzip-decompress.adb.html#l1922" title="defined at unzip-decompress.adb:1922:7">tolerance_wrong_password</a> <span class="keyword">then</span> </pre></li>
<li id="l1965"><pre>                     <span class="keyword">raise</span>; </pre></li>
<li id="l1966"><pre>                  <span class="keyword">end</span> <span class="keyword">if</span>; <span class="comment">-- alarm!</span> </pre></li>
<li id="l1967"><pre>                  <span class="keyword">if</span> <span class="droplink">get_new_password<ul><li><a href="unzip-decompress.ads.html#unzip-decompress.ads:34:5" title="To API doc">To API doc</a></li><li><a href="src_unzip-decompress.ads.html#l34" title="To spec">To spec</a></li></ul></span> /= <span class="keyword">null</span> <span class="keyword">then</span> </pre></li>
<li id="l1968"><pre>                     <span class="droplink">get_new_password<ul><li><a href="unzip-decompress.ads.html#unzip-decompress.ads:34:5" title="To API doc">To API doc</a></li><li><a href="src_unzip-decompress.ads.html#l34" title="To spec">To spec</a></li></ul></span> (<span class="droplink">password<ul><li><a href="unzip-decompress.ads.html#unzip-decompress.ads:33:5" title="To API doc">To API doc</a></li><li><a href="src_unzip-decompress.ads.html#l33" title="To spec">To spec</a></li><li><a href="src_unzip-decompress.adb.html#l18" title="To body">To body</a></li></ul></span>); <span class="comment">-- ask for a new one</span> </pre></li>
<li id="l1969"><pre>                  <span class="keyword">end</span> <span class="keyword">if</span>; </pre></li>
<li id="l1970"><pre>            <span class="keyword">end</span>; </pre></li>
<li id="l1971"><pre>            <span class="comment">-- Go back to data beginning:</span> </pre></li>
<li id="l1972"><pre>            <span class="keyword">begin</span> </pre></li>
<li id="l1973"><pre>               <span class="droplink">Zip_Streams.Set_Index<ul><li><a href="zip_streams.ads.html#zip_streams.ads:46:14" title="To API doc">To API doc</a></li><li><a href="src_zip_streams.ads.html#l46" title="To spec">To spec</a></li></ul></span> (<span class="droplink">zip_file<ul><li><a href="unzip-decompress.ads.html#unzip-decompress.ads:21:5" title="To API doc">To API doc</a></li><li><a href="src_unzip-decompress.ads.html#l21" title="To spec">To spec</a></li></ul></span>, Positive (<a href="src_unzip-decompress.adb.html#l1923" title="defined at unzip-decompress.adb:1923:7">work_index</a>)); </pre></li>
<li id="l1974"><pre>            <span class="keyword">exception</span> </pre></li>
<li id="l1975"><pre>               <span class="keyword">when</span> <span class="keyword">others</span> =&gt; </pre></li>
<li id="l1976"><pre>                  <span class="keyword">raise</span> <span class="droplink">Read_Error<ul><li><a href="unzip.ads.html#unzip.ads:288:3" title="To API doc">To API doc</a></li><li><a href="src_unzip.ads.html#l288" title="To spec">To spec</a></li></ul></span>; </pre></li>
<li id="l1977"><pre>            <span class="keyword">end</span>; </pre></li>
<li id="l1978"><pre>            <span class="droplink">UnZ_IO.Init_Buffers<ul><li><a href="src_unzip-decompress.adb.html#l61" title="To spec">To spec</a></li><li><a href="src_unzip-decompress.adb.html#l133" title="To body">To body</a></li></ul></span>; </pre></li>
<li id="l1979"><pre>         <span class="keyword">end</span> <span class="keyword">loop</span> password_passes; </pre></li>
<li id="l1980"><pre>      <span class="keyword">end</span> <span class="keyword">if</span>; </pre></li>
<li id="l1981"><pre> </pre></li>
<li id="l1982"><pre>      <span class="comment">-- Unzip correct type</span> </pre></li>
<li id="l1983"><pre>      <span class="keyword">begin</span> </pre></li>
<li id="l1984"><pre>         <span class="keyword">case</span> <span class="droplink">format<ul><li><a href="unzip-decompress.ads.html#unzip-decompress.ads:24:5" title="To API doc">To API doc</a></li><li><a href="src_unzip-decompress.ads.html#l24" title="To spec">To spec</a></li><li><a href="src_unzip-decompress.adb.html#l9" title="To body">To body</a></li></ul></span> <span class="keyword">is</span> </pre></li>
<li id="l1985"><pre>         <span class="keyword">when</span> store    =&gt; <span class="droplink">Copy_stored<ul><li><a href="src_unzip-decompress.adb.html#l116" title="To spec">To spec</a></li><li><a href="src_unzip-decompress.adb.html#l1427" title="To body">To body</a></li></ul></span>; </pre></li>
<li id="l1986"><pre>         <span class="keyword">when</span> shrink   =&gt; <span class="droplink">Unshrink<ul><li><a href="src_unzip-decompress.adb.html#l117" title="To spec">To spec</a></li><li><a href="src_unzip-decompress.adb.html#l678" title="To body">To body</a></li></ul></span>; </pre></li>
<li id="l1987"><pre>         <span class="keyword">when</span> reduce_1 =&gt; <span class="droplink">Unreduce<ul><li><a href="src_unzip-decompress.adb.html#l119" title="To spec">To spec</a></li><li><a href="src_unzip-decompress.adb.html#l806" title="To body">To body</a></li></ul></span> (1); </pre></li>
<li id="l1988"><pre>         <span class="keyword">when</span> reduce_2 =&gt; <span class="droplink">Unreduce<ul><li><a href="src_unzip-decompress.adb.html#l119" title="To spec">To spec</a></li><li><a href="src_unzip-decompress.adb.html#l806" title="To body">To body</a></li></ul></span> (2); </pre></li>
<li id="l1989"><pre>         <span class="keyword">when</span> reduce_3 =&gt; <span class="droplink">Unreduce<ul><li><a href="src_unzip-decompress.adb.html#l119" title="To spec">To spec</a></li><li><a href="src_unzip-decompress.adb.html#l806" title="To body">To body</a></li></ul></span> (3); </pre></li>
<li id="l1990"><pre>         <span class="keyword">when</span> reduce_4 =&gt; <span class="droplink">Unreduce<ul><li><a href="src_unzip-decompress.adb.html#l119" title="To spec">To spec</a></li><li><a href="src_unzip-decompress.adb.html#l806" title="To body">To body</a></li></ul></span> (4); </pre></li>
<li id="l1991"><pre>         <span class="keyword">when</span> implode  =&gt; </pre></li>
<li id="l1992"><pre>            <span class="droplink">UnZ_Meth.Explode<ul><li><a href="src_unzip-decompress.adb.html#l120" title="To spec">To spec</a></li><li><a href="src_unzip-decompress.adb.html#l1228" title="To body">To body</a></li></ul></span> (<span class="droplink">explode_literal_tree<ul><li><a href="unzip-decompress.ads.html#unzip-decompress.ads:29:5" title="To API doc">To API doc</a></li><li><a href="src_unzip-decompress.ads.html#l29" title="To spec">To spec</a></li></ul></span>, <span class="droplink">explode_slide_8KB<ul><li><a href="unzip-decompress.ads.html#unzip-decompress.ads:30:5" title="To API doc">To API doc</a></li><li><a href="src_unzip-decompress.ads.html#l30" title="To spec">To spec</a></li></ul></span>); </pre></li>
<li id="l1993"><pre>         <span class="keyword">when</span> deflate | deflate_e =&gt; </pre></li>
<li id="l1994"><pre>            <a href="src_unzip-decompress.adb.html#l121" title="defined at unzip-decompress.adb:121:10">UnZ_Meth.deflate_e_mode</a> := <span class="droplink">format<ul><li><a href="unzip-decompress.ads.html#unzip-decompress.ads:24:5" title="To API doc">To API doc</a></li><li><a href="src_unzip-decompress.ads.html#l24" title="To spec">To spec</a></li><li><a href="src_unzip-decompress.adb.html#l9" title="To body">To body</a></li></ul></span> = deflate_e; </pre></li>
<li id="l1995"><pre>            <span class="droplink">UnZ_Meth.Inflate<ul><li><a href="src_unzip-decompress.adb.html#l122" title="To spec">To spec</a></li><li><a href="src_unzip-decompress.adb.html#l1845" title="To body">To body</a></li></ul></span>; </pre></li>
<li id="l1996"><pre>         <span class="keyword">when</span> Zip.bzip2 =&gt; <span class="droplink">UnZ_Meth.Bunzip2<ul><li><a href="src_unzip-decompress.adb.html#l123" title="To spec">To spec</a></li><li><a href="src_unzip-decompress.adb.html#l1870" title="To body">To body</a></li></ul></span>; </pre></li>
<li id="l1997"><pre>         <span class="keyword">when</span> <span class="keyword">others</span> =&gt; </pre></li>
<li id="l1998"><pre>            <span class="keyword">raise</span> <span class="droplink">Unsupported_method<ul><li><a href="unzip.ads.html#unzip.ads:292:3" title="To API doc">To API doc</a></li><li><a href="src_unzip.ads.html#l292" title="To spec">To spec</a></li></ul></span>; </pre></li>
<li id="l1999"><pre>         <span class="keyword">end</span> <span class="keyword">case</span>; </pre></li>
<li id="l2000"><pre>      <span class="keyword">exception</span> </pre></li>
<li id="l2001"><pre>         <span class="keyword">when</span> <span class="keyword">others</span> =&gt; </pre></li>
<li id="l2002"><pre>            <span class="droplink">UnZ_IO.Delete_output<ul><li><a href="src_unzip-decompress.adb.html#l111" title="To spec">To spec</a></li><li><a href="src_unzip-decompress.adb.html#l543" title="To body">To body</a></li></ul></span>; </pre></li>
<li id="l2003"><pre>            <span class="keyword">raise</span>; </pre></li>
<li id="l2004"><pre>      <span class="keyword">end</span>; </pre></li>
<li id="l2005"><pre>      <a href="src_unzip-decompress.adb.html#l51" title="defined at unzip-decompress.adb:51:10">UnZ_Glob.crc32val</a> := <span class="droplink">Zip.CRC.Final<ul><li><a href="zip-crc.ads.html#zip-crc.ads:9:13" title="To API doc">To API doc</a></li><li><a href="src_zip-crc.ads.html#l9" title="To spec">To spec</a></li><li><a href="src_zip-crc.adb.html#l49" title="To body">To body</a></li></ul></span> (<a href="src_unzip-decompress.adb.html#l51" title="defined at unzip-decompress.adb:51:10">UnZ_Glob.crc32val</a>); </pre></li>
<li id="l2006"><pre>      <span class="comment">-- Decompression done !</span> </pre></li>
<li id="l2007"><pre> </pre></li>
<li id="l2008"><pre>      <span class="keyword">if</span> <span class="droplink">end_data_descriptor<ul><li><a href="unzip-decompress.ads.html#unzip-decompress.ads:31:5" title="To API doc">To API doc</a></li><li><a href="src_unzip-decompress.ads.html#l31" title="To spec">To spec</a></li></ul></span> <span class="keyword">then</span> <span class="comment">-- Sizes and CRC at the end</span> </pre></li>
<li id="l2009"><pre>         <span class="keyword">declare</span> </pre></li>
<li id="l2010"><pre>            memo_uncomp_size : <span class="keyword">constant</span> Unsigned_32 := </pre></li>
<li id="l2011"><pre>              hint.uncompressed_size; </pre></li>
<li id="l2012"><pre>         <span class="keyword">begin</span> </pre></li>
<li id="l2013"><pre>            <span class="droplink">Process<ul><li><a href="src_unzip-decompress.adb.html#l1900" title="To spec">To spec</a></li><li><a href="src_unzip-decompress.adb.html#l1900" title="To body">To body</a></li></ul></span> (<span class="droplink">hint<ul><li><a href="unzip-decompress.ads.html#unzip-decompress.ads:35:5" title="To API doc">To API doc</a></li><li><a href="src_unzip-decompress.ads.html#l35" title="To spec">To spec</a></li><li><a href="src_unzip-decompress.adb.html#l20" title="To body">To body</a></li></ul></span>); <span class="comment">-- CRC for checking and sizes for informing user</span> </pre></li>
<li id="l2014"><pre>            <span class="keyword">if</span> memo_uncomp_size &lt; Unsigned_32&apos;Last <span class="keyword">and</span> <span class="keyword">then</span> <span class="comment">--</span> </pre></li>
<li id="l2015"><pre>              memo_uncomp_size /= hint.uncompressed_size </pre></li>
<li id="l2016"><pre>            <span class="keyword">then</span> </pre></li>
<li id="l2017"><pre>               <span class="droplink">UnZ_IO.Delete_output<ul><li><a href="src_unzip-decompress.adb.html#l111" title="To spec">To spec</a></li><li><a href="src_unzip-decompress.adb.html#l543" title="To body">To body</a></li></ul></span>; </pre></li>
<li id="l2018"><pre>               <span class="keyword">raise</span> <span class="droplink">Uncompressed_size_Error<ul><li><a href="unzip.ads.html#unzip.ads:286:3" title="To API doc">To API doc</a></li><li><a href="src_unzip.ads.html#l286" title="To spec">To spec</a></li></ul></span>; </pre></li>
<li id="l2019"><pre>            <span class="keyword">end</span> <span class="keyword">if</span>; </pre></li>
<li id="l2020"><pre>         <span class="keyword">end</span>; </pre></li>
<li id="l2021"><pre>      <span class="keyword">end</span> <span class="keyword">if</span>; </pre></li>
<li id="l2022"><pre> </pre></li>
<li id="l2023"><pre>      <span class="keyword">if</span> hint.crc_32 /= <a href="src_unzip-decompress.adb.html#l51" title="defined at unzip-decompress.adb:51:10">UnZ_Glob.crc32val</a> <span class="keyword">then</span> </pre></li>
<li id="l2024"><pre>         <span class="droplink">UnZ_IO.Delete_output<ul><li><a href="src_unzip-decompress.adb.html#l111" title="To spec">To spec</a></li><li><a href="src_unzip-decompress.adb.html#l543" title="To body">To body</a></li></ul></span>; </pre></li>
<li id="l2025"><pre>         <span class="keyword">raise</span> <span class="droplink">CRC_Error<ul><li><a href="unzip.ads.html#unzip.ads:285:3" title="To API doc">To API doc</a></li><li><a href="src_unzip.ads.html#l285" title="To spec">To spec</a></li></ul></span>; </pre></li>
<li id="l2026"><pre>      <span class="keyword">end</span> <span class="keyword">if</span>; </pre></li>
<li id="l2027"><pre> </pre></li>
<li id="l2028"><pre>      <span class="keyword">case</span> <span class="droplink">mode<ul><li><a href="unzip-decompress.ads.html#unzip-decompress.ads:25:5" title="To API doc">To API doc</a></li><li><a href="src_unzip-decompress.ads.html#l25" title="To spec">To spec</a></li><li><a href="src_unzip-decompress.adb.html#l10" title="To body">To body</a></li></ul></span> <span class="keyword">is</span> </pre></li>
<li id="l2029"><pre>      <span class="keyword">when</span> write_to_binary_file =&gt; </pre></li>
<li id="l2030"><pre>         Ada.Streams.Stream_IO.Close (<a href="src_unzip-decompress.adb.html#l57" title="defined at unzip-decompress.adb:57:10">UnZ_IO.out_bin_file</a>); </pre></li>
<li id="l2031"><pre>      <span class="keyword">when</span> write_to_text_file =&gt; </pre></li>
<li id="l2032"><pre>         Ada.Text_IO.Close (<a href="src_unzip-decompress.adb.html#l58" title="defined at unzip-decompress.adb:58:10">UnZ_IO.out_txt_file</a>); </pre></li>
<li id="l2033"><pre>      <span class="keyword">when</span> <span class="keyword">others</span> =&gt; </pre></li>
<li id="l2034"><pre>         <span class="keyword">null</span>; </pre></li>
<li id="l2035"><pre>      <span class="keyword">end</span> <span class="keyword">case</span>; </pre></li>
<li id="l2036"><pre> </pre></li>
<li id="l2037"><pre>   <span class="keyword">exception</span> </pre></li>
<li id="l2038"><pre> </pre></li>
<li id="l2039"><pre>      <span class="keyword">when</span> <span class="keyword">others</span> =&gt; <span class="comment">-- close the file in case of an error, if not yet closed</span> </pre></li>
<li id="l2040"><pre>         <span class="keyword">case</span> <span class="droplink">mode<ul><li><a href="unzip-decompress.ads.html#unzip-decompress.ads:25:5" title="To API doc">To API doc</a></li><li><a href="src_unzip-decompress.ads.html#l25" title="To spec">To spec</a></li><li><a href="src_unzip-decompress.adb.html#l10" title="To body">To body</a></li></ul></span> <span class="keyword">is</span> <span class="comment">-- or deleted</span> </pre></li>
<li id="l2041"><pre>         <span class="keyword">when</span> write_to_binary_file =&gt; </pre></li>
<li id="l2042"><pre>            <span class="keyword">if</span> Ada.Streams.Stream_IO.Is_Open (<a href="src_unzip-decompress.adb.html#l57" title="defined at unzip-decompress.adb:57:10">UnZ_IO.out_bin_file</a>) <span class="keyword">then</span> </pre></li>
<li id="l2043"><pre>               Ada.Streams.Stream_IO.Close (<a href="src_unzip-decompress.adb.html#l57" title="defined at unzip-decompress.adb:57:10">UnZ_IO.out_bin_file</a>); </pre></li>
<li id="l2044"><pre>            <span class="keyword">end</span> <span class="keyword">if</span>; </pre></li>
<li id="l2045"><pre>         <span class="keyword">when</span> write_to_text_file =&gt; </pre></li>
<li id="l2046"><pre>            <span class="keyword">if</span> Ada.Text_IO.Is_Open (<a href="src_unzip-decompress.adb.html#l58" title="defined at unzip-decompress.adb:58:10">UnZ_IO.out_txt_file</a>) <span class="keyword">then</span> </pre></li>
<li id="l2047"><pre>               Ada.Text_IO.Close (<a href="src_unzip-decompress.adb.html#l58" title="defined at unzip-decompress.adb:58:10">UnZ_IO.out_txt_file</a>); </pre></li>
<li id="l2048"><pre>            <span class="keyword">end</span> <span class="keyword">if</span>; </pre></li>
<li id="l2049"><pre>         <span class="keyword">when</span> <span class="keyword">others</span> =&gt; </pre></li>
<li id="l2050"><pre>            <span class="keyword">null</span>; </pre></li>
<li id="l2051"><pre>         <span class="keyword">end</span> <span class="keyword">case</span>; </pre></li>
<li id="l2052"><pre>         <span class="keyword">raise</span>; </pre></li>
<li id="l2053"><pre> </pre></li>
<li id="l2054"><pre>   <span class="keyword">end</span> <span class="droplink">Decompress_data<ul><li><a href="unzip-decompress.ads.html#unzip-decompress.ads:20:14" title="To API doc">To API doc</a></li><li><a href="src_unzip-decompress.ads.html#l20" title="To spec">To spec</a></li><li><a href="src_unzip-decompress.adb.html#l7" title="To body">To body</a></li></ul></span>; </pre></li>
<li id="l2055"><pre> </pre></li>
<li id="l2056"><pre><span class="keyword">end</span> <span class="droplink">UnZip.Decompress<ul><li><a href="unzip-decompress.ads.html#unzip-decompress.ads:18:23" title="To API doc">To API doc</a></li><li><a href="src_unzip-decompress.ads.html#l18" title="To spec">To spec</a></li><li><a href="src_unzip-decompress.adb.html#l5" title="To body">To body</a></li></ul></span>; </pre></li>
</ol></div>
</div>

</body>
</html>