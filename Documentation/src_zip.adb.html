<?xml version='1.0' encoding='utf-8'?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN"  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html><head>
  <meta http-equiv="Content-Type" content="application/xhtml+xml; charset=UTF-8" />
  <meta http-equiv="Content-Script-Type" content="text/javascript"/>

  <title>
    File: zip.adb
  </title>
  <link rel='stylesheet' href='support/docgen.css' type='text/css'/>
  <link rel='stylesheet' href='support/tags.css' type='text/css'/>
  <script src='support/docgen.js' type='text/javascript' charset='utf-8'></script>
</head>
<body onload="onloadDoc();">

<div id='leftSide'>
  <div id='leftSideInside'>
  <div id='header'>
    <h2 class="button">Documentation</h2>
    <a href='toc.html'><div class="button2">Table of Contents</div></a>

    <a href='tree.html'><div class="button2">Class Inheritance Tree</div></a>

  </div>
  </div>
</div> <!-- leftSide -->

<div class='subprograms'>
  <div class='details'><ol><li id="l1"><pre><span class="keyword">with</span> <span class="droplink">Zip.Headers<ul><li><a href="zip-headers.ads.html#zip-headers.ads:22:13" title="To API doc">To API doc</a></li><li><a href="src_zip-headers.ads.html#l22" title="To spec">To spec</a></li><li><a href="src_zip-headers.adb.html#l2" title="To body">To body</a></li></ul></span>; </pre></li>
<li id="l2"><pre> </pre></li>
<li id="l3"><pre><span class="keyword">with</span> Ada.Characters.Handling; </pre></li>
<li id="l4"><pre><span class="keyword">with</span> Ada.Unchecked_Deallocation; </pre></li>
<li id="l5"><pre><span class="keyword">with</span> Ada.Exceptions; </pre></li>
<li id="l6"><pre><span class="keyword">with</span> Ada.IO_Exceptions; </pre></li>
<li id="l7"><pre><span class="keyword">with</span> Ada.Strings.Fixed; </pre></li>
<li id="l8"><pre> </pre></li>
<li id="l9"><pre><span class="keyword">package</span> <span class="keyword">body</span> <span class="droplink">Zip<ul><li><a href="zip.ads.html#zip.ads:45:9" title="To API doc">To API doc</a></li><li><a href="src_zip.ads.html#l45" title="To spec">To spec</a></li></ul></span> <span class="keyword">is</span> </pre></li>
<li id="l10"><pre> </pre></li>
<li id="l11"><pre>   <span class="keyword">use</span> Interfaces; </pre></li>
<li id="l12"><pre> </pre></li>
<li id="l13"><pre>   <span class="keyword">procedure</span> Dispose <span class="keyword">is</span> <span class="keyword">new</span> Ada.Unchecked_Deallocation (<span class="droplink">Dir_node<ul><li><a href="zip.ads.html#zip.ads:290:8" title="To API doc">To API doc</a></li><li><a href="src_zip.ads.html#l290" title="To spec">To spec</a></li><li><a href="src_zip.ads.html#l293" title="To body">To body</a></li></ul></span>, <span class="droplink">p_Dir_node<ul><li><a href="zip.ads.html#zip.ads:291:8" title="To API doc">To API doc</a></li><li><a href="src_zip.ads.html#l291" title="To spec">To spec</a></li></ul></span>); </pre></li>
<li id="l14"><pre>   <span class="keyword">procedure</span> Dispose <span class="keyword">is</span> <span class="keyword">new</span> Ada.Unchecked_Deallocation (String, <span class="droplink">p_String<ul><li><a href="zip.ads.html#zip.ads:306:8" title="To API doc">To API doc</a></li><li><a href="src_zip.ads.html#l306" title="To spec">To spec</a></li></ul></span>); </pre></li>
<li id="l15"><pre> </pre></li>
<li id="l16"><pre>   <span class="keyword">package</span> <a href="src_zip.adb.html#l20" title="defined at zip.adb:16:12">Binary_tree_rebalancing</a> <span class="keyword">is</span> </pre></li>
<li id="l17"><pre>      <span class="keyword">procedure</span> <a href="src_zip.adb.html#l105" title="defined at zip.adb:17:17">Rebalance</a> (root : <span class="keyword">in</span> <span class="keyword">out</span> <span class="droplink">p_Dir_node<ul><li><a href="zip.ads.html#zip.ads:291:8" title="To API doc">To API doc</a></li><li><a href="src_zip.ads.html#l291" title="To spec">To spec</a></li></ul></span>); </pre></li>
<li id="l18"><pre>   <span class="keyword">end</span> <span class="droplink">Binary_tree_rebalancing<ul><li><a href="src_zip.adb.html#l16" title="To spec">To spec</a></li><li><a href="src_zip.adb.html#l20" title="To body">To body</a></li></ul></span>; </pre></li>
<li id="l19"><pre> </pre></li>
<li id="l20"><pre>   <span class="keyword">package</span> <span class="keyword">body</span> <a href="src_zip.adb.html#l16" title="defined at zip.adb:16:12">Binary_tree_rebalancing</a> <span class="keyword">is</span> </pre></li>
<li id="l21"><pre> </pre></li>
<li id="l22"><pre>      <span class="comment">-------------------------------------------------------------------</span> </pre></li>
<li id="l23"><pre>      <span class="comment">-- Tree Rebalancing in Optimal Time and Space                    --</span> </pre></li>
<li id="l24"><pre>      <span class="comment">-- QUENTIN F. STOUT and BETTE L. WARREN                          --</span> </pre></li>
<li id="l25"><pre>      <span class="comment">-- Communications of the ACM September 1986 Volume 29 Number 9   --</span> </pre></li>
<li id="l26"><pre>      <span class="comment">-------------------------------------------------------------------</span> </pre></li>
<li id="l27"><pre>      <span class="comment">-- http://www.eecs.umich.edu/~qstout/pap/CACM86.pdf</span> </pre></li>
<li id="l28"><pre>      <span class="comment">--</span> </pre></li>
<li id="l29"><pre>      <span class="comment">-- Translated by (New) P2Ada v. 15 - Nov - 2006</span> </pre></li>
<li id="l30"><pre> </pre></li>
<li id="l31"><pre>      <span class="keyword">procedure</span> Tree_to_vine (root : <span class="droplink">p_Dir_node<ul><li><a href="zip.ads.html#zip.ads:291:8" title="To API doc">To API doc</a></li><li><a href="src_zip.ads.html#l291" title="To spec">To spec</a></li></ul></span>; size : <span class="keyword">out</span> Integer) <span class="keyword">is</span> </pre></li>
<li id="l32"><pre>         <span class="comment">--  transform the tree with pseudo - root</span> </pre></li>
<li id="l33"><pre>         <span class="comment">--   &quot;root^&quot; into a vine with pseudo - root</span> </pre></li>
<li id="l34"><pre>         <span class="comment">--   node &quot;root^&quot;, and store the number of</span> </pre></li>
<li id="l35"><pre>         <span class="comment">--   nodes in &quot;size&quot;</span> </pre></li>
<li id="l36"><pre> </pre></li>
<li id="l37"><pre>         vine_tail, remainder, temp : <span class="droplink">p_Dir_node<ul><li><a href="zip.ads.html#zip.ads:291:8" title="To API doc">To API doc</a></li><li><a href="src_zip.ads.html#l291" title="To spec">To spec</a></li></ul></span>; </pre></li>
<li id="l38"><pre> </pre></li>
<li id="l39"><pre>      <span class="keyword">begin</span> </pre></li>
<li id="l40"><pre>         vine_tail := root; </pre></li>
<li id="l41"><pre>         remainder := vine_tail.<span class="keyword">all</span>.right; </pre></li>
<li id="l42"><pre>         size := 0; </pre></li>
<li id="l43"><pre>         <span class="keyword">while</span> remainder /= <span class="keyword">null</span> <span class="keyword">loop</span> </pre></li>
<li id="l44"><pre>            <span class="keyword">if</span> remainder.<span class="keyword">all</span>.left = <span class="keyword">null</span> <span class="keyword">then</span> </pre></li>
<li id="l45"><pre>               <span class="comment">--  move vine - tail down one:</span> </pre></li>
<li id="l46"><pre>               vine_tail := remainder; </pre></li>
<li id="l47"><pre>               remainder := remainder.<span class="keyword">all</span>.right; </pre></li>
<li id="l48"><pre>               size := size + 1; </pre></li>
<li id="l49"><pre>            <span class="keyword">else</span> </pre></li>
<li id="l50"><pre>               <span class="comment">--  rotate:</span> </pre></li>
<li id="l51"><pre>               temp := remainder.<span class="keyword">all</span>.left; </pre></li>
<li id="l52"><pre>               remainder.<span class="keyword">all</span>.left := temp.<span class="keyword">all</span>.right; </pre></li>
<li id="l53"><pre>               temp.<span class="keyword">all</span>.right := remainder; </pre></li>
<li id="l54"><pre>               remainder := temp; </pre></li>
<li id="l55"><pre>               vine_tail.<span class="keyword">all</span>.right := temp; </pre></li>
<li id="l56"><pre>            <span class="keyword">end</span> <span class="keyword">if</span>; </pre></li>
<li id="l57"><pre>         <span class="keyword">end</span> <span class="keyword">loop</span>; </pre></li>
<li id="l58"><pre>      <span class="keyword">end</span> Tree_to_vine; </pre></li>
<li id="l59"><pre> </pre></li>
<li id="l60"><pre>      <span class="keyword">procedure</span> Vine_to_tree (root : <span class="droplink">p_Dir_node<ul><li><a href="zip.ads.html#zip.ads:291:8" title="To API doc">To API doc</a></li><li><a href="src_zip.ads.html#l291" title="To spec">To spec</a></li></ul></span>; size_given : Integer) <span class="keyword">is</span> </pre></li>
<li id="l61"><pre>         <span class="comment">--  convert the vine with &quot;size&quot; nodes and pseudo - root</span> </pre></li>
<li id="l62"><pre>         <span class="comment">--  node &quot;root^&quot; into a balanced tree</span> </pre></li>
<li id="l63"><pre>         leaf_count : Integer; </pre></li>
<li id="l64"><pre>         size  : Integer := size_given; </pre></li>
<li id="l65"><pre> </pre></li>
<li id="l66"><pre>         <span class="keyword">procedure</span> Compression (Dir_Root : <span class="droplink">p_Dir_node<ul><li><a href="zip.ads.html#zip.ads:291:8" title="To API doc">To API doc</a></li><li><a href="src_zip.ads.html#l291" title="To spec">To spec</a></li></ul></span>; count : Integer) <span class="keyword">is</span> </pre></li>
<li id="l67"><pre>            <span class="comment">--  compress &quot;count&quot; spine nodes in the tree with pseudo - root &quot;root^&quot;</span> </pre></li>
<li id="l68"><pre>            scanner, child : <span class="droplink">p_Dir_node<ul><li><a href="zip.ads.html#zip.ads:291:8" title="To API doc">To API doc</a></li><li><a href="src_zip.ads.html#l291" title="To spec">To spec</a></li></ul></span>; </pre></li>
<li id="l69"><pre>         <span class="keyword">begin</span> </pre></li>
<li id="l70"><pre>            scanner := Dir_Root; </pre></li>
<li id="l71"><pre>            <span class="keyword">for</span> i <span class="keyword">in</span> 1 .. count <span class="keyword">loop</span> </pre></li>
<li id="l72"><pre>               child := scanner.<span class="keyword">all</span>.right; </pre></li>
<li id="l73"><pre>               scanner.<span class="keyword">all</span>.right := child.<span class="keyword">all</span>.right; </pre></li>
<li id="l74"><pre>               scanner := scanner.<span class="keyword">all</span>.right; </pre></li>
<li id="l75"><pre>               child.<span class="keyword">all</span>.right := scanner.<span class="keyword">all</span>.left; </pre></li>
<li id="l76"><pre>               scanner.<span class="keyword">all</span>.left := child; </pre></li>
<li id="l77"><pre>            <span class="keyword">end</span> <span class="keyword">loop</span>; </pre></li>
<li id="l78"><pre>         <span class="keyword">end</span> Compression; </pre></li>
<li id="l79"><pre> </pre></li>
<li id="l80"><pre>         <span class="comment">-- Returns n - 2 ** Integer (Float&apos;Floor (log (Float (n)) / log (2.0)))</span> </pre></li>
<li id="l81"><pre>         <span class="comment">-- without Float - Point calculation and rounding errors with too short floats</span> </pre></li>
<li id="l82"><pre>         <span class="keyword">function</span> Remove_leading_binary_1 (n : Integer) <span class="keyword">return</span> Integer <span class="keyword">is</span> </pre></li>
<li id="l83"><pre>            x : Integer := 2**16; <span class="comment">-- supposed maximum</span> </pre></li>
<li id="l84"><pre>         <span class="keyword">begin</span> </pre></li>
<li id="l85"><pre>            <span class="keyword">if</span> n &lt; 1 <span class="keyword">then</span> </pre></li>
<li id="l86"><pre>               <span class="keyword">return</span> n; </pre></li>
<li id="l87"><pre>            <span class="keyword">end</span> <span class="keyword">if</span>; </pre></li>
<li id="l88"><pre>            <span class="keyword">while</span> n <span class="keyword">mod</span> x = n <span class="keyword">loop</span> </pre></li>
<li id="l89"><pre>               x := x / 2; </pre></li>
<li id="l90"><pre>            <span class="keyword">end</span> <span class="keyword">loop</span>; </pre></li>
<li id="l91"><pre>            <span class="keyword">return</span> n <span class="keyword">mod</span> x; </pre></li>
<li id="l92"><pre>         <span class="keyword">end</span> Remove_leading_binary_1; </pre></li>
<li id="l93"><pre> </pre></li>
<li id="l94"><pre>      <span class="keyword">begin</span> <span class="comment">--  Vine_to_tree</span> </pre></li>
<li id="l95"><pre>         leaf_count := Remove_leading_binary_1 (size + 1); </pre></li>
<li id="l96"><pre>         Compression (root, leaf_count); <span class="comment">-- create deepest leaves</span> </pre></li>
<li id="l97"><pre>         <span class="comment">-- use Perfect_leaves instead for a perfectly balanced tree</span> </pre></li>
<li id="l98"><pre>         size := size - leaf_count; </pre></li>
<li id="l99"><pre>         <span class="keyword">while</span> size &gt; 1 <span class="keyword">loop</span> </pre></li>
<li id="l100"><pre>            Compression (root, size / 2); </pre></li>
<li id="l101"><pre>            size := size / 2; </pre></li>
<li id="l102"><pre>         <span class="keyword">end</span> <span class="keyword">loop</span>; </pre></li>
<li id="l103"><pre>      <span class="keyword">end</span> Vine_to_tree; </pre></li>
<li id="l104"><pre> </pre></li>
<li id="l105"><pre>      <span class="keyword">procedure</span> <a href="src_zip.adb.html#l17" title="defined at zip.adb:17:17">Rebalance</a> (<a href="src_zip.adb.html#l17" title="defined at zip.adb:17:28">root</a> : <span class="keyword">in</span> <span class="keyword">out</span> <span class="droplink">p_Dir_node<ul><li><a href="zip.ads.html#zip.ads:291:8" title="To API doc">To API doc</a></li><li><a href="src_zip.ads.html#l291" title="To spec">To spec</a></li></ul></span>) <span class="keyword">is</span> </pre></li>
<li id="l106"><pre>         <span class="comment">--  Rebalance the binary search tree with root &quot;root.all&quot;,</span> </pre></li>
<li id="l107"><pre>         <span class="comment">--  with the result also rooted at &quot;root.all&quot;.</span> </pre></li>
<li id="l108"><pre>         <span class="comment">--  Uses the Tree_to_vine and Vine_to_tree procedures.</span> </pre></li>
<li id="l109"><pre>         pseudo_root : <span class="droplink">p_Dir_node<ul><li><a href="zip.ads.html#zip.ads:291:8" title="To API doc">To API doc</a></li><li><a href="src_zip.ads.html#l291" title="To spec">To spec</a></li></ul></span>; </pre></li>
<li id="l110"><pre>         size : Integer; </pre></li>
<li id="l111"><pre>      <span class="keyword">begin</span> </pre></li>
<li id="l112"><pre>         pseudo_root := <span class="keyword">new</span> <span class="droplink">Dir_node<ul><li><a href="zip.ads.html#zip.ads:290:8" title="To API doc">To API doc</a></li><li><a href="src_zip.ads.html#l290" title="To spec">To spec</a></li><li><a href="src_zip.ads.html#l293" title="To body">To body</a></li></ul></span> (name_len =&gt; 0); </pre></li>
<li id="l113"><pre>         pseudo_root.<span class="keyword">all</span>.right := <a href="src_zip.adb.html#l17" title="defined at zip.adb:17:28">root</a>; </pre></li>
<li id="l114"><pre>         Tree_to_vine (pseudo_root, size); </pre></li>
<li id="l115"><pre>         Vine_to_tree (pseudo_root, size); </pre></li>
<li id="l116"><pre>         <a href="src_zip.adb.html#l17" title="defined at zip.adb:17:28">root</a> := pseudo_root.<span class="keyword">all</span>.right; </pre></li>
<li id="l117"><pre>         <a href="src_zip.adb.html#l13" title="defined at zip.adb:13:14">Dispose</a> (pseudo_root); </pre></li>
<li id="l118"><pre>      <span class="keyword">end</span> <span class="droplink">Rebalance<ul><li><a href="src_zip.adb.html#l17" title="To spec">To spec</a></li><li><a href="src_zip.adb.html#l105" title="To body">To body</a></li></ul></span>; </pre></li>
<li id="l119"><pre> </pre></li>
<li id="l120"><pre>   <span class="keyword">end</span> <span class="droplink">Binary_tree_rebalancing<ul><li><a href="src_zip.adb.html#l16" title="To spec">To spec</a></li><li><a href="src_zip.adb.html#l20" title="To body">To body</a></li></ul></span>; </pre></li>
<li id="l121"><pre> </pre></li>
<li id="l122"><pre>   <span class="comment">-- 19 - Jun - 2001 : Enhanced file name identification</span> </pre></li>
<li id="l123"><pre>   <span class="comment">--              a) when case insensitive  - &gt; all UPPER (current)</span> </pre></li>
<li id="l124"><pre>   <span class="comment">--              b) &apos;\&apos; and &apos;/&apos; identified - &gt; all &apos;/&apos;   (new)</span> </pre></li>
<li id="l125"><pre> </pre></li>
<li id="l126"><pre>   <span class="keyword">function</span> Normalize (s : String; case_sensitive : Boolean) <span class="keyword">return</span> String <span class="keyword">is</span> </pre></li>
<li id="l127"><pre>      sn : String (<a href="src_zip.adb.html#l126" title="defined at zip.adb:126:24">s</a>&apos;Range); </pre></li>
<li id="l128"><pre>   <span class="keyword">begin</span> </pre></li>
<li id="l129"><pre>      <span class="keyword">if</span> <a href="src_zip.adb.html#l126" title="defined at zip.adb:126:36">case_sensitive</a> <span class="keyword">then</span> </pre></li>
<li id="l130"><pre>         <a href="src_zip.adb.html#l127" title="defined at zip.adb:127:7">sn</a> := <a href="src_zip.adb.html#l126" title="defined at zip.adb:126:24">s</a>; </pre></li>
<li id="l131"><pre>      <span class="keyword">else</span> </pre></li>
<li id="l132"><pre>         <a href="src_zip.adb.html#l127" title="defined at zip.adb:127:7">sn</a> := Ada.Characters.Handling.To_Upper (<a href="src_zip.adb.html#l126" title="defined at zip.adb:126:24">s</a>); </pre></li>
<li id="l133"><pre>      <span class="keyword">end</span> <span class="keyword">if</span>; </pre></li>
<li id="l134"><pre>      <span class="keyword">for</span> i <span class="keyword">in</span> <a href="src_zip.adb.html#l127" title="defined at zip.adb:127:7">sn</a>&apos;Range <span class="keyword">loop</span> </pre></li>
<li id="l135"><pre>         <span class="keyword">if</span> <a href="src_zip.adb.html#l127" title="defined at zip.adb:127:7">sn</a> (i) = <span class="string">&apos;\&apos;</span> <span class="keyword">then</span> </pre></li>
<li id="l136"><pre>            <a href="src_zip.adb.html#l127" title="defined at zip.adb:127:7">sn</a> (i) := <span class="string">&apos;/&apos;</span>; </pre></li>
<li id="l137"><pre>         <span class="keyword">end</span> <span class="keyword">if</span>; </pre></li>
<li id="l138"><pre>      <span class="keyword">end</span> <span class="keyword">loop</span>; </pre></li>
<li id="l139"><pre>      <span class="keyword">return</span> <a href="src_zip.adb.html#l127" title="defined at zip.adb:127:7">sn</a>; </pre></li>
<li id="l140"><pre>   <span class="keyword">end</span> <span class="droplink">Normalize<ul><li><a href="src_zip.adb.html#l126" title="To spec">To spec</a></li><li><a href="src_zip.adb.html#l126" title="To body">To body</a></li></ul></span>; </pre></li>
<li id="l141"><pre> </pre></li>
<li id="l142"><pre>   <span class="comment">-------------------------------------------------------------</span> </pre></li>
<li id="l143"><pre>   <span class="comment">-- Load Zip_info from a stream containing the .zip archive --</span> </pre></li>
<li id="l144"><pre>   <span class="comment">-------------------------------------------------------------</span> </pre></li>
<li id="l145"><pre> </pre></li>
<li id="l146"><pre>   <span class="keyword">procedure</span> <span class="droplink">Load<ul><li><a href="zip.ads.html#zip.ads:68:14" title="To API doc">To API doc</a></li><li><a href="src_zip.ads.html#l68" title="To spec">To spec</a></li></ul></span> (<span class="droplink">info<ul><li><a href="zip.ads.html#zip.ads:68:20" title="To API doc">To API doc</a></li><li><a href="src_zip.ads.html#l68" title="To spec">To spec</a></li></ul></span>            : <span class="keyword">out</span> <span class="droplink">Zip_info<ul><li><a href="zip.ads.html#zip.ads:53:8" title="To API doc">To API doc</a></li><li><a href="src_zip.ads.html#l53" title="To spec">To spec</a></li><li><a href="src_zip.ads.html#l308" title="To body">To body</a></li></ul></span>; </pre></li>
<li id="l147"><pre>                   <span class="droplink">from<ul><li><a href="zip.ads.html#zip.ads:69:20" title="To API doc">To API doc</a></li><li><a href="src_zip.ads.html#l69" title="To spec">To spec</a></li></ul></span>            :     <span class="droplink">Zip_Streams.Zipstream_Class<ul><li><a href="zip_streams.ads.html#zip_streams.ads:43:9" title="To API doc">To API doc</a></li><li><a href="src_zip_streams.ads.html#l43" title="To spec">To spec</a></li></ul></span>; </pre></li>
<li id="l148"><pre>                   <span class="droplink">case_sensitive<ul><li><a href="zip.ads.html#zip.ads:70:20" title="To API doc">To API doc</a></li><li><a href="src_zip.ads.html#l70" title="To spec">To spec</a></li></ul></span>  :     Boolean := False) <span class="keyword">is</span> </pre></li>
<li id="l149"><pre> </pre></li>
<li id="l150"><pre>      <span class="keyword">procedure</span> Insert (dico_name         :        String; <span class="comment">-- UPPER if case - insensitive search</span> </pre></li>
<li id="l151"><pre>                        file_name         :        String; </pre></li>
<li id="l152"><pre>                        file_index        :        Ada.Streams.Stream_IO.Positive_Count; </pre></li>
<li id="l153"><pre>                        comp_size, </pre></li>
<li id="l154"><pre>                        uncomp_size       :        <span class="droplink">File_size_type<ul><li><a href="zip.ads.html#zip.ads:97:11" title="To API doc">To API doc</a></li><li><a href="src_zip.ads.html#l97" title="To spec">To spec</a></li></ul></span>; </pre></li>
<li id="l155"><pre>                        crc_32            :        Unsigned_32; </pre></li>
<li id="l156"><pre>                        date_time         :        <span class="droplink">Time<ul><li><a href="zip.ads.html#zip.ads:128:12" title="To API doc">To API doc</a></li><li><a href="src_zip.ads.html#l128" title="To spec">To spec</a></li></ul></span>; </pre></li>
<li id="l157"><pre>                        method            :        <span class="droplink">PKZip_method<ul><li><a href="zip.ads.html#zip.ads:106:8" title="To API doc">To API doc</a></li><li><a href="src_zip.ads.html#l106" title="To spec">To spec</a></li></ul></span>; </pre></li>
<li id="l158"><pre>                        unicode_file_name :        Boolean; </pre></li>
<li id="l159"><pre>                        node              : <span class="keyword">in</span> <span class="keyword">out</span> <span class="droplink">p_Dir_node<ul><li><a href="zip.ads.html#zip.ads:291:8" title="To API doc">To API doc</a></li><li><a href="src_zip.ads.html#l291" title="To spec">To spec</a></li></ul></span>) <span class="keyword">is</span> </pre></li>
<li id="l160"><pre> </pre></li>
<li id="l161"><pre>      <span class="keyword">begin</span> </pre></li>
<li id="l162"><pre>         <span class="keyword">if</span> <a href="src_zip.adb.html#l159" title="defined at zip.adb:159:25">node</a> = <span class="keyword">null</span> <span class="keyword">then</span> </pre></li>
<li id="l163"><pre>            <a href="src_zip.adb.html#l159" title="defined at zip.adb:159:25">node</a> := <span class="keyword">new</span> <span class="droplink">Dir_node<ul><li><a href="zip.ads.html#zip.ads:290:8" title="To API doc">To API doc</a></li><li><a href="src_zip.ads.html#l290" title="To spec">To spec</a></li><li><a href="src_zip.ads.html#l293" title="To body">To body</a></li></ul></span>&apos; </pre></li>
<li id="l164"><pre>              ((name_len          =&gt; <a href="src_zip.adb.html#l151" title="defined at zip.adb:151:25">file_name</a>&apos;Length, </pre></li>
<li id="l165"><pre>                left              =&gt; <span class="keyword">null</span>, </pre></li>
<li id="l166"><pre>                right             =&gt; <span class="keyword">null</span>, </pre></li>
<li id="l167"><pre>                dico_name         =&gt; <a href="src_zip.adb.html#l150" title="defined at zip.adb:150:25">dico_name</a>, </pre></li>
<li id="l168"><pre>                file_name         =&gt; <a href="src_zip.adb.html#l151" title="defined at zip.adb:151:25">file_name</a>, </pre></li>
<li id="l169"><pre>                file_index        =&gt; <a href="src_zip.adb.html#l152" title="defined at zip.adb:152:25">file_index</a>, </pre></li>
<li id="l170"><pre>                comp_size         =&gt; <a href="src_zip.adb.html#l153" title="defined at zip.adb:153:25">comp_size</a>, </pre></li>
<li id="l171"><pre>                uncomp_size       =&gt; <a href="src_zip.adb.html#l154" title="defined at zip.adb:154:25">uncomp_size</a>, </pre></li>
<li id="l172"><pre>                crc_32            =&gt; <a href="src_zip.adb.html#l155" title="defined at zip.adb:155:25">crc_32</a>, </pre></li>
<li id="l173"><pre>                date_time         =&gt; <a href="src_zip.adb.html#l156" title="defined at zip.adb:156:25">date_time</a>, </pre></li>
<li id="l174"><pre>                method            =&gt; <a href="src_zip.adb.html#l157" title="defined at zip.adb:157:25">method</a>, </pre></li>
<li id="l175"><pre>                unicode_file_name =&gt; <a href="src_zip.adb.html#l158" title="defined at zip.adb:158:25">unicode_file_name</a> </pre></li>
<li id="l176"><pre>               ) </pre></li>
<li id="l177"><pre>              ); </pre></li>
<li id="l178"><pre>         <span class="keyword">elsif</span> <a href="src_zip.adb.html#l150" title="defined at zip.adb:150:25">dico_name</a> &gt; <a href="src_zip.adb.html#l159" title="defined at zip.adb:159:25">node</a>.<span class="keyword">all</span>.dico_name <span class="keyword">then</span> </pre></li>
<li id="l179"><pre>            <span class="droplink">Insert<ul><li><a href="src_zip.adb.html#l150" title="To spec">To spec</a></li><li><a href="src_zip.adb.html#l150" title="To body">To body</a></li></ul></span> (<a href="src_zip.adb.html#l150" title="defined at zip.adb:150:25">dico_name</a>, <a href="src_zip.adb.html#l151" title="defined at zip.adb:151:25">file_name</a>, <a href="src_zip.adb.html#l152" title="defined at zip.adb:152:25">file_index</a>, <a href="src_zip.adb.html#l153" title="defined at zip.adb:153:25">comp_size</a>, <a href="src_zip.adb.html#l154" title="defined at zip.adb:154:25">uncomp_size</a>, <a href="src_zip.adb.html#l155" title="defined at zip.adb:155:25">crc_32</a>, <a href="src_zip.adb.html#l156" title="defined at zip.adb:156:25">date_time</a>, <a href="src_zip.adb.html#l157" title="defined at zip.adb:157:25">method</a>, <a href="src_zip.adb.html#l158" title="defined at zip.adb:158:25">unicode_file_name</a>, <a href="src_zip.adb.html#l159" title="defined at zip.adb:159:25">node</a>.<span class="keyword">all</span>.right); </pre></li>
<li id="l180"><pre>         <span class="keyword">elsif</span> <a href="src_zip.adb.html#l150" title="defined at zip.adb:150:25">dico_name</a> &lt; <a href="src_zip.adb.html#l159" title="defined at zip.adb:159:25">node</a>.<span class="keyword">all</span>.dico_name <span class="keyword">then</span> </pre></li>
<li id="l181"><pre>            <span class="droplink">Insert<ul><li><a href="src_zip.adb.html#l150" title="To spec">To spec</a></li><li><a href="src_zip.adb.html#l150" title="To body">To body</a></li></ul></span> (<a href="src_zip.adb.html#l150" title="defined at zip.adb:150:25">dico_name</a>, <a href="src_zip.adb.html#l151" title="defined at zip.adb:151:25">file_name</a>, <a href="src_zip.adb.html#l152" title="defined at zip.adb:152:25">file_index</a>, <a href="src_zip.adb.html#l153" title="defined at zip.adb:153:25">comp_size</a>, <a href="src_zip.adb.html#l154" title="defined at zip.adb:154:25">uncomp_size</a>, <a href="src_zip.adb.html#l155" title="defined at zip.adb:155:25">crc_32</a>, <a href="src_zip.adb.html#l156" title="defined at zip.adb:156:25">date_time</a>, <a href="src_zip.adb.html#l157" title="defined at zip.adb:157:25">method</a>, <a href="src_zip.adb.html#l158" title="defined at zip.adb:158:25">unicode_file_name</a>, <a href="src_zip.adb.html#l159" title="defined at zip.adb:159:25">node</a>.<span class="keyword">all</span>.left); </pre></li>
<li id="l182"><pre>         <span class="keyword">else</span> </pre></li>
<li id="l183"><pre>            <span class="keyword">raise</span> <span class="droplink">Duplicate_name<ul><li><a href="zip.ads.html#zip.ads:74:3" title="To API doc">To API doc</a></li><li><a href="src_zip.ads.html#l74" title="To spec">To spec</a></li></ul></span>; </pre></li>
<li id="l184"><pre>         <span class="keyword">end</span> <span class="keyword">if</span>; </pre></li>
<li id="l185"><pre>      <span class="keyword">end</span> <span class="droplink">Insert<ul><li><a href="src_zip.adb.html#l150" title="To spec">To spec</a></li><li><a href="src_zip.adb.html#l150" title="To body">To body</a></li></ul></span>; </pre></li>
<li id="l186"><pre> </pre></li>
<li id="l187"><pre>      the_end : <span class="droplink">Zip.Headers.End_of_Central_Dir<ul><li><a href="zip-headers.ads.html#zip-headers.ads:118:8" title="To API doc">To API doc</a></li><li><a href="src_zip-headers.ads.html#l118" title="To spec">To spec</a></li></ul></span>; </pre></li>
<li id="l188"><pre>      header  : <span class="droplink">Zip.Headers.Central_File_Header<ul><li><a href="zip-headers.ads.html#zip-headers.ads:84:8" title="To API doc">To API doc</a></li><li><a href="src_zip-headers.ads.html#l84" title="To spec">To spec</a></li></ul></span>; </pre></li>
<li id="l189"><pre>      p       : <span class="droplink">p_Dir_node<ul><li><a href="zip.ads.html#zip.ads:291:8" title="To API doc">To API doc</a></li><li><a href="src_zip.ads.html#l291" title="To spec">To spec</a></li></ul></span> := <span class="keyword">null</span>; </pre></li>
<li id="l190"><pre>      zip_info_already_loaded : <span class="keyword">exception</span>; </pre></li>
<li id="l191"><pre>      main_comment : <span class="droplink">p_String<ul><li><a href="zip.ads.html#zip.ads:306:8" title="To API doc">To API doc</a></li><li><a href="src_zip.ads.html#l306" title="To spec">To spec</a></li></ul></span>; </pre></li>
<li id="l192"><pre>      <span class="keyword">use</span> Ada.Streams, Ada.Streams.Stream_IO; </pre></li>
<li id="l193"><pre>   <span class="keyword">begin</span> <span class="comment">-- Load Zip_info</span> </pre></li>
<li id="l194"><pre>      <span class="keyword">if</span> info.loaded <span class="keyword">then</span> </pre></li>
<li id="l195"><pre>         <span class="keyword">raise</span> <a href="src_zip.adb.html#l190" title="defined at zip.adb:190:7">zip_info_already_loaded</a>; </pre></li>
<li id="l196"><pre>      <span class="keyword">end</span> <span class="keyword">if</span>; <span class="comment">-- 15 - Apr - 2002</span> </pre></li>
<li id="l197"><pre>      <span class="droplink">Zip.Headers.Load<ul><li><a href="zip-headers.ads.html#zip-headers.ads:152:13" title="To API doc">To API doc</a></li><li><a href="src_zip-headers.ads.html#l152" title="To spec">To spec</a></li><li><a href="src_zip-headers.adb.html#l222" title="To body">To body</a></li></ul></span> (<span class="droplink">from<ul><li><a href="zip.ads.html#zip.ads:69:20" title="To API doc">To API doc</a></li><li><a href="src_zip.ads.html#l69" title="To spec">To spec</a></li></ul></span>, <a href="src_zip.adb.html#l187" title="defined at zip.adb:187:7">the_end</a>); </pre></li>
<li id="l198"><pre>      <span class="comment">-- We take the opportunity to read the main comment, which is right</span> </pre></li>
<li id="l199"><pre>      <span class="comment">-- after the end - of - central - directory block.</span> </pre></li>
<li id="l200"><pre>      <a href="src_zip.adb.html#l191" title="defined at zip.adb:191:7">main_comment</a> := <span class="keyword">new</span> String (1 .. Integer (the_end.main_comment_length)); </pre></li>
<li id="l201"><pre>      String&apos;Read (<span class="droplink">from<ul><li><a href="zip.ads.html#zip.ads:69:20" title="To API doc">To API doc</a></li><li><a href="src_zip.ads.html#l69" title="To spec">To spec</a></li></ul></span>, <a href="src_zip.adb.html#l191" title="defined at zip.adb:191:7">main_comment</a>.<span class="keyword">all</span>); </pre></li>
<li id="l202"><pre>      <span class="comment">-- Process central directory:</span> </pre></li>
<li id="l203"><pre>      <span class="droplink">Zip_Streams.Set_Index<ul><li><a href="zip_streams.ads.html#zip_streams.ads:46:14" title="To API doc">To API doc</a></li><li><a href="src_zip_streams.ads.html#l46" title="To spec">To spec</a></li></ul></span> ( </pre></li>
<li id="l204"><pre>                             <span class="droplink">from<ul><li><a href="zip.ads.html#zip.ads:69:20" title="To API doc">To API doc</a></li><li><a href="src_zip.ads.html#l69" title="To spec">To spec</a></li></ul></span>, </pre></li>
<li id="l205"><pre>                             Positive ( </pre></li>
<li id="l206"><pre>                               1 + </pre></li>
<li id="l207"><pre>                                 the_end.offset_shifting + the_end.central_dir_offset </pre></li>
<li id="l208"><pre>                              ) </pre></li>
<li id="l209"><pre>                            ); </pre></li>
<li id="l210"><pre> </pre></li>
<li id="l211"><pre>      <span class="keyword">for</span> i <span class="keyword">in</span> 1 .. the_end.total_entries <span class="keyword">loop</span> </pre></li>
<li id="l212"><pre>         <span class="droplink">Zip.Headers.Read_and_check<ul><li><a href="zip-headers.ads.html#zip-headers.ads:106:13" title="To API doc">To API doc</a></li><li><a href="src_zip-headers.ads.html#l106" title="To spec">To spec</a></li><li><a href="src_zip-headers.adb.html#l69" title="To body">To body</a></li></ul></span> (<span class="droplink">from<ul><li><a href="zip.ads.html#zip.ads:69:20" title="To API doc">To API doc</a></li><li><a href="src_zip.ads.html#l69" title="To spec">To spec</a></li></ul></span>, <a href="src_zip.adb.html#l188" title="defined at zip.adb:188:7">header</a>); </pre></li>
<li id="l213"><pre>         <span class="keyword">declare</span> </pre></li>
<li id="l214"><pre>            this_name : String (1 .. Natural (header.short_info.filename_length)); </pre></li>
<li id="l215"><pre>         <span class="keyword">begin</span> </pre></li>
<li id="l216"><pre>            String&apos;Read (<span class="droplink">from<ul><li><a href="zip.ads.html#zip.ads:69:20" title="To API doc">To API doc</a></li><li><a href="src_zip.ads.html#l69" title="To spec">To spec</a></li></ul></span>, this_name); </pre></li>
<li id="l217"><pre>            <span class="comment">-- Skip extra field and entry comment.</span> </pre></li>
<li id="l218"><pre>            <span class="droplink">Zip_Streams.Set_Index<ul><li><a href="zip_streams.ads.html#zip_streams.ads:46:14" title="To API doc">To API doc</a></li><li><a href="src_zip_streams.ads.html#l46" title="To spec">To spec</a></li></ul></span> ( </pre></li>
<li id="l219"><pre>                                   <span class="droplink">from<ul><li><a href="zip.ads.html#zip.ads:69:20" title="To API doc">To API doc</a></li><li><a href="src_zip.ads.html#l69" title="To spec">To spec</a></li></ul></span>, Positive ( </pre></li>
<li id="l220"><pre>                                     Ada.Streams.Stream_IO.Count (<span class="droplink">Zip_Streams.Index<ul><li><a href="zip_streams.ads.html#zip_streams.ads:50:13" title="To API doc">To API doc</a></li><li><a href="src_zip_streams.ads.html#l50" title="To spec">To spec</a></li></ul></span> (<span class="droplink">from<ul><li><a href="zip.ads.html#zip.ads:69:20" title="To API doc">To API doc</a></li><li><a href="src_zip.ads.html#l69" title="To spec">To spec</a></li></ul></span>)) + </pre></li>
<li id="l221"><pre>                                       Ada.Streams.Stream_IO.Count ( </pre></li>
<li id="l222"><pre>                                         header.short_info.extra_field_length + </pre></li>
<li id="l223"><pre>                                           header.comment_length </pre></li>
<li id="l224"><pre>                                        )) </pre></li>
<li id="l225"><pre>                                  ); </pre></li>
<li id="l226"><pre>            <span class="comment">-- Now the whole i_th central directory entry is behind</span> </pre></li>
<li id="l227"><pre>            <span class="droplink">Insert<ul><li><a href="src_zip.adb.html#l150" title="To spec">To spec</a></li><li><a href="src_zip.adb.html#l150" title="To body">To body</a></li></ul></span> (<a href="src_zip.adb.html#l150" title="defined at zip.adb:150:25">dico_name</a>   =&gt; <span class="droplink">Normalize<ul><li><a href="src_zip.adb.html#l126" title="To spec">To spec</a></li><li><a href="src_zip.adb.html#l126" title="To body">To body</a></li></ul></span> (this_name, <span class="droplink">case_sensitive<ul><li><a href="zip.ads.html#zip.ads:70:20" title="To API doc">To API doc</a></li><li><a href="src_zip.ads.html#l70" title="To spec">To spec</a></li></ul></span>), </pre></li>
<li id="l228"><pre>                    <a href="src_zip.adb.html#l151" title="defined at zip.adb:151:25">file_name</a>   =&gt; <span class="droplink">Normalize<ul><li><a href="src_zip.adb.html#l126" title="To spec">To spec</a></li><li><a href="src_zip.adb.html#l126" title="To body">To body</a></li></ul></span> (this_name, True), </pre></li>
<li id="l229"><pre>                    <a href="src_zip.adb.html#l152" title="defined at zip.adb:152:25">file_index</a>  =&gt; Ada.Streams.Stream_IO.Count </pre></li>
<li id="l230"><pre>                      (1 + header.local_header_offset + the_end.offset_shifting), </pre></li>
<li id="l231"><pre>                    <a href="src_zip.adb.html#l153" title="defined at zip.adb:153:25">comp_size</a>   =&gt; header.short_info.dd.compressed_size, </pre></li>
<li id="l232"><pre>                    <a href="src_zip.adb.html#l154" title="defined at zip.adb:154:25">uncomp_size</a> =&gt; header.short_info.dd.uncompressed_size, </pre></li>
<li id="l233"><pre>                    <a href="src_zip.adb.html#l155" title="defined at zip.adb:155:25">crc_32</a>      =&gt; header.short_info.dd.crc_32, </pre></li>
<li id="l234"><pre>                    <a href="src_zip.adb.html#l156" title="defined at zip.adb:156:25">date_time</a>   =&gt; header.short_info.file_timedate, </pre></li>
<li id="l235"><pre>                    <a href="src_zip.adb.html#l157" title="defined at zip.adb:157:25">method</a>      =&gt; <span class="droplink">Method_from_code<ul><li><a href="zip.ads.html#zip.ads:124:12" title="To API doc">To API doc</a></li><li><a href="src_zip.ads.html#l124" title="To spec">To spec</a></li><li><a href="src_zip.adb.html#l694" title="To body">To body</a></li></ul></span> (header.short_info.zip_type), </pre></li>
<li id="l236"><pre>                    <a href="src_zip.adb.html#l158" title="defined at zip.adb:158:25">unicode_file_name</a> =&gt; </pre></li>
<li id="l237"><pre>                      (header.short_info.bit_flag <span class="keyword">and</span> </pre></li>
<li id="l238"><pre>                         <span class="droplink">Zip.Headers.Language_Encoding_Flag_Bit<ul><li><a href="zip-headers.ads.html#zip-headers.ads:56:3" title="To API doc">To API doc</a></li><li><a href="src_zip-headers.ads.html#l56" title="To spec">To spec</a></li></ul></span>) /= 0, </pre></li>
<li id="l239"><pre>                    <a href="src_zip.adb.html#l159" title="defined at zip.adb:159:25">node</a>        =&gt; <a href="src_zip.adb.html#l189" title="defined at zip.adb:189:7">p</a>); </pre></li>
<li id="l240"><pre>            <span class="comment">-- Since the files are usually well ordered, the tree as inserted</span> </pre></li>
<li id="l241"><pre>            <span class="comment">-- is very unbalanced; we need to rebalance it from time to time</span> </pre></li>
<li id="l242"><pre>            <span class="comment">-- during loading, otherwise the insertion slows down dramatically</span> </pre></li>
<li id="l243"><pre>            <span class="comment">-- for zip files with plenty of files - converges to</span> </pre></li>
<li id="l244"><pre>            <span class="comment">-- O (total_entries ** 2) .. .</span> </pre></li>
<li id="l245"><pre>            <span class="keyword">if</span> i <span class="keyword">mod</span> 256 = 0 <span class="keyword">then</span> </pre></li>
<li id="l246"><pre>               <span class="droplink">Binary_tree_rebalancing.Rebalance<ul><li><a href="src_zip.adb.html#l17" title="To spec">To spec</a></li><li><a href="src_zip.adb.html#l105" title="To body">To body</a></li></ul></span> (<a href="src_zip.adb.html#l189" title="defined at zip.adb:189:7">p</a>); </pre></li>
<li id="l247"><pre>            <span class="keyword">end</span> <span class="keyword">if</span>; </pre></li>
<li id="l248"><pre>         <span class="keyword">end</span>; </pre></li>
<li id="l249"><pre>      <span class="keyword">end</span> <span class="keyword">loop</span>; </pre></li>
<li id="l250"><pre>      <span class="droplink">Binary_tree_rebalancing.Rebalance<ul><li><a href="src_zip.adb.html#l17" title="To spec">To spec</a></li><li><a href="src_zip.adb.html#l105" title="To body">To body</a></li></ul></span> (<a href="src_zip.adb.html#l189" title="defined at zip.adb:189:7">p</a>); </pre></li>
<li id="l251"><pre>      <span class="droplink">info<ul><li><a href="zip.ads.html#zip.ads:68:20" title="To API doc">To API doc</a></li><li><a href="src_zip.ads.html#l68" title="To spec">To spec</a></li><li><a href="src_zip.adb.html#l146" title="To body">To body</a></li></ul></span> := (loaded           =&gt; True, </pre></li>
<li id="l252"><pre>               zip_file_name    =&gt; <span class="keyword">new</span> String&apos;(<span class="string">&quot;This is a stream, no direct file!&quot;</span>), </pre></li>
<li id="l253"><pre>               zip_input_stream =&gt; <span class="droplink">from<ul><li><a href="zip.ads.html#zip.ads:69:20" title="To API doc">To API doc</a></li><li><a href="src_zip.ads.html#l69" title="To spec">To spec</a></li></ul></span>, </pre></li>
<li id="l254"><pre>               dir_binary_tree  =&gt; <a href="src_zip.adb.html#l189" title="defined at zip.adb:189:7">p</a>, </pre></li>
<li id="l255"><pre>               total_entries    =&gt; Integer (the_end.total_entries), </pre></li>
<li id="l256"><pre>               zip_file_comment =&gt; <a href="src_zip.adb.html#l191" title="defined at zip.adb:191:7">main_comment</a> </pre></li>
<li id="l257"><pre>              ); </pre></li>
<li id="l258"><pre>   <span class="keyword">end</span> <span class="droplink">Load<ul><li><a href="zip.ads.html#zip.ads:68:14" title="To API doc">To API doc</a></li><li><a href="src_zip.ads.html#l68" title="To spec">To spec</a></li><li><a href="src_zip.adb.html#l146" title="To body">To body</a></li></ul></span>; </pre></li>
<li id="l259"><pre> </pre></li>
<li id="l260"><pre>   <span class="comment">-----------------------------------------------------------</span> </pre></li>
<li id="l261"><pre>   <span class="comment">-- Load Zip_info from a file containing the .zip archive --</span> </pre></li>
<li id="l262"><pre>   <span class="comment">-----------------------------------------------------------</span> </pre></li>
<li id="l263"><pre> </pre></li>
<li id="l264"><pre>   <span class="keyword">procedure</span> <span class="droplink">Load<ul><li><a href="zip.ads.html#zip.ads:62:14" title="To API doc">To API doc</a></li><li><a href="src_zip.ads.html#l62" title="To spec">To spec</a></li></ul></span> (<span class="droplink">info<ul><li><a href="zip.ads.html#zip.ads:62:20" title="To API doc">To API doc</a></li><li><a href="src_zip.ads.html#l62" title="To spec">To spec</a></li></ul></span>            : <span class="keyword">out</span> <span class="droplink">Zip_info<ul><li><a href="zip.ads.html#zip.ads:53:8" title="To API doc">To API doc</a></li><li><a href="src_zip.ads.html#l53" title="To spec">To spec</a></li><li><a href="src_zip.ads.html#l308" title="To body">To body</a></li></ul></span>; </pre></li>
<li id="l265"><pre>                   <span class="droplink">from<ul><li><a href="zip.ads.html#zip.ads:63:20" title="To API doc">To API doc</a></li><li><a href="src_zip.ads.html#l63" title="To spec">To spec</a></li></ul></span>            :     String; <span class="comment">-- Zip file name</span> </pre></li>
<li id="l266"><pre>                   <span class="droplink">case_sensitive<ul><li><a href="zip.ads.html#zip.ads:64:20" title="To API doc">To API doc</a></li><li><a href="src_zip.ads.html#l64" title="To spec">To spec</a></li></ul></span>  :     Boolean := False) <span class="keyword">is</span> </pre></li>
<li id="l267"><pre> </pre></li>
<li id="l268"><pre>      <span class="keyword">use</span> <span class="droplink">Zip_Streams<ul><li><a href="zip_streams.ads.html#zip_streams.ads:31:9" title="To API doc">To API doc</a></li><li><a href="src_zip_streams.ads.html#l31" title="To spec">To spec</a></li><li><a href="src_zip_streams.adb.html#l10" title="To body">To body</a></li></ul></span>; </pre></li>
<li id="l269"><pre> </pre></li>
<li id="l270"><pre>      MyStream    : <span class="keyword">aliased</span> <span class="droplink">File_Zipstream<ul><li><a href="zip_streams.ads.html#zip_streams.ads:125:9" title="To API doc">To API doc</a></li><li><a href="src_zip_streams.ads.html#l125" title="To spec">To spec</a></li><li><a href="src_zip_streams.ads.html#l212" title="To body">To body</a></li></ul></span>; </pre></li>
<li id="l271"><pre>      StreamFile  : <span class="keyword">constant</span> <span class="droplink">Zipstream_Class<ul><li><a href="zip_streams.ads.html#zip_streams.ads:43:9" title="To API doc">To API doc</a></li><li><a href="src_zip_streams.ads.html#l43" title="To spec">To spec</a></li></ul></span> := <a href="src_zip.adb.html#l270" title="defined at zip.adb:270:7">MyStream</a>&apos;Unchecked_Access; </pre></li>
<li id="l272"><pre> </pre></li>
<li id="l273"><pre>   <span class="keyword">begin</span> </pre></li>
<li id="l274"><pre>      <span class="droplink">Set_Name<ul><li><a href="zip_streams.ads.html#zip_streams.ads:56:14" title="To API doc">To API doc</a></li><li><a href="src_zip_streams.ads.html#l56" title="To spec">To spec</a></li><li><a href="src_zip_streams.adb.html#l12" title="To body">To body</a></li></ul></span> (<a href="src_zip.adb.html#l271" title="defined at zip.adb:271:7">StreamFile</a>, <span class="droplink">from<ul><li><a href="zip.ads.html#zip.ads:63:20" title="To API doc">To API doc</a></li><li><a href="src_zip.ads.html#l63" title="To spec">To spec</a></li></ul></span>); </pre></li>
<li id="l275"><pre>      <span class="keyword">begin</span> </pre></li>
<li id="l276"><pre>         <span class="droplink">Open<ul><li><a href="zip_streams.ads.html#zip_streams.ads:131:14" title="To API doc">To API doc</a></li><li><a href="src_zip_streams.ads.html#l131" title="To spec">To spec</a></li><li><a href="src_zip_streams.adb.html#l162" title="To body">To body</a></li></ul></span> (<a href="src_zip.adb.html#l270" title="defined at zip.adb:270:7">MyStream</a>, Ada.Streams.Stream_IO.In_File); </pre></li>
<li id="l277"><pre>      <span class="keyword">exception</span> </pre></li>
<li id="l278"><pre>         <span class="keyword">when</span> <span class="keyword">others</span> =&gt; </pre></li>
<li id="l279"><pre>            Ada.Exceptions.Raise_Exception </pre></li>
<li id="l280"><pre>              (<span class="droplink">Zip_file_open_Error<ul><li><a href="zip.ads.html#zip.ads:73:3" title="To API doc">To API doc</a></li><li><a href="src_zip.ads.html#l73" title="To spec">To spec</a></li></ul></span>&apos;Identity, <span class="string">&quot;Archive : [&quot;</span> &amp; <span class="droplink">from<ul><li><a href="zip.ads.html#zip.ads:63:20" title="To API doc">To API doc</a></li><li><a href="src_zip.ads.html#l63" title="To spec">To spec</a></li></ul></span> &amp; <span class="string">&apos;]&apos;</span>); </pre></li>
<li id="l281"><pre>      <span class="keyword">end</span>; </pre></li>
<li id="l282"><pre>      <span class="comment">-- Call the stream version of Load ( .. .)</span> </pre></li>
<li id="l283"><pre>      <span class="droplink">Load<ul><li><a href="zip.ads.html#zip.ads:68:14" title="To API doc">To API doc</a></li><li><a href="src_zip.ads.html#l68" title="To spec">To spec</a></li><li><a href="src_zip.adb.html#l146" title="To body">To body</a></li></ul></span> ( </pre></li>
<li id="l284"><pre>            <span class="droplink">info<ul><li><a href="zip.ads.html#zip.ads:62:20" title="To API doc">To API doc</a></li><li><a href="src_zip.ads.html#l62" title="To spec">To spec</a></li><li><a href="src_zip.adb.html#l264" title="To body">To body</a></li></ul></span>, </pre></li>
<li id="l285"><pre>            <a href="src_zip.adb.html#l271" title="defined at zip.adb:271:7">StreamFile</a>, </pre></li>
<li id="l286"><pre>            <span class="droplink">case_sensitive<ul><li><a href="zip.ads.html#zip.ads:64:20" title="To API doc">To API doc</a></li><li><a href="src_zip.ads.html#l64" title="To spec">To spec</a></li></ul></span> </pre></li>
<li id="l287"><pre>           ); </pre></li>
<li id="l288"><pre>      <span class="droplink">Close<ul><li><a href="zip_streams.ads.html#zip_streams.ads:138:14" title="To API doc">To API doc</a></li><li><a href="src_zip_streams.ads.html#l138" title="To spec">To spec</a></li><li><a href="src_zip_streams.adb.html#l176" title="To body">To body</a></li></ul></span> (<a href="src_zip.adb.html#l270" title="defined at zip.adb:270:7">MyStream</a>); </pre></li>
<li id="l289"><pre>      <a href="src_zip.adb.html#l14" title="defined at zip.adb:14:14">Dispose</a> (info.zip_file_name); </pre></li>
<li id="l290"><pre>      info.zip_file_name := <span class="keyword">new</span> String&apos;(<span class="droplink">from<ul><li><a href="zip.ads.html#zip.ads:63:20" title="To API doc">To API doc</a></li><li><a href="src_zip.ads.html#l63" title="To spec">To spec</a></li></ul></span>); </pre></li>
<li id="l291"><pre>      info.zip_input_stream := <span class="keyword">null</span>; <span class="comment">-- forget about the stream!</span> </pre></li>
<li id="l292"><pre>   <span class="keyword">end</span> <span class="droplink">Load<ul><li><a href="zip.ads.html#zip.ads:62:14" title="To API doc">To API doc</a></li><li><a href="src_zip.ads.html#l62" title="To spec">To spec</a></li><li><a href="src_zip.adb.html#l264" title="To body">To body</a></li></ul></span>; </pre></li>
<li id="l293"><pre> </pre></li>
<li id="l294"><pre>   <span class="keyword">function</span> <span class="droplink">Is_loaded<ul><li><a href="zip.ads.html#zip.ads:82:12" title="To API doc">To API doc</a></li><li><a href="src_zip.ads.html#l82" title="To spec">To spec</a></li></ul></span> (<span class="droplink">info<ul><li><a href="zip.ads.html#zip.ads:82:23" title="To API doc">To API doc</a></li><li><a href="src_zip.ads.html#l82" title="To spec">To spec</a></li></ul></span> : <span class="droplink">Zip_info<ul><li><a href="zip.ads.html#zip.ads:53:8" title="To API doc">To API doc</a></li><li><a href="src_zip.ads.html#l53" title="To spec">To spec</a></li><li><a href="src_zip.ads.html#l308" title="To body">To body</a></li></ul></span>) <span class="keyword">return</span> Boolean <span class="keyword">is</span> (info.loaded); </pre></li>
<li id="l295"><pre> </pre></li>
<li id="l296"><pre>   <span class="keyword">function</span> <span class="droplink">Zip_name<ul><li><a href="zip.ads.html#zip.ads:84:12" title="To API doc">To API doc</a></li><li><a href="src_zip.ads.html#l84" title="To spec">To spec</a></li></ul></span> (<span class="droplink">info<ul><li><a href="zip.ads.html#zip.ads:84:22" title="To API doc">To API doc</a></li><li><a href="src_zip.ads.html#l84" title="To spec">To spec</a></li></ul></span> : <span class="droplink">Zip_info<ul><li><a href="zip.ads.html#zip.ads:53:8" title="To API doc">To API doc</a></li><li><a href="src_zip.ads.html#l53" title="To spec">To spec</a></li><li><a href="src_zip.ads.html#l308" title="To body">To body</a></li></ul></span>) <span class="keyword">return</span> String <span class="keyword">is</span> </pre></li>
<li id="l297"><pre> </pre></li>
<li id="l298"><pre>   <span class="keyword">begin</span> </pre></li>
<li id="l299"><pre>      <span class="keyword">if</span> <span class="keyword">not</span> info.loaded <span class="keyword">then</span> </pre></li>
<li id="l300"><pre>         <span class="keyword">raise</span> <span class="droplink">Forgot_to_load_zip_info<ul><li><a href="zip.ads.html#zip.ads:94:3" title="To API doc">To API doc</a></li><li><a href="src_zip.ads.html#l94" title="To spec">To spec</a></li></ul></span>; </pre></li>
<li id="l301"><pre>      <span class="keyword">end</span> <span class="keyword">if</span>; </pre></li>
<li id="l302"><pre>      <span class="keyword">return</span> info.zip_file_name.<span class="keyword">all</span>; </pre></li>
<li id="l303"><pre>   <span class="keyword">end</span> <span class="droplink">Zip_name<ul><li><a href="zip.ads.html#zip.ads:84:12" title="To API doc">To API doc</a></li><li><a href="src_zip.ads.html#l84" title="To spec">To spec</a></li><li><a href="src_zip.adb.html#l296" title="To body">To body</a></li></ul></span>; </pre></li>
<li id="l304"><pre> </pre></li>
<li id="l305"><pre>   <span class="keyword">function</span> <span class="droplink">Zip_comment<ul><li><a href="zip.ads.html#zip.ads:86:12" title="To API doc">To API doc</a></li><li><a href="src_zip.ads.html#l86" title="To spec">To spec</a></li></ul></span> (<span class="droplink">info<ul><li><a href="zip.ads.html#zip.ads:86:25" title="To API doc">To API doc</a></li><li><a href="src_zip.ads.html#l86" title="To spec">To spec</a></li></ul></span> : <span class="droplink">Zip_info<ul><li><a href="zip.ads.html#zip.ads:53:8" title="To API doc">To API doc</a></li><li><a href="src_zip.ads.html#l53" title="To spec">To spec</a></li><li><a href="src_zip.ads.html#l308" title="To body">To body</a></li></ul></span>) <span class="keyword">return</span> String <span class="keyword">is</span> </pre></li>
<li id="l306"><pre> </pre></li>
<li id="l307"><pre>   <span class="keyword">begin</span> </pre></li>
<li id="l308"><pre>      <span class="keyword">if</span> <span class="keyword">not</span> info.loaded <span class="keyword">then</span> </pre></li>
<li id="l309"><pre>         <span class="keyword">raise</span> <span class="droplink">Forgot_to_load_zip_info<ul><li><a href="zip.ads.html#zip.ads:94:3" title="To API doc">To API doc</a></li><li><a href="src_zip.ads.html#l94" title="To spec">To spec</a></li></ul></span>; </pre></li>
<li id="l310"><pre>      <span class="keyword">end</span> <span class="keyword">if</span>; </pre></li>
<li id="l311"><pre>      <span class="keyword">return</span> info.zip_file_comment.<span class="keyword">all</span>; </pre></li>
<li id="l312"><pre>   <span class="keyword">end</span> <span class="droplink">Zip_comment<ul><li><a href="zip.ads.html#zip.ads:86:12" title="To API doc">To API doc</a></li><li><a href="src_zip.ads.html#l86" title="To spec">To spec</a></li><li><a href="src_zip.adb.html#l305" title="To body">To body</a></li></ul></span>; </pre></li>
<li id="l313"><pre> </pre></li>
<li id="l314"><pre>   <span class="keyword">function</span> <span class="droplink">Zip_Stream<ul><li><a href="zip.ads.html#zip.ads:88:12" title="To API doc">To API doc</a></li><li><a href="src_zip.ads.html#l88" title="To spec">To spec</a></li></ul></span> (<span class="droplink">info<ul><li><a href="zip.ads.html#zip.ads:88:24" title="To API doc">To API doc</a></li><li><a href="src_zip.ads.html#l88" title="To spec">To spec</a></li></ul></span> : <span class="droplink">Zip_info<ul><li><a href="zip.ads.html#zip.ads:53:8" title="To API doc">To API doc</a></li><li><a href="src_zip.ads.html#l53" title="To spec">To spec</a></li><li><a href="src_zip.ads.html#l308" title="To body">To body</a></li></ul></span>) <span class="keyword">return</span> <span class="droplink">Zip_Streams.Zipstream_Class<ul><li><a href="zip_streams.ads.html#zip_streams.ads:43:9" title="To API doc">To API doc</a></li><li><a href="src_zip_streams.ads.html#l43" title="To spec">To spec</a></li></ul></span> <span class="keyword">is</span> </pre></li>
<li id="l315"><pre> </pre></li>
<li id="l316"><pre>   <span class="keyword">begin</span> </pre></li>
<li id="l317"><pre>      <span class="keyword">if</span> <span class="keyword">not</span> info.loaded <span class="keyword">then</span> </pre></li>
<li id="l318"><pre>         <span class="keyword">raise</span> <span class="droplink">Forgot_to_load_zip_info<ul><li><a href="zip.ads.html#zip.ads:94:3" title="To API doc">To API doc</a></li><li><a href="src_zip.ads.html#l94" title="To spec">To spec</a></li></ul></span>; </pre></li>
<li id="l319"><pre>      <span class="keyword">end</span> <span class="keyword">if</span>; </pre></li>
<li id="l320"><pre>      <span class="keyword">return</span> info.zip_input_stream; </pre></li>
<li id="l321"><pre>   <span class="keyword">end</span> <span class="droplink">Zip_Stream<ul><li><a href="zip.ads.html#zip.ads:88:12" title="To API doc">To API doc</a></li><li><a href="src_zip.ads.html#l88" title="To spec">To spec</a></li><li><a href="src_zip.adb.html#l314" title="To body">To body</a></li></ul></span>; </pre></li>
<li id="l322"><pre> </pre></li>
<li id="l323"><pre>   <span class="keyword">function</span> <span class="droplink">Entries<ul><li><a href="zip.ads.html#zip.ads:90:12" title="To API doc">To API doc</a></li><li><a href="src_zip.ads.html#l90" title="To spec">To spec</a></li></ul></span> (<span class="droplink">info<ul><li><a href="zip.ads.html#zip.ads:90:21" title="To API doc">To API doc</a></li><li><a href="src_zip.ads.html#l90" title="To spec">To spec</a></li></ul></span> : <span class="droplink">Zip_info<ul><li><a href="zip.ads.html#zip.ads:53:8" title="To API doc">To API doc</a></li><li><a href="src_zip.ads.html#l53" title="To spec">To spec</a></li><li><a href="src_zip.ads.html#l308" title="To body">To body</a></li></ul></span>) <span class="keyword">return</span> Natural <span class="keyword">is</span> (info.total_entries); </pre></li>
<li id="l324"><pre> </pre></li>
<li id="l325"><pre>   <span class="comment">------------</span> </pre></li>
<li id="l326"><pre>   <span class="comment">-- Delete --</span> </pre></li>
<li id="l327"><pre>   <span class="comment">------------</span> </pre></li>
<li id="l328"><pre> </pre></li>
<li id="l329"><pre>   <span class="keyword">procedure</span> <span class="droplink">Delete<ul><li><a href="zip.ads.html#zip.ads:92:13" title="To API doc">To API doc</a></li><li><a href="src_zip.ads.html#l92" title="To spec">To spec</a></li></ul></span> (<span class="droplink">info<ul><li><a href="zip.ads.html#zip.ads:92:21" title="To API doc">To API doc</a></li><li><a href="src_zip.ads.html#l92" title="To spec">To spec</a></li></ul></span>  : <span class="keyword">in</span> <span class="keyword">out</span> <span class="droplink">Zip_info<ul><li><a href="zip.ads.html#zip.ads:53:8" title="To API doc">To API doc</a></li><li><a href="src_zip.ads.html#l53" title="To spec">To spec</a></li><li><a href="src_zip.ads.html#l308" title="To body">To body</a></li></ul></span>) <span class="keyword">is</span> </pre></li>
<li id="l330"><pre> </pre></li>
<li id="l331"><pre>      <span class="keyword">procedure</span> Delete (p : <span class="keyword">in</span> <span class="keyword">out</span> <span class="droplink">p_Dir_node<ul><li><a href="zip.ads.html#zip.ads:291:8" title="To API doc">To API doc</a></li><li><a href="src_zip.ads.html#l291" title="To spec">To spec</a></li></ul></span>) <span class="keyword">is</span> </pre></li>
<li id="l332"><pre>      <span class="keyword">begin</span> </pre></li>
<li id="l333"><pre>         <span class="keyword">if</span> <a href="src_zip.adb.html#l331" title="defined at zip.adb:331:25">p</a> /= <span class="keyword">null</span> <span class="keyword">then</span> </pre></li>
<li id="l334"><pre>            <span class="droplink">Delete<ul><li><a href="src_zip.adb.html#l331" title="To spec">To spec</a></li><li><a href="src_zip.adb.html#l331" title="To body">To body</a></li></ul></span> (<a href="src_zip.adb.html#l331" title="defined at zip.adb:331:25">p</a>.<span class="keyword">all</span>.left); </pre></li>
<li id="l335"><pre>            <span class="droplink">Delete<ul><li><a href="src_zip.adb.html#l331" title="To spec">To spec</a></li><li><a href="src_zip.adb.html#l331" title="To body">To body</a></li></ul></span> (<a href="src_zip.adb.html#l331" title="defined at zip.adb:331:25">p</a>.<span class="keyword">all</span>.right); </pre></li>
<li id="l336"><pre>            <a href="src_zip.adb.html#l13" title="defined at zip.adb:13:14">Dispose</a> (<a href="src_zip.adb.html#l331" title="defined at zip.adb:331:25">p</a>); </pre></li>
<li id="l337"><pre>            <a href="src_zip.adb.html#l331" title="defined at zip.adb:331:25">p</a> := <span class="keyword">null</span>; </pre></li>
<li id="l338"><pre>         <span class="keyword">end</span> <span class="keyword">if</span>; </pre></li>
<li id="l339"><pre>      <span class="keyword">end</span> <span class="droplink">Delete<ul><li><a href="src_zip.adb.html#l331" title="To spec">To spec</a></li><li><a href="src_zip.adb.html#l331" title="To body">To body</a></li></ul></span>; </pre></li>
<li id="l340"><pre> </pre></li>
<li id="l341"><pre>   <span class="keyword">begin</span> </pre></li>
<li id="l342"><pre>      <span class="keyword">if</span> <span class="keyword">not</span> info.loaded <span class="keyword">then</span> </pre></li>
<li id="l343"><pre>         <span class="keyword">raise</span> <span class="droplink">Forgot_to_load_zip_info<ul><li><a href="zip.ads.html#zip.ads:94:3" title="To API doc">To API doc</a></li><li><a href="src_zip.ads.html#l94" title="To spec">To spec</a></li></ul></span>; </pre></li>
<li id="l344"><pre>      <span class="keyword">end</span> <span class="keyword">if</span>; </pre></li>
<li id="l345"><pre>      <span class="droplink">Delete<ul><li><a href="src_zip.adb.html#l331" title="To spec">To spec</a></li><li><a href="src_zip.adb.html#l331" title="To body">To body</a></li></ul></span> (info.dir_binary_tree); </pre></li>
<li id="l346"><pre>      <a href="src_zip.adb.html#l14" title="defined at zip.adb:14:14">Dispose</a> (info.zip_file_name); </pre></li>
<li id="l347"><pre>      info.loaded := False; <span class="comment">-- &lt; -- added 14 - Jan - 2002</span> </pre></li>
<li id="l348"><pre>   <span class="keyword">end</span> <span class="droplink">Delete<ul><li><a href="zip.ads.html#zip.ads:92:13" title="To API doc">To API doc</a></li><li><a href="src_zip.ads.html#l92" title="To spec">To spec</a></li><li><a href="src_zip.adb.html#l329" title="To body">To body</a></li></ul></span>; </pre></li>
<li id="l349"><pre> </pre></li>
<li id="l350"><pre>   <span class="comment">-- Traverse a whole Zip_info directory in sorted order, giving the</span> </pre></li>
<li id="l351"><pre>   <span class="comment">-- name for each entry to an user - defined &quot;Action&quot; procedure.</span> </pre></li>
<li id="l352"><pre>   <span class="comment">-- Added 29 - Nov - 2002</span> </pre></li>
<li id="l353"><pre>   <span class="keyword">procedure</span> <span class="droplink">Traverse<ul><li><a href="zip.ads.html#zip.ads:140:13" title="To API doc">To API doc</a></li><li><a href="src_zip.ads.html#l140" title="To spec">To spec</a></li></ul></span> (<span class="droplink">z<ul><li><a href="zip.ads.html#zip.ads:140:23" title="To API doc">To API doc</a></li><li><a href="src_zip.ads.html#l140" title="To spec">To spec</a></li></ul></span> : <span class="droplink">Zip_info<ul><li><a href="zip.ads.html#zip.ads:53:8" title="To API doc">To API doc</a></li><li><a href="src_zip.ads.html#l53" title="To spec">To spec</a></li><li><a href="src_zip.ads.html#l308" title="To body">To body</a></li></ul></span>) <span class="keyword">is</span> </pre></li>
<li id="l354"><pre> </pre></li>
<li id="l355"><pre>      <span class="keyword">procedure</span> Traverse (p : <span class="droplink">p_Dir_node<ul><li><a href="zip.ads.html#zip.ads:291:8" title="To API doc">To API doc</a></li><li><a href="src_zip.ads.html#l291" title="To spec">To spec</a></li></ul></span>) <span class="keyword">is</span> </pre></li>
<li id="l356"><pre> </pre></li>
<li id="l357"><pre>      <span class="keyword">begin</span> </pre></li>
<li id="l358"><pre>         <span class="keyword">if</span> <a href="src_zip.adb.html#l355" title="defined at zip.adb:355:27">p</a> /= <span class="keyword">null</span> <span class="keyword">then</span> </pre></li>
<li id="l359"><pre>            <span class="droplink">Traverse<ul><li><a href="src_zip.adb.html#l355" title="To spec">To spec</a></li><li><a href="src_zip.adb.html#l355" title="To body">To body</a></li></ul></span> (<a href="src_zip.adb.html#l355" title="defined at zip.adb:355:27">p</a>.<span class="keyword">all</span>.left); </pre></li>
<li id="l360"><pre>            <span class="droplink">Action<ul><li><a href="zip.ads.html#zip.ads:139:20" title="To API doc">To API doc</a></li><li><a href="src_zip.ads.html#l139" title="To spec">To spec</a></li></ul></span> (<a href="src_zip.adb.html#l355" title="defined at zip.adb:355:27">p</a>.<span class="keyword">all</span>.file_name); </pre></li>
<li id="l361"><pre>            <span class="droplink">Traverse<ul><li><a href="src_zip.adb.html#l355" title="To spec">To spec</a></li><li><a href="src_zip.adb.html#l355" title="To body">To body</a></li></ul></span> (<a href="src_zip.adb.html#l355" title="defined at zip.adb:355:27">p</a>.<span class="keyword">all</span>.right); </pre></li>
<li id="l362"><pre>         <span class="keyword">end</span> <span class="keyword">if</span>; </pre></li>
<li id="l363"><pre>      <span class="keyword">end</span> <span class="droplink">Traverse<ul><li><a href="src_zip.adb.html#l355" title="To spec">To spec</a></li><li><a href="src_zip.adb.html#l355" title="To body">To body</a></li></ul></span>; </pre></li>
<li id="l364"><pre> </pre></li>
<li id="l365"><pre>   <span class="keyword">begin</span> </pre></li>
<li id="l366"><pre>      <span class="droplink">Traverse<ul><li><a href="src_zip.adb.html#l355" title="To spec">To spec</a></li><li><a href="src_zip.adb.html#l355" title="To body">To body</a></li></ul></span> (z.dir_binary_tree); </pre></li>
<li id="l367"><pre>   <span class="keyword">end</span> <span class="droplink">Traverse<ul><li><a href="zip.ads.html#zip.ads:140:13" title="To API doc">To API doc</a></li><li><a href="src_zip.ads.html#l140" title="To spec">To spec</a></li><li><a href="src_zip.adb.html#l353" title="To body">To body</a></li></ul></span>; </pre></li>
<li id="l368"><pre> </pre></li>
<li id="l369"><pre>   <span class="keyword">procedure</span> <span class="droplink">Traverse_verbose<ul><li><a href="zip.ads.html#zip.ads:155:13" title="To API doc">To API doc</a></li><li><a href="src_zip.ads.html#l155" title="To spec">To spec</a></li></ul></span> (<span class="droplink">z<ul><li><a href="zip.ads.html#zip.ads:155:31" title="To API doc">To API doc</a></li><li><a href="src_zip.ads.html#l155" title="To spec">To spec</a></li></ul></span> : <span class="droplink">Zip_info<ul><li><a href="zip.ads.html#zip.ads:53:8" title="To API doc">To API doc</a></li><li><a href="src_zip.ads.html#l53" title="To spec">To spec</a></li><li><a href="src_zip.ads.html#l308" title="To body">To body</a></li></ul></span>) <span class="keyword">is</span> </pre></li>
<li id="l370"><pre> </pre></li>
<li id="l371"><pre>      <span class="keyword">procedure</span> Traverse_verbose_recursive (p : <span class="droplink">p_Dir_node<ul><li><a href="zip.ads.html#zip.ads:291:8" title="To API doc">To API doc</a></li><li><a href="src_zip.ads.html#l291" title="To spec">To spec</a></li></ul></span>) <span class="keyword">is</span> </pre></li>
<li id="l372"><pre> </pre></li>
<li id="l373"><pre>      <span class="keyword">begin</span> </pre></li>
<li id="l374"><pre>         <span class="keyword">if</span> <a href="src_zip.adb.html#l371" title="defined at zip.adb:371:45">p</a> /= <span class="keyword">null</span> <span class="keyword">then</span> </pre></li>
<li id="l375"><pre>            <span class="droplink">Traverse_verbose_recursive<ul><li><a href="src_zip.adb.html#l371" title="To spec">To spec</a></li><li><a href="src_zip.adb.html#l371" title="To body">To body</a></li></ul></span> (<a href="src_zip.adb.html#l371" title="defined at zip.adb:371:45">p</a>.<span class="keyword">all</span>.left); </pre></li>
<li id="l376"><pre>            <span class="droplink">Action<ul><li><a href="zip.ads.html#zip.ads:145:20" title="To API doc">To API doc</a></li><li><a href="src_zip.ads.html#l145" title="To spec">To spec</a></li></ul></span> (<a href="src_zip.adb.html#l371" title="defined at zip.adb:371:45">p</a>.<span class="keyword">all</span>.file_name, </pre></li>
<li id="l377"><pre>                    Positive (<a href="src_zip.adb.html#l371" title="defined at zip.adb:371:45">p</a>.<span class="keyword">all</span>.file_index), </pre></li>
<li id="l378"><pre>                    <a href="src_zip.adb.html#l371" title="defined at zip.adb:371:45">p</a>.<span class="keyword">all</span>.comp_size, </pre></li>
<li id="l379"><pre>                    <a href="src_zip.adb.html#l371" title="defined at zip.adb:371:45">p</a>.<span class="keyword">all</span>.uncomp_size, </pre></li>
<li id="l380"><pre>                    <a href="src_zip.adb.html#l371" title="defined at zip.adb:371:45">p</a>.<span class="keyword">all</span>.crc_32, </pre></li>
<li id="l381"><pre>                    <a href="src_zip.adb.html#l371" title="defined at zip.adb:371:45">p</a>.<span class="keyword">all</span>.date_time, </pre></li>
<li id="l382"><pre>                    <a href="src_zip.adb.html#l371" title="defined at zip.adb:371:45">p</a>.<span class="keyword">all</span>.method, </pre></li>
<li id="l383"><pre>                    <a href="src_zip.adb.html#l371" title="defined at zip.adb:371:45">p</a>.<span class="keyword">all</span>.unicode_file_name); </pre></li>
<li id="l384"><pre>            <span class="droplink">Traverse_verbose_recursive<ul><li><a href="src_zip.adb.html#l371" title="To spec">To spec</a></li><li><a href="src_zip.adb.html#l371" title="To body">To body</a></li></ul></span> (<a href="src_zip.adb.html#l371" title="defined at zip.adb:371:45">p</a>.<span class="keyword">all</span>.right); </pre></li>
<li id="l385"><pre>         <span class="keyword">end</span> <span class="keyword">if</span>; </pre></li>
<li id="l386"><pre>      <span class="keyword">end</span> <span class="droplink">Traverse_verbose_recursive<ul><li><a href="src_zip.adb.html#l371" title="To spec">To spec</a></li><li><a href="src_zip.adb.html#l371" title="To body">To body</a></li></ul></span>; </pre></li>
<li id="l387"><pre> </pre></li>
<li id="l388"><pre>   <span class="keyword">begin</span> </pre></li>
<li id="l389"><pre>      <span class="droplink">Traverse_verbose_recursive<ul><li><a href="src_zip.adb.html#l371" title="To spec">To spec</a></li><li><a href="src_zip.adb.html#l371" title="To body">To body</a></li></ul></span> (z.dir_binary_tree); </pre></li>
<li id="l390"><pre>   <span class="keyword">end</span> <span class="droplink">Traverse_verbose<ul><li><a href="zip.ads.html#zip.ads:155:13" title="To API doc">To API doc</a></li><li><a href="src_zip.ads.html#l155" title="To spec">To spec</a></li><li><a href="src_zip.adb.html#l369" title="To body">To body</a></li></ul></span>; </pre></li>
<li id="l391"><pre> </pre></li>
<li id="l392"><pre>   <span class="keyword">procedure</span> <span class="droplink">Tree_stat<ul><li><a href="zip.ads.html#zip.ads:158:14" title="To API doc">To API doc</a></li><li><a href="src_zip.ads.html#l158" title="To spec">To spec</a></li></ul></span> (<span class="droplink">z<ul><li><a href="zip.ads.html#zip.ads:158:25" title="To API doc">To API doc</a></li><li><a href="src_zip.ads.html#l158" title="To spec">To spec</a></li></ul></span>         :     <span class="droplink">Zip_info<ul><li><a href="zip.ads.html#zip.ads:53:8" title="To API doc">To API doc</a></li><li><a href="src_zip.ads.html#l53" title="To spec">To spec</a></li><li><a href="src_zip.ads.html#l308" title="To body">To body</a></li></ul></span>; </pre></li>
<li id="l393"><pre>                        <span class="droplink">total<ul><li><a href="zip.ads.html#zip.ads:159:25" title="To API doc">To API doc</a></li><li><a href="src_zip.ads.html#l159" title="To spec">To spec</a></li></ul></span>     : <span class="keyword">out</span> Natural; </pre></li>
<li id="l394"><pre>                        <span class="droplink">max_depth<ul><li><a href="zip.ads.html#zip.ads:160:25" title="To API doc">To API doc</a></li><li><a href="src_zip.ads.html#l160" title="To spec">To spec</a></li></ul></span> : <span class="keyword">out</span> Natural; </pre></li>
<li id="l395"><pre>                        <span class="droplink">avg_depth<ul><li><a href="zip.ads.html#zip.ads:161:25" title="To API doc">To API doc</a></li><li><a href="src_zip.ads.html#l161" title="To spec">To spec</a></li></ul></span> : <span class="keyword">out</span> Float) <span class="keyword">is</span> </pre></li>
<li id="l396"><pre> </pre></li>
<li id="l397"><pre>      sum_depth : Natural := 0; </pre></li>
<li id="l398"><pre> </pre></li>
<li id="l399"><pre>      <span class="keyword">procedure</span> Traverse_stat_recursive (p : <span class="droplink">p_Dir_node<ul><li><a href="zip.ads.html#zip.ads:291:8" title="To API doc">To API doc</a></li><li><a href="src_zip.ads.html#l291" title="To spec">To spec</a></li></ul></span>; depth : Natural) <span class="keyword">is</span> </pre></li>
<li id="l400"><pre> </pre></li>
<li id="l401"><pre>      <span class="keyword">begin</span> </pre></li>
<li id="l402"><pre>         <span class="keyword">if</span> <a href="src_zip.adb.html#l399" title="defined at zip.adb:399:42">p</a> /= <span class="keyword">null</span> <span class="keyword">then</span> </pre></li>
<li id="l403"><pre>            <span class="droplink">total<ul><li><a href="zip.ads.html#zip.ads:159:25" title="To API doc">To API doc</a></li><li><a href="src_zip.ads.html#l159" title="To spec">To spec</a></li></ul></span> := <span class="droplink">total<ul><li><a href="zip.ads.html#zip.ads:159:25" title="To API doc">To API doc</a></li><li><a href="src_zip.ads.html#l159" title="To spec">To spec</a></li></ul></span> + 1; </pre></li>
<li id="l404"><pre>            <span class="keyword">if</span> <a href="src_zip.adb.html#l399" title="defined at zip.adb:399:58">depth</a> &gt; <span class="droplink">max_depth<ul><li><a href="zip.ads.html#zip.ads:160:25" title="To API doc">To API doc</a></li><li><a href="src_zip.ads.html#l160" title="To spec">To spec</a></li></ul></span> <span class="keyword">then</span> </pre></li>
<li id="l405"><pre>               <span class="droplink">max_depth<ul><li><a href="zip.ads.html#zip.ads:160:25" title="To API doc">To API doc</a></li><li><a href="src_zip.ads.html#l160" title="To spec">To spec</a></li></ul></span> := <a href="src_zip.adb.html#l399" title="defined at zip.adb:399:58">depth</a>; </pre></li>
<li id="l406"><pre>            <span class="keyword">end</span> <span class="keyword">if</span>; </pre></li>
<li id="l407"><pre>            <a href="src_zip.adb.html#l397" title="defined at zip.adb:397:7">sum_depth</a> := <a href="src_zip.adb.html#l397" title="defined at zip.adb:397:7">sum_depth</a> + <a href="src_zip.adb.html#l399" title="defined at zip.adb:399:58">depth</a>; </pre></li>
<li id="l408"><pre>            <span class="droplink">Traverse_stat_recursive<ul><li><a href="src_zip.adb.html#l399" title="To spec">To spec</a></li><li><a href="src_zip.adb.html#l399" title="To body">To body</a></li></ul></span> (<a href="src_zip.adb.html#l399" title="defined at zip.adb:399:42">p</a>.<span class="keyword">all</span>.left, <a href="src_zip.adb.html#l399" title="defined at zip.adb:399:58">depth</a> + 1); </pre></li>
<li id="l409"><pre>            <span class="droplink">Traverse_stat_recursive<ul><li><a href="src_zip.adb.html#l399" title="To spec">To spec</a></li><li><a href="src_zip.adb.html#l399" title="To body">To body</a></li></ul></span> (<a href="src_zip.adb.html#l399" title="defined at zip.adb:399:42">p</a>.<span class="keyword">all</span>.right, <a href="src_zip.adb.html#l399" title="defined at zip.adb:399:58">depth</a> + 1); </pre></li>
<li id="l410"><pre>         <span class="keyword">end</span> <span class="keyword">if</span>; </pre></li>
<li id="l411"><pre>      <span class="keyword">end</span> <span class="droplink">Traverse_stat_recursive<ul><li><a href="src_zip.adb.html#l399" title="To spec">To spec</a></li><li><a href="src_zip.adb.html#l399" title="To body">To body</a></li></ul></span>; </pre></li>
<li id="l412"><pre> </pre></li>
<li id="l413"><pre>   <span class="keyword">begin</span> </pre></li>
<li id="l414"><pre>      <span class="droplink">total<ul><li><a href="zip.ads.html#zip.ads:159:25" title="To API doc">To API doc</a></li><li><a href="src_zip.ads.html#l159" title="To spec">To spec</a></li></ul></span> := 0; </pre></li>
<li id="l415"><pre>      <span class="droplink">max_depth<ul><li><a href="zip.ads.html#zip.ads:160:25" title="To API doc">To API doc</a></li><li><a href="src_zip.ads.html#l160" title="To spec">To spec</a></li></ul></span> := 0; </pre></li>
<li id="l416"><pre>      <span class="droplink">Traverse_stat_recursive<ul><li><a href="src_zip.adb.html#l399" title="To spec">To spec</a></li><li><a href="src_zip.adb.html#l399" title="To body">To body</a></li></ul></span> (z.dir_binary_tree, 0); </pre></li>
<li id="l417"><pre>      <span class="keyword">if</span> <span class="droplink">total<ul><li><a href="zip.ads.html#zip.ads:159:25" title="To API doc">To API doc</a></li><li><a href="src_zip.ads.html#l159" title="To spec">To spec</a></li></ul></span> = 0 <span class="keyword">then</span> </pre></li>
<li id="l418"><pre>         <span class="droplink">avg_depth<ul><li><a href="zip.ads.html#zip.ads:161:25" title="To API doc">To API doc</a></li><li><a href="src_zip.ads.html#l161" title="To spec">To spec</a></li></ul></span> := 0.0; </pre></li>
<li id="l419"><pre>      <span class="keyword">else</span> </pre></li>
<li id="l420"><pre>         <span class="droplink">avg_depth<ul><li><a href="zip.ads.html#zip.ads:161:25" title="To API doc">To API doc</a></li><li><a href="src_zip.ads.html#l161" title="To spec">To spec</a></li></ul></span> := Float (<a href="src_zip.adb.html#l397" title="defined at zip.adb:397:7">sum_depth</a>) / Float (<span class="droplink">total<ul><li><a href="zip.ads.html#zip.ads:159:25" title="To API doc">To API doc</a></li><li><a href="src_zip.ads.html#l159" title="To spec">To spec</a></li></ul></span>); </pre></li>
<li id="l421"><pre>      <span class="keyword">end</span> <span class="keyword">if</span>; </pre></li>
<li id="l422"><pre>   <span class="keyword">end</span> <span class="droplink">Tree_stat<ul><li><a href="zip.ads.html#zip.ads:158:14" title="To API doc">To API doc</a></li><li><a href="src_zip.ads.html#l158" title="To spec">To spec</a></li><li><a href="src_zip.adb.html#l392" title="To body">To body</a></li></ul></span>; </pre></li>
<li id="l423"><pre> </pre></li>
<li id="l424"><pre>   <span class="comment">-- 13 - May - 2001 : Find_first_offset</span> </pre></li>
<li id="l425"><pre> </pre></li>
<li id="l426"><pre>   <span class="comment">-- For an all - files unzipping of an appended (e.g. self - extracting) archive</span> </pre></li>
<li id="l427"><pre>   <span class="comment">-- (not beginning with ZIP contents), we cannot start with</span> </pre></li>
<li id="l428"><pre>   <span class="comment">-- index 1 in file.</span> </pre></li>
<li id="l429"><pre>   <span class="comment">-- But the offset of first entry in ZIP directory is not valid either,</span> </pre></li>
<li id="l430"><pre>   <span class="comment">-- as this excerpt of appnote.txt states:</span> </pre></li>
<li id="l431"><pre> </pre></li>
<li id="l432"><pre>   <span class="comment">-- &quot;   4)  The entries in the central directory may not necessarily</span> </pre></li>
<li id="l433"><pre>   <span class="comment">--         be in the same order that files appear in the zipfile.    &quot;</span> </pre></li>
<li id="l434"><pre> </pre></li>
<li id="l435"><pre>   <span class="keyword">procedure</span> <span class="droplink">Find_first_offset<ul><li><a href="zip.ads.html#zip.ads:169:14" title="To API doc">To API doc</a></li><li><a href="src_zip.ads.html#l169" title="To spec">To spec</a></li></ul></span> (<span class="droplink">file<ul><li><a href="zip.ads.html#zip.ads:169:33" title="To API doc">To API doc</a></li><li><a href="src_zip.ads.html#l169" title="To spec">To spec</a></li></ul></span>            :     <span class="droplink">Zip_Streams.Zipstream_Class<ul><li><a href="zip_streams.ads.html#zip_streams.ads:43:9" title="To API doc">To API doc</a></li><li><a href="src_zip_streams.ads.html#l43" title="To spec">To spec</a></li></ul></span>; </pre></li>
<li id="l436"><pre>                                <span class="droplink">file_index<ul><li><a href="zip.ads.html#zip.ads:170:33" title="To API doc">To API doc</a></li><li><a href="src_zip.ads.html#l170" title="To spec">To spec</a></li></ul></span>      : <span class="keyword">out</span> Positive) <span class="keyword">is</span> </pre></li>
<li id="l437"><pre> </pre></li>
<li id="l438"><pre>      the_end    : <span class="droplink">Zip.Headers.End_of_Central_Dir<ul><li><a href="zip-headers.ads.html#zip-headers.ads:118:8" title="To API doc">To API doc</a></li><li><a href="src_zip-headers.ads.html#l118" title="To spec">To spec</a></li></ul></span>; </pre></li>
<li id="l439"><pre>      header     : <span class="droplink">Zip.Headers.Central_File_Header<ul><li><a href="zip-headers.ads.html#zip-headers.ads:84:8" title="To API doc">To API doc</a></li><li><a href="src_zip-headers.ads.html#l84" title="To spec">To spec</a></li></ul></span>; </pre></li>
<li id="l440"><pre>      min_offset : <span class="droplink">File_size_type<ul><li><a href="zip.ads.html#zip.ads:97:11" title="To API doc">To API doc</a></li><li><a href="src_zip.ads.html#l97" title="To spec">To spec</a></li></ul></span>; </pre></li>
<li id="l441"><pre> </pre></li>
<li id="l442"><pre>      <span class="keyword">use</span> Ada.Streams.Stream_IO, <span class="droplink">Zip_Streams<ul><li><a href="zip_streams.ads.html#zip_streams.ads:31:9" title="To API doc">To API doc</a></li><li><a href="src_zip_streams.ads.html#l31" title="To spec">To spec</a></li><li><a href="src_zip_streams.adb.html#l10" title="To body">To body</a></li></ul></span>; </pre></li>
<li id="l443"><pre> </pre></li>
<li id="l444"><pre>   <span class="keyword">begin</span> </pre></li>
<li id="l445"><pre>      <span class="droplink">Zip.Headers.Load<ul><li><a href="zip-headers.ads.html#zip-headers.ads:152:13" title="To API doc">To API doc</a></li><li><a href="src_zip-headers.ads.html#l152" title="To spec">To spec</a></li><li><a href="src_zip-headers.adb.html#l222" title="To body">To body</a></li></ul></span> (<span class="droplink">file<ul><li><a href="zip.ads.html#zip.ads:169:33" title="To API doc">To API doc</a></li><li><a href="src_zip.ads.html#l169" title="To spec">To spec</a></li></ul></span>, <a href="src_zip.adb.html#l438" title="defined at zip.adb:438:7">the_end</a>); </pre></li>
<li id="l446"><pre>      <span class="droplink">Set_Index<ul><li><a href="zip_streams.ads.html#zip_streams.ads:46:14" title="To API doc">To API doc</a></li><li><a href="src_zip_streams.ads.html#l46" title="To spec">To spec</a></li></ul></span> ( </pre></li>
<li id="l447"><pre>                 <span class="droplink">file<ul><li><a href="zip.ads.html#zip.ads:169:33" title="To API doc">To API doc</a></li><li><a href="src_zip.ads.html#l169" title="To spec">To spec</a></li></ul></span>, Positive (1 + the_end.offset_shifting + the_end.central_dir_offset) </pre></li>
<li id="l448"><pre>                ); </pre></li>
<li id="l449"><pre> </pre></li>
<li id="l450"><pre>      <a href="src_zip.adb.html#l440" title="defined at zip.adb:440:7">min_offset</a> := the_end.central_dir_offset; <span class="comment">-- will be lowered</span> </pre></li>
<li id="l451"><pre> </pre></li>
<li id="l452"><pre>      <span class="keyword">for</span> i <span class="keyword">in</span> 1 .. the_end.total_entries <span class="keyword">loop</span> </pre></li>
<li id="l453"><pre>         <span class="keyword">declare</span> </pre></li>
<li id="l454"><pre>            TempStream  : <span class="keyword">constant</span> <span class="droplink">Zip_Streams.Zipstream_Class<ul><li><a href="zip_streams.ads.html#zip_streams.ads:43:9" title="To API doc">To API doc</a></li><li><a href="src_zip_streams.ads.html#l43" title="To spec">To spec</a></li></ul></span> := <span class="droplink">file<ul><li><a href="zip.ads.html#zip.ads:169:33" title="To API doc">To API doc</a></li><li><a href="src_zip.ads.html#l169" title="To spec">To spec</a></li></ul></span>; </pre></li>
<li id="l455"><pre>         <span class="keyword">begin</span> </pre></li>
<li id="l456"><pre>            <span class="droplink">Zip.Headers.Read_and_check<ul><li><a href="zip-headers.ads.html#zip-headers.ads:106:13" title="To API doc">To API doc</a></li><li><a href="src_zip-headers.ads.html#l106" title="To spec">To spec</a></li><li><a href="src_zip-headers.adb.html#l69" title="To body">To body</a></li></ul></span> (TempStream, <a href="src_zip.adb.html#l439" title="defined at zip.adb:439:7">header</a>); </pre></li>
<li id="l457"><pre>         <span class="keyword">end</span>; </pre></li>
<li id="l458"><pre> </pre></li>
<li id="l459"><pre>         <span class="droplink">Set_Index<ul><li><a href="zip_streams.ads.html#zip_streams.ads:46:14" title="To API doc">To API doc</a></li><li><a href="src_zip_streams.ads.html#l46" title="To spec">To spec</a></li></ul></span> (<span class="droplink">file<ul><li><a href="zip.ads.html#zip.ads:169:33" title="To API doc">To API doc</a></li><li><a href="src_zip.ads.html#l169" title="To spec">To spec</a></li></ul></span>, <span class="droplink">Index<ul><li><a href="zip_streams.ads.html#zip_streams.ads:50:13" title="To API doc">To API doc</a></li><li><a href="src_zip_streams.ads.html#l50" title="To spec">To spec</a></li></ul></span> (<span class="droplink">file<ul><li><a href="zip.ads.html#zip.ads:169:33" title="To API doc">To API doc</a></li><li><a href="src_zip.ads.html#l169" title="To spec">To spec</a></li></ul></span>) + </pre></li>
<li id="l460"><pre>                      Positive </pre></li>
<li id="l461"><pre>                        (header.short_info.filename_length + </pre></li>
<li id="l462"><pre>                             header.short_info.extra_field_length + </pre></li>
<li id="l463"><pre>                               header.comment_length)); </pre></li>
<li id="l464"><pre>         <span class="comment">-- Now the whole i_th central directory entry is behind</span> </pre></li>
<li id="l465"><pre> </pre></li>
<li id="l466"><pre>         <span class="keyword">if</span> header.local_header_offset &lt; <a href="src_zip.adb.html#l440" title="defined at zip.adb:440:7">min_offset</a> <span class="keyword">then</span> </pre></li>
<li id="l467"><pre>            <a href="src_zip.adb.html#l440" title="defined at zip.adb:440:7">min_offset</a> := header.local_header_offset; </pre></li>
<li id="l468"><pre>         <span class="keyword">end</span> <span class="keyword">if</span>; </pre></li>
<li id="l469"><pre>      <span class="keyword">end</span> <span class="keyword">loop</span>; </pre></li>
<li id="l470"><pre> </pre></li>
<li id="l471"><pre>      <span class="droplink">file_index<ul><li><a href="zip.ads.html#zip.ads:170:33" title="To API doc">To API doc</a></li><li><a href="src_zip.ads.html#l170" title="To spec">To spec</a></li></ul></span> := Positive (1 + <a href="src_zip.adb.html#l440" title="defined at zip.adb:440:7">min_offset</a> + the_end.offset_shifting); </pre></li>
<li id="l472"><pre> </pre></li>
<li id="l473"><pre>   <span class="keyword">end</span> <span class="droplink">Find_first_offset<ul><li><a href="zip.ads.html#zip.ads:169:14" title="To API doc">To API doc</a></li><li><a href="src_zip.ads.html#l169" title="To spec">To spec</a></li><li><a href="src_zip.adb.html#l435" title="To body">To body</a></li></ul></span>; </pre></li>
<li id="l474"><pre> </pre></li>
<li id="l475"><pre>   <span class="comment">-- Internal : find offset of a zipped file by reading sequentially the</span> </pre></li>
<li id="l476"><pre>   <span class="comment">-- central directory : - (</span> </pre></li>
<li id="l477"><pre> </pre></li>
<li id="l478"><pre>   <span class="keyword">procedure</span> <span class="droplink">Find_offset<ul><li><a href="zip.ads.html#zip.ads:175:14" title="To API doc">To API doc</a></li><li><a href="src_zip.ads.html#l175" title="To spec">To spec</a></li></ul></span> (<span class="droplink">file<ul><li><a href="zip.ads.html#zip.ads:175:27" title="To API doc">To API doc</a></li><li><a href="src_zip.ads.html#l175" title="To spec">To spec</a></li></ul></span>            :     <span class="droplink">Zip_Streams.Zipstream_Class<ul><li><a href="zip_streams.ads.html#zip_streams.ads:43:9" title="To API doc">To API doc</a></li><li><a href="src_zip_streams.ads.html#l43" title="To spec">To spec</a></li></ul></span>; </pre></li>
<li id="l479"><pre>                          <span class="droplink">name<ul><li><a href="zip.ads.html#zip.ads:176:27" title="To API doc">To API doc</a></li><li><a href="src_zip.ads.html#l176" title="To spec">To spec</a></li></ul></span>            :     String; </pre></li>
<li id="l480"><pre>                          <span class="droplink">case_sensitive<ul><li><a href="zip.ads.html#zip.ads:177:27" title="To API doc">To API doc</a></li><li><a href="src_zip.ads.html#l177" title="To spec">To spec</a></li></ul></span>  :     Boolean; </pre></li>
<li id="l481"><pre>                          <span class="droplink">file_index<ul><li><a href="zip.ads.html#zip.ads:178:27" title="To API doc">To API doc</a></li><li><a href="src_zip.ads.html#l178" title="To spec">To spec</a></li></ul></span>      : <span class="keyword">out</span> Positive; </pre></li>
<li id="l482"><pre>                          <span class="droplink">comp_size<ul><li><a href="zip.ads.html#zip.ads:179:27" title="To API doc">To API doc</a></li><li><a href="src_zip.ads.html#l179" title="To spec">To spec</a></li></ul></span>       : <span class="keyword">out</span> <span class="droplink">File_size_type<ul><li><a href="zip.ads.html#zip.ads:97:11" title="To API doc">To API doc</a></li><li><a href="src_zip.ads.html#l97" title="To spec">To spec</a></li></ul></span>; </pre></li>
<li id="l483"><pre>                          <span class="droplink">uncomp_size<ul><li><a href="zip.ads.html#zip.ads:180:27" title="To API doc">To API doc</a></li><li><a href="src_zip.ads.html#l180" title="To spec">To spec</a></li></ul></span>     : <span class="keyword">out</span> <span class="droplink">File_size_type<ul><li><a href="zip.ads.html#zip.ads:97:11" title="To API doc">To API doc</a></li><li><a href="src_zip.ads.html#l97" title="To spec">To spec</a></li></ul></span>) <span class="keyword">is</span> </pre></li>
<li id="l484"><pre> </pre></li>
<li id="l485"><pre>      the_end : <span class="droplink">Zip.Headers.End_of_Central_Dir<ul><li><a href="zip-headers.ads.html#zip-headers.ads:118:8" title="To API doc">To API doc</a></li><li><a href="src_zip-headers.ads.html#l118" title="To spec">To spec</a></li></ul></span>; </pre></li>
<li id="l486"><pre> </pre></li>
<li id="l487"><pre>      header  : <span class="droplink">Zip.Headers.Central_File_Header<ul><li><a href="zip-headers.ads.html#zip-headers.ads:84:8" title="To API doc">To API doc</a></li><li><a href="src_zip-headers.ads.html#l84" title="To spec">To spec</a></li></ul></span>; </pre></li>
<li id="l488"><pre> </pre></li>
<li id="l489"><pre>      <span class="keyword">use</span> Ada.Streams, Ada.Streams.Stream_IO, <span class="droplink">Zip_Streams<ul><li><a href="zip_streams.ads.html#zip_streams.ads:31:9" title="To API doc">To API doc</a></li><li><a href="src_zip_streams.ads.html#l31" title="To spec">To spec</a></li><li><a href="src_zip_streams.adb.html#l10" title="To body">To body</a></li></ul></span>; </pre></li>
<li id="l490"><pre> </pre></li>
<li id="l491"><pre>   <span class="keyword">begin</span> </pre></li>
<li id="l492"><pre>      <span class="droplink">Zip.Headers.Load<ul><li><a href="zip-headers.ads.html#zip-headers.ads:152:13" title="To API doc">To API doc</a></li><li><a href="src_zip-headers.ads.html#l152" title="To spec">To spec</a></li><li><a href="src_zip-headers.adb.html#l222" title="To body">To body</a></li></ul></span> (<span class="droplink">file<ul><li><a href="zip.ads.html#zip.ads:175:27" title="To API doc">To API doc</a></li><li><a href="src_zip.ads.html#l175" title="To spec">To spec</a></li></ul></span>, <a href="src_zip.adb.html#l485" title="defined at zip.adb:485:7">the_end</a>); </pre></li>
<li id="l493"><pre>      <span class="droplink">Set_Index<ul><li><a href="zip_streams.ads.html#zip_streams.ads:46:14" title="To API doc">To API doc</a></li><li><a href="src_zip_streams.ads.html#l46" title="To spec">To spec</a></li></ul></span> (<span class="droplink">file<ul><li><a href="zip.ads.html#zip.ads:175:27" title="To API doc">To API doc</a></li><li><a href="src_zip.ads.html#l175" title="To spec">To spec</a></li></ul></span>, Positive (1 + the_end.central_dir_offset + the_end.offset_shifting)); </pre></li>
<li id="l494"><pre>      <span class="keyword">for</span> i <span class="keyword">in</span> 1 .. the_end.total_entries <span class="keyword">loop</span> </pre></li>
<li id="l495"><pre>         <span class="keyword">declare</span> </pre></li>
<li id="l496"><pre>            TempStream  : <span class="keyword">constant</span> <span class="droplink">Zipstream_Class<ul><li><a href="zip_streams.ads.html#zip_streams.ads:43:9" title="To API doc">To API doc</a></li><li><a href="src_zip_streams.ads.html#l43" title="To spec">To spec</a></li></ul></span> := <span class="droplink">file<ul><li><a href="zip.ads.html#zip.ads:175:27" title="To API doc">To API doc</a></li><li><a href="src_zip.ads.html#l175" title="To spec">To spec</a></li></ul></span>; </pre></li>
<li id="l497"><pre>         <span class="keyword">begin</span> </pre></li>
<li id="l498"><pre>            <span class="droplink">Zip.Headers.Read_and_check<ul><li><a href="zip-headers.ads.html#zip-headers.ads:106:13" title="To API doc">To API doc</a></li><li><a href="src_zip-headers.ads.html#l106" title="To spec">To spec</a></li><li><a href="src_zip-headers.adb.html#l69" title="To body">To body</a></li></ul></span> (TempStream, <a href="src_zip.adb.html#l487" title="defined at zip.adb:487:7">header</a>); </pre></li>
<li id="l499"><pre>         <span class="keyword">end</span>; </pre></li>
<li id="l500"><pre>         <span class="keyword">declare</span> </pre></li>
<li id="l501"><pre>            this_name : String (1 .. Natural (header.short_info.filename_length)); </pre></li>
<li id="l502"><pre>         <span class="keyword">begin</span> </pre></li>
<li id="l503"><pre>            String&apos;Read (<span class="droplink">file<ul><li><a href="zip.ads.html#zip.ads:175:27" title="To API doc">To API doc</a></li><li><a href="src_zip.ads.html#l175" title="To spec">To spec</a></li></ul></span>, this_name); </pre></li>
<li id="l504"><pre>            <span class="droplink">Set_Index<ul><li><a href="zip_streams.ads.html#zip_streams.ads:46:14" title="To API doc">To API doc</a></li><li><a href="src_zip_streams.ads.html#l46" title="To spec">To spec</a></li></ul></span> (<span class="droplink">file<ul><li><a href="zip.ads.html#zip.ads:175:27" title="To API doc">To API doc</a></li><li><a href="src_zip.ads.html#l175" title="To spec">To spec</a></li></ul></span>, <span class="droplink">Index<ul><li><a href="zip_streams.ads.html#zip_streams.ads:50:13" title="To API doc">To API doc</a></li><li><a href="src_zip_streams.ads.html#l50" title="To spec">To spec</a></li></ul></span> (<span class="droplink">file<ul><li><a href="zip.ads.html#zip.ads:175:27" title="To API doc">To API doc</a></li><li><a href="src_zip.ads.html#l175" title="To spec">To spec</a></li></ul></span>) + </pre></li>
<li id="l505"><pre>                         Natural (Ada.Streams.Stream_IO.Count </pre></li>
<li id="l506"><pre>                           (header.short_info.extra_field_length + </pre></li>
<li id="l507"><pre>                                header.comment_length))); </pre></li>
<li id="l508"><pre>            <span class="comment">-- Now the whole i_th central directory entry is behind</span> </pre></li>
<li id="l509"><pre>            <span class="keyword">if</span> <span class="droplink">Normalize<ul><li><a href="src_zip.adb.html#l126" title="To spec">To spec</a></li><li><a href="src_zip.adb.html#l126" title="To body">To body</a></li></ul></span> (this_name, <span class="droplink">case_sensitive<ul><li><a href="zip.ads.html#zip.ads:177:27" title="To API doc">To API doc</a></li><li><a href="src_zip.ads.html#l177" title="To spec">To spec</a></li></ul></span>) = </pre></li>
<li id="l510"><pre>              <span class="droplink">Normalize<ul><li><a href="src_zip.adb.html#l126" title="To spec">To spec</a></li><li><a href="src_zip.adb.html#l126" title="To body">To body</a></li></ul></span> (<span class="droplink">name<ul><li><a href="zip.ads.html#zip.ads:176:27" title="To API doc">To API doc</a></li><li><a href="src_zip.ads.html#l176" title="To spec">To spec</a></li></ul></span>, <span class="droplink">case_sensitive<ul><li><a href="zip.ads.html#zip.ads:177:27" title="To API doc">To API doc</a></li><li><a href="src_zip.ads.html#l177" title="To spec">To spec</a></li></ul></span>) </pre></li>
<li id="l511"><pre>            <span class="keyword">then</span> </pre></li>
<li id="l512"><pre>               <span class="comment">-- Name found in central directory !</span> </pre></li>
<li id="l513"><pre>               <span class="droplink">file_index<ul><li><a href="zip.ads.html#zip.ads:178:27" title="To API doc">To API doc</a></li><li><a href="src_zip.ads.html#l178" title="To spec">To spec</a></li></ul></span> := Positive (1 + header.local_header_offset + the_end.offset_shifting); </pre></li>
<li id="l514"><pre>               <span class="droplink">comp_size<ul><li><a href="zip.ads.html#zip.ads:179:27" title="To API doc">To API doc</a></li><li><a href="src_zip.ads.html#l179" title="To spec">To spec</a></li></ul></span>  := <span class="droplink">File_size_type<ul><li><a href="zip.ads.html#zip.ads:97:11" title="To API doc">To API doc</a></li><li><a href="src_zip.ads.html#l97" title="To spec">To spec</a></li></ul></span> (header.short_info.dd.compressed_size); </pre></li>
<li id="l515"><pre>               <span class="droplink">uncomp_size<ul><li><a href="zip.ads.html#zip.ads:180:27" title="To API doc">To API doc</a></li><li><a href="src_zip.ads.html#l180" title="To spec">To spec</a></li></ul></span> := <span class="droplink">File_size_type<ul><li><a href="zip.ads.html#zip.ads:97:11" title="To API doc">To API doc</a></li><li><a href="src_zip.ads.html#l97" title="To spec">To spec</a></li></ul></span> (header.short_info.dd.uncompressed_size); </pre></li>
<li id="l516"><pre>               <span class="keyword">return</span>; </pre></li>
<li id="l517"><pre>            <span class="keyword">end</span> <span class="keyword">if</span>; </pre></li>
<li id="l518"><pre>         <span class="keyword">end</span>; </pre></li>
<li id="l519"><pre>      <span class="keyword">end</span> <span class="keyword">loop</span>; </pre></li>
<li id="l520"><pre>      <span class="keyword">raise</span> <span class="droplink">File_name_not_found<ul><li><a href="zip.ads.html#zip.ads:191:3" title="To API doc">To API doc</a></li><li><a href="src_zip.ads.html#l191" title="To spec">To spec</a></li></ul></span>; </pre></li>
<li id="l521"><pre>   <span class="keyword">end</span> <span class="droplink">Find_offset<ul><li><a href="zip.ads.html#zip.ads:175:14" title="To API doc">To API doc</a></li><li><a href="src_zip.ads.html#l175" title="To spec">To spec</a></li><li><a href="src_zip.adb.html#l478" title="To body">To body</a></li></ul></span>; </pre></li>
<li id="l522"><pre> </pre></li>
<li id="l523"><pre>   <span class="comment">-- Internal : find offset of a zipped file using the zip_info tree 8 - )</span> </pre></li>
<li id="l524"><pre> </pre></li>
<li id="l525"><pre>   <span class="keyword">procedure</span> <span class="droplink">Find_offset<ul><li><a href="zip.ads.html#zip.ads:184:14" title="To API doc">To API doc</a></li><li><a href="src_zip.ads.html#l184" title="To spec">To spec</a></li></ul></span> (<span class="droplink">info<ul><li><a href="zip.ads.html#zip.ads:184:27" title="To API doc">To API doc</a></li><li><a href="src_zip.ads.html#l184" title="To spec">To spec</a></li></ul></span>            :     <span class="droplink">Zip_info<ul><li><a href="zip.ads.html#zip.ads:53:8" title="To API doc">To API doc</a></li><li><a href="src_zip.ads.html#l53" title="To spec">To spec</a></li><li><a href="src_zip.ads.html#l308" title="To body">To body</a></li></ul></span>; </pre></li>
<li id="l526"><pre>                          <span class="droplink">name<ul><li><a href="zip.ads.html#zip.ads:185:27" title="To API doc">To API doc</a></li><li><a href="src_zip.ads.html#l185" title="To spec">To spec</a></li></ul></span>            :     String; </pre></li>
<li id="l527"><pre>                          <span class="droplink">case_sensitive<ul><li><a href="zip.ads.html#zip.ads:186:27" title="To API doc">To API doc</a></li><li><a href="src_zip.ads.html#l186" title="To spec">To spec</a></li></ul></span>  :     Boolean; </pre></li>
<li id="l528"><pre>                          <span class="droplink">file_index<ul><li><a href="zip.ads.html#zip.ads:187:27" title="To API doc">To API doc</a></li><li><a href="src_zip.ads.html#l187" title="To spec">To spec</a></li></ul></span>      : <span class="keyword">out</span> Ada.Streams.Stream_IO.Positive_Count; </pre></li>
<li id="l529"><pre>                          <span class="droplink">comp_size<ul><li><a href="zip.ads.html#zip.ads:188:27" title="To API doc">To API doc</a></li><li><a href="src_zip.ads.html#l188" title="To spec">To spec</a></li></ul></span>       : <span class="keyword">out</span> <span class="droplink">File_size_type<ul><li><a href="zip.ads.html#zip.ads:97:11" title="To API doc">To API doc</a></li><li><a href="src_zip.ads.html#l97" title="To spec">To spec</a></li></ul></span>; </pre></li>
<li id="l530"><pre>                          <span class="droplink">uncomp_size<ul><li><a href="zip.ads.html#zip.ads:189:27" title="To API doc">To API doc</a></li><li><a href="src_zip.ads.html#l189" title="To spec">To spec</a></li></ul></span>     : <span class="keyword">out</span> <span class="droplink">File_size_type<ul><li><a href="zip.ads.html#zip.ads:97:11" title="To API doc">To API doc</a></li><li><a href="src_zip.ads.html#l97" title="To spec">To spec</a></li></ul></span>) <span class="keyword">is</span> </pre></li>
<li id="l531"><pre> </pre></li>
<li id="l532"><pre>      aux : <span class="droplink">p_Dir_node<ul><li><a href="zip.ads.html#zip.ads:291:8" title="To API doc">To API doc</a></li><li><a href="src_zip.ads.html#l291" title="To spec">To spec</a></li></ul></span> := info.dir_binary_tree; </pre></li>
<li id="l533"><pre>      up_name : String := <span class="droplink">Normalize<ul><li><a href="src_zip.adb.html#l126" title="To spec">To spec</a></li><li><a href="src_zip.adb.html#l126" title="To body">To body</a></li></ul></span> (<span class="droplink">name<ul><li><a href="zip.ads.html#zip.ads:185:27" title="To API doc">To API doc</a></li><li><a href="src_zip.ads.html#l185" title="To spec">To spec</a></li></ul></span>, <span class="droplink">case_sensitive<ul><li><a href="zip.ads.html#zip.ads:186:27" title="To API doc">To API doc</a></li><li><a href="src_zip.ads.html#l186" title="To spec">To spec</a></li></ul></span>); </pre></li>
<li id="l534"><pre> </pre></li>
<li id="l535"><pre>   <span class="keyword">begin</span> </pre></li>
<li id="l536"><pre>      <span class="keyword">if</span> <span class="keyword">not</span> info.loaded <span class="keyword">then</span> </pre></li>
<li id="l537"><pre>         <span class="keyword">raise</span> <span class="droplink">Forgot_to_load_zip_info<ul><li><a href="zip.ads.html#zip.ads:94:3" title="To API doc">To API doc</a></li><li><a href="src_zip.ads.html#l94" title="To spec">To spec</a></li></ul></span>; </pre></li>
<li id="l538"><pre>      <span class="keyword">end</span> <span class="keyword">if</span>; </pre></li>
<li id="l539"><pre>      <span class="keyword">while</span> <a href="src_zip.adb.html#l532" title="defined at zip.adb:532:7">aux</a> /= <span class="keyword">null</span> <span class="keyword">loop</span> </pre></li>
<li id="l540"><pre>         <span class="keyword">if</span> <a href="src_zip.adb.html#l533" title="defined at zip.adb:533:7">up_name</a> &gt; <a href="src_zip.adb.html#l532" title="defined at zip.adb:532:7">aux</a>.<span class="keyword">all</span>.dico_name <span class="keyword">then</span> </pre></li>
<li id="l541"><pre>            <a href="src_zip.adb.html#l532" title="defined at zip.adb:532:7">aux</a> := <a href="src_zip.adb.html#l532" title="defined at zip.adb:532:7">aux</a>.<span class="keyword">all</span>.right; </pre></li>
<li id="l542"><pre>         <span class="keyword">elsif</span> <a href="src_zip.adb.html#l533" title="defined at zip.adb:533:7">up_name</a> &lt; <a href="src_zip.adb.html#l532" title="defined at zip.adb:532:7">aux</a>.<span class="keyword">all</span>.dico_name <span class="keyword">then</span> </pre></li>
<li id="l543"><pre>            <a href="src_zip.adb.html#l532" title="defined at zip.adb:532:7">aux</a> := <a href="src_zip.adb.html#l532" title="defined at zip.adb:532:7">aux</a>.<span class="keyword">all</span>.left; </pre></li>
<li id="l544"><pre>         <span class="keyword">else</span>  <span class="comment">-- file found !</span> </pre></li>
<li id="l545"><pre>            <span class="droplink">file_index<ul><li><a href="zip.ads.html#zip.ads:187:27" title="To API doc">To API doc</a></li><li><a href="src_zip.ads.html#l187" title="To spec">To spec</a></li></ul></span> := <a href="src_zip.adb.html#l532" title="defined at zip.adb:532:7">aux</a>.<span class="keyword">all</span>.file_index; </pre></li>
<li id="l546"><pre>            <span class="droplink">comp_size<ul><li><a href="zip.ads.html#zip.ads:188:27" title="To API doc">To API doc</a></li><li><a href="src_zip.ads.html#l188" title="To spec">To spec</a></li></ul></span>  := <a href="src_zip.adb.html#l532" title="defined at zip.adb:532:7">aux</a>.<span class="keyword">all</span>.comp_size; </pre></li>
<li id="l547"><pre>            <span class="droplink">uncomp_size<ul><li><a href="zip.ads.html#zip.ads:189:27" title="To API doc">To API doc</a></li><li><a href="src_zip.ads.html#l189" title="To spec">To spec</a></li></ul></span> := <a href="src_zip.adb.html#l532" title="defined at zip.adb:532:7">aux</a>.<span class="keyword">all</span>.uncomp_size; </pre></li>
<li id="l548"><pre>            <span class="keyword">return</span>; </pre></li>
<li id="l549"><pre>         <span class="keyword">end</span> <span class="keyword">if</span>; </pre></li>
<li id="l550"><pre>      <span class="keyword">end</span> <span class="keyword">loop</span>; </pre></li>
<li id="l551"><pre>      Ada.Exceptions.Raise_Exception ( </pre></li>
<li id="l552"><pre>                                      <span class="droplink">File_name_not_found<ul><li><a href="zip.ads.html#zip.ads:191:3" title="To API doc">To API doc</a></li><li><a href="src_zip.ads.html#l191" title="To spec">To spec</a></li></ul></span>&apos;Identity, </pre></li>
<li id="l553"><pre>                                      <span class="string">&quot;Archive : [&quot;</span> &amp; info.zip_file_name.<span class="keyword">all</span> &amp; <span class="string">&quot;], entry : [&quot;</span> &amp; <span class="droplink">name<ul><li><a href="zip.ads.html#zip.ads:185:27" title="To API doc">To API doc</a></li><li><a href="src_zip.ads.html#l185" title="To spec">To spec</a></li></ul></span> &amp; <span class="string">&apos;]&apos;</span> </pre></li>
<li id="l554"><pre>                                     ); </pre></li>
<li id="l555"><pre>   <span class="keyword">end</span> <span class="droplink">Find_offset<ul><li><a href="zip.ads.html#zip.ads:184:14" title="To API doc">To API doc</a></li><li><a href="src_zip.ads.html#l184" title="To spec">To spec</a></li><li><a href="src_zip.adb.html#l525" title="To body">To body</a></li></ul></span>; </pre></li>
<li id="l556"><pre> </pre></li>
<li id="l557"><pre>   <span class="keyword">procedure</span> <span class="droplink">Get_sizes<ul><li><a href="zip.ads.html#zip.ads:193:14" title="To API doc">To API doc</a></li><li><a href="src_zip.ads.html#l193" title="To spec">To spec</a></li></ul></span> (<span class="droplink">info<ul><li><a href="zip.ads.html#zip.ads:193:25" title="To API doc">To API doc</a></li><li><a href="src_zip.ads.html#l193" title="To spec">To spec</a></li></ul></span>            :     <span class="droplink">Zip_info<ul><li><a href="zip.ads.html#zip.ads:53:8" title="To API doc">To API doc</a></li><li><a href="src_zip.ads.html#l53" title="To spec">To spec</a></li><li><a href="src_zip.ads.html#l308" title="To body">To body</a></li></ul></span>; </pre></li>
<li id="l558"><pre>                        <span class="droplink">name<ul><li><a href="zip.ads.html#zip.ads:194:25" title="To API doc">To API doc</a></li><li><a href="src_zip.ads.html#l194" title="To spec">To spec</a></li></ul></span>            :     String; </pre></li>
<li id="l559"><pre>                        <span class="droplink">case_sensitive<ul><li><a href="zip.ads.html#zip.ads:195:25" title="To API doc">To API doc</a></li><li><a href="src_zip.ads.html#l195" title="To spec">To spec</a></li></ul></span>  :     Boolean; </pre></li>
<li id="l560"><pre>                        <span class="droplink">comp_size<ul><li><a href="zip.ads.html#zip.ads:196:25" title="To API doc">To API doc</a></li><li><a href="src_zip.ads.html#l196" title="To spec">To spec</a></li></ul></span>       : <span class="keyword">out</span> <span class="droplink">File_size_type<ul><li><a href="zip.ads.html#zip.ads:97:11" title="To API doc">To API doc</a></li><li><a href="src_zip.ads.html#l97" title="To spec">To spec</a></li></ul></span>; </pre></li>
<li id="l561"><pre>                        <span class="droplink">uncomp_size<ul><li><a href="zip.ads.html#zip.ads:197:25" title="To API doc">To API doc</a></li><li><a href="src_zip.ads.html#l197" title="To spec">To spec</a></li></ul></span>     : <span class="keyword">out</span> <span class="droplink">File_size_type<ul><li><a href="zip.ads.html#zip.ads:97:11" title="To API doc">To API doc</a></li><li><a href="src_zip.ads.html#l97" title="To spec">To spec</a></li></ul></span>) <span class="keyword">is</span> </pre></li>
<li id="l562"><pre> </pre></li>
<li id="l563"><pre>      dummy_file_index : Ada.Streams.Stream_IO.Positive_Count; </pre></li>
<li id="l564"><pre> </pre></li>
<li id="l565"><pre>   <span class="keyword">begin</span> </pre></li>
<li id="l566"><pre>      <span class="droplink">Find_offset<ul><li><a href="zip.ads.html#zip.ads:184:14" title="To API doc">To API doc</a></li><li><a href="src_zip.ads.html#l184" title="To spec">To spec</a></li><li><a href="src_zip.adb.html#l525" title="To body">To body</a></li></ul></span> (<span class="droplink">info<ul><li><a href="zip.ads.html#zip.ads:193:25" title="To API doc">To API doc</a></li><li><a href="src_zip.ads.html#l193" title="To spec">To spec</a></li><li><a href="src_zip.adb.html#l557" title="To body">To body</a></li></ul></span>, <span class="droplink">name<ul><li><a href="zip.ads.html#zip.ads:194:25" title="To API doc">To API doc</a></li><li><a href="src_zip.ads.html#l194" title="To spec">To spec</a></li></ul></span>, <span class="droplink">case_sensitive<ul><li><a href="zip.ads.html#zip.ads:195:25" title="To API doc">To API doc</a></li><li><a href="src_zip.ads.html#l195" title="To spec">To spec</a></li></ul></span>, <a href="src_zip.adb.html#l563" title="defined at zip.adb:563:7">dummy_file_index</a>, <span class="droplink">comp_size<ul><li><a href="zip.ads.html#zip.ads:196:25" title="To API doc">To API doc</a></li><li><a href="src_zip.ads.html#l196" title="To spec">To spec</a></li></ul></span>, <span class="droplink">uncomp_size<ul><li><a href="zip.ads.html#zip.ads:197:25" title="To API doc">To API doc</a></li><li><a href="src_zip.ads.html#l197" title="To spec">To spec</a></li></ul></span>); </pre></li>
<li id="l567"><pre>      <span class="keyword">pragma</span> Unreferenced (<a href="src_zip.adb.html#l563" title="defined at zip.adb:563:7">dummy_file_index</a>); </pre></li>
<li id="l568"><pre>   <span class="keyword">end</span> <span class="droplink">Get_sizes<ul><li><a href="zip.ads.html#zip.ads:193:14" title="To API doc">To API doc</a></li><li><a href="src_zip.ads.html#l193" title="To spec">To spec</a></li><li><a href="src_zip.adb.html#l557" title="To body">To body</a></li></ul></span>; </pre></li>
<li id="l569"><pre> </pre></li>
<li id="l570"><pre>   <span class="comment">-- Workaround for the severe xxx&apos;Read xxx&apos;Write performance</span> </pre></li>
<li id="l571"><pre>   <span class="comment">-- problems in the GNAT and ObjectAda compilers (as in 2009)</span> </pre></li>
<li id="l572"><pre>   <span class="comment">-- This is possible if and only if Byte = Stream_Element and</span> </pre></li>
<li id="l573"><pre>   <span class="comment">-- arrays types are both packed and aligned the same way.</span> </pre></li>
<li id="l574"><pre>   <span class="comment">--</span> </pre></li>
<li id="l575"><pre>   <span class="keyword">subtype</span> Size_test_a <span class="keyword">is</span> <span class="droplink">Byte_Buffer<ul><li><a href="zip.ads.html#zip.ads:219:8" title="To API doc">To API doc</a></li><li><a href="src_zip.ads.html#l219" title="To spec">To spec</a></li></ul></span> (1 .. 19); </pre></li>
<li id="l576"><pre>   <span class="keyword">subtype</span> Size_test_b <span class="keyword">is</span> Ada.Streams.Stream_Element_Array (1 .. 19); </pre></li>
<li id="l577"><pre>   workaround_possible : <span class="keyword">constant</span> Boolean := </pre></li>
<li id="l578"><pre>     <a href="src_zip.adb.html#l575" title="defined at zip.adb:575:12">Size_test_a</a>&apos;Size = <a href="src_zip.adb.html#l576" title="defined at zip.adb:576:12">Size_test_b</a>&apos;Size <span class="keyword">and</span> <span class="keyword">then</span> </pre></li>
<li id="l579"><pre>     <a href="src_zip.adb.html#l575" title="defined at zip.adb:575:12">Size_test_a</a>&apos;Alignment = <a href="src_zip.adb.html#l576" title="defined at zip.adb:576:12">Size_test_b</a>&apos;Alignment; </pre></li>
<li id="l580"><pre> </pre></li>
<li id="l581"><pre>   <span class="comment">-- BlockRead - general - purpose procedure (nothing really specific</span> </pre></li>
<li id="l582"><pre>   <span class="comment">-- to Zip / UnZip) : reads either the whole buffer from a file, or</span> </pre></li>
<li id="l583"><pre>   <span class="comment">-- if the end of the file lays inbetween, a part of the buffer.</span> </pre></li>
<li id="l584"><pre> </pre></li>
<li id="l585"><pre>   <span class="keyword">procedure</span> <span class="droplink">BlockRead<ul><li><a href="zip.ads.html#zip.ads:222:14" title="To API doc">To API doc</a></li><li><a href="src_zip.ads.html#l222" title="To spec">To spec</a></li></ul></span> (<span class="droplink">file<ul><li><a href="zip.ads.html#zip.ads:222:25" title="To API doc">To API doc</a></li><li><a href="src_zip.ads.html#l222" title="To spec">To spec</a></li></ul></span>          :     Ada.Streams.Stream_IO.File_Type; </pre></li>
<li id="l586"><pre>                        <span class="droplink">buffer<ul><li><a href="zip.ads.html#zip.ads:223:25" title="To API doc">To API doc</a></li><li><a href="src_zip.ads.html#l223" title="To spec">To spec</a></li></ul></span>        : <span class="keyword">out</span> <span class="droplink">Byte_Buffer<ul><li><a href="zip.ads.html#zip.ads:219:8" title="To API doc">To API doc</a></li><li><a href="src_zip.ads.html#l219" title="To spec">To spec</a></li></ul></span>; </pre></li>
<li id="l587"><pre>                        <span class="droplink">actually_read<ul><li><a href="zip.ads.html#zip.ads:224:25" title="To API doc">To API doc</a></li><li><a href="src_zip.ads.html#l224" title="To spec">To spec</a></li></ul></span> : <span class="keyword">out</span> Natural) <span class="keyword">is</span> </pre></li>
<li id="l588"><pre> </pre></li>
<li id="l589"><pre>      <span class="keyword">use</span> Ada.Streams, Ada.Streams.Stream_IO; </pre></li>
<li id="l590"><pre> </pre></li>
<li id="l591"><pre>      SE_Buffer    : Stream_Element_Array (1 .. <span class="droplink">buffer<ul><li><a href="zip.ads.html#zip.ads:223:25" title="To API doc">To API doc</a></li><li><a href="src_zip.ads.html#l223" title="To spec">To spec</a></li></ul></span>&apos;Length); </pre></li>
<li id="l592"><pre>      <span class="keyword">for</span> <a href="src_zip.adb.html#l591" title="defined at zip.adb:591:7">SE_Buffer</a>&apos;Address <span class="keyword">use</span> <span class="droplink">buffer<ul><li><a href="zip.ads.html#zip.ads:223:25" title="To API doc">To API doc</a></li><li><a href="src_zip.ads.html#l223" title="To spec">To spec</a></li></ul></span>&apos;Address; </pre></li>
<li id="l593"><pre>      <span class="keyword">pragma</span> Import (Ada, <a href="src_zip.adb.html#l591" title="defined at zip.adb:591:7">SE_Buffer</a>); </pre></li>
<li id="l594"><pre> </pre></li>
<li id="l595"><pre>      Last_Read    : Stream_Element_Offset; </pre></li>
<li id="l596"><pre> </pre></li>
<li id="l597"><pre>   <span class="keyword">begin</span> </pre></li>
<li id="l598"><pre>      <span class="keyword">if</span> <a href="src_zip.adb.html#l577" title="defined at zip.adb:577:4">workaround_possible</a> <span class="keyword">then</span> </pre></li>
<li id="l599"><pre>         Read (Stream (<span class="droplink">file<ul><li><a href="zip.ads.html#zip.ads:222:25" title="To API doc">To API doc</a></li><li><a href="src_zip.ads.html#l222" title="To spec">To spec</a></li></ul></span>).<span class="keyword">all</span>, <a href="src_zip.adb.html#l591" title="defined at zip.adb:591:7">SE_Buffer</a>, <a href="src_zip.adb.html#l595" title="defined at zip.adb:595:7">Last_Read</a>); </pre></li>
<li id="l600"><pre>         <span class="droplink">actually_read<ul><li><a href="zip.ads.html#zip.ads:224:25" title="To API doc">To API doc</a></li><li><a href="src_zip.ads.html#l224" title="To spec">To spec</a></li></ul></span> := Natural (<a href="src_zip.adb.html#l595" title="defined at zip.adb:595:7">Last_Read</a>); </pre></li>
<li id="l601"><pre>      <span class="keyword">else</span> </pre></li>
<li id="l602"><pre>         <span class="keyword">if</span> End_Of_File (<span class="droplink">file<ul><li><a href="zip.ads.html#zip.ads:222:25" title="To API doc">To API doc</a></li><li><a href="src_zip.ads.html#l222" title="To spec">To spec</a></li></ul></span>) <span class="keyword">then</span> </pre></li>
<li id="l603"><pre>            <span class="droplink">actually_read<ul><li><a href="zip.ads.html#zip.ads:224:25" title="To API doc">To API doc</a></li><li><a href="src_zip.ads.html#l224" title="To spec">To spec</a></li></ul></span> := 0; </pre></li>
<li id="l604"><pre>         <span class="keyword">else</span> </pre></li>
<li id="l605"><pre>            <span class="droplink">actually_read<ul><li><a href="zip.ads.html#zip.ads:224:25" title="To API doc">To API doc</a></li><li><a href="src_zip.ads.html#l224" title="To spec">To spec</a></li></ul></span> := </pre></li>
<li id="l606"><pre>              Integer&apos;Min (<span class="droplink">buffer<ul><li><a href="zip.ads.html#zip.ads:223:25" title="To API doc">To API doc</a></li><li><a href="src_zip.ads.html#l223" title="To spec">To spec</a></li></ul></span>&apos;Length, Integer (Size (<span class="droplink">file<ul><li><a href="zip.ads.html#zip.ads:222:25" title="To API doc">To API doc</a></li><li><a href="src_zip.ads.html#l222" title="To spec">To spec</a></li></ul></span>) - Index (<span class="droplink">file<ul><li><a href="zip.ads.html#zip.ads:222:25" title="To API doc">To API doc</a></li><li><a href="src_zip.ads.html#l222" title="To spec">To spec</a></li></ul></span>) + 1)); </pre></li>
<li id="l607"><pre>            <span class="droplink">Byte_Buffer<ul><li><a href="zip.ads.html#zip.ads:219:8" title="To API doc">To API doc</a></li><li><a href="src_zip.ads.html#l219" title="To spec">To spec</a></li></ul></span>&apos;Read ( </pre></li>
<li id="l608"><pre>                              Stream (<span class="droplink">file<ul><li><a href="zip.ads.html#zip.ads:222:25" title="To API doc">To API doc</a></li><li><a href="src_zip.ads.html#l222" title="To spec">To spec</a></li></ul></span>), </pre></li>
<li id="l609"><pre>                              <span class="droplink">buffer<ul><li><a href="zip.ads.html#zip.ads:223:25" title="To API doc">To API doc</a></li><li><a href="src_zip.ads.html#l223" title="To spec">To spec</a></li></ul></span> (<span class="droplink">buffer<ul><li><a href="zip.ads.html#zip.ads:223:25" title="To API doc">To API doc</a></li><li><a href="src_zip.ads.html#l223" title="To spec">To spec</a></li></ul></span>&apos;First .. <span class="droplink">buffer<ul><li><a href="zip.ads.html#zip.ads:223:25" title="To API doc">To API doc</a></li><li><a href="src_zip.ads.html#l223" title="To spec">To spec</a></li></ul></span>&apos;First + <span class="droplink">actually_read<ul><li><a href="zip.ads.html#zip.ads:224:25" title="To API doc">To API doc</a></li><li><a href="src_zip.ads.html#l224" title="To spec">To spec</a></li></ul></span> - 1) </pre></li>
<li id="l610"><pre>                             ); </pre></li>
<li id="l611"><pre>         <span class="keyword">end</span> <span class="keyword">if</span>; </pre></li>
<li id="l612"><pre>      <span class="keyword">end</span> <span class="keyword">if</span>; </pre></li>
<li id="l613"><pre>   <span class="keyword">end</span> <span class="droplink">BlockRead<ul><li><a href="zip.ads.html#zip.ads:222:14" title="To API doc">To API doc</a></li><li><a href="src_zip.ads.html#l222" title="To spec">To spec</a></li><li><a href="src_zip.adb.html#l585" title="To body">To body</a></li></ul></span>; </pre></li>
<li id="l614"><pre> </pre></li>
<li id="l615"><pre>   <span class="keyword">procedure</span> <span class="droplink">BlockRead<ul><li><a href="zip.ads.html#zip.ads:229:14" title="To API doc">To API doc</a></li><li><a href="src_zip.ads.html#l229" title="To spec">To spec</a></li></ul></span> (<span class="droplink">stream<ul><li><a href="zip.ads.html#zip.ads:229:25" title="To API doc">To API doc</a></li><li><a href="src_zip.ads.html#l229" title="To spec">To spec</a></li></ul></span>        :     <span class="droplink">Zip_Streams.Zipstream_Class<ul><li><a href="zip_streams.ads.html#zip_streams.ads:43:9" title="To API doc">To API doc</a></li><li><a href="src_zip_streams.ads.html#l43" title="To spec">To spec</a></li></ul></span>; </pre></li>
<li id="l616"><pre>                        <span class="droplink">buffer<ul><li><a href="zip.ads.html#zip.ads:230:25" title="To API doc">To API doc</a></li><li><a href="src_zip.ads.html#l230" title="To spec">To spec</a></li></ul></span>        : <span class="keyword">out</span> <span class="droplink">Byte_Buffer<ul><li><a href="zip.ads.html#zip.ads:219:8" title="To API doc">To API doc</a></li><li><a href="src_zip.ads.html#l219" title="To spec">To spec</a></li></ul></span>; </pre></li>
<li id="l617"><pre>                        <span class="droplink">actually_read<ul><li><a href="zip.ads.html#zip.ads:231:25" title="To API doc">To API doc</a></li><li><a href="src_zip.ads.html#l231" title="To spec">To spec</a></li></ul></span> : <span class="keyword">out</span> Natural) <span class="keyword">is</span> </pre></li>
<li id="l618"><pre> </pre></li>
<li id="l619"><pre>      <span class="keyword">use</span> Ada.Streams, Ada.Streams.Stream_IO, <span class="droplink">Zip_Streams<ul><li><a href="zip_streams.ads.html#zip_streams.ads:31:9" title="To API doc">To API doc</a></li><li><a href="src_zip_streams.ads.html#l31" title="To spec">To spec</a></li><li><a href="src_zip_streams.adb.html#l10" title="To body">To body</a></li></ul></span>; </pre></li>
<li id="l620"><pre> </pre></li>
<li id="l621"><pre>      SE_Buffer    : Stream_Element_Array (1 .. <span class="droplink">buffer<ul><li><a href="zip.ads.html#zip.ads:230:25" title="To API doc">To API doc</a></li><li><a href="src_zip.ads.html#l230" title="To spec">To spec</a></li></ul></span>&apos;Length); </pre></li>
<li id="l622"><pre>      <span class="keyword">for</span> <a href="src_zip.adb.html#l621" title="defined at zip.adb:621:7">SE_Buffer</a>&apos;Address <span class="keyword">use</span> <span class="droplink">buffer<ul><li><a href="zip.ads.html#zip.ads:230:25" title="To API doc">To API doc</a></li><li><a href="src_zip.ads.html#l230" title="To spec">To spec</a></li></ul></span>&apos;Address; </pre></li>
<li id="l623"><pre>      <span class="keyword">pragma</span> Import (Ada, <a href="src_zip.adb.html#l621" title="defined at zip.adb:621:7">SE_Buffer</a>); </pre></li>
<li id="l624"><pre> </pre></li>
<li id="l625"><pre>      Last_Read    : Stream_Element_Offset; </pre></li>
<li id="l626"><pre> </pre></li>
<li id="l627"><pre>   <span class="keyword">begin</span> </pre></li>
<li id="l628"><pre>      <span class="keyword">if</span> <a href="src_zip.adb.html#l577" title="defined at zip.adb:577:4">workaround_possible</a> <span class="keyword">then</span> </pre></li>
<li id="l629"><pre>         Read (<span class="droplink">stream<ul><li><a href="zip.ads.html#zip.ads:229:25" title="To API doc">To API doc</a></li><li><a href="src_zip.ads.html#l229" title="To spec">To spec</a></li></ul></span>.<span class="keyword">all</span>, <a href="src_zip.adb.html#l621" title="defined at zip.adb:621:7">SE_Buffer</a>, <a href="src_zip.adb.html#l625" title="defined at zip.adb:625:7">Last_Read</a>); </pre></li>
<li id="l630"><pre>         <span class="droplink">actually_read<ul><li><a href="zip.ads.html#zip.ads:231:25" title="To API doc">To API doc</a></li><li><a href="src_zip.ads.html#l231" title="To spec">To spec</a></li></ul></span> := Natural (<a href="src_zip.adb.html#l625" title="defined at zip.adb:625:7">Last_Read</a>); </pre></li>
<li id="l631"><pre>      <span class="keyword">else</span> </pre></li>
<li id="l632"><pre>         <span class="keyword">if</span> <span class="droplink">End_Of_Stream<ul><li><a href="zip_streams.ads.html#zip_streams.ads:105:13" title="To API doc">To API doc</a></li><li><a href="src_zip_streams.ads.html#l105" title="To spec">To spec</a></li></ul></span> (<span class="droplink">stream<ul><li><a href="zip.ads.html#zip.ads:229:25" title="To API doc">To API doc</a></li><li><a href="src_zip.ads.html#l229" title="To spec">To spec</a></li></ul></span>) <span class="keyword">then</span> </pre></li>
<li id="l633"><pre>            <span class="droplink">actually_read<ul><li><a href="zip.ads.html#zip.ads:231:25" title="To API doc">To API doc</a></li><li><a href="src_zip.ads.html#l231" title="To spec">To spec</a></li></ul></span> := 0; </pre></li>
<li id="l634"><pre>         <span class="keyword">else</span> </pre></li>
<li id="l635"><pre>            <span class="droplink">actually_read<ul><li><a href="zip.ads.html#zip.ads:231:25" title="To API doc">To API doc</a></li><li><a href="src_zip.ads.html#l231" title="To spec">To spec</a></li></ul></span> := Integer&apos;Min (<span class="droplink">buffer<ul><li><a href="zip.ads.html#zip.ads:230:25" title="To API doc">To API doc</a></li><li><a href="src_zip.ads.html#l230" title="To spec">To spec</a></li></ul></span>&apos;Length, Integer (<span class="droplink">Size<ul><li><a href="zip_streams.ads.html#zip_streams.ads:53:13" title="To API doc">To API doc</a></li><li><a href="src_zip_streams.ads.html#l53" title="To spec">To spec</a></li></ul></span> (<span class="droplink">stream<ul><li><a href="zip.ads.html#zip.ads:229:25" title="To API doc">To API doc</a></li><li><a href="src_zip.ads.html#l229" title="To spec">To spec</a></li></ul></span>) - <span class="droplink">Index<ul><li><a href="zip_streams.ads.html#zip_streams.ads:50:13" title="To API doc">To API doc</a></li><li><a href="src_zip_streams.ads.html#l50" title="To spec">To spec</a></li></ul></span> (<span class="droplink">stream<ul><li><a href="zip.ads.html#zip.ads:229:25" title="To API doc">To API doc</a></li><li><a href="src_zip.ads.html#l229" title="To spec">To spec</a></li></ul></span>) + 1)); </pre></li>
<li id="l636"><pre>            <span class="droplink">Byte_Buffer<ul><li><a href="zip.ads.html#zip.ads:219:8" title="To API doc">To API doc</a></li><li><a href="src_zip.ads.html#l219" title="To spec">To spec</a></li></ul></span>&apos;Read (<span class="droplink">stream<ul><li><a href="zip.ads.html#zip.ads:229:25" title="To API doc">To API doc</a></li><li><a href="src_zip.ads.html#l229" title="To spec">To spec</a></li></ul></span>, <span class="droplink">buffer<ul><li><a href="zip.ads.html#zip.ads:230:25" title="To API doc">To API doc</a></li><li><a href="src_zip.ads.html#l230" title="To spec">To spec</a></li></ul></span> (<span class="droplink">buffer<ul><li><a href="zip.ads.html#zip.ads:230:25" title="To API doc">To API doc</a></li><li><a href="src_zip.ads.html#l230" title="To spec">To spec</a></li></ul></span>&apos;First .. <span class="droplink">buffer<ul><li><a href="zip.ads.html#zip.ads:230:25" title="To API doc">To API doc</a></li><li><a href="src_zip.ads.html#l230" title="To spec">To spec</a></li></ul></span>&apos;First + <span class="droplink">actually_read<ul><li><a href="zip.ads.html#zip.ads:231:25" title="To API doc">To API doc</a></li><li><a href="src_zip.ads.html#l231" title="To spec">To spec</a></li></ul></span> - 1)); </pre></li>
<li id="l637"><pre>         <span class="keyword">end</span> <span class="keyword">if</span>; </pre></li>
<li id="l638"><pre>      <span class="keyword">end</span> <span class="keyword">if</span>; </pre></li>
<li id="l639"><pre>   <span class="keyword">end</span> <span class="droplink">BlockRead<ul><li><a href="zip.ads.html#zip.ads:229:14" title="To API doc">To API doc</a></li><li><a href="src_zip.ads.html#l229" title="To spec">To spec</a></li><li><a href="src_zip.adb.html#l615" title="To body">To body</a></li></ul></span>; </pre></li>
<li id="l640"><pre> </pre></li>
<li id="l641"><pre>   <span class="keyword">procedure</span> <span class="droplink">BlockRead<ul><li><a href="zip.ads.html#zip.ads:238:14" title="To API doc">To API doc</a></li><li><a href="src_zip.ads.html#l238" title="To spec">To spec</a></li></ul></span> (<span class="droplink">stream<ul><li><a href="zip.ads.html#zip.ads:238:25" title="To API doc">To API doc</a></li><li><a href="src_zip.ads.html#l238" title="To spec">To spec</a></li></ul></span>  :     <span class="droplink">Zip_Streams.Zipstream_Class<ul><li><a href="zip_streams.ads.html#zip_streams.ads:43:9" title="To API doc">To API doc</a></li><li><a href="src_zip_streams.ads.html#l43" title="To spec">To spec</a></li></ul></span>; </pre></li>
<li id="l642"><pre>                        <span class="droplink">buffer<ul><li><a href="zip.ads.html#zip.ads:239:25" title="To API doc">To API doc</a></li><li><a href="src_zip.ads.html#l239" title="To spec">To spec</a></li></ul></span>  : <span class="keyword">out</span> <span class="droplink">Byte_Buffer<ul><li><a href="zip.ads.html#zip.ads:219:8" title="To API doc">To API doc</a></li><li><a href="src_zip.ads.html#l219" title="To spec">To spec</a></li></ul></span>) <span class="keyword">is</span> </pre></li>
<li id="l643"><pre> </pre></li>
<li id="l644"><pre>      actually_read : Natural; </pre></li>
<li id="l645"><pre> </pre></li>
<li id="l646"><pre>   <span class="keyword">begin</span> </pre></li>
<li id="l647"><pre>      <span class="droplink">BlockRead<ul><li><a href="zip.ads.html#zip.ads:229:14" title="To API doc">To API doc</a></li><li><a href="src_zip.ads.html#l229" title="To spec">To spec</a></li><li><a href="src_zip.adb.html#l615" title="To body">To body</a></li></ul></span> (<span class="droplink">stream<ul><li><a href="zip.ads.html#zip.ads:238:25" title="To API doc">To API doc</a></li><li><a href="src_zip.ads.html#l238" title="To spec">To spec</a></li></ul></span>, <span class="droplink">buffer<ul><li><a href="zip.ads.html#zip.ads:239:25" title="To API doc">To API doc</a></li><li><a href="src_zip.ads.html#l239" title="To spec">To spec</a></li></ul></span>, <a href="src_zip.adb.html#l644" title="defined at zip.adb:644:7">actually_read</a>); </pre></li>
<li id="l648"><pre>      <span class="keyword">if</span> <a href="src_zip.adb.html#l644" title="defined at zip.adb:644:7">actually_read</a> &lt; <span class="droplink">buffer<ul><li><a href="zip.ads.html#zip.ads:239:25" title="To API doc">To API doc</a></li><li><a href="src_zip.ads.html#l239" title="To spec">To spec</a></li></ul></span>&apos;Length <span class="keyword">then</span> </pre></li>
<li id="l649"><pre>         <span class="keyword">raise</span> Ada.IO_Exceptions.End_Error; </pre></li>
<li id="l650"><pre>      <span class="keyword">end</span> <span class="keyword">if</span>; </pre></li>
<li id="l651"><pre>   <span class="keyword">end</span> <span class="droplink">BlockRead<ul><li><a href="zip.ads.html#zip.ads:238:14" title="To API doc">To API doc</a></li><li><a href="src_zip.ads.html#l238" title="To spec">To spec</a></li><li><a href="src_zip.adb.html#l641" title="To body">To body</a></li></ul></span>; </pre></li>
<li id="l652"><pre> </pre></li>
<li id="l653"><pre>   <span class="keyword">procedure</span> <span class="droplink">BlockWrite<ul><li><a href="zip.ads.html#zip.ads:244:14" title="To API doc">To API doc</a></li><li><a href="src_zip.ads.html#l244" title="To spec">To spec</a></li></ul></span> (<span class="droplink">stream<ul><li><a href="zip.ads.html#zip.ads:244:26" title="To API doc">To API doc</a></li><li><a href="src_zip.ads.html#l244" title="To spec">To spec</a></li></ul></span>  : <span class="keyword">in</span> <span class="keyword">out</span> Ada.Streams.Root_Stream_Type&apos;Class; </pre></li>
<li id="l654"><pre>                         <span class="droplink">buffer<ul><li><a href="zip.ads.html#zip.ads:245:26" title="To API doc">To API doc</a></li><li><a href="src_zip.ads.html#l245" title="To spec">To spec</a></li></ul></span>  :        <span class="droplink">Byte_Buffer<ul><li><a href="zip.ads.html#zip.ads:219:8" title="To API doc">To API doc</a></li><li><a href="src_zip.ads.html#l219" title="To spec">To spec</a></li></ul></span>) <span class="keyword">is</span> </pre></li>
<li id="l655"><pre> </pre></li>
<li id="l656"><pre>      <span class="keyword">use</span> Ada.Streams; </pre></li>
<li id="l657"><pre> </pre></li>
<li id="l658"><pre>      SE_Buffer    : Stream_Element_Array (1 .. <span class="droplink">buffer<ul><li><a href="zip.ads.html#zip.ads:245:26" title="To API doc">To API doc</a></li><li><a href="src_zip.ads.html#l245" title="To spec">To spec</a></li></ul></span>&apos;Length); </pre></li>
<li id="l659"><pre>      <span class="keyword">for</span> <a href="src_zip.adb.html#l658" title="defined at zip.adb:658:7">SE_Buffer</a>&apos;Address <span class="keyword">use</span> <span class="droplink">buffer<ul><li><a href="zip.ads.html#zip.ads:245:26" title="To API doc">To API doc</a></li><li><a href="src_zip.ads.html#l245" title="To spec">To spec</a></li></ul></span>&apos;Address; </pre></li>
<li id="l660"><pre>      <span class="keyword">pragma</span> Import (Ada, <a href="src_zip.adb.html#l658" title="defined at zip.adb:658:7">SE_Buffer</a>); </pre></li>
<li id="l661"><pre> </pre></li>
<li id="l662"><pre>   <span class="keyword">begin</span> </pre></li>
<li id="l663"><pre>      <span class="keyword">if</span> <a href="src_zip.adb.html#l577" title="defined at zip.adb:577:4">workaround_possible</a> <span class="keyword">then</span> </pre></li>
<li id="l664"><pre>         Ada.Streams.Write (<span class="droplink">stream<ul><li><a href="zip.ads.html#zip.ads:244:26" title="To API doc">To API doc</a></li><li><a href="src_zip.ads.html#l244" title="To spec">To spec</a></li></ul></span>, <a href="src_zip.adb.html#l658" title="defined at zip.adb:658:7">SE_Buffer</a>); </pre></li>
<li id="l665"><pre>      <span class="keyword">else</span> </pre></li>
<li id="l666"><pre>         <span class="droplink">Byte_Buffer<ul><li><a href="zip.ads.html#zip.ads:219:8" title="To API doc">To API doc</a></li><li><a href="src_zip.ads.html#l219" title="To spec">To spec</a></li></ul></span>&apos;Write (<span class="droplink">stream<ul><li><a href="zip.ads.html#zip.ads:244:26" title="To API doc">To API doc</a></li><li><a href="src_zip.ads.html#l244" title="To spec">To spec</a></li></ul></span>&apos;Access, <span class="droplink">buffer<ul><li><a href="zip.ads.html#zip.ads:245:26" title="To API doc">To API doc</a></li><li><a href="src_zip.ads.html#l245" title="To spec">To spec</a></li></ul></span>); </pre></li>
<li id="l667"><pre>         <span class="comment">-- ^This is 30x to 70x slower on GNAT 2009 !</span> </pre></li>
<li id="l668"><pre>      <span class="keyword">end</span> <span class="keyword">if</span>; </pre></li>
<li id="l669"><pre>   <span class="keyword">end</span> <span class="droplink">BlockWrite<ul><li><a href="zip.ads.html#zip.ads:244:14" title="To API doc">To API doc</a></li><li><a href="src_zip.ads.html#l244" title="To spec">To spec</a></li><li><a href="src_zip.adb.html#l653" title="To body">To body</a></li></ul></span>; </pre></li>
<li id="l670"><pre> </pre></li>
<li id="l671"><pre>   <span class="keyword">function</span> <span class="droplink">Method_from_code<ul><li><a href="zip.ads.html#zip.ads:125:12" title="To API doc">To API doc</a></li><li><a href="src_zip.ads.html#l125" title="To spec">To spec</a></li></ul></span> (<span class="droplink">x<ul><li><a href="zip.ads.html#zip.ads:125:30" title="To API doc">To API doc</a></li><li><a href="src_zip.ads.html#l125" title="To spec">To spec</a></li></ul></span> : Natural) <span class="keyword">return</span> <span class="droplink">PKZip_method<ul><li><a href="zip.ads.html#zip.ads:106:8" title="To API doc">To API doc</a></li><li><a href="src_zip.ads.html#l106" title="To spec">To spec</a></li></ul></span> <span class="keyword">is</span> </pre></li>
<li id="l672"><pre>      <span class="comment">-- An enumeration clause might be more elegant, but needs</span> </pre></li>
<li id="l673"><pre>      <span class="comment">-- curiously an Unchecked_Conversion .. . (RM 13.4)</span> </pre></li>
<li id="l674"><pre> </pre></li>
<li id="l675"><pre>   <span class="keyword">begin</span> </pre></li>
<li id="l676"><pre>      <span class="keyword">case</span> <span class="droplink">x<ul><li><a href="zip.ads.html#zip.ads:125:30" title="To API doc">To API doc</a></li><li><a href="src_zip.ads.html#l125" title="To spec">To spec</a></li></ul></span> <span class="keyword">is</span> </pre></li>
<li id="l677"><pre>         <span class="keyword">when</span>  0 =&gt; <span class="keyword">return</span> store; </pre></li>
<li id="l678"><pre>         <span class="keyword">when</span>  1 =&gt; <span class="keyword">return</span> shrink; </pre></li>
<li id="l679"><pre>         <span class="keyword">when</span>  2 =&gt; <span class="keyword">return</span> reduce_1; </pre></li>
<li id="l680"><pre>         <span class="keyword">when</span>  3 =&gt; <span class="keyword">return</span> reduce_2; </pre></li>
<li id="l681"><pre>         <span class="keyword">when</span>  4 =&gt; <span class="keyword">return</span> reduce_3; </pre></li>
<li id="l682"><pre>         <span class="keyword">when</span>  5 =&gt; <span class="keyword">return</span> reduce_4; </pre></li>
<li id="l683"><pre>         <span class="keyword">when</span>  6 =&gt; <span class="keyword">return</span> implode; </pre></li>
<li id="l684"><pre>         <span class="keyword">when</span>  7 =&gt; <span class="keyword">return</span> tokenize; </pre></li>
<li id="l685"><pre>         <span class="keyword">when</span>  8 =&gt; <span class="keyword">return</span> deflate; </pre></li>
<li id="l686"><pre>         <span class="keyword">when</span>  9 =&gt; <span class="keyword">return</span> deflate_e; </pre></li>
<li id="l687"><pre>         <span class="keyword">when</span> 12 =&gt; <span class="keyword">return</span> bzip2; </pre></li>
<li id="l688"><pre>         <span class="keyword">when</span> 14 =&gt; <span class="keyword">return</span> lzma; </pre></li>
<li id="l689"><pre>         <span class="keyword">when</span> 98 =&gt; <span class="keyword">return</span> ppmd; </pre></li>
<li id="l690"><pre>         <span class="keyword">when</span> <span class="keyword">others</span> =&gt; <span class="keyword">return</span> unknown; </pre></li>
<li id="l691"><pre>      <span class="keyword">end</span> <span class="keyword">case</span>; </pre></li>
<li id="l692"><pre>   <span class="keyword">end</span> <span class="droplink">Method_from_code<ul><li><a href="zip.ads.html#zip.ads:125:12" title="To API doc">To API doc</a></li><li><a href="src_zip.ads.html#l125" title="To spec">To spec</a></li><li><a href="src_zip.adb.html#l671" title="To body">To body</a></li></ul></span>; </pre></li>
<li id="l693"><pre> </pre></li>
<li id="l694"><pre>   <span class="keyword">function</span> <span class="droplink">Method_from_code<ul><li><a href="zip.ads.html#zip.ads:124:12" title="To API doc">To API doc</a></li><li><a href="src_zip.ads.html#l124" title="To spec">To spec</a></li></ul></span> (<span class="droplink">x<ul><li><a href="zip.ads.html#zip.ads:124:30" title="To API doc">To API doc</a></li><li><a href="src_zip.ads.html#l124" title="To spec">To spec</a></li></ul></span> : Interfaces.Unsigned_16) <span class="keyword">return</span> <span class="droplink">PKZip_method<ul><li><a href="zip.ads.html#zip.ads:106:8" title="To API doc">To API doc</a></li><li><a href="src_zip.ads.html#l106" title="To spec">To spec</a></li></ul></span> <span class="keyword">is</span> </pre></li>
<li id="l695"><pre>     (<span class="droplink">Method_from_code<ul><li><a href="zip.ads.html#zip.ads:125:12" title="To API doc">To API doc</a></li><li><a href="src_zip.ads.html#l125" title="To spec">To spec</a></li><li><a href="src_zip.adb.html#l671" title="To body">To body</a></li></ul></span> (Natural (<span class="droplink">x<ul><li><a href="zip.ads.html#zip.ads:124:30" title="To API doc">To API doc</a></li><li><a href="src_zip.ads.html#l124" title="To spec">To spec</a></li></ul></span>))); </pre></li>
<li id="l696"><pre> </pre></li>
<li id="l697"><pre>   <span class="comment">-- This does the same as Ada 2005&apos;s Ada.Directories.Exists</span> </pre></li>
<li id="l698"><pre>   <span class="comment">-- Just there as helper for Ada 95 only systems</span> </pre></li>
<li id="l699"><pre>   <span class="comment">--</span> </pre></li>
<li id="l700"><pre>   <span class="keyword">function</span> <span class="droplink">Exists<ul><li><a href="zip.ads.html#zip.ads:250:12" title="To API doc">To API doc</a></li><li><a href="src_zip.ads.html#l250" title="To spec">To spec</a></li></ul></span> (<span class="droplink">name<ul><li><a href="zip.ads.html#zip.ads:250:20" title="To API doc">To API doc</a></li><li><a href="src_zip.ads.html#l250" title="To spec">To spec</a></li></ul></span> : String) <span class="keyword">return</span> Boolean <span class="keyword">is</span> </pre></li>
<li id="l701"><pre> </pre></li>
<li id="l702"><pre>      <span class="keyword">use</span> Ada.Text_IO, Ada.Strings.Fixed; </pre></li>
<li id="l703"><pre> </pre></li>
<li id="l704"><pre>      f : File_Type; </pre></li>
<li id="l705"><pre> </pre></li>
<li id="l706"><pre>   <span class="keyword">begin</span> </pre></li>
<li id="l707"><pre>      <span class="keyword">if</span> Index (<span class="droplink">name<ul><li><a href="zip.ads.html#zip.ads:250:20" title="To API doc">To API doc</a></li><li><a href="src_zip.ads.html#l250" title="To spec">To spec</a></li></ul></span>, <span class="string">&quot;*&quot;</span>) &gt; 0 <span class="keyword">then</span> </pre></li>
<li id="l708"><pre>         <span class="keyword">return</span> False; </pre></li>
<li id="l709"><pre>      <span class="keyword">end</span> <span class="keyword">if</span>; </pre></li>
<li id="l710"><pre>      Open (<a href="src_zip.adb.html#l704" title="defined at zip.adb:704:7">f</a>, In_File, <span class="droplink">name<ul><li><a href="zip.ads.html#zip.ads:250:20" title="To API doc">To API doc</a></li><li><a href="src_zip.ads.html#l250" title="To spec">To spec</a></li></ul></span>, Form =&gt; Ada.Strings.Unbounded.To_String (<span class="droplink">Form_For_IO_Open_N_Create<ul><li><a href="zip.ads.html#zip.ads:77:3" title="To API doc">To API doc</a></li><li><a href="src_zip.ads.html#l77" title="To spec">To spec</a></li></ul></span>)); </pre></li>
<li id="l711"><pre>      Close (<a href="src_zip.adb.html#l704" title="defined at zip.adb:704:7">f</a>); </pre></li>
<li id="l712"><pre>      <span class="keyword">return</span> True; </pre></li>
<li id="l713"><pre> </pre></li>
<li id="l714"><pre>   <span class="keyword">exception</span> </pre></li>
<li id="l715"><pre>      <span class="keyword">when</span> Name_Error =&gt; </pre></li>
<li id="l716"><pre>         <span class="keyword">return</span> False; <span class="comment">-- The file cannot exist !</span> </pre></li>
<li id="l717"><pre>      <span class="keyword">when</span> Use_Error =&gt; </pre></li>
<li id="l718"><pre>         <span class="keyword">return</span> True;  <span class="comment">-- The file exist and is already opened !</span> </pre></li>
<li id="l719"><pre>   <span class="keyword">end</span> <span class="droplink">Exists<ul><li><a href="zip.ads.html#zip.ads:250:12" title="To API doc">To API doc</a></li><li><a href="src_zip.ads.html#l250" title="To spec">To spec</a></li><li><a href="src_zip.adb.html#l700" title="To body">To body</a></li></ul></span>; </pre></li>
<li id="l720"><pre> </pre></li>
<li id="l721"><pre>   <span class="keyword">procedure</span> <span class="droplink">Put_Multi_Line<ul><li><a href="zip.ads.html#zip.ads:257:13" title="To API doc">To API doc</a></li><li><a href="src_zip.ads.html#l257" title="To spec">To spec</a></li></ul></span> ( </pre></li>
<li id="l722"><pre>                             <span class="droplink">out_file<ul><li><a href="zip.ads.html#zip.ads:258:5" title="To API doc">To API doc</a></li><li><a href="src_zip.ads.html#l258" title="To spec">To spec</a></li></ul></span>  :        Ada.Text_IO.File_Type; </pre></li>
<li id="l723"><pre>                             <span class="droplink">text<ul><li><a href="zip.ads.html#zip.ads:259:5" title="To API doc">To API doc</a></li><li><a href="src_zip.ads.html#l259" title="To spec">To spec</a></li></ul></span>      :        String </pre></li>
<li id="l724"><pre>                            ) </pre></li>
<li id="l725"><pre>   <span class="keyword">is</span> </pre></li>
<li id="l726"><pre>      last_char : Character := <span class="string">&apos; &apos;</span>; </pre></li>
<li id="l727"><pre>      c : Character; </pre></li>
<li id="l728"><pre>   <span class="keyword">begin</span> </pre></li>
<li id="l729"><pre>      <span class="keyword">for</span> i <span class="keyword">in</span> <span class="droplink">text<ul><li><a href="zip.ads.html#zip.ads:259:5" title="To API doc">To API doc</a></li><li><a href="src_zip.ads.html#l259" title="To spec">To spec</a></li></ul></span>&apos;Range <span class="keyword">loop</span> </pre></li>
<li id="l730"><pre>         <a href="src_zip.adb.html#l727" title="defined at zip.adb:727:7">c</a> := <span class="droplink">text<ul><li><a href="zip.ads.html#zip.ads:259:5" title="To API doc">To API doc</a></li><li><a href="src_zip.ads.html#l259" title="To spec">To spec</a></li></ul></span> (i); </pre></li>
<li id="l731"><pre>         <span class="keyword">case</span> <a href="src_zip.adb.html#l727" title="defined at zip.adb:727:7">c</a> <span class="keyword">is</span> </pre></li>
<li id="l732"><pre>            <span class="keyword">when</span> ASCII.CR =&gt; </pre></li>
<li id="l733"><pre>               Ada.Text_IO.New_Line (<span class="droplink">out_file<ul><li><a href="zip.ads.html#zip.ads:258:5" title="To API doc">To API doc</a></li><li><a href="src_zip.ads.html#l258" title="To spec">To spec</a></li></ul></span>); </pre></li>
<li id="l734"><pre>            <span class="keyword">when</span> ASCII.LF =&gt; </pre></li>
<li id="l735"><pre>               <span class="keyword">if</span> <a href="src_zip.adb.html#l726" title="defined at zip.adb:726:7">last_char</a> /= ASCII.CR <span class="keyword">then</span> </pre></li>
<li id="l736"><pre>                  Ada.Text_IO.New_Line (<span class="droplink">out_file<ul><li><a href="zip.ads.html#zip.ads:258:5" title="To API doc">To API doc</a></li><li><a href="src_zip.ads.html#l258" title="To spec">To spec</a></li></ul></span>); </pre></li>
<li id="l737"><pre>               <span class="keyword">end</span> <span class="keyword">if</span>; </pre></li>
<li id="l738"><pre>            <span class="keyword">when</span> <span class="keyword">others</span> =&gt; </pre></li>
<li id="l739"><pre>               Ada.Text_IO.Put (<span class="droplink">out_file<ul><li><a href="zip.ads.html#zip.ads:258:5" title="To API doc">To API doc</a></li><li><a href="src_zip.ads.html#l258" title="To spec">To spec</a></li></ul></span>, <a href="src_zip.adb.html#l727" title="defined at zip.adb:727:7">c</a>); </pre></li>
<li id="l740"><pre>         <span class="keyword">end</span> <span class="keyword">case</span>; </pre></li>
<li id="l741"><pre>         <a href="src_zip.adb.html#l726" title="defined at zip.adb:726:7">last_char</a> := <a href="src_zip.adb.html#l727" title="defined at zip.adb:727:7">c</a>; </pre></li>
<li id="l742"><pre>      <span class="keyword">end</span> <span class="keyword">loop</span>; </pre></li>
<li id="l743"><pre>   <span class="keyword">end</span> <span class="droplink">Put_Multi_Line<ul><li><a href="zip.ads.html#zip.ads:257:13" title="To API doc">To API doc</a></li><li><a href="src_zip.ads.html#l257" title="To spec">To spec</a></li><li><a href="src_zip.adb.html#l721" title="To body">To body</a></li></ul></span>; </pre></li>
<li id="l744"><pre> </pre></li>
<li id="l745"><pre>   <span class="keyword">procedure</span> <span class="droplink">Write_as_text<ul><li><a href="zip.ads.html#zip.ads:262:13" title="To API doc">To API doc</a></li><li><a href="src_zip.ads.html#l262" title="To spec">To spec</a></li></ul></span> (<span class="droplink">out_file<ul><li><a href="zip.ads.html#zip.ads:263:5" title="To API doc">To API doc</a></li><li><a href="src_zip.ads.html#l263" title="To spec">To spec</a></li></ul></span>  :        Ada.Text_IO.File_Type; </pre></li>
<li id="l746"><pre>                            <span class="droplink">buffer<ul><li><a href="zip.ads.html#zip.ads:264:5" title="To API doc">To API doc</a></li><li><a href="src_zip.ads.html#l264" title="To spec">To spec</a></li></ul></span>    :        <span class="droplink">Byte_Buffer<ul><li><a href="zip.ads.html#zip.ads:219:8" title="To API doc">To API doc</a></li><li><a href="src_zip.ads.html#l219" title="To spec">To spec</a></li></ul></span>; </pre></li>
<li id="l747"><pre>                            <span class="droplink">last_char<ul><li><a href="zip.ads.html#zip.ads:265:5" title="To API doc">To API doc</a></li><li><a href="src_zip.ads.html#l265" title="To spec">To spec</a></li></ul></span> : <span class="keyword">in</span> <span class="keyword">out</span> Character) <span class="keyword">is</span> <span class="comment">-- track line - ending characters across writes</span> </pre></li>
<li id="l748"><pre> </pre></li>
<li id="l749"><pre>      c : Character; </pre></li>
<li id="l750"><pre> </pre></li>
<li id="l751"><pre>   <span class="keyword">begin</span> </pre></li>
<li id="l752"><pre>      <span class="keyword">for</span> i <span class="keyword">in</span> <span class="droplink">buffer<ul><li><a href="zip.ads.html#zip.ads:264:5" title="To API doc">To API doc</a></li><li><a href="src_zip.ads.html#l264" title="To spec">To spec</a></li></ul></span>&apos;Range <span class="keyword">loop</span> </pre></li>
<li id="l753"><pre>         <a href="src_zip.adb.html#l749" title="defined at zip.adb:749:7">c</a> := Character&apos;Val (<span class="droplink">buffer<ul><li><a href="zip.ads.html#zip.ads:264:5" title="To API doc">To API doc</a></li><li><a href="src_zip.ads.html#l264" title="To spec">To spec</a></li></ul></span> (i)); </pre></li>
<li id="l754"><pre>         <span class="keyword">case</span> <a href="src_zip.adb.html#l749" title="defined at zip.adb:749:7">c</a> <span class="keyword">is</span> </pre></li>
<li id="l755"><pre>         <span class="keyword">when</span> ASCII.CR =&gt; </pre></li>
<li id="l756"><pre>            Ada.Text_IO.New_Line (<span class="droplink">out_file<ul><li><a href="zip.ads.html#zip.ads:263:5" title="To API doc">To API doc</a></li><li><a href="src_zip.ads.html#l263" title="To spec">To spec</a></li></ul></span>); </pre></li>
<li id="l757"><pre>         <span class="keyword">when</span> ASCII.LF =&gt; </pre></li>
<li id="l758"><pre>            <span class="keyword">if</span> <span class="droplink">last_char<ul><li><a href="zip.ads.html#zip.ads:265:5" title="To API doc">To API doc</a></li><li><a href="src_zip.ads.html#l265" title="To spec">To spec</a></li><li><a href="src_zip.adb.html#l747" title="To body">To body</a></li></ul></span> /= ASCII.CR <span class="keyword">then</span> </pre></li>
<li id="l759"><pre>               Ada.Text_IO.New_Line (<span class="droplink">out_file<ul><li><a href="zip.ads.html#zip.ads:263:5" title="To API doc">To API doc</a></li><li><a href="src_zip.ads.html#l263" title="To spec">To spec</a></li></ul></span>); </pre></li>
<li id="l760"><pre>            <span class="keyword">end</span> <span class="keyword">if</span>; </pre></li>
<li id="l761"><pre>         <span class="keyword">when</span> <span class="keyword">others</span> =&gt; </pre></li>
<li id="l762"><pre>            Ada.Text_IO.Put (<span class="droplink">out_file<ul><li><a href="zip.ads.html#zip.ads:263:5" title="To API doc">To API doc</a></li><li><a href="src_zip.ads.html#l263" title="To spec">To spec</a></li></ul></span>, <a href="src_zip.adb.html#l749" title="defined at zip.adb:749:7">c</a>); </pre></li>
<li id="l763"><pre>         <span class="keyword">end</span> <span class="keyword">case</span>; </pre></li>
<li id="l764"><pre>         <span class="droplink">last_char<ul><li><a href="zip.ads.html#zip.ads:265:5" title="To API doc">To API doc</a></li><li><a href="src_zip.ads.html#l265" title="To spec">To spec</a></li><li><a href="src_zip.adb.html#l747" title="To body">To body</a></li></ul></span> := <a href="src_zip.adb.html#l749" title="defined at zip.adb:749:7">c</a>; </pre></li>
<li id="l765"><pre>      <span class="keyword">end</span> <span class="keyword">loop</span>; </pre></li>
<li id="l766"><pre>   <span class="keyword">end</span> <span class="droplink">Write_as_text<ul><li><a href="zip.ads.html#zip.ads:262:13" title="To API doc">To API doc</a></li><li><a href="src_zip.ads.html#l262" title="To spec">To spec</a></li><li><a href="src_zip.adb.html#l745" title="To body">To body</a></li></ul></span>; </pre></li>
<li id="l767"><pre> </pre></li>
<li id="l768"><pre><span class="keyword">end</span> <span class="droplink">Zip<ul><li><a href="zip.ads.html#zip.ads:45:9" title="To API doc">To API doc</a></li><li><a href="src_zip.ads.html#l45" title="To spec">To spec</a></li><li><a href="src_zip.adb.html#l9" title="To body">To body</a></li></ul></span>; </pre></li>
</ol></div>
</div>

</body>
</html>