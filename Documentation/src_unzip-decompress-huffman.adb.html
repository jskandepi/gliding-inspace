<?xml version='1.0' encoding='utf-8'?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN"  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html><head>
  <meta http-equiv="Content-Type" content="application/xhtml+xml; charset=UTF-8" />
  <meta http-equiv="Content-Script-Type" content="text/javascript"/>

  <title>
    File: unzip-decompress-huffman.adb
  </title>
  <link rel='stylesheet' href='support/docgen.css' type='text/css'/>
  <link rel='stylesheet' href='support/tags.css' type='text/css'/>
  <script src='support/docgen.js' type='text/javascript' charset='utf-8'></script>
</head>
<body onload="onloadDoc();">

<div id='leftSide'>
  <div id='leftSideInside'>
  <div id='header'>
    <h2 class="button">Documentation</h2>
    <a href='toc.html'><div class="button2">Table of Contents</div></a>

    <a href='tree.html'><div class="button2">Class Inheritance Tree</div></a>

  </div>
  </div>
</div> <!-- leftSide -->

<div class='subprograms'>
  <div class='details'><ol><li id="l1"><pre><span class="keyword">with</span> Interfaces; </pre></li>
<li id="l2"><pre><span class="keyword">with</span> Ada.Text_IO; </pre></li>
<li id="l3"><pre><span class="keyword">with</span> Ada.Unchecked_Deallocation; </pre></li>
<li id="l4"><pre> </pre></li>
<li id="l5"><pre><span class="keyword">package</span> <span class="keyword">body</span> <span class="droplink">UnZip.Decompress.Huffman<ul><li><a href="unzip-decompress-huffman.ads.html#unzip-decompress-huffman.ads:6:34" title="To API doc">To API doc</a></li><li><a href="src_unzip-decompress-huffman.ads.html#l6" title="To spec">To spec</a></li></ul></span> <span class="keyword">is</span> </pre></li>
<li id="l6"><pre> </pre></li>
<li id="l7"><pre>   <span class="comment">-- Note from Pascal source:</span> </pre></li>
<li id="l8"><pre>   <span class="comment">-- C code by info - zip group, translated to pascal by Christian Ghisler</span> </pre></li>
<li id="l9"><pre>   <span class="comment">-- based on unz51g.zip</span> </pre></li>
<li id="l10"><pre> </pre></li>
<li id="l11"><pre>   <span class="comment">-- Free huffman tables starting with table where t points to</span> </pre></li>
<li id="l12"><pre> </pre></li>
<li id="l13"><pre>   <span class="keyword">procedure</span> <span class="droplink">HufT_free<ul><li><a href="unzip-decompress-huffman.ads.html#unzip-decompress-huffman.ads:39:13" title="To API doc">To API doc</a></li><li><a href="src_unzip-decompress-huffman.ads.html#l39" title="To spec">To spec</a></li></ul></span> (<span class="droplink">tl<ul><li><a href="unzip-decompress-huffman.ads.html#unzip-decompress-huffman.ads:39:24" title="To API doc">To API doc</a></li><li><a href="src_unzip-decompress-huffman.ads.html#l39" title="To spec">To spec</a></li></ul></span> : <span class="keyword">in</span> <span class="keyword">out</span> <span class="droplink">p_Table_list<ul><li><a href="unzip-decompress-huffman.ads.html#unzip-decompress-huffman.ads:27:8" title="To API doc">To API doc</a></li><li><a href="src_unzip-decompress-huffman.ads.html#l27" title="To spec">To spec</a></li></ul></span>) <span class="keyword">is</span> </pre></li>
<li id="l14"><pre> </pre></li>
<li id="l15"><pre>      <span class="keyword">procedure</span>  Dispose <span class="keyword">is</span> <span class="keyword">new</span> </pre></li>
<li id="l16"><pre>        Ada.Unchecked_Deallocation (<span class="droplink">HufT_table<ul><li><a href="unzip-decompress-huffman.ads.html#unzip-decompress-huffman.ads:8:8" title="To API doc">To API doc</a></li><li><a href="src_unzip-decompress-huffman.ads.html#l8" title="To spec">To spec</a></li></ul></span>, <span class="droplink">p_HufT_table<ul><li><a href="unzip-decompress-huffman.ads.html#unzip-decompress-huffman.ads:9:8" title="To API doc">To API doc</a></li><li><a href="src_unzip-decompress-huffman.ads.html#l9" title="To spec">To spec</a></li></ul></span>); </pre></li>
<li id="l17"><pre>      <span class="keyword">procedure</span>  Dispose <span class="keyword">is</span> <span class="keyword">new</span> </pre></li>
<li id="l18"><pre>        Ada.Unchecked_Deallocation (<span class="droplink">Table_list<ul><li><a href="unzip-decompress-huffman.ads.html#unzip-decompress-huffman.ads:26:8" title="To API doc">To API doc</a></li><li><a href="src_unzip-decompress-huffman.ads.html#l26" title="To spec">To spec</a></li><li><a href="src_unzip-decompress-huffman.ads.html#l29" title="To body">To body</a></li></ul></span>, <span class="droplink">p_Table_list<ul><li><a href="unzip-decompress-huffman.ads.html#unzip-decompress-huffman.ads:27:8" title="To API doc">To API doc</a></li><li><a href="src_unzip-decompress-huffman.ads.html#l27" title="To spec">To spec</a></li></ul></span>); </pre></li>
<li id="l19"><pre> </pre></li>
<li id="l20"><pre>      current : <span class="droplink">p_Table_list<ul><li><a href="unzip-decompress-huffman.ads.html#unzip-decompress-huffman.ads:27:8" title="To API doc">To API doc</a></li><li><a href="src_unzip-decompress-huffman.ads.html#l27" title="To spec">To spec</a></li></ul></span>; </pre></li>
<li id="l21"><pre>      tcount  : Natural; <span class="comment">-- just a stat. Idea : replace table_list with an array</span> </pre></li>
<li id="l22"><pre> </pre></li>
<li id="l23"><pre>   <span class="keyword">begin</span> </pre></li>
<li id="l24"><pre>      <span class="keyword">if</span> <span class="droplink">full_trace<ul><li><a href="unzip-decompress.ads.html#unzip-decompress.ads:51:3" title="To API doc">To API doc</a></li><li><a href="src_unzip-decompress.ads.html#l51" title="To spec">To spec</a></li></ul></span> <span class="keyword">then</span> </pre></li>
<li id="l25"><pre>         <span class="keyword">pragma</span> Warnings (Off, <span class="string">&quot;this code can never be executed and has been deleted&quot;</span>); </pre></li>
<li id="l26"><pre>         Ada.Text_IO.Put (<span class="string">&quot;[HufT_Free .. . &quot;</span>); </pre></li>
<li id="l27"><pre>         <a href="src_unzip-decompress-huffman.adb.html#l21" title="defined at unzip-decompress-huffman.adb:21:7">tcount</a> := 0; </pre></li>
<li id="l28"><pre>         <span class="keyword">pragma</span> Warnings (On,  <span class="string">&quot;this code can never be executed and has been deleted&quot;</span>); </pre></li>
<li id="l29"><pre>      <span class="keyword">end</span> <span class="keyword">if</span>; </pre></li>
<li id="l30"><pre>      <span class="keyword">while</span> <span class="droplink">tl<ul><li><a href="unzip-decompress-huffman.ads.html#unzip-decompress-huffman.ads:39:24" title="To API doc">To API doc</a></li><li><a href="src_unzip-decompress-huffman.ads.html#l39" title="To spec">To spec</a></li></ul></span> /= <span class="keyword">null</span> <span class="keyword">loop</span> </pre></li>
<li id="l31"><pre>         <a href="src_unzip-decompress-huffman.adb.html#l15" title="defined at unzip-decompress-huffman.adb:15:18">Dispose</a> (<span class="droplink">tl<ul><li><a href="unzip-decompress-huffman.ads.html#unzip-decompress-huffman.ads:39:24" title="To API doc">To API doc</a></li><li><a href="src_unzip-decompress-huffman.ads.html#l39" title="To spec">To spec</a></li></ul></span>.<span class="keyword">all</span>.table); <span class="comment">-- destroy the Huffman table</span> </pre></li>
<li id="l32"><pre>         <a href="src_unzip-decompress-huffman.adb.html#l20" title="defined at unzip-decompress-huffman.adb:20:7">current</a> := <span class="droplink">tl<ul><li><a href="unzip-decompress-huffman.ads.html#unzip-decompress-huffman.ads:39:24" title="To API doc">To API doc</a></li><li><a href="src_unzip-decompress-huffman.ads.html#l39" title="To spec">To spec</a></li></ul></span>; </pre></li>
<li id="l33"><pre>         <span class="droplink">tl<ul><li><a href="unzip-decompress-huffman.ads.html#unzip-decompress-huffman.ads:39:24" title="To API doc">To API doc</a></li><li><a href="src_unzip-decompress-huffman.ads.html#l39" title="To spec">To spec</a></li></ul></span>     := <span class="droplink">tl<ul><li><a href="unzip-decompress-huffman.ads.html#unzip-decompress-huffman.ads:39:24" title="To API doc">To API doc</a></li><li><a href="src_unzip-decompress-huffman.ads.html#l39" title="To spec">To spec</a></li></ul></span>.<span class="keyword">all</span>.next; </pre></li>
<li id="l34"><pre>         <a href="src_unzip-decompress-huffman.adb.html#l17" title="defined at unzip-decompress-huffman.adb:17:18">Dispose</a> (<a href="src_unzip-decompress-huffman.adb.html#l20" title="defined at unzip-decompress-huffman.adb:20:7">current</a>);  <span class="comment">-- destroy the current node</span> </pre></li>
<li id="l35"><pre>         <span class="keyword">if</span> <span class="droplink">full_trace<ul><li><a href="unzip-decompress.ads.html#unzip-decompress.ads:51:3" title="To API doc">To API doc</a></li><li><a href="src_unzip-decompress.ads.html#l51" title="To spec">To spec</a></li></ul></span> <span class="keyword">then</span> </pre></li>
<li id="l36"><pre>            <span class="keyword">pragma</span> Warnings (Off, <span class="string">&quot;this code can never be executed and has been deleted&quot;</span>); </pre></li>
<li id="l37"><pre>            <a href="src_unzip-decompress-huffman.adb.html#l21" title="defined at unzip-decompress-huffman.adb:21:7">tcount</a> := <a href="src_unzip-decompress-huffman.adb.html#l21" title="defined at unzip-decompress-huffman.adb:21:7">tcount</a> + 1; </pre></li>
<li id="l38"><pre>            <span class="keyword">pragma</span> Warnings (On,  <span class="string">&quot;this code can never be executed and has been deleted&quot;</span>); </pre></li>
<li id="l39"><pre>         <span class="keyword">end</span> <span class="keyword">if</span>; </pre></li>
<li id="l40"><pre>      <span class="keyword">end</span> <span class="keyword">loop</span>; </pre></li>
<li id="l41"><pre>      <span class="keyword">if</span> <span class="droplink">full_trace<ul><li><a href="unzip-decompress.ads.html#unzip-decompress.ads:51:3" title="To API doc">To API doc</a></li><li><a href="src_unzip-decompress.ads.html#l51" title="To spec">To spec</a></li></ul></span> <span class="keyword">then</span> </pre></li>
<li id="l42"><pre>         <span class="keyword">pragma</span> Warnings (Off, <span class="string">&quot;this code can never be executed and has been deleted&quot;</span>); </pre></li>
<li id="l43"><pre>         Ada.Text_IO.Put_Line (Integer&apos;Image (<a href="src_unzip-decompress-huffman.adb.html#l21" title="defined at unzip-decompress-huffman.adb:21:7">tcount</a>) &amp; <span class="string">&quot; tables]&quot;</span>); </pre></li>
<li id="l44"><pre>         <span class="keyword">pragma</span> Warnings (On,  <span class="string">&quot;this code can never be executed and has been deleted&quot;</span>); </pre></li>
<li id="l45"><pre>      <span class="keyword">end</span> <span class="keyword">if</span>; </pre></li>
<li id="l46"><pre>   <span class="keyword">end</span> <span class="droplink">HufT_free<ul><li><a href="unzip-decompress-huffman.ads.html#unzip-decompress-huffman.ads:39:13" title="To API doc">To API doc</a></li><li><a href="src_unzip-decompress-huffman.ads.html#l39" title="To spec">To spec</a></li><li><a href="src_unzip-decompress-huffman.adb.html#l13" title="To body">To body</a></li></ul></span>; </pre></li>
<li id="l47"><pre> </pre></li>
<li id="l48"><pre>   <span class="comment">-- Build huffman table from code lengths given by array b</span> </pre></li>
<li id="l49"><pre> </pre></li>
<li id="l50"><pre>   <span class="keyword">procedure</span> <span class="droplink">HufT_build<ul><li><a href="unzip-decompress-huffman.ads.html#unzip-decompress-huffman.ads:42:13" title="To API doc">To API doc</a></li><li><a href="src_unzip-decompress-huffman.ads.html#l42" title="To spec">To spec</a></li></ul></span> (<span class="droplink">b<ul><li><a href="unzip-decompress-huffman.ads.html#unzip-decompress-huffman.ads:42:25" title="To API doc">To API doc</a></li><li><a href="src_unzip-decompress-huffman.ads.html#l42" title="To spec">To spec</a></li></ul></span>     : <span class="droplink">Length_array<ul><li><a href="unzip-decompress-huffman.ads.html#unzip-decompress-huffman.ads:34:8" title="To API doc">To API doc</a></li><li><a href="src_unzip-decompress-huffman.ads.html#l34" title="To spec">To spec</a></li></ul></span>; </pre></li>
<li id="l51"><pre>                         <span class="droplink">s<ul><li><a href="unzip-decompress-huffman.ads.html#unzip-decompress-huffman.ads:43:26" title="To API doc">To API doc</a></li><li><a href="src_unzip-decompress-huffman.ads.html#l43" title="To spec">To spec</a></li></ul></span>     : Integer; </pre></li>
<li id="l52"><pre>                         <span class="droplink">d<ul><li><a href="unzip-decompress-huffman.ads.html#unzip-decompress-huffman.ads:44:26" title="To API doc">To API doc</a></li><li><a href="src_unzip-decompress-huffman.ads.html#l44" title="To spec">To spec</a></li></ul></span>, <span class="droplink">e<ul><li><a href="unzip-decompress-huffman.ads.html#unzip-decompress-huffman.ads:44:29" title="To API doc">To API doc</a></li><li><a href="src_unzip-decompress-huffman.ads.html#l44" title="To spec">To spec</a></li></ul></span>  : <span class="droplink">Length_array<ul><li><a href="unzip-decompress-huffman.ads.html#unzip-decompress-huffman.ads:34:8" title="To API doc">To API doc</a></li><li><a href="src_unzip-decompress-huffman.ads.html#l34" title="To spec">To spec</a></li></ul></span>; </pre></li>
<li id="l53"><pre>                         <span class="droplink">tl<ul><li><a href="unzip-decompress-huffman.ads.html#unzip-decompress-huffman.ads:45:26" title="To API doc">To API doc</a></li><li><a href="src_unzip-decompress-huffman.ads.html#l45" title="To spec">To spec</a></li></ul></span>    :    <span class="keyword">out</span> <span class="droplink">p_Table_list<ul><li><a href="unzip-decompress-huffman.ads.html#unzip-decompress-huffman.ads:27:8" title="To API doc">To API doc</a></li><li><a href="src_unzip-decompress-huffman.ads.html#l27" title="To spec">To spec</a></li></ul></span>; </pre></li>
<li id="l54"><pre>                         <span class="droplink">m<ul><li><a href="unzip-decompress-huffman.ads.html#unzip-decompress-huffman.ads:46:26" title="To API doc">To API doc</a></li><li><a href="src_unzip-decompress-huffman.ads.html#l46" title="To spec">To spec</a></li></ul></span>     : <span class="keyword">in</span> <span class="keyword">out</span> Integer; </pre></li>
<li id="l55"><pre>                         <span class="droplink">huft_incomplete<ul><li><a href="unzip-decompress-huffman.ads.html#unzip-decompress-huffman.ads:47:15" title="To API doc">To API doc</a></li><li><a href="src_unzip-decompress-huffman.ads.html#l47" title="To spec">To spec</a></li></ul></span>  :    <span class="keyword">out</span> Boolean) </pre></li>
<li id="l56"><pre>   <span class="keyword">is</span> </pre></li>
<li id="l57"><pre>      <span class="keyword">use</span> Interfaces; </pre></li>
<li id="l58"><pre> </pre></li>
<li id="l59"><pre>      b_max   : <span class="keyword">constant</span> := 16; </pre></li>
<li id="l60"><pre>      b_maxp1 : <span class="keyword">constant</span> := <a href="src_unzip-decompress-huffman.adb.html#l59" title="defined at unzip-decompress-huffman.adb:59:7">b_max</a> + 1; </pre></li>
<li id="l61"><pre> </pre></li>
<li id="l62"><pre>      <span class="comment">-- bit length count table</span> </pre></li>
<li id="l63"><pre>      count  : <span class="keyword">array</span> (0 .. <a href="src_unzip-decompress-huffman.adb.html#l60" title="defined at unzip-decompress-huffman.adb:60:7">b_maxp1</a>) <span class="keyword">of</span> Integer := (<span class="keyword">others</span> =&gt; 0); </pre></li>
<li id="l64"><pre> </pre></li>
<li id="l65"><pre>      f    : Integer;                    <span class="comment">-- i repeats in table every f entries</span> </pre></li>
<li id="l66"><pre>      g    : Integer;                    <span class="comment">-- max. code length</span> </pre></li>
<li id="l67"><pre>      i,                                <span class="comment">-- counter, current code</span> </pre></li>
<li id="l68"><pre>      j  : Integer;                    <span class="comment">-- counter</span> </pre></li>
<li id="l69"><pre>      kcc  : Integer;                    <span class="comment">-- number of bits in current code</span> </pre></li>
<li id="l70"><pre> </pre></li>
<li id="l71"><pre>      c_idx, v_idx : Natural;            <span class="comment">-- array indices</span> </pre></li>
<li id="l72"><pre> </pre></li>
<li id="l73"><pre>      current_table_ptr  : <span class="droplink">p_HufT_table<ul><li><a href="unzip-decompress-huffman.ads.html#unzip-decompress-huffman.ads:9:8" title="To API doc">To API doc</a></li><li><a href="src_unzip-decompress-huffman.ads.html#l9" title="To spec">To spec</a></li></ul></span> := <span class="keyword">null</span>; </pre></li>
<li id="l74"><pre>      current_node_ptr   : <span class="droplink">p_Table_list<ul><li><a href="unzip-decompress-huffman.ads.html#unzip-decompress-huffman.ads:27:8" title="To API doc">To API doc</a></li><li><a href="src_unzip-decompress-huffman.ads.html#l27" title="To spec">To spec</a></li></ul></span> := <span class="keyword">null</span>; <span class="comment">-- curr. node for the curr. table</span> </pre></li>
<li id="l75"><pre>      new_node_ptr       : <span class="droplink">p_Table_list<ul><li><a href="unzip-decompress-huffman.ads.html#unzip-decompress-huffman.ads:27:8" title="To API doc">To API doc</a></li><li><a href="src_unzip-decompress-huffman.ads.html#l27" title="To spec">To spec</a></li></ul></span>;        <span class="comment">-- new node for the new table</span> </pre></li>
<li id="l76"><pre> </pre></li>
<li id="l77"><pre>      new_entry : <span class="droplink">HufT<ul><li><a href="unzip-decompress-huffman.ads.html#unzip-decompress-huffman.ads:11:8" title="To API doc">To API doc</a></li><li><a href="src_unzip-decompress-huffman.ads.html#l11" title="To spec">To spec</a></li></ul></span>;                  <span class="comment">-- table entry for structure assignment</span> </pre></li>
<li id="l78"><pre> </pre></li>
<li id="l79"><pre>      u  : <span class="keyword">array</span> (0 .. <a href="src_unzip-decompress-huffman.adb.html#l59" title="defined at unzip-decompress-huffman.adb:59:7">b_max</a>) <span class="keyword">of</span> <span class="droplink">p_HufT_table<ul><li><a href="unzip-decompress-huffman.ads.html#unzip-decompress-huffman.ads:9:8" title="To API doc">To API doc</a></li><li><a href="src_unzip-decompress-huffman.ads.html#l9" title="To spec">To spec</a></li></ul></span>;   <span class="comment">-- table stack</span> </pre></li>
<li id="l80"><pre> </pre></li>
<li id="l81"><pre>      n_max  : <span class="keyword">constant</span> := 288; </pre></li>
<li id="l82"><pre>      <span class="comment">-- values in order of bit length</span> </pre></li>
<li id="l83"><pre>      v  : <span class="keyword">array</span> (0 .. <a href="src_unzip-decompress-huffman.adb.html#l81" title="defined at unzip-decompress-huffman.adb:81:7">n_max</a>) <span class="keyword">of</span> Integer := (<span class="keyword">others</span> =&gt; 0); </pre></li>
<li id="l84"><pre>      el_v, el_v_m_s : Integer; </pre></li>
<li id="l85"><pre> </pre></li>
<li id="l86"><pre>      w  : Natural := 0;                        <span class="comment">-- bits before this table</span> </pre></li>
<li id="l87"><pre> </pre></li>
<li id="l88"><pre>      offset, code_stack  : <span class="keyword">array</span> (0 .. <a href="src_unzip-decompress-huffman.adb.html#l60" title="defined at unzip-decompress-huffman.adb:60:7">b_maxp1</a>) <span class="keyword">of</span> Integer; </pre></li>
<li id="l89"><pre> </pre></li>
<li id="l90"><pre>      table_level  : Integer := -1; </pre></li>
<li id="l91"><pre>      bits  : <span class="keyword">array</span> (Integer&apos;(-1) .. <a href="src_unzip-decompress-huffman.adb.html#l60" title="defined at unzip-decompress-huffman.adb:60:7">b_maxp1</a>) <span class="keyword">of</span> Integer; </pre></li>
<li id="l92"><pre>      <span class="comment">-- ^bits (table_level) = # bits in table of level table_level</span> </pre></li>
<li id="l93"><pre> </pre></li>
<li id="l94"><pre>      y   : Integer;                     <span class="comment">-- number of dummy codes added</span> </pre></li>
<li id="l95"><pre>      z   : Natural := 0;                 <span class="comment">-- number of entries in current table</span> </pre></li>
<li id="l96"><pre>      el  : Integer;                     <span class="comment">-- length of eob code=code 256</span> </pre></li>
<li id="l97"><pre> </pre></li>
<li id="l98"><pre>      no_copy_length_array : <span class="keyword">constant</span> Boolean := <span class="droplink">d<ul><li><a href="unzip-decompress-huffman.ads.html#unzip-decompress-huffman.ads:44:26" title="To API doc">To API doc</a></li><li><a href="src_unzip-decompress-huffman.ads.html#l44" title="To spec">To spec</a></li></ul></span>&apos;Length = 0 <span class="keyword">or</span> <span class="keyword">else</span> <span class="droplink">e<ul><li><a href="unzip-decompress-huffman.ads.html#unzip-decompress-huffman.ads:44:29" title="To API doc">To API doc</a></li><li><a href="src_unzip-decompress-huffman.ads.html#l44" title="To spec">To spec</a></li></ul></span>&apos;Length = 0; </pre></li>
<li id="l99"><pre> </pre></li>
<li id="l100"><pre>   <span class="keyword">begin</span> </pre></li>
<li id="l101"><pre>      <span class="keyword">if</span> <span class="droplink">full_trace<ul><li><a href="unzip-decompress.ads.html#unzip-decompress.ads:51:3" title="To API doc">To API doc</a></li><li><a href="src_unzip-decompress.ads.html#l51" title="To spec">To spec</a></li></ul></span> <span class="keyword">then</span> </pre></li>
<li id="l102"><pre>         <span class="keyword">pragma</span> Warnings (Off, <span class="string">&quot;this code can never be executed and has been deleted&quot;</span>); </pre></li>
<li id="l103"><pre>         Ada.Text_IO.Put (<span class="string">&quot;[HufT_Build .. .&quot;</span>); </pre></li>
<li id="l104"><pre>         <span class="keyword">pragma</span> Warnings (On,  <span class="string">&quot;this code can never be executed and has been deleted&quot;</span>); </pre></li>
<li id="l105"><pre>      <span class="keyword">end</span> <span class="keyword">if</span>; </pre></li>
<li id="l106"><pre>      <span class="droplink">tl<ul><li><a href="unzip-decompress-huffman.ads.html#unzip-decompress-huffman.ads:45:26" title="To API doc">To API doc</a></li><li><a href="src_unzip-decompress-huffman.ads.html#l45" title="To spec">To spec</a></li></ul></span> := <span class="keyword">null</span>; </pre></li>
<li id="l107"><pre> </pre></li>
<li id="l108"><pre>      <span class="keyword">if</span> <span class="droplink">b<ul><li><a href="unzip-decompress-huffman.ads.html#unzip-decompress-huffman.ads:42:25" title="To API doc">To API doc</a></li><li><a href="src_unzip-decompress-huffman.ads.html#l42" title="To spec">To spec</a></li></ul></span>&apos;Length &gt; 256 <span class="keyword">then</span> <span class="comment">-- set length of EOB code, if any</span> </pre></li>
<li id="l109"><pre>         <a href="src_unzip-decompress-huffman.adb.html#l96" title="defined at unzip-decompress-huffman.adb:96:7">el</a> := <span class="droplink">b<ul><li><a href="unzip-decompress-huffman.ads.html#unzip-decompress-huffman.ads:42:25" title="To API doc">To API doc</a></li><li><a href="src_unzip-decompress-huffman.ads.html#l42" title="To spec">To spec</a></li></ul></span> (256); </pre></li>
<li id="l110"><pre>      <span class="keyword">else</span> </pre></li>
<li id="l111"><pre>         <a href="src_unzip-decompress-huffman.adb.html#l96" title="defined at unzip-decompress-huffman.adb:96:7">el</a> := <a href="src_unzip-decompress-huffman.adb.html#l59" title="defined at unzip-decompress-huffman.adb:59:7">b_max</a>; </pre></li>
<li id="l112"><pre>      <span class="keyword">end</span> <span class="keyword">if</span>; </pre></li>
<li id="l113"><pre> </pre></li>
<li id="l114"><pre>      <span class="comment">-- Generate counts for each bit length</span> </pre></li>
<li id="l115"><pre> </pre></li>
<li id="l116"><pre>      <span class="keyword">for</span> k <span class="keyword">in</span> <span class="droplink">b<ul><li><a href="unzip-decompress-huffman.ads.html#unzip-decompress-huffman.ads:42:25" title="To API doc">To API doc</a></li><li><a href="src_unzip-decompress-huffman.ads.html#l42" title="To spec">To spec</a></li></ul></span>&apos;Range <span class="keyword">loop</span> </pre></li>
<li id="l117"><pre>         <span class="keyword">if</span> <span class="droplink">b<ul><li><a href="unzip-decompress-huffman.ads.html#unzip-decompress-huffman.ads:42:25" title="To API doc">To API doc</a></li><li><a href="src_unzip-decompress-huffman.ads.html#l42" title="To spec">To spec</a></li></ul></span> (k) &gt; <a href="src_unzip-decompress-huffman.adb.html#l59" title="defined at unzip-decompress-huffman.adb:59:7">b_max</a> <span class="keyword">then</span> </pre></li>
<li id="l118"><pre>            <span class="comment">-- m := 0; -- GNAT 2005 doesn&apos;t like it (warning).</span> </pre></li>
<li id="l119"><pre>            <span class="keyword">raise</span> <span class="droplink">huft_error<ul><li><a href="unzip-decompress-huffman.ads.html#unzip-decompress-huffman.ads:50:3" title="To API doc">To API doc</a></li><li><a href="src_unzip-decompress-huffman.ads.html#l50" title="To spec">To spec</a></li></ul></span>; </pre></li>
<li id="l120"><pre>         <span class="keyword">end</span> <span class="keyword">if</span>; </pre></li>
<li id="l121"><pre>         <a href="src_unzip-decompress-huffman.adb.html#l63" title="defined at unzip-decompress-huffman.adb:63:7">count</a> (<span class="droplink">b<ul><li><a href="unzip-decompress-huffman.ads.html#unzip-decompress-huffman.ads:42:25" title="To API doc">To API doc</a></li><li><a href="src_unzip-decompress-huffman.ads.html#l42" title="To spec">To spec</a></li></ul></span> (k)) := <a href="src_unzip-decompress-huffman.adb.html#l63" title="defined at unzip-decompress-huffman.adb:63:7">count</a> (<span class="droplink">b<ul><li><a href="unzip-decompress-huffman.ads.html#unzip-decompress-huffman.ads:42:25" title="To API doc">To API doc</a></li><li><a href="src_unzip-decompress-huffman.ads.html#l42" title="To spec">To spec</a></li></ul></span> (k)) + 1; </pre></li>
<li id="l122"><pre>      <span class="keyword">end</span> <span class="keyword">loop</span>; </pre></li>
<li id="l123"><pre> </pre></li>
<li id="l124"><pre>      <span class="keyword">if</span> <a href="src_unzip-decompress-huffman.adb.html#l63" title="defined at unzip-decompress-huffman.adb:63:7">count</a> (0) = <span class="droplink">b<ul><li><a href="unzip-decompress-huffman.ads.html#unzip-decompress-huffman.ads:42:25" title="To API doc">To API doc</a></li><li><a href="src_unzip-decompress-huffman.ads.html#l42" title="To spec">To spec</a></li></ul></span>&apos;Length <span class="keyword">then</span> </pre></li>
<li id="l125"><pre>         <span class="droplink">m<ul><li><a href="unzip-decompress-huffman.ads.html#unzip-decompress-huffman.ads:46:26" title="To API doc">To API doc</a></li><li><a href="src_unzip-decompress-huffman.ads.html#l46" title="To spec">To spec</a></li></ul></span> := 0; </pre></li>
<li id="l126"><pre>         <span class="droplink">huft_incomplete<ul><li><a href="unzip-decompress-huffman.ads.html#unzip-decompress-huffman.ads:47:15" title="To API doc">To API doc</a></li><li><a href="src_unzip-decompress-huffman.ads.html#l47" title="To spec">To spec</a></li></ul></span> := False; <span class="comment">-- spotted by Tucker Taft, 19 - Aug - 2004</span> </pre></li>
<li id="l127"><pre>         <span class="keyword">return</span>; <span class="comment">-- complete</span> </pre></li>
<li id="l128"><pre>      <span class="keyword">end</span> <span class="keyword">if</span>; </pre></li>
<li id="l129"><pre> </pre></li>
<li id="l130"><pre>      <span class="comment">-- Find minimum and maximum length, bound m by those</span> </pre></li>
<li id="l131"><pre> </pre></li>
<li id="l132"><pre>      <a href="src_unzip-decompress-huffman.adb.html#l68" title="defined at unzip-decompress-huffman.adb:68:7">j</a> := 1; </pre></li>
<li id="l133"><pre>      <span class="keyword">while</span> <a href="src_unzip-decompress-huffman.adb.html#l68" title="defined at unzip-decompress-huffman.adb:68:7">j</a> &lt;= <a href="src_unzip-decompress-huffman.adb.html#l59" title="defined at unzip-decompress-huffman.adb:59:7">b_max</a> <span class="keyword">and</span> <span class="keyword">then</span> <a href="src_unzip-decompress-huffman.adb.html#l63" title="defined at unzip-decompress-huffman.adb:63:7">count</a> (<a href="src_unzip-decompress-huffman.adb.html#l68" title="defined at unzip-decompress-huffman.adb:68:7">j</a>) = 0 <span class="keyword">loop</span> </pre></li>
<li id="l134"><pre>         <a href="src_unzip-decompress-huffman.adb.html#l68" title="defined at unzip-decompress-huffman.adb:68:7">j</a> := <a href="src_unzip-decompress-huffman.adb.html#l68" title="defined at unzip-decompress-huffman.adb:68:7">j</a> + 1; </pre></li>
<li id="l135"><pre>      <span class="keyword">end</span> <span class="keyword">loop</span>; </pre></li>
<li id="l136"><pre>      <a href="src_unzip-decompress-huffman.adb.html#l69" title="defined at unzip-decompress-huffman.adb:69:7">kcc</a> := <a href="src_unzip-decompress-huffman.adb.html#l68" title="defined at unzip-decompress-huffman.adb:68:7">j</a>; </pre></li>
<li id="l137"><pre>      <span class="keyword">if</span> <span class="droplink">m<ul><li><a href="unzip-decompress-huffman.ads.html#unzip-decompress-huffman.ads:46:26" title="To API doc">To API doc</a></li><li><a href="src_unzip-decompress-huffman.ads.html#l46" title="To spec">To spec</a></li></ul></span> &lt; <a href="src_unzip-decompress-huffman.adb.html#l68" title="defined at unzip-decompress-huffman.adb:68:7">j</a> <span class="keyword">then</span> </pre></li>
<li id="l138"><pre>         <span class="droplink">m<ul><li><a href="unzip-decompress-huffman.ads.html#unzip-decompress-huffman.ads:46:26" title="To API doc">To API doc</a></li><li><a href="src_unzip-decompress-huffman.ads.html#l46" title="To spec">To spec</a></li></ul></span> := <a href="src_unzip-decompress-huffman.adb.html#l68" title="defined at unzip-decompress-huffman.adb:68:7">j</a>; </pre></li>
<li id="l139"><pre>      <span class="keyword">end</span> <span class="keyword">if</span>; </pre></li>
<li id="l140"><pre>      <a href="src_unzip-decompress-huffman.adb.html#l67" title="defined at unzip-decompress-huffman.adb:67:7">i</a> := <a href="src_unzip-decompress-huffman.adb.html#l59" title="defined at unzip-decompress-huffman.adb:59:7">b_max</a>; </pre></li>
<li id="l141"><pre>      <span class="keyword">while</span> <a href="src_unzip-decompress-huffman.adb.html#l67" title="defined at unzip-decompress-huffman.adb:67:7">i</a> &gt; 0 <span class="keyword">and</span> <span class="keyword">then</span> <a href="src_unzip-decompress-huffman.adb.html#l63" title="defined at unzip-decompress-huffman.adb:63:7">count</a> (<a href="src_unzip-decompress-huffman.adb.html#l67" title="defined at unzip-decompress-huffman.adb:67:7">i</a>) = 0 <span class="keyword">loop</span> </pre></li>
<li id="l142"><pre>         <a href="src_unzip-decompress-huffman.adb.html#l67" title="defined at unzip-decompress-huffman.adb:67:7">i</a> := <a href="src_unzip-decompress-huffman.adb.html#l67" title="defined at unzip-decompress-huffman.adb:67:7">i</a> - 1; </pre></li>
<li id="l143"><pre>      <span class="keyword">end</span> <span class="keyword">loop</span>; </pre></li>
<li id="l144"><pre>      <a href="src_unzip-decompress-huffman.adb.html#l66" title="defined at unzip-decompress-huffman.adb:66:7">g</a> := <a href="src_unzip-decompress-huffman.adb.html#l67" title="defined at unzip-decompress-huffman.adb:67:7">i</a>; </pre></li>
<li id="l145"><pre>      <span class="keyword">if</span> <span class="droplink">m<ul><li><a href="unzip-decompress-huffman.ads.html#unzip-decompress-huffman.ads:46:26" title="To API doc">To API doc</a></li><li><a href="src_unzip-decompress-huffman.ads.html#l46" title="To spec">To spec</a></li></ul></span> &gt; <a href="src_unzip-decompress-huffman.adb.html#l67" title="defined at unzip-decompress-huffman.adb:67:7">i</a> <span class="keyword">then</span> </pre></li>
<li id="l146"><pre>         <span class="droplink">m<ul><li><a href="unzip-decompress-huffman.ads.html#unzip-decompress-huffman.ads:46:26" title="To API doc">To API doc</a></li><li><a href="src_unzip-decompress-huffman.ads.html#l46" title="To spec">To spec</a></li></ul></span> := <a href="src_unzip-decompress-huffman.adb.html#l67" title="defined at unzip-decompress-huffman.adb:67:7">i</a>; </pre></li>
<li id="l147"><pre>      <span class="keyword">end</span> <span class="keyword">if</span>; </pre></li>
<li id="l148"><pre> </pre></li>
<li id="l149"><pre>      <span class="comment">-- Adjust last length count to fill out codes, if needed</span> </pre></li>
<li id="l150"><pre> </pre></li>
<li id="l151"><pre>      <a href="src_unzip-decompress-huffman.adb.html#l94" title="defined at unzip-decompress-huffman.adb:94:7">y</a> := Integer (Shift_Left (Unsigned_32&apos;(1), <a href="src_unzip-decompress-huffman.adb.html#l68" title="defined at unzip-decompress-huffman.adb:68:7">j</a>)); <span class="comment">-- y := 2 ** j;</span> </pre></li>
<li id="l152"><pre>      <span class="keyword">while</span> <a href="src_unzip-decompress-huffman.adb.html#l68" title="defined at unzip-decompress-huffman.adb:68:7">j</a> &lt; <a href="src_unzip-decompress-huffman.adb.html#l67" title="defined at unzip-decompress-huffman.adb:67:7">i</a> <span class="keyword">loop</span> </pre></li>
<li id="l153"><pre>         <a href="src_unzip-decompress-huffman.adb.html#l94" title="defined at unzip-decompress-huffman.adb:94:7">y</a> := <a href="src_unzip-decompress-huffman.adb.html#l94" title="defined at unzip-decompress-huffman.adb:94:7">y</a> - <a href="src_unzip-decompress-huffman.adb.html#l63" title="defined at unzip-decompress-huffman.adb:63:7">count</a> (<a href="src_unzip-decompress-huffman.adb.html#l68" title="defined at unzip-decompress-huffman.adb:68:7">j</a>); </pre></li>
<li id="l154"><pre>         <span class="keyword">if</span> <a href="src_unzip-decompress-huffman.adb.html#l94" title="defined at unzip-decompress-huffman.adb:94:7">y</a> &lt; 0 <span class="keyword">then</span> </pre></li>
<li id="l155"><pre>            <span class="keyword">raise</span> <span class="droplink">huft_error<ul><li><a href="unzip-decompress-huffman.ads.html#unzip-decompress-huffman.ads:50:3" title="To API doc">To API doc</a></li><li><a href="src_unzip-decompress-huffman.ads.html#l50" title="To spec">To spec</a></li></ul></span>; </pre></li>
<li id="l156"><pre>         <span class="keyword">end</span> <span class="keyword">if</span>; </pre></li>
<li id="l157"><pre>         <a href="src_unzip-decompress-huffman.adb.html#l94" title="defined at unzip-decompress-huffman.adb:94:7">y</a> := <a href="src_unzip-decompress-huffman.adb.html#l94" title="defined at unzip-decompress-huffman.adb:94:7">y</a> * 2; </pre></li>
<li id="l158"><pre>         <a href="src_unzip-decompress-huffman.adb.html#l68" title="defined at unzip-decompress-huffman.adb:68:7">j</a> := <a href="src_unzip-decompress-huffman.adb.html#l68" title="defined at unzip-decompress-huffman.adb:68:7">j</a> + 1; </pre></li>
<li id="l159"><pre>      <span class="keyword">end</span> <span class="keyword">loop</span>; </pre></li>
<li id="l160"><pre> </pre></li>
<li id="l161"><pre>      <a href="src_unzip-decompress-huffman.adb.html#l94" title="defined at unzip-decompress-huffman.adb:94:7">y</a> := <a href="src_unzip-decompress-huffman.adb.html#l94" title="defined at unzip-decompress-huffman.adb:94:7">y</a> - <a href="src_unzip-decompress-huffman.adb.html#l63" title="defined at unzip-decompress-huffman.adb:63:7">count</a> (<a href="src_unzip-decompress-huffman.adb.html#l67" title="defined at unzip-decompress-huffman.adb:67:7">i</a>); </pre></li>
<li id="l162"><pre>      <span class="keyword">if</span> <a href="src_unzip-decompress-huffman.adb.html#l94" title="defined at unzip-decompress-huffman.adb:94:7">y</a> &lt; 0 <span class="keyword">then</span> </pre></li>
<li id="l163"><pre>         <span class="keyword">raise</span> <span class="droplink">huft_error<ul><li><a href="unzip-decompress-huffman.ads.html#unzip-decompress-huffman.ads:50:3" title="To API doc">To API doc</a></li><li><a href="src_unzip-decompress-huffman.ads.html#l50" title="To spec">To spec</a></li></ul></span>; </pre></li>
<li id="l164"><pre>      <span class="keyword">end</span> <span class="keyword">if</span>; </pre></li>
<li id="l165"><pre>      <a href="src_unzip-decompress-huffman.adb.html#l63" title="defined at unzip-decompress-huffman.adb:63:7">count</a> (<a href="src_unzip-decompress-huffman.adb.html#l67" title="defined at unzip-decompress-huffman.adb:67:7">i</a>) := <a href="src_unzip-decompress-huffman.adb.html#l63" title="defined at unzip-decompress-huffman.adb:63:7">count</a> (<a href="src_unzip-decompress-huffman.adb.html#l67" title="defined at unzip-decompress-huffman.adb:67:7">i</a>) + <a href="src_unzip-decompress-huffman.adb.html#l94" title="defined at unzip-decompress-huffman.adb:94:7">y</a>; </pre></li>
<li id="l166"><pre> </pre></li>
<li id="l167"><pre>      <span class="comment">-- Generate starting offsets into the value table for each length</span> </pre></li>
<li id="l168"><pre> </pre></li>
<li id="l169"><pre>      <a href="src_unzip-decompress-huffman.adb.html#l88" title="defined at unzip-decompress-huffman.adb:88:7">offset</a> (1) := 0; </pre></li>
<li id="l170"><pre>      <a href="src_unzip-decompress-huffman.adb.html#l68" title="defined at unzip-decompress-huffman.adb:68:7">j</a> := 0; </pre></li>
<li id="l171"><pre>      <span class="keyword">for</span> idx <span class="keyword">in</span> 2 .. <a href="src_unzip-decompress-huffman.adb.html#l67" title="defined at unzip-decompress-huffman.adb:67:7">i</a> <span class="keyword">loop</span> </pre></li>
<li id="l172"><pre>         <a href="src_unzip-decompress-huffman.adb.html#l68" title="defined at unzip-decompress-huffman.adb:68:7">j</a> := <a href="src_unzip-decompress-huffman.adb.html#l68" title="defined at unzip-decompress-huffman.adb:68:7">j</a> + <a href="src_unzip-decompress-huffman.adb.html#l63" title="defined at unzip-decompress-huffman.adb:63:7">count</a> (idx - 1); </pre></li>
<li id="l173"><pre>         <a href="src_unzip-decompress-huffman.adb.html#l88" title="defined at unzip-decompress-huffman.adb:88:7">offset</a> (idx) := <a href="src_unzip-decompress-huffman.adb.html#l68" title="defined at unzip-decompress-huffman.adb:68:7">j</a>; </pre></li>
<li id="l174"><pre>      <span class="keyword">end</span> <span class="keyword">loop</span>; </pre></li>
<li id="l175"><pre> </pre></li>
<li id="l176"><pre>      <span class="comment">-- Make table of values in order of bit length</span> </pre></li>
<li id="l177"><pre> </pre></li>
<li id="l178"><pre>      <span class="keyword">for</span> idx <span class="keyword">in</span> <span class="droplink">b<ul><li><a href="unzip-decompress-huffman.ads.html#unzip-decompress-huffman.ads:42:25" title="To API doc">To API doc</a></li><li><a href="src_unzip-decompress-huffman.ads.html#l42" title="To spec">To spec</a></li></ul></span>&apos;Range <span class="keyword">loop</span> </pre></li>
<li id="l179"><pre>         <a href="src_unzip-decompress-huffman.adb.html#l68" title="defined at unzip-decompress-huffman.adb:68:7">j</a> := <span class="droplink">b<ul><li><a href="unzip-decompress-huffman.ads.html#unzip-decompress-huffman.ads:42:25" title="To API doc">To API doc</a></li><li><a href="src_unzip-decompress-huffman.ads.html#l42" title="To spec">To spec</a></li></ul></span> (idx); </pre></li>
<li id="l180"><pre>         <span class="keyword">if</span> <a href="src_unzip-decompress-huffman.adb.html#l68" title="defined at unzip-decompress-huffman.adb:68:7">j</a> /= 0 <span class="keyword">then</span> </pre></li>
<li id="l181"><pre>            <a href="src_unzip-decompress-huffman.adb.html#l83" title="defined at unzip-decompress-huffman.adb:83:7">v</a> (<a href="src_unzip-decompress-huffman.adb.html#l88" title="defined at unzip-decompress-huffman.adb:88:7">offset</a> (<a href="src_unzip-decompress-huffman.adb.html#l68" title="defined at unzip-decompress-huffman.adb:68:7">j</a>)) := idx - <span class="droplink">b<ul><li><a href="unzip-decompress-huffman.ads.html#unzip-decompress-huffman.ads:42:25" title="To API doc">To API doc</a></li><li><a href="src_unzip-decompress-huffman.ads.html#l42" title="To spec">To spec</a></li></ul></span>&apos;First; </pre></li>
<li id="l182"><pre>            <a href="src_unzip-decompress-huffman.adb.html#l88" title="defined at unzip-decompress-huffman.adb:88:7">offset</a> (<a href="src_unzip-decompress-huffman.adb.html#l68" title="defined at unzip-decompress-huffman.adb:68:7">j</a>) := <a href="src_unzip-decompress-huffman.adb.html#l88" title="defined at unzip-decompress-huffman.adb:88:7">offset</a> (<a href="src_unzip-decompress-huffman.adb.html#l68" title="defined at unzip-decompress-huffman.adb:68:7">j</a>) + 1; </pre></li>
<li id="l183"><pre>         <span class="keyword">end</span> <span class="keyword">if</span>; </pre></li>
<li id="l184"><pre>      <span class="keyword">end</span> <span class="keyword">loop</span>; </pre></li>
<li id="l185"><pre> </pre></li>
<li id="l186"><pre>      <span class="comment">-- Generate huffman codes and for each, make the table entries</span> </pre></li>
<li id="l187"><pre> </pre></li>
<li id="l188"><pre>      <a href="src_unzip-decompress-huffman.adb.html#l88" title="defined at unzip-decompress-huffman.adb:88:15">code_stack</a> (0) := 0; </pre></li>
<li id="l189"><pre>      <a href="src_unzip-decompress-huffman.adb.html#l67" title="defined at unzip-decompress-huffman.adb:67:7">i</a> := 0; </pre></li>
<li id="l190"><pre>      <a href="src_unzip-decompress-huffman.adb.html#l71" title="defined at unzip-decompress-huffman.adb:71:14">v_idx</a> := <a href="src_unzip-decompress-huffman.adb.html#l83" title="defined at unzip-decompress-huffman.adb:83:7">v</a>&apos;First; </pre></li>
<li id="l191"><pre>      <a href="src_unzip-decompress-huffman.adb.html#l91" title="defined at unzip-decompress-huffman.adb:91:7">bits</a> (-1) := 0; </pre></li>
<li id="l192"><pre> </pre></li>
<li id="l193"><pre>      <span class="comment">-- go through the bit lengths (kcc already is bits in shortest code)</span> </pre></li>
<li id="l194"><pre>      <span class="keyword">for</span> k <span class="keyword">in</span> <a href="src_unzip-decompress-huffman.adb.html#l69" title="defined at unzip-decompress-huffman.adb:69:7">kcc</a> .. <a href="src_unzip-decompress-huffman.adb.html#l66" title="defined at unzip-decompress-huffman.adb:66:7">g</a> <span class="keyword">loop</span> </pre></li>
<li id="l195"><pre> </pre></li>
<li id="l196"><pre>         <span class="keyword">for</span> am1 <span class="keyword">in</span> <span class="keyword">reverse</span> 0 .. <a href="src_unzip-decompress-huffman.adb.html#l63" title="defined at unzip-decompress-huffman.adb:63:7">count</a> (k) - 1 <span class="keyword">loop</span> <span class="comment">-- a counts codes of length k</span> </pre></li>
<li id="l197"><pre> </pre></li>
<li id="l198"><pre>            <span class="comment">-- here i is the huffman code of length k bits for value v (v_idx)</span> </pre></li>
<li id="l199"><pre>            <span class="keyword">while</span> k &gt; <a href="src_unzip-decompress-huffman.adb.html#l86" title="defined at unzip-decompress-huffman.adb:86:7">w</a> + <a href="src_unzip-decompress-huffman.adb.html#l91" title="defined at unzip-decompress-huffman.adb:91:7">bits</a> (<a href="src_unzip-decompress-huffman.adb.html#l90" title="defined at unzip-decompress-huffman.adb:90:7">table_level</a>) <span class="keyword">loop</span> </pre></li>
<li id="l200"><pre> </pre></li>
<li id="l201"><pre>               <a href="src_unzip-decompress-huffman.adb.html#l86" title="defined at unzip-decompress-huffman.adb:86:7">w</a> := <a href="src_unzip-decompress-huffman.adb.html#l86" title="defined at unzip-decompress-huffman.adb:86:7">w</a> + <a href="src_unzip-decompress-huffman.adb.html#l91" title="defined at unzip-decompress-huffman.adb:91:7">bits</a> (<a href="src_unzip-decompress-huffman.adb.html#l90" title="defined at unzip-decompress-huffman.adb:90:7">table_level</a>);    <span class="comment">-- Length of tables to this position</span> </pre></li>
<li id="l202"><pre>               <a href="src_unzip-decompress-huffman.adb.html#l90" title="defined at unzip-decompress-huffman.adb:90:7">table_level</a> := <a href="src_unzip-decompress-huffman.adb.html#l90" title="defined at unzip-decompress-huffman.adb:90:7">table_level</a> + 1; </pre></li>
<li id="l203"><pre>               <a href="src_unzip-decompress-huffman.adb.html#l95" title="defined at unzip-decompress-huffman.adb:95:7">z</a> := <a href="src_unzip-decompress-huffman.adb.html#l66" title="defined at unzip-decompress-huffman.adb:66:7">g</a> - <a href="src_unzip-decompress-huffman.adb.html#l86" title="defined at unzip-decompress-huffman.adb:86:7">w</a>;                    <span class="comment">-- Compute min size table &lt;= m bits</span> </pre></li>
<li id="l204"><pre>               <span class="keyword">if</span> <a href="src_unzip-decompress-huffman.adb.html#l95" title="defined at unzip-decompress-huffman.adb:95:7">z</a> &gt; <span class="droplink">m<ul><li><a href="unzip-decompress-huffman.ads.html#unzip-decompress-huffman.ads:46:26" title="To API doc">To API doc</a></li><li><a href="src_unzip-decompress-huffman.ads.html#l46" title="To spec">To spec</a></li></ul></span> <span class="keyword">then</span> </pre></li>
<li id="l205"><pre>                  <a href="src_unzip-decompress-huffman.adb.html#l95" title="defined at unzip-decompress-huffman.adb:95:7">z</a> := <span class="droplink">m<ul><li><a href="unzip-decompress-huffman.ads.html#unzip-decompress-huffman.ads:46:26" title="To API doc">To API doc</a></li><li><a href="src_unzip-decompress-huffman.ads.html#l46" title="To spec">To spec</a></li></ul></span>; </pre></li>
<li id="l206"><pre>               <span class="keyword">end</span> <span class="keyword">if</span>; </pre></li>
<li id="l207"><pre>               <a href="src_unzip-decompress-huffman.adb.html#l68" title="defined at unzip-decompress-huffman.adb:68:7">j</a> := k - <a href="src_unzip-decompress-huffman.adb.html#l86" title="defined at unzip-decompress-huffman.adb:86:7">w</a>; </pre></li>
<li id="l208"><pre>               <a href="src_unzip-decompress-huffman.adb.html#l65" title="defined at unzip-decompress-huffman.adb:65:7">f</a> := Integer (Shift_Left (Unsigned_32&apos;(1), <a href="src_unzip-decompress-huffman.adb.html#l68" title="defined at unzip-decompress-huffman.adb:68:7">j</a>)); <span class="comment">-- f := 2 ** j;</span> </pre></li>
<li id="l209"><pre>               <span class="keyword">if</span> <a href="src_unzip-decompress-huffman.adb.html#l65" title="defined at unzip-decompress-huffman.adb:65:7">f</a> &gt; am1 + 2 <span class="keyword">then</span>   <span class="comment">-- Try a k - w bit table</span> </pre></li>
<li id="l210"><pre>                  <a href="src_unzip-decompress-huffman.adb.html#l65" title="defined at unzip-decompress-huffman.adb:65:7">f</a> := <a href="src_unzip-decompress-huffman.adb.html#l65" title="defined at unzip-decompress-huffman.adb:65:7">f</a> - (am1 + 2); </pre></li>
<li id="l211"><pre>                  <a href="src_unzip-decompress-huffman.adb.html#l71" title="defined at unzip-decompress-huffman.adb:71:7">c_idx</a> := k; </pre></li>
<li id="l212"><pre>                  <span class="keyword">loop</span>              <span class="comment">-- Try smaller tables up to z bits</span> </pre></li>
<li id="l213"><pre>                     <a href="src_unzip-decompress-huffman.adb.html#l68" title="defined at unzip-decompress-huffman.adb:68:7">j</a> := <a href="src_unzip-decompress-huffman.adb.html#l68" title="defined at unzip-decompress-huffman.adb:68:7">j</a> + 1; </pre></li>
<li id="l214"><pre>                     <span class="keyword">exit</span> <span class="keyword">when</span> <a href="src_unzip-decompress-huffman.adb.html#l68" title="defined at unzip-decompress-huffman.adb:68:7">j</a> &gt;= <a href="src_unzip-decompress-huffman.adb.html#l95" title="defined at unzip-decompress-huffman.adb:95:7">z</a>; </pre></li>
<li id="l215"><pre>                     <a href="src_unzip-decompress-huffman.adb.html#l65" title="defined at unzip-decompress-huffman.adb:65:7">f</a> := <a href="src_unzip-decompress-huffman.adb.html#l65" title="defined at unzip-decompress-huffman.adb:65:7">f</a> * 2; </pre></li>
<li id="l216"><pre>                     <a href="src_unzip-decompress-huffman.adb.html#l71" title="defined at unzip-decompress-huffman.adb:71:7">c_idx</a> := <a href="src_unzip-decompress-huffman.adb.html#l71" title="defined at unzip-decompress-huffman.adb:71:7">c_idx</a> + 1; </pre></li>
<li id="l217"><pre>                     <span class="keyword">exit</span> <span class="keyword">when</span> <a href="src_unzip-decompress-huffman.adb.html#l65" title="defined at unzip-decompress-huffman.adb:65:7">f</a> - <a href="src_unzip-decompress-huffman.adb.html#l63" title="defined at unzip-decompress-huffman.adb:63:7">count</a> (<a href="src_unzip-decompress-huffman.adb.html#l71" title="defined at unzip-decompress-huffman.adb:71:7">c_idx</a>) &lt;= 0; </pre></li>
<li id="l218"><pre>                     <a href="src_unzip-decompress-huffman.adb.html#l65" title="defined at unzip-decompress-huffman.adb:65:7">f</a> := <a href="src_unzip-decompress-huffman.adb.html#l65" title="defined at unzip-decompress-huffman.adb:65:7">f</a> - <a href="src_unzip-decompress-huffman.adb.html#l63" title="defined at unzip-decompress-huffman.adb:63:7">count</a> (<a href="src_unzip-decompress-huffman.adb.html#l71" title="defined at unzip-decompress-huffman.adb:71:7">c_idx</a>); </pre></li>
<li id="l219"><pre>                  <span class="keyword">end</span> <span class="keyword">loop</span>; </pre></li>
<li id="l220"><pre>               <span class="keyword">end</span> <span class="keyword">if</span>; </pre></li>
<li id="l221"><pre> </pre></li>
<li id="l222"><pre>               <span class="keyword">if</span> <a href="src_unzip-decompress-huffman.adb.html#l86" title="defined at unzip-decompress-huffman.adb:86:7">w</a> + <a href="src_unzip-decompress-huffman.adb.html#l68" title="defined at unzip-decompress-huffman.adb:68:7">j</a> &gt; <a href="src_unzip-decompress-huffman.adb.html#l96" title="defined at unzip-decompress-huffman.adb:96:7">el</a> <span class="keyword">and</span> <span class="keyword">then</span>  <a href="src_unzip-decompress-huffman.adb.html#l86" title="defined at unzip-decompress-huffman.adb:86:7">w</a> &lt; <a href="src_unzip-decompress-huffman.adb.html#l96" title="defined at unzip-decompress-huffman.adb:96:7">el</a>  <span class="keyword">then</span> </pre></li>
<li id="l223"><pre>                  <a href="src_unzip-decompress-huffman.adb.html#l68" title="defined at unzip-decompress-huffman.adb:68:7">j</a> := <a href="src_unzip-decompress-huffman.adb.html#l96" title="defined at unzip-decompress-huffman.adb:96:7">el</a> - <a href="src_unzip-decompress-huffman.adb.html#l86" title="defined at unzip-decompress-huffman.adb:86:7">w</a>;       <span class="comment">-- Make EOB code end at table</span> </pre></li>
<li id="l224"><pre>               <span class="keyword">end</span> <span class="keyword">if</span>; </pre></li>
<li id="l225"><pre>               <span class="keyword">if</span> <a href="src_unzip-decompress-huffman.adb.html#l86" title="defined at unzip-decompress-huffman.adb:86:7">w</a> = 0 <span class="keyword">then</span> </pre></li>
<li id="l226"><pre>                  <a href="src_unzip-decompress-huffman.adb.html#l68" title="defined at unzip-decompress-huffman.adb:68:7">j</a> := <span class="droplink">m<ul><li><a href="unzip-decompress-huffman.ads.html#unzip-decompress-huffman.ads:46:26" title="To API doc">To API doc</a></li><li><a href="src_unzip-decompress-huffman.ads.html#l46" title="To spec">To spec</a></li></ul></span>;  <span class="comment">-- Fix : main table always m bits!</span> </pre></li>
<li id="l227"><pre>               <span class="keyword">end</span> <span class="keyword">if</span>; </pre></li>
<li id="l228"><pre>               <a href="src_unzip-decompress-huffman.adb.html#l95" title="defined at unzip-decompress-huffman.adb:95:7">z</a> := Integer (Shift_Left (Unsigned_32&apos;(1), <a href="src_unzip-decompress-huffman.adb.html#l68" title="defined at unzip-decompress-huffman.adb:68:7">j</a>)); <span class="comment">-- z := 2 ** j;</span> </pre></li>
<li id="l229"><pre>               <a href="src_unzip-decompress-huffman.adb.html#l91" title="defined at unzip-decompress-huffman.adb:91:7">bits</a> (<a href="src_unzip-decompress-huffman.adb.html#l90" title="defined at unzip-decompress-huffman.adb:90:7">table_level</a>) := <a href="src_unzip-decompress-huffman.adb.html#l68" title="defined at unzip-decompress-huffman.adb:68:7">j</a>; </pre></li>
<li id="l230"><pre> </pre></li>
<li id="l231"><pre>               <span class="comment">-- Allocate and link new table</span> </pre></li>
<li id="l232"><pre> </pre></li>
<li id="l233"><pre>               <span class="keyword">begin</span> </pre></li>
<li id="l234"><pre>                  <a href="src_unzip-decompress-huffman.adb.html#l73" title="defined at unzip-decompress-huffman.adb:73:7">current_table_ptr</a> := <span class="keyword">new</span> <span class="droplink">HufT_table<ul><li><a href="unzip-decompress-huffman.ads.html#unzip-decompress-huffman.ads:8:8" title="To API doc">To API doc</a></li><li><a href="src_unzip-decompress-huffman.ads.html#l8" title="To spec">To spec</a></li></ul></span> (0 .. <a href="src_unzip-decompress-huffman.adb.html#l95" title="defined at unzip-decompress-huffman.adb:95:7">z</a>); </pre></li>
<li id="l235"><pre>                  <a href="src_unzip-decompress-huffman.adb.html#l75" title="defined at unzip-decompress-huffman.adb:75:7">new_node_ptr</a>      := <span class="keyword">new</span> <span class="droplink">Table_list<ul><li><a href="unzip-decompress-huffman.ads.html#unzip-decompress-huffman.ads:26:8" title="To API doc">To API doc</a></li><li><a href="src_unzip-decompress-huffman.ads.html#l26" title="To spec">To spec</a></li><li><a href="src_unzip-decompress-huffman.ads.html#l29" title="To body">To body</a></li></ul></span>&apos;(<a href="src_unzip-decompress-huffman.adb.html#l73" title="defined at unzip-decompress-huffman.adb:73:7">current_table_ptr</a>, <span class="keyword">null</span>); </pre></li>
<li id="l236"><pre>               <span class="keyword">exception</span> </pre></li>
<li id="l237"><pre>                  <span class="keyword">when</span> Storage_Error =&gt; </pre></li>
<li id="l238"><pre>                     <span class="keyword">raise</span> <span class="droplink">huft_out_of_memory<ul><li><a href="unzip-decompress-huffman.ads.html#unzip-decompress-huffman.ads:51:3" title="To API doc">To API doc</a></li><li><a href="src_unzip-decompress-huffman.ads.html#l51" title="To spec">To spec</a></li></ul></span>; </pre></li>
<li id="l239"><pre>               <span class="keyword">end</span>; </pre></li>
<li id="l240"><pre> </pre></li>
<li id="l241"><pre>               <span class="keyword">if</span> <a href="src_unzip-decompress-huffman.adb.html#l74" title="defined at unzip-decompress-huffman.adb:74:7">current_node_ptr</a> = <span class="keyword">null</span> <span class="keyword">then</span> <span class="comment">-- first table</span> </pre></li>
<li id="l242"><pre>                  <span class="droplink">tl<ul><li><a href="unzip-decompress-huffman.ads.html#unzip-decompress-huffman.ads:45:26" title="To API doc">To API doc</a></li><li><a href="src_unzip-decompress-huffman.ads.html#l45" title="To spec">To spec</a></li></ul></span> := <a href="src_unzip-decompress-huffman.adb.html#l75" title="defined at unzip-decompress-huffman.adb:75:7">new_node_ptr</a>; </pre></li>
<li id="l243"><pre>               <span class="keyword">else</span> </pre></li>
<li id="l244"><pre>                  <a href="src_unzip-decompress-huffman.adb.html#l74" title="defined at unzip-decompress-huffman.adb:74:7">current_node_ptr</a>.<span class="keyword">all</span>.next := <a href="src_unzip-decompress-huffman.adb.html#l75" title="defined at unzip-decompress-huffman.adb:75:7">new_node_ptr</a>;   <span class="comment">-- not my first .. .</span> </pre></li>
<li id="l245"><pre>               <span class="keyword">end</span> <span class="keyword">if</span>; </pre></li>
<li id="l246"><pre> </pre></li>
<li id="l247"><pre>               <a href="src_unzip-decompress-huffman.adb.html#l74" title="defined at unzip-decompress-huffman.adb:74:7">current_node_ptr</a> := <a href="src_unzip-decompress-huffman.adb.html#l75" title="defined at unzip-decompress-huffman.adb:75:7">new_node_ptr</a>; <span class="comment">-- always non - Null from there</span> </pre></li>
<li id="l248"><pre> </pre></li>
<li id="l249"><pre>               <a href="src_unzip-decompress-huffman.adb.html#l79" title="defined at unzip-decompress-huffman.adb:79:7">u</a> (<a href="src_unzip-decompress-huffman.adb.html#l90" title="defined at unzip-decompress-huffman.adb:90:7">table_level</a>) := <a href="src_unzip-decompress-huffman.adb.html#l73" title="defined at unzip-decompress-huffman.adb:73:7">current_table_ptr</a>; </pre></li>
<li id="l250"><pre> </pre></li>
<li id="l251"><pre>               <span class="comment">-- Connect to last table, if there is one</span> </pre></li>
<li id="l252"><pre> </pre></li>
<li id="l253"><pre>               <span class="keyword">if</span> <a href="src_unzip-decompress-huffman.adb.html#l90" title="defined at unzip-decompress-huffman.adb:90:7">table_level</a> &gt; 0 <span class="keyword">then</span> </pre></li>
<li id="l254"><pre>                  <a href="src_unzip-decompress-huffman.adb.html#l88" title="defined at unzip-decompress-huffman.adb:88:15">code_stack</a> (<a href="src_unzip-decompress-huffman.adb.html#l90" title="defined at unzip-decompress-huffman.adb:90:7">table_level</a>) := <a href="src_unzip-decompress-huffman.adb.html#l67" title="defined at unzip-decompress-huffman.adb:67:7">i</a>; </pre></li>
<li id="l255"><pre>                  new_entry.bits          := <a href="src_unzip-decompress-huffman.adb.html#l91" title="defined at unzip-decompress-huffman.adb:91:7">bits</a> (<a href="src_unzip-decompress-huffman.adb.html#l90" title="defined at unzip-decompress-huffman.adb:90:7">table_level</a> - 1); </pre></li>
<li id="l256"><pre>                  new_entry.extra_bits    := 16 + <a href="src_unzip-decompress-huffman.adb.html#l68" title="defined at unzip-decompress-huffman.adb:68:7">j</a>; </pre></li>
<li id="l257"><pre>                  new_entry.next_table    := <a href="src_unzip-decompress-huffman.adb.html#l73" title="defined at unzip-decompress-huffman.adb:73:7">current_table_ptr</a>; </pre></li>
<li id="l258"><pre> </pre></li>
<li id="l259"><pre>                  <a href="src_unzip-decompress-huffman.adb.html#l68" title="defined at unzip-decompress-huffman.adb:68:7">j</a> :=  Integer ( </pre></li>
<li id="l260"><pre>                                 Shift_Right (Unsigned_32 (<a href="src_unzip-decompress-huffman.adb.html#l67" title="defined at unzip-decompress-huffman.adb:67:7">i</a>) <span class="keyword">and</span> </pre></li>
<li id="l261"><pre>                                     (Shift_Left (Unsigned_32&apos;(1), <a href="src_unzip-decompress-huffman.adb.html#l86" title="defined at unzip-decompress-huffman.adb:86:7">w</a>) - 1), </pre></li>
<li id="l262"><pre>                                   <a href="src_unzip-decompress-huffman.adb.html#l86" title="defined at unzip-decompress-huffman.adb:86:7">w</a> - <a href="src_unzip-decompress-huffman.adb.html#l91" title="defined at unzip-decompress-huffman.adb:91:7">bits</a> (<a href="src_unzip-decompress-huffman.adb.html#l90" title="defined at unzip-decompress-huffman.adb:90:7">table_level</a> - 1)) </pre></li>
<li id="l263"><pre>                                ); </pre></li>
<li id="l264"><pre> </pre></li>
<li id="l265"><pre>                  <span class="comment">-- Test against bad input!</span> </pre></li>
<li id="l266"><pre> </pre></li>
<li id="l267"><pre>                  <span class="keyword">if</span> <a href="src_unzip-decompress-huffman.adb.html#l68" title="defined at unzip-decompress-huffman.adb:68:7">j</a> &gt; <a href="src_unzip-decompress-huffman.adb.html#l79" title="defined at unzip-decompress-huffman.adb:79:7">u</a> (<a href="src_unzip-decompress-huffman.adb.html#l90" title="defined at unzip-decompress-huffman.adb:90:7">table_level</a> - 1)&apos;Last <span class="keyword">then</span> </pre></li>
<li id="l268"><pre>                     <span class="keyword">raise</span> <span class="droplink">huft_error<ul><li><a href="unzip-decompress-huffman.ads.html#unzip-decompress-huffman.ads:50:3" title="To API doc">To API doc</a></li><li><a href="src_unzip-decompress-huffman.ads.html#l50" title="To spec">To spec</a></li></ul></span>; </pre></li>
<li id="l269"><pre>                  <span class="keyword">end</span> <span class="keyword">if</span>; </pre></li>
<li id="l270"><pre>                  <a href="src_unzip-decompress-huffman.adb.html#l79" title="defined at unzip-decompress-huffman.adb:79:7">u</a> (<a href="src_unzip-decompress-huffman.adb.html#l90" title="defined at unzip-decompress-huffman.adb:90:7">table_level</a> - 1).<span class="keyword">all</span> (<a href="src_unzip-decompress-huffman.adb.html#l68" title="defined at unzip-decompress-huffman.adb:68:7">j</a>) := <a href="src_unzip-decompress-huffman.adb.html#l77" title="defined at unzip-decompress-huffman.adb:77:7">new_entry</a>; </pre></li>
<li id="l271"><pre>               <span class="keyword">end</span> <span class="keyword">if</span>; </pre></li>
<li id="l272"><pre> </pre></li>
<li id="l273"><pre>            <span class="keyword">end</span> <span class="keyword">loop</span>; </pre></li>
<li id="l274"><pre> </pre></li>
<li id="l275"><pre>            <span class="comment">-- Set up table entry in new_entry</span> </pre></li>
<li id="l276"><pre> </pre></li>
<li id="l277"><pre>            new_entry.bits      := k - <a href="src_unzip-decompress-huffman.adb.html#l86" title="defined at unzip-decompress-huffman.adb:86:7">w</a>; </pre></li>
<li id="l278"><pre>            new_entry.next_table := <span class="keyword">null</span>;   <span class="comment">-- Unused</span> </pre></li>
<li id="l279"><pre> </pre></li>
<li id="l280"><pre>            <span class="keyword">if</span> <a href="src_unzip-decompress-huffman.adb.html#l71" title="defined at unzip-decompress-huffman.adb:71:14">v_idx</a> &gt;= <span class="droplink">b<ul><li><a href="unzip-decompress-huffman.ads.html#unzip-decompress-huffman.ads:42:25" title="To API doc">To API doc</a></li><li><a href="src_unzip-decompress-huffman.ads.html#l42" title="To spec">To spec</a></li></ul></span>&apos;Length <span class="keyword">then</span> </pre></li>
<li id="l281"><pre>               new_entry.extra_bits := <span class="droplink">invalid<ul><li><a href="unzip-decompress-huffman.ads.html#unzip-decompress-huffman.ads:18:3" title="To API doc">To API doc</a></li><li><a href="src_unzip-decompress-huffman.ads.html#l18" title="To spec">To spec</a></li></ul></span>; </pre></li>
<li id="l282"><pre>            <span class="keyword">else</span> </pre></li>
<li id="l283"><pre>               <a href="src_unzip-decompress-huffman.adb.html#l84" title="defined at unzip-decompress-huffman.adb:84:7">el_v</a> := <a href="src_unzip-decompress-huffman.adb.html#l83" title="defined at unzip-decompress-huffman.adb:83:7">v</a> (<a href="src_unzip-decompress-huffman.adb.html#l71" title="defined at unzip-decompress-huffman.adb:71:14">v_idx</a>); </pre></li>
<li id="l284"><pre>               <a href="src_unzip-decompress-huffman.adb.html#l84" title="defined at unzip-decompress-huffman.adb:84:13">el_v_m_s</a> := <a href="src_unzip-decompress-huffman.adb.html#l84" title="defined at unzip-decompress-huffman.adb:84:7">el_v</a> - <span class="droplink">s<ul><li><a href="unzip-decompress-huffman.ads.html#unzip-decompress-huffman.ads:43:26" title="To API doc">To API doc</a></li><li><a href="src_unzip-decompress-huffman.ads.html#l43" title="To spec">To spec</a></li></ul></span>; </pre></li>
<li id="l285"><pre>               <span class="keyword">if</span> <a href="src_unzip-decompress-huffman.adb.html#l84" title="defined at unzip-decompress-huffman.adb:84:13">el_v_m_s</a> &lt; 0 <span class="keyword">then</span> <span class="comment">-- Simple code, raw value</span> </pre></li>
<li id="l286"><pre>                  <span class="keyword">if</span> <a href="src_unzip-decompress-huffman.adb.html#l84" title="defined at unzip-decompress-huffman.adb:84:7">el_v</a> &lt; 256 <span class="keyword">then</span> </pre></li>
<li id="l287"><pre>                     new_entry.extra_bits := 16; </pre></li>
<li id="l288"><pre>                  <span class="keyword">else</span> </pre></li>
<li id="l289"><pre>                     new_entry.extra_bits := 15; </pre></li>
<li id="l290"><pre>                  <span class="keyword">end</span> <span class="keyword">if</span>; </pre></li>
<li id="l291"><pre>                  new_entry.n := <a href="src_unzip-decompress-huffman.adb.html#l84" title="defined at unzip-decompress-huffman.adb:84:7">el_v</a>; </pre></li>
<li id="l292"><pre>               <span class="keyword">else</span>                    <span class="comment">-- Non - simple - &gt; lookup in lists</span> </pre></li>
<li id="l293"><pre>                  <span class="keyword">if</span> <a href="src_unzip-decompress-huffman.adb.html#l98" title="defined at unzip-decompress-huffman.adb:98:7">no_copy_length_array</a> <span class="keyword">then</span> </pre></li>
<li id="l294"><pre>                     <span class="keyword">raise</span> <span class="droplink">huft_error<ul><li><a href="unzip-decompress-huffman.ads.html#unzip-decompress-huffman.ads:50:3" title="To API doc">To API doc</a></li><li><a href="src_unzip-decompress-huffman.ads.html#l50" title="To spec">To spec</a></li></ul></span>; </pre></li>
<li id="l295"><pre>                  <span class="keyword">end</span> <span class="keyword">if</span>; </pre></li>
<li id="l296"><pre>                  new_entry.extra_bits := <span class="droplink">e<ul><li><a href="unzip-decompress-huffman.ads.html#unzip-decompress-huffman.ads:44:29" title="To API doc">To API doc</a></li><li><a href="src_unzip-decompress-huffman.ads.html#l44" title="To spec">To spec</a></li></ul></span> (<a href="src_unzip-decompress-huffman.adb.html#l84" title="defined at unzip-decompress-huffman.adb:84:13">el_v_m_s</a>); </pre></li>
<li id="l297"><pre>                  new_entry.n          := <span class="droplink">d<ul><li><a href="unzip-decompress-huffman.ads.html#unzip-decompress-huffman.ads:44:26" title="To API doc">To API doc</a></li><li><a href="src_unzip-decompress-huffman.ads.html#l44" title="To spec">To spec</a></li></ul></span> (<a href="src_unzip-decompress-huffman.adb.html#l84" title="defined at unzip-decompress-huffman.adb:84:13">el_v_m_s</a>); </pre></li>
<li id="l298"><pre>               <span class="keyword">end</span> <span class="keyword">if</span>; </pre></li>
<li id="l299"><pre>               <a href="src_unzip-decompress-huffman.adb.html#l71" title="defined at unzip-decompress-huffman.adb:71:14">v_idx</a> := <a href="src_unzip-decompress-huffman.adb.html#l71" title="defined at unzip-decompress-huffman.adb:71:14">v_idx</a> + 1; </pre></li>
<li id="l300"><pre>            <span class="keyword">end</span> <span class="keyword">if</span>; </pre></li>
<li id="l301"><pre> </pre></li>
<li id="l302"><pre>            <span class="comment">-- fill code - like entries with new_entry</span> </pre></li>
<li id="l303"><pre>            <a href="src_unzip-decompress-huffman.adb.html#l65" title="defined at unzip-decompress-huffman.adb:65:7">f</a> := Integer (Shift_Left (Unsigned_32&apos;(1), k - <a href="src_unzip-decompress-huffman.adb.html#l86" title="defined at unzip-decompress-huffman.adb:86:7">w</a>)); </pre></li>
<li id="l304"><pre>            <span class="comment">-- i.e. f := 2 ** (k - w);</span> </pre></li>
<li id="l305"><pre>            <a href="src_unzip-decompress-huffman.adb.html#l68" title="defined at unzip-decompress-huffman.adb:68:7">j</a> := Integer (Shift_Right (Unsigned_32 (<a href="src_unzip-decompress-huffman.adb.html#l67" title="defined at unzip-decompress-huffman.adb:67:7">i</a>), <a href="src_unzip-decompress-huffman.adb.html#l86" title="defined at unzip-decompress-huffman.adb:86:7">w</a>)); </pre></li>
<li id="l306"><pre>            <span class="keyword">while</span> <a href="src_unzip-decompress-huffman.adb.html#l68" title="defined at unzip-decompress-huffman.adb:68:7">j</a> &lt; <a href="src_unzip-decompress-huffman.adb.html#l95" title="defined at unzip-decompress-huffman.adb:95:7">z</a> <span class="keyword">loop</span> </pre></li>
<li id="l307"><pre>               <a href="src_unzip-decompress-huffman.adb.html#l73" title="defined at unzip-decompress-huffman.adb:73:7">current_table_ptr</a>.<span class="keyword">all</span> (<a href="src_unzip-decompress-huffman.adb.html#l68" title="defined at unzip-decompress-huffman.adb:68:7">j</a>) := <a href="src_unzip-decompress-huffman.adb.html#l77" title="defined at unzip-decompress-huffman.adb:77:7">new_entry</a>; </pre></li>
<li id="l308"><pre>               <a href="src_unzip-decompress-huffman.adb.html#l68" title="defined at unzip-decompress-huffman.adb:68:7">j</a> := <a href="src_unzip-decompress-huffman.adb.html#l68" title="defined at unzip-decompress-huffman.adb:68:7">j</a> + <a href="src_unzip-decompress-huffman.adb.html#l65" title="defined at unzip-decompress-huffman.adb:65:7">f</a>; </pre></li>
<li id="l309"><pre>            <span class="keyword">end</span> <span class="keyword">loop</span>; </pre></li>
<li id="l310"><pre> </pre></li>
<li id="l311"><pre>            <span class="comment">-- backwards increment the k - bit code i</span> </pre></li>
<li id="l312"><pre>            <a href="src_unzip-decompress-huffman.adb.html#l68" title="defined at unzip-decompress-huffman.adb:68:7">j</a> := Integer (Shift_Left (Unsigned_32&apos;(1), k - 1)); </pre></li>
<li id="l313"><pre>            <span class="comment">-- i.e. : j := 2 ** (k - 1)</span> </pre></li>
<li id="l314"><pre>            <span class="keyword">while</span> (Unsigned_32 (<a href="src_unzip-decompress-huffman.adb.html#l67" title="defined at unzip-decompress-huffman.adb:67:7">i</a>) <span class="keyword">and</span> Unsigned_32 (<a href="src_unzip-decompress-huffman.adb.html#l68" title="defined at unzip-decompress-huffman.adb:68:7">j</a>)) /= 0 <span class="keyword">loop</span> </pre></li>
<li id="l315"><pre>               <a href="src_unzip-decompress-huffman.adb.html#l67" title="defined at unzip-decompress-huffman.adb:67:7">i</a> := Integer (Unsigned_32 (<a href="src_unzip-decompress-huffman.adb.html#l67" title="defined at unzip-decompress-huffman.adb:67:7">i</a>) <span class="keyword">xor</span> Unsigned_32 (<a href="src_unzip-decompress-huffman.adb.html#l68" title="defined at unzip-decompress-huffman.adb:68:7">j</a>)); </pre></li>
<li id="l316"><pre>               <a href="src_unzip-decompress-huffman.adb.html#l68" title="defined at unzip-decompress-huffman.adb:68:7">j</a> :=  <a href="src_unzip-decompress-huffman.adb.html#l68" title="defined at unzip-decompress-huffman.adb:68:7">j</a> / 2; </pre></li>
<li id="l317"><pre>            <span class="keyword">end</span> <span class="keyword">loop</span>; </pre></li>
<li id="l318"><pre>            <a href="src_unzip-decompress-huffman.adb.html#l67" title="defined at unzip-decompress-huffman.adb:67:7">i</a> := Integer (Unsigned_32 (<a href="src_unzip-decompress-huffman.adb.html#l67" title="defined at unzip-decompress-huffman.adb:67:7">i</a>) <span class="keyword">xor</span> Unsigned_32 (<a href="src_unzip-decompress-huffman.adb.html#l68" title="defined at unzip-decompress-huffman.adb:68:7">j</a>)); </pre></li>
<li id="l319"><pre> </pre></li>
<li id="l320"><pre>            <span class="comment">-- backup over finished tables</span> </pre></li>
<li id="l321"><pre>            <span class="keyword">while</span> </pre></li>
<li id="l322"><pre>              Integer (Unsigned_32 (<a href="src_unzip-decompress-huffman.adb.html#l67" title="defined at unzip-decompress-huffman.adb:67:7">i</a>) <span class="keyword">and</span> (Shift_Left (1, <a href="src_unzip-decompress-huffman.adb.html#l86" title="defined at unzip-decompress-huffman.adb:86:7">w</a>) - 1)) /= </pre></li>
<li id="l323"><pre>              <a href="src_unzip-decompress-huffman.adb.html#l88" title="defined at unzip-decompress-huffman.adb:88:15">code_stack</a> (<a href="src_unzip-decompress-huffman.adb.html#l90" title="defined at unzip-decompress-huffman.adb:90:7">table_level</a>) </pre></li>
<li id="l324"><pre>            <span class="keyword">loop</span> </pre></li>
<li id="l325"><pre>               <a href="src_unzip-decompress-huffman.adb.html#l90" title="defined at unzip-decompress-huffman.adb:90:7">table_level</a> := <a href="src_unzip-decompress-huffman.adb.html#l90" title="defined at unzip-decompress-huffman.adb:90:7">table_level</a> - 1; </pre></li>
<li id="l326"><pre>               <a href="src_unzip-decompress-huffman.adb.html#l86" title="defined at unzip-decompress-huffman.adb:86:7">w</a> := <a href="src_unzip-decompress-huffman.adb.html#l86" title="defined at unzip-decompress-huffman.adb:86:7">w</a> - <a href="src_unzip-decompress-huffman.adb.html#l91" title="defined at unzip-decompress-huffman.adb:91:7">bits</a> (<a href="src_unzip-decompress-huffman.adb.html#l90" title="defined at unzip-decompress-huffman.adb:90:7">table_level</a>); <span class="comment">-- Size of previous table!</span> </pre></li>
<li id="l327"><pre>            <span class="keyword">end</span> <span class="keyword">loop</span>; </pre></li>
<li id="l328"><pre> </pre></li>
<li id="l329"><pre>         <span class="keyword">end</span> <span class="keyword">loop</span>;  <span class="comment">-- am1</span> </pre></li>
<li id="l330"><pre>      <span class="keyword">end</span> <span class="keyword">loop</span>;  <span class="comment">-- k</span> </pre></li>
<li id="l331"><pre> </pre></li>
<li id="l332"><pre>      <span class="keyword">if</span> <span class="droplink">full_trace<ul><li><a href="unzip-decompress.ads.html#unzip-decompress.ads:51:3" title="To API doc">To API doc</a></li><li><a href="src_unzip-decompress.ads.html#l51" title="To spec">To spec</a></li></ul></span> <span class="keyword">then</span> </pre></li>
<li id="l333"><pre>         <span class="keyword">pragma</span> Warnings (Off, <span class="string">&quot;this code can never be executed and has been deleted&quot;</span>); </pre></li>
<li id="l334"><pre>         Ada.Text_IO.Put_Line (<span class="string">&quot;finished]&quot;</span>); </pre></li>
<li id="l335"><pre>         <span class="keyword">pragma</span> Warnings (On,  <span class="string">&quot;this code can never be executed and has been deleted&quot;</span>); </pre></li>
<li id="l336"><pre>      <span class="keyword">end</span> <span class="keyword">if</span>; </pre></li>
<li id="l337"><pre> </pre></li>
<li id="l338"><pre>      <span class="droplink">huft_incomplete<ul><li><a href="unzip-decompress-huffman.ads.html#unzip-decompress-huffman.ads:47:15" title="To API doc">To API doc</a></li><li><a href="src_unzip-decompress-huffman.ads.html#l47" title="To spec">To spec</a></li></ul></span> := <a href="src_unzip-decompress-huffman.adb.html#l94" title="defined at unzip-decompress-huffman.adb:94:7">y</a> /= 0 <span class="keyword">and</span> <span class="keyword">then</span> <a href="src_unzip-decompress-huffman.adb.html#l66" title="defined at unzip-decompress-huffman.adb:66:7">g</a> /= 1; </pre></li>
<li id="l339"><pre> </pre></li>
<li id="l340"><pre>   <span class="keyword">exception</span> </pre></li>
<li id="l341"><pre>      <span class="keyword">when</span> <span class="keyword">others</span> =&gt; </pre></li>
<li id="l342"><pre>         <span class="droplink">HufT_free<ul><li><a href="unzip-decompress-huffman.ads.html#unzip-decompress-huffman.ads:39:13" title="To API doc">To API doc</a></li><li><a href="src_unzip-decompress-huffman.ads.html#l39" title="To spec">To spec</a></li><li><a href="src_unzip-decompress-huffman.adb.html#l13" title="To body">To body</a></li></ul></span> (<span class="droplink">tl<ul><li><a href="unzip-decompress-huffman.ads.html#unzip-decompress-huffman.ads:45:26" title="To API doc">To API doc</a></li><li><a href="src_unzip-decompress-huffman.ads.html#l45" title="To spec">To spec</a></li></ul></span>); </pre></li>
<li id="l343"><pre>         <span class="keyword">raise</span>; </pre></li>
<li id="l344"><pre>   <span class="keyword">end</span> <span class="droplink">HufT_build<ul><li><a href="unzip-decompress-huffman.ads.html#unzip-decompress-huffman.ads:42:13" title="To API doc">To API doc</a></li><li><a href="src_unzip-decompress-huffman.ads.html#l42" title="To spec">To spec</a></li><li><a href="src_unzip-decompress-huffman.adb.html#l50" title="To body">To body</a></li></ul></span>; </pre></li>
<li id="l345"><pre> </pre></li>
<li id="l346"><pre><span class="keyword">end</span> <span class="droplink">UnZip.Decompress.Huffman<ul><li><a href="unzip-decompress-huffman.ads.html#unzip-decompress-huffman.ads:6:34" title="To API doc">To API doc</a></li><li><a href="src_unzip-decompress-huffman.ads.html#l6" title="To spec">To spec</a></li><li><a href="src_unzip-decompress-huffman.adb.html#l5" title="To body">To body</a></li></ul></span>; </pre></li>
</ol></div>
</div>

</body>
</html>